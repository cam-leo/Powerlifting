<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Leo Cam My Github" />

<meta name="date" content="2023-01-22" />

<title>Life Insurance Analysis</title>

<script src="index_files/header-attrs-2.25/header-attrs.js"></script>
<script src="index_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="index_files/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="index_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="index_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="index_files/navigation-1.1/tabsets.js"></script>
<script src="index_files/navigation-1.1/codefolding.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="combined.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#section-TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#section-TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="section-TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="section-header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Life Insurance Analysis</h1>
<h4 class="author">Leo Cam <a
href="https://github.com/cam-leo/index.html">My Github</a></h4>
<h4 class="date">2023-01-22</h4>

</div>


<div class="content-wrapper">
<hr />
<div id="section-introduction" class="section level1">
<h1>Introduction</h1>
<p>This document is divided into four parts, each focusing on different
aspects of financial and actuarial
analysis<sup><a href="#" title="Actuarial analysis involves the application of mathematical and statistical methods to assess risk in insurance, finance, and other industries. Actuaries use this analysis to model and predict future events, such as life expectancy, accident frequency, and financial losses, enabling companies to develop policies and strategies to mitigate potential risks. This process includes evaluating the likelihood of events, estimating their financial impact, and using this information to set premiums, reserves, and other financial metrics. Actuarial analysis is essential for ensuring the financial stability and sustainability of insurance companies and pension plans.">(?)</a></sup>
related to life
insurance<sup><a href="#" title="Life insurance is a contract between an individual and an insurance company. The individual pays regular premiums, and in return, the insurance company promises to pay a specified amount of money to designated beneficiaries upon the insured person's death. This financial protection helps beneficiaries cover expenses such as funeral costs, debts, and living expenses, ensuring financial stability during a difficult time.">(?)</a></sup>.
I am using actuarial analysis because there is lots of data that we can
learn and use from actuaries in overall data analysis. For most key
subjects, there is a small question mark that you can hover over and it
will give you a blurb of information describing what that topic is.
<strong><em>If you want to only see the calculations, you can skip ahead
through the TOC on the left and click on ‘show’ to see the
code</em></strong>:</p>
<hr />
<p><strong>Cash Flows</strong></p>
<p><strong><em>Topic</em></strong>: <em>Present Value
(PV)<sup><a href="#" title="Present Value (PV) represents the current worth of a future sum of money, discounted back to the present using an appropriate discount rate. This concept is rooted in probability theory, where future cash flows are uncertain and thus discounted to reflect the time value of money and the associated risk. Statistical inference techniques help determine appropriate discount rates by analyzing historical data and estimating future uncertainties, such as inflation rates or market risks.">(?)</a></sup>,
Net Present Value
(NPV)<sup><a href="#" title="Net Present Value (NPV) builds upon PV by considering the difference between the present value of cash inflows and outflows over a specified period. NPV incorporates probability theory by assessing the likelihood of achieving expected cash flows, often using statistical methods to model uncertain future outcomes. It serves as a critical decision-making tool, indicating whether an investment or project is expected to generate positive returns after accounting for the time value of money and risk.">(?)</a></sup>,
Accumulated Value
(AV)<sup><a href="#" title="Accumulated Value (AV) refers to the total value of an investment or project at a specific point in time, taking into account all cash flows, including initial investments, returns, and reinvestments. Probability theory assists in forecasting AV by analyzing the distribution of possible future cash flows and their associated uncertainties. Statistical inference techniques, such as Monte Carlo simulations or sensitivity analysis, further refine these forecasts by exploring different scenarios and their impacts on AV over time.">(?)</a></sup>,
Statistical
Inference<sup><a href="#" title="Statistical inference uses data from a sample to make guesses about a larger population. It helps us draw conclusions and make decisions based on limited information.">(?)</a></sup>
and Probability
Theory<sup><a href="#" title="Probability theory is the study of chance. It helps us understand how likely events are to happen, like rolling a die or predicting the weather.">(?)</a></sup></em></p>
<p>Cash flows are fundamental to financial analysis, involving the
movement of money into (income) and out of (expenses) a business or
project over time. The concepts of Present Value (PV), Net Present Value
(NPV), and Accumulated Value (AV) are crucial tools in evaluating these
cash flows, providing insights into their current and future worth.</p>
<p>In summary, integrating statistical inference and probability theory
enhances the analysis of cash flows by providing methods to quantify
uncertainties, estimate future values, and assess risks. PV, NPV, and AV
serve as powerful tools within this framework, enabling informed
financial decisions by accounting for the complex interplay between
time, risk, and value in financial management and investment
evaluation.</p>
<p><strong>Life Tables</strong></p>
<p><strong><em>Topic</em></strong>: <em>Survival
probabilities<sup><a href="#" title="Survival probabilities refer to the likelihood of individuals surviving from one age to the next within a specified population or cohort. These probabilities are fundamental in demography, actuarial science, and medical research, where they are used to analyze and predict how long individuals are expected to live.">(?)</a></sup>,
Probability and Statistics</em></p>
<p>Life tables are foundational in demography and actuarial science,
providing a statistical framework to analyze and predict survival
probabilities within a population. These tables import and organize
mortality data, offering insights into how longevity varies across
different age groups and over time.</p>
<p>Life tables utilize probability theory to estimate survival
probabilities (qx) at various ages. These probabilities represent the
likelihood of individuals surviving from one age to the next, derived
from historical mortality data. Statistical inference techniques are
employed to analyze and interpret these probabilities, including:</p>
<p>Estimation Methods: Statistical methods such as <em>maximum
likelihood
estimation</em><sup><a href="#" title="Maximum Likelihood Estimation (MLE) is a method used to estimate the parameters of a statistical model by maximizing the likelihood function. The likelihood function represents the probability of observing the given data under a specific set of parameter values. MLE selects the parameter values that make the observed data most likely, assuming the model is correct. It is widely used in statistical modeling and inference to find the best-fitting model parameters based on the available data.">(?)</a></sup>
(MLE) or <em>Bayesian
inference</em><sup><a href="#" title="Bayesian inference is a statistical approach that combines prior beliefs or knowledge with observed data to update and quantify uncertainty about a hypothesis or parameter of interest. Unlike frequentist statistics, which focuses on estimating parameters based solely on observed data, Bayesian inference incorporates prior information into the analysis. It provides a framework for updating beliefs as new evidence becomes available, making it especially useful in decision-making under uncertainty.">(?)</a></sup>
are used to derive survival probabilities (qx) from observed mortality
rates
(mx)<sup><a href="#" title="In demography and actuarial science, mx represents the central mortality rate at exact age x within a population. It denotes the probability of dying during a specific age interval, usually expressed as deaths per unit of population at the exact age x. mx values are essential in constructing life tables, survival models, and mortality projections. They provide insights into age-specific mortality patterns and are used to calculate life expectancies, assess insurance risks, and plan for retirement and healthcare needs..">(?)</a></sup>.</p>
<p>Population Dynamics: Statistical analysis of life tables informs
demographic studies, healthcare planning, and insurance risk assessment
by predicting population growth, mortality patterns, and aging
trends.</p>
<p>In summary, probability and statistics play a critical role in
understanding life tables and mortality data sets. They facilitate the
analysis of survival probabilities (qx) and provide valuable insights
into population dynamics, longevity trends, and risk assessment in
various fields, from public health to insurance and pension
planning.</p>
<p><strong>Life Annuities</strong></p>
<p><strong><em>Topic</em></strong>: <em>Generalized Linear Models
(GLMs)<sup><a href="#" title="GLMs are a way to predict outcomes using data. They extend regular linear models to handle different types of data, like counts or categories.">(?)</a></sup>
and Time Series
Analysis<sup><a href="#" title="Time series analysis looks at data collected over time. It helps us find patterns, like trends or cycles, and make forecasts about the future.">(?)</a></sup></em></p>
<p>Life annuities are financial products that provide a stream of
payments to an individual over their lifetime or for a specified period.
Analyzing these annuities involves applying statistical methods such as
Generalized Linear Models (GLMs) and Time Series Analysis to estimate
their present value and expected future payments.</p>
<p>GLMs are utilized to model the relationship between factors like age,
gender and economic conditions with the PV of an annuity. They help
adjust for non-linear relationships and
<em>heteroscedasticity</em><sup><a href="#" title="Heteroscedasticity refers to the unequal variance of errors (or residuals) in a regression model. In simpler terms, it indicates that the variability of the dependent variable (y) is not constant across all levels of the independent variable(s). This violates the assumption of homoscedasticity, where the variability of y is consistent. Heteroscedasticity can affect the accuracy of statistical tests and predictions, requiring adjustments in modeling techniques to account for varying levels of variability.">(?)</a></sup>
in annuity pricing. GLMs also allow for the use of risk factors like
mortality rates
(qx)<sup><a href="#" title="In actuarial science and demography, qx represents the probability of dying within a specified age interval, often referred to as the mortality rate at age x. It is a fundamental measure used in life tables and survival models to analyze and predict the likelihood of death at different ages within a population. qx values are derived from mortality data and are crucial for assessing life expectancy, pricing life insurance products, and evaluating healthcare and pension plans.">(?)</a></sup>,
interest rates and such into pricing models. This way, insurers can
assess and price the risk associated with annuity payments.</p>
<p>Time Series Analysis is another critical tool for analyzing
annuities, particularly for forecasting future payments and assessing
long-term trends:</p>
<p>Models like
ARIMA<sup><a href="#" title="ARIMA is a statistical model used for time series analysis and forecasting. It combines autoregressive (AR), moving average (MA), and differencing components (I for Integrated) to model the temporal structure and patterns in data. ARIMA models are useful for predicting future values based on past observations and are widely applied in economics, finance, and other fields where time-dependent data is analyzed.">(?)</a></sup>
(<em>AutoRegressive Integrated Moving Average</em>) or exponential
smooth models can be used to forecast future cash flows from annuities.
The Expected Present Value (EPV) is calculated as the discounted sum of
expected future payments, incorporating forecasts generated from time
series models. Time series also allow for stochastic modeling of
uncertain factors affecting annuity payments, such as mortality
improvements and economic fluctuations. One such model are the Monte
Carlo
simulations<sup><a href="#" title="Computational techniques used to understand the impact of uncertainty and variability in mathematical, financial, and scientific models. They involve running numerous random simulations based on input variables that have uncertain values. By repeating these simulations many times, Monte Carlo methods provide estimates of possible outcomes and their probabilities.">(?)</a></sup>,
which provide probabilistic forecasts of future annuity cash flows</p>
<p>Application in Financial Decision-Making:</p>
<p>The integration of GLMs and Time Series Analysis enhances the
understanding and management of life annuities. In product design,
statistical models inform the design of annuity products tailored to
demographic trends and customer preferences, ensuring competitive
pricing. In risk management, by quantifying risks and uncertainties
through GLMs and Time Series Analysis, insurers and financial planners
can optimize portfolio allocation and hedging strategies to mitigate
adverse impacts on annuity liabilities</p>
<p>In conclusion, GLMs and Time Series Analysis are powerful tools in
the evaluation and management of life annuities. They facilitate the
calculation of present values (PV) and expected future payments (EPV),
providing insights into pricing dynamics, risk assessment, and strategic
decision-making in insurance and retirement planning.</p>
<p><strong>Life Insurance</strong></p>
<p><strong><em>Topic</em></strong>: <em>Survival
Models<sup><a href="#" title="Survival models predict the time until an event occurs, like how long a patient might live after treatment. They help in planning and understanding risks.">(?)</a></sup>
and Credibility
Theory<sup><a href="#" title="Credibility theory combines past data with new data to make better predictions. It's often used in insurance to set fair premiums based on individual risk.">(?)</a></sup></em></p>
<p>Life insurance products provide financial protection against the risk
of premature death, offering payouts (benefits) to beneficiaries upon
the death of the insured. Analyzing these products involves applying
statistical methods such as Survival Models and Credibility Theory to
assess premiums and estimate their expected future values.</p>
<p>Survival
Models<sup><a href="#" title="Survival models are statistical tools used to analyze and predict the time until an event of interest occurs, such as death, failure of a device, or recurrence of a disease. These models help understand factors influencing survival times and can account for censored data (where the event of interest hasn't occurred for all subjects by the end of the study).">(?)</a></sup>,
such as the
Kaplan-Meier<sup><a href="#" title="The Kaplan-Meier estimator is a statistical method used to estimate the probability of survival over time. It's often used in medical and biological studies to analyze how long patients survive after treatment or diagnosis. It calculates survival probabilities based on observed data, especially when not all individuals have experienced the event of interest (such as death) by the end of the study.">(?)</a></sup>
estimator or Cox proportional hazards
model<sup><a href="#" title="The Cox proportional hazards model is a statistical technique used to assess the influence of multiple factors (like age, gender, and treatment) on the timing of a specific event (such as death). It doesn't assume a specific distribution for the survival times and allows for the estimation of hazard ratios, which describe how the hazard (or risk) of an event changes with different variables.">(?)</a></sup>,
are statistical techniques used to model and analyze the time until an
event occurs—in this case, the death of the insured. In the context of
life insurance:</p>
<p>Survival models can estimate mortality rates (qx) and predict the
likelihood of death at different ages and for different demographic
groups. These models help the calculation of premiums by assessing the
risk of the insured dying before the policy term. They also help quanity
the risk associated with these life insurance policies by considering
numerous factors like age, gender, health status etc. By modeling
mortality risks, insurers can set appropriate premiums that reflect the
expected costs of providing insurance coverage.</p>
<p>Credibility
Theory<sup><a href="#" title="Credibility theory is a statistical framework used in insurance and risk management to improve the accuracy of predictions when data is limited or variable. It combines historical data with prior beliefs or external information to estimate future outcomes more reliably. In insurance, it helps set appropriate premiums by adjusting for uncertainties and variations in risk across different policyholders or groups.">(?)</a></sup>
is a statistical framework used to improve the accuracy of risk
estimation when data is limited or variable. Key aspects in the context
of life insurance include:</p>
<p>It can enhance the estimation of Expected Present Value (EPV) through
combining historical data with prior beliefs / external info
(credibility factors), as well as help insurers reduce estimation errors
by incorporating these credibility factors when they optimize pricing
strategies</p>
<p>Application in Insurance Planning:</p>
<p>The integration of Survival Models and Credibility Theory supports
strategic decision-making in life insurance. Statistical models can
inform the design of life insurance products tailored to customer needs
and risk profiles, as well as provide insights that enable insurers to
offer competitive products. Bu helping insurers assess mortality risks,
insurers can manage reinsurance arrangements and capital adequacy to
mitigate adverse financial impacts from unexpected claims</p>
<p>In summary, Survival Models and Credibility Theory are essential
tools in the analysis and management of life insurance. They facilitate
the calculation of premiums, estimation of EPV, and strategic
decision-making, ensuring sustainable risk management and competitive
product offerings in the insurance industry.</p>
<hr />
</div>
<div id="section-cash-flows" class="section level1">
<h1>Cash Flows</h1>
<hr />
<div id="section-present-value" class="section level2">
<h2>Present Value</h2>
<details>
<summary>
What is Present Value (PV)?
</summary>
<p style="font-weight: bold; color: blue;">
Present value is the current worth of a future sum of money. It tells
you how much money you would need to invest today to reach a specific
amount in the future, considering a certain interest rate.
</p>
</details>
<p>Suppose you want to go on a trip 5 years from now. You have expenses
of $3000 each year for 4 years (including this year), followed by an
expense of $4000 and a final expense of $5000. How much would you have
to deposit at this moment in time to cover all of these future payments?
Assume a constant interest rate of 2.14% and payments would take place
at the beginning of the year.</p>
<div class="sourceCode" id="section-cb1"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb1-1"><a href="#section-cb1-1" tabindex="-1"></a><span class="co"># Define cash flows and time periods</span></span>
<span id="section-cb1-2"><a href="#section-cb1-2" tabindex="-1"></a>cash_flows <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3000</span>, <span class="dv">3000</span>, <span class="dv">3000</span>, <span class="dv">3000</span>, <span class="dv">4000</span>, <span class="dv">5000</span>)</span>
<span id="section-cb1-3"><a href="#section-cb1-3" tabindex="-1"></a>time_periods <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>  </span>
<span id="section-cb1-4"><a href="#section-cb1-4" tabindex="-1"></a></span>
<span id="section-cb1-5"><a href="#section-cb1-5" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="section-cb1-6"><a href="#section-cb1-6" tabindex="-1"></a><span class="fu">plot</span>(time_periods, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(time_periods)), <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="section-cb1-7"><a href="#section-cb1-7" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(cash_flows) <span class="sc">*</span> <span class="fl">1.1</span>),</span>
<span id="section-cb1-8"><a href="#section-cb1-8" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),  </span>
<span id="section-cb1-9"><a href="#section-cb1-9" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;t&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="section-cb1-10"><a href="#section-cb1-10" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Cash Flow Timeline&quot;</span>,</span>
<span id="section-cb1-11"><a href="#section-cb1-11" tabindex="-1"></a>     <span class="at">xaxt =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="section-cb1-12"><a href="#section-cb1-12" tabindex="-1"></a></span>
<span id="section-cb1-13"><a href="#section-cb1-13" tabindex="-1"></a></span>
<span id="section-cb1-14"><a href="#section-cb1-14" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> time_periods)</span>
<span id="section-cb1-15"><a href="#section-cb1-15" tabindex="-1"></a></span>
<span id="section-cb1-16"><a href="#section-cb1-16" tabindex="-1"></a><span class="co"># Here we add labels for the separate cash flows</span></span>
<span id="section-cb1-17"><a href="#section-cb1-17" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cash_flows)) {</span>
<span id="section-cb1-18"><a href="#section-cb1-18" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">c</span>(i, i), <span class="fu">c</span>(<span class="dv">0</span>, cash_flows[i]))</span>
<span id="section-cb1-19"><a href="#section-cb1-19" tabindex="-1"></a>  <span class="fu">text</span>(i, cash_flows[i], <span class="at">labels =</span> cash_flows[i], <span class="at">pos =</span> <span class="dv">3</span>)</span>
<span id="section-cb1-20"><a href="#section-cb1-20" tabindex="-1"></a>}</span>
<span id="section-cb1-21"><a href="#section-cb1-21" tabindex="-1"></a></span>
<span id="section-cb1-22"><a href="#section-cb1-22" tabindex="-1"></a><span class="co"># Add horizontal line to connect all labels together and provide some more cohesiveness</span></span>
<span id="section-cb1-23"><a href="#section-cb1-23" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-1-1.png" width="672" /></p>
<p>Let the annual interest rate be \(i = 0.0214\).</p>
<p>The discount factor \(v\) is calculated as follows: \[ v =
\frac{1}{1+i} \]</p>
<details>
<summary>
What is discount factor?
</summary>
<p style="font-weight: bold; color: blue;">
A discount factor is a number used to calculate the present value of a
future amount of money. It shows how much a future sum is worth today,
considering a specific interest rate over time.
</p>
</details>
<p>The discount factors for the time periods \(t = 0\) to \(t = 5\) are
given by: \[ v^{(0:5)} = \left(v^0, v^1, v^2, v^3, v^4, v^5\right)
\]</p>
<p>The present value (PV) of the cash flows is calculated as the sum of
the cash flows multiplied by the corresponding discount factors: \[
\text{PV} = \sum_{t=0}^{5} (\text{cash flow at } t) \times v^t \]</p>
<div class="sourceCode" id="section-cb2"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb2-1"><a href="#section-cb2-1" tabindex="-1"></a><span class="co"># We have an expense of 3000 from t=0 to t=3, an expense of 4000 at t=4 and 5000 at t=5</span></span>
<span id="section-cb2-2"><a href="#section-cb2-2" tabindex="-1"></a></span>
<span id="section-cb2-3"><a href="#section-cb2-3" tabindex="-1"></a><span class="co"># Cash flows</span></span>
<span id="section-cb2-4"><a href="#section-cb2-4" tabindex="-1"></a>cash_flows <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">3000</span>,<span class="dv">4</span>), <span class="dv">4000</span>, <span class="dv">5000</span>)</span>
<span id="section-cb2-5"><a href="#section-cb2-5" tabindex="-1"></a>                </span>
<span id="section-cb2-6"><a href="#section-cb2-6" tabindex="-1"></a><span class="co"># Interest Rate</span></span>
<span id="section-cb2-7"><a href="#section-cb2-7" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fl">0.0214</span></span>
<span id="section-cb2-8"><a href="#section-cb2-8" tabindex="-1"></a></span>
<span id="section-cb2-9"><a href="#section-cb2-9" tabindex="-1"></a><span class="co"># Discount factor</span></span>
<span id="section-cb2-10"><a href="#section-cb2-10" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span><span class="sc">+</span>i)</span>
<span id="section-cb2-11"><a href="#section-cb2-11" tabindex="-1"></a></span>
<span id="section-cb2-12"><a href="#section-cb2-12" tabindex="-1"></a><span class="co"># Discount factors</span></span>
<span id="section-cb2-13"><a href="#section-cb2-13" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> v <span class="sc">^</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="section-cb2-14"><a href="#section-cb2-14" tabindex="-1"></a></span>
<span id="section-cb2-15"><a href="#section-cb2-15" tabindex="-1"></a><span class="co"># Present value PV</span></span>
<span id="section-cb2-16"><a href="#section-cb2-16" tabindex="-1"></a>present_val <span class="ot">&lt;-</span> <span class="fu">sum</span>(cash_flows <span class="sc">*</span> discount_factors)</span>
<span id="section-cb2-17"><a href="#section-cb2-17" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Present Value (PV):&quot;</span>, present_val)</span></code></pre></div>
<pre><code>## Present Value (PV): 19800.98</code></pre>
<p>So you would have to make a deposit of 19800.98 at this current time
to cover all of these future payments.</p>
<div id="section-confidence-interval-for-present-value"
class="section level5">
<h5>Confidence Interval for Present Value</h5>
<p>We can use
bootstrapping<sup><a href="#" title="Bootstrapping is used to estimate the accuracy of sample statistics by repeatedly resampling with replacement from the data. It helps to understand the variability and reliability of estimates, especially when the theoretical distribution is unknown or complex.">(?)</a></sup>
to estimate the confidence interval for the present value of the cash
flows.</p>
<div class="sourceCode" id="section-cb4"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb4-1"><a href="#section-cb4-1" tabindex="-1"></a><span class="co"># Bootstrapping for confidence interval</span></span>
<span id="section-cb4-2"><a href="#section-cb4-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="section-cb4-3"><a href="#section-cb4-3" tabindex="-1"></a>n_bootstrap <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="section-cb4-4"><a href="#section-cb4-4" tabindex="-1"></a>bootstrap_pvs <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_bootstrap, {</span>
<span id="section-cb4-5"><a href="#section-cb4-5" tabindex="-1"></a>  sampled_cash_flows <span class="ot">&lt;-</span> <span class="fu">sample</span>(cash_flows, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="section-cb4-6"><a href="#section-cb4-6" tabindex="-1"></a>  <span class="fu">sum</span>(sampled_cash_flows <span class="sc">*</span> discount_factors)</span>
<span id="section-cb4-7"><a href="#section-cb4-7" tabindex="-1"></a>})</span>
<span id="section-cb4-8"><a href="#section-cb4-8" tabindex="-1"></a></span>
<span id="section-cb4-9"><a href="#section-cb4-9" tabindex="-1"></a><span class="co"># Calculate 95% confidence interval</span></span>
<span id="section-cb4-10"><a href="#section-cb4-10" tabindex="-1"></a>ci <span class="ot">&lt;-</span> <span class="fu">quantile</span>(bootstrap_pvs, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="section-cb4-11"><a href="#section-cb4-11" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;95% Confidence Interval for PV:&quot;</span>, ci)</span></code></pre></div>
<pre><code>## 95% Confidence Interval for PV: 17083.1 23714.74</code></pre>
<details>
<summary>
Why use confidence interval?
</summary>
<p style="font-weight: bold; color: blue;">
A confidence interval provides a range of values that likely contains
the true value of an unknown parameter. It helps us understand the
precision of our estimate and gives a measure of uncertainty.
</p>
</details>
<p><strong>Hypothesis Testing for Present Value</strong></p>
<p>We can perform a
hypothesis<sup><a href="#" title="A hypothesis test is a statistical method used to determine if there is enough evidence to support a specific claim about a population.">(?)</a></sup>
test to determine if the present value of the cash flows is
significantly different from a hypothesized value, say $20,000.</p>
<div class="sourceCode" id="section-cb6"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb6-1"><a href="#section-cb6-1" tabindex="-1"></a><span class="co"># Hypothesis testing for PV</span></span>
<span id="section-cb6-2"><a href="#section-cb6-2" tabindex="-1"></a>hypothesized_pv <span class="ot">&lt;-</span> <span class="dv">20000</span></span>
<span id="section-cb6-3"><a href="#section-cb6-3" tabindex="-1"></a>t_stat <span class="ot">&lt;-</span> (present_val <span class="sc">-</span> hypothesized_pv) <span class="sc">/</span> (<span class="fu">sd</span>(bootstrap_pvs) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(bootstrap_pvs)))</span>
<span id="section-cb6-4"><a href="#section-cb6-4" tabindex="-1"></a>p_value <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="sc">-</span><span class="fu">abs</span>(t_stat), <span class="at">df =</span> <span class="fu">length</span>(bootstrap_pvs) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="section-cb6-5"><a href="#section-cb6-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;T-statistic:&quot;</span>, t_stat, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## T-statistic: -3.540303</code></pre>
<div class="sourceCode" id="section-cb8"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb8-1"><a href="#section-cb8-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;P-value:&quot;</span>, p_value, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## P-value: 0.0004180939</code></pre>
<div class="sourceCode" id="section-cb10"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb10-1"><a href="#section-cb10-1" tabindex="-1"></a><span class="cf">if</span> (p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>) {</span>
<span id="section-cb10-2"><a href="#section-cb10-2" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;We reject the null hypothesis that the PV is equal to&quot;</span>, hypothesized_pv, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="section-cb10-3"><a href="#section-cb10-3" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="section-cb10-4"><a href="#section-cb10-4" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;We fail to reject the null hypothesis that the PV is equal to&quot;</span>, hypothesized_pv, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="section-cb10-5"><a href="#section-cb10-5" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## We reject the null hypothesis that the PV is equal to 20000</code></pre>
<details>
<summary>
Why use hypothesis testing?
</summary>
<p style="font-weight: bold; color: blue;">
It helps us decide whether to accept or reject the claim based on sample
data, providing a way to make informed decisions in the face of
uncertainty.
</p>
</details>
<p>It is consistent that we would reject our null hypothesis here since
we calculated earlier that the PV of the deposit would be 19800.98</p>
<hr />
</div>
</div>
<div id="section-net-present-value-npv" class="section level2">
<h2>Net Present Value (NPV)</h2>
<details>
<summary>
What is Net Present value (NPV)?
</summary>
<p style="font-weight: bold; color: blue;">
Net Present Value (NPV) is a financial metric that calculates the value
of a series of future cash flows in today’s terms. It takes into account
the time value of money by discounting future cash flows back to the
present. NPV helps determine the profitability of an investment: a
positive NPV indicates a good investment, while a negative NPV suggests
it may not be worthwhile.
</p>
</details>
<p>You’re the head of a lawn mowing company. You want to invest in a new
lawn mower than you are confident will generate cash flows of 50 each
month for 3 months, followed by 20 for 2 months. The issue is it costs
185 and you’re unsure if it will be a profitable investment. To find out
if it is a good investment or not, you must calculate the NPV for this
investment. Assume the monthly interest rate is 0.6%.</p>
<div class="sourceCode" id="section-cb12"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb12-1"><a href="#section-cb12-1" tabindex="-1"></a><span class="co"># Define the cash flows</span></span>
<span id="section-cb12-2"><a href="#section-cb12-2" tabindex="-1"></a>cash_flows <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">185</span>, <span class="fu">rep</span>(<span class="dv">50</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="dv">20</span>, <span class="dv">2</span>))</span>
<span id="section-cb12-3"><a href="#section-cb12-3" tabindex="-1"></a></span>
<span id="section-cb12-4"><a href="#section-cb12-4" tabindex="-1"></a><span class="co"># Discount factors</span></span>
<span id="section-cb12-5"><a href="#section-cb12-5" tabindex="-1"></a>monthly_interest_rate <span class="ot">&lt;-</span> <span class="fl">0.006</span></span>
<span id="section-cb12-6"><a href="#section-cb12-6" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> monthly_interest_rate) <span class="sc">^</span> <span class="sc">-</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="section-cb12-7"><a href="#section-cb12-7" tabindex="-1"></a></span>
<span id="section-cb12-8"><a href="#section-cb12-8" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="section-cb12-9"><a href="#section-cb12-9" tabindex="-1"></a></span>
<span id="section-cb12-10"><a href="#section-cb12-10" tabindex="-1"></a></span>
<span id="section-cb12-11"><a href="#section-cb12-11" tabindex="-1"></a><span class="fu">plot</span>(times, cash_flows, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Time (t)&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Cash Flows&quot;</span>, <span class="at">main=</span><span class="st">&quot;Cash Flow Timeline&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">200</span>, <span class="dv">70</span>))</span>
<span id="section-cb12-12"><a href="#section-cb12-12" tabindex="-1"></a></span>
<span id="section-cb12-13"><a href="#section-cb12-13" tabindex="-1"></a></span>
<span id="section-cb12-14"><a href="#section-cb12-14" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span>
<span id="section-cb12-15"><a href="#section-cb12-15" tabindex="-1"></a></span>
<span id="section-cb12-16"><a href="#section-cb12-16" tabindex="-1"></a></span>
<span id="section-cb12-17"><a href="#section-cb12-17" tabindex="-1"></a><span class="fu">segments</span>(times, <span class="dv">0</span>, times, cash_flows)</span>
<span id="section-cb12-18"><a href="#section-cb12-18" tabindex="-1"></a></span>
<span id="section-cb12-19"><a href="#section-cb12-19" tabindex="-1"></a><span class="co"># Add text labels for the cash flows</span></span>
<span id="section-cb12-20"><a href="#section-cb12-20" tabindex="-1"></a><span class="fu">text</span>(times, cash_flows, <span class="at">labels=</span>cash_flows, <span class="at">pos=</span><span class="fu">ifelse</span>(cash_flows <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="section-cb12-21"><a href="#section-cb12-21" tabindex="-1"></a></span>
<span id="section-cb12-22"><a href="#section-cb12-22" tabindex="-1"></a></span>
<span id="section-cb12-23"><a href="#section-cb12-23" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at=</span>times, <span class="at">labels=</span>times)</span>
<span id="section-cb12-24"><a href="#section-cb12-24" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">labels=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-5-1.png" width="672" /></p>
<div class="sourceCode" id="section-cb13"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb13-1"><a href="#section-cb13-1" tabindex="-1"></a><span class="co"># NPV calculation</span></span>
<span id="section-cb13-2"><a href="#section-cb13-2" tabindex="-1"></a>npv <span class="ot">&lt;-</span> <span class="fu">sum</span>(cash_flows <span class="sc">*</span> discount_factors)</span>
<span id="section-cb13-3"><a href="#section-cb13-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Net Present Value (NPV):&quot;</span>, npv, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Net Present Value (NPV): 2.155604</code></pre>
<p>The Net Present Value (NPV) is calculated using the formula: \[
\text{NPV} = \sum_{t=1}^{n} (\text{cash flow at } t) \times v^t \]</p>
<p>Where:</p>
<ul>
<li><p>\( CF_t \) is the cash flow at time \( t \)</p></li>
<li><p>\( r \) is the monthly interest rate</p></li>
<li><p>\( C_0 \) is the initial investment cost</p></li>
<li><p>\( n \) is the number of periods</p></li>
</ul>
<p>Given:</p>
<ul>
<li><p>Cash flows: \( CF_1 = 50, CF_2 = 50, CF_3 = 50, CF_4 = 20, CF_5 =
20 \)</p></li>
<li><p>Initial investment: \( C_0 = 185 \)</p></li>
<li><p>Monthly interest rate: \( r = 0.006 \)</p></li>
</ul>
<div class="sourceCode" id="section-cb15"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb15-1"><a href="#section-cb15-1" tabindex="-1"></a><span class="co"># NPV calculation</span></span>
<span id="section-cb15-2"><a href="#section-cb15-2" tabindex="-1"></a>npv <span class="ot">&lt;-</span> <span class="fu">sum</span>(cash_flows <span class="sc">*</span> discount_factors)</span>
<span id="section-cb15-3"><a href="#section-cb15-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Net Present Value (NPV):&quot;</span>, npv, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Net Present Value (NPV): 2.155604</code></pre>
<p>Since our NPV is positive, this indicates that this would be an
overall gain ie profit.</p>
<p>To better understand the risk of the investment, we can simulate the
cash flows under
uncertainty<sup><a href="#" title="Uncertainty means not knowing exactly what will happen in the future. In this context, it refers to the unpredictable factors that can affect the cash flows of an investment, such as market fluctuations or economic changes.">(?)</a></sup>.
Let’s assume that the cash flows have a certain variability</p>
<div class="sourceCode" id="section-cb17"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb17-1"><a href="#section-cb17-1" tabindex="-1"></a><span class="co"># Simulation for NPV under uncertainty</span></span>
<span id="section-cb17-2"><a href="#section-cb17-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="section-cb17-3"><a href="#section-cb17-3" tabindex="-1"></a>n_simulations <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="section-cb17-4"><a href="#section-cb17-4" tabindex="-1"></a>simulated_npvs <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_simulations, {</span>
<span id="section-cb17-5"><a href="#section-cb17-5" tabindex="-1"></a>  simulated_cash_flows <span class="ot">&lt;-</span> cash_flows <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(cash_flows), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">5</span>)</span>
<span id="section-cb17-6"><a href="#section-cb17-6" tabindex="-1"></a>  <span class="fu">sum</span>(simulated_cash_flows <span class="sc">*</span> discount_factors)</span>
<span id="section-cb17-7"><a href="#section-cb17-7" tabindex="-1"></a>})</span>
<span id="section-cb17-8"><a href="#section-cb17-8" tabindex="-1"></a></span>
<span id="section-cb17-9"><a href="#section-cb17-9" tabindex="-1"></a><span class="co"># Calculate the mean and standard deviation of simulated NPVs</span></span>
<span id="section-cb17-10"><a href="#section-cb17-10" tabindex="-1"></a>mean_npv <span class="ot">&lt;-</span> <span class="fu">mean</span>(simulated_npvs)</span>
<span id="section-cb17-11"><a href="#section-cb17-11" tabindex="-1"></a>sd_npv <span class="ot">&lt;-</span> <span class="fu">sd</span>(simulated_npvs)</span>
<span id="section-cb17-12"><a href="#section-cb17-12" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Mean NPV:&quot;</span>, mean_npv, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Mean NPV: 2.310703</code></pre>
<div class="sourceCode" id="section-cb19"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb19-1"><a href="#section-cb19-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Standard Deviation of NPV:&quot;</span>, sd_npv, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Standard Deviation of NPV: 11.42757</code></pre>
<div class="sourceCode" id="section-cb21"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb21-1"><a href="#section-cb21-1" tabindex="-1"></a><span class="co"># Plot the distribution of simulated NPVs</span></span>
<span id="section-cb21-2"><a href="#section-cb21-2" tabindex="-1"></a><span class="fu">hist</span>(simulated_npvs, <span class="at">breaks =</span> <span class="dv">30</span>, <span class="at">main =</span> <span class="st">&quot;Distribution of Simulated NPVs&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;NPV&quot;</span>)</span>
<span id="section-cb21-3"><a href="#section-cb21-3" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> mean_npv, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-7-1.png" width="672" /></p>
<hr />
</div>
<div id="section-accumulated-value" class="section level2">
<h2>Accumulated Value</h2>
<details>
<summary>
What is Accumulated Value (AV)?
</summary>
<p style="font-weight: bold; color: blue;">
The total amount of money accumulated or earned over time from an
initial investment or savings, including both the original amount
invested (principal) and any interest or earnings gained on it.
</p>
</details>
<p>Suppose instead of making those expenses, you chose to put them into
a savings account. What would be your new present value, assuming same
interest rate. What would be your new accumulated value?</p>
<div class="sourceCode" id="section-cb22"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb22-1"><a href="#section-cb22-1" tabindex="-1"></a><span class="co"># Cash flows</span></span>
<span id="section-cb22-2"><a href="#section-cb22-2" tabindex="-1"></a>cash_flows <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">3000</span>, <span class="dv">4</span>), <span class="dv">4000</span>, <span class="dv">5000</span>)</span>
<span id="section-cb22-3"><a href="#section-cb22-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Cash flows:&quot;</span>, cash_flows)</span></code></pre></div>
<pre><code>## Cash flows: 3000 3000 3000 3000 4000 5000</code></pre>
<div class="sourceCode" id="section-cb24"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb24-1"><a href="#section-cb24-1" tabindex="-1"></a><span class="co"># Define the discount function </span></span>
<span id="section-cb24-2"><a href="#section-cb24-2" tabindex="-1"></a>discount <span class="ot">&lt;-</span> <span class="cf">function</span>(s, t, <span class="at">i =</span> <span class="fl">0.0214</span>) {</span>
<span id="section-cb24-3"><a href="#section-cb24-3" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (t <span class="sc">-</span> s)</span>
<span id="section-cb24-4"><a href="#section-cb24-4" tabindex="-1"></a>}</span>
<span id="section-cb24-5"><a href="#section-cb24-5" tabindex="-1"></a></span>
<span id="section-cb24-6"><a href="#section-cb24-6" tabindex="-1"></a><span class="co"># Calculate the present value PV</span></span>
<span id="section-cb24-7"><a href="#section-cb24-7" tabindex="-1"></a>pv <span class="ot">&lt;-</span> <span class="fu">sum</span>(cash_flows <span class="sc">*</span> <span class="fu">discount</span>(<span class="dv">0</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>))</span>
<span id="section-cb24-8"><a href="#section-cb24-8" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Present Value (PV):&quot;</span>, pv)</span></code></pre></div>
<pre><code>## Present Value (PV): 19800.98</code></pre>
<div class="sourceCode" id="section-cb26"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb26-1"><a href="#section-cb26-1" tabindex="-1"></a><span class="co"># Calculate the value at time 6</span></span>
<span id="section-cb26-2"><a href="#section-cb26-2" tabindex="-1"></a>av <span class="ot">&lt;-</span> <span class="fu">sum</span>(cash_flows <span class="sc">*</span> <span class="fu">discount</span>(<span class="dv">6</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>))</span>
<span id="section-cb26-3"><a href="#section-cb26-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Accumulated Value (AV):&quot;</span>, av)</span></code></pre></div>
<pre><code>## Accumulated Value (AV): 22483.39</code></pre>
<div class="sourceCode" id="section-cb28"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb28-1"><a href="#section-cb28-1" tabindex="-1"></a><span class="co"># Calculate the value at time 6, starting from the PV</span></span>
<span id="section-cb28-2"><a href="#section-cb28-2" tabindex="-1"></a>pv_at_6 <span class="ot">&lt;-</span> pv <span class="sc">*</span> <span class="fu">discount</span>(<span class="dv">6</span>, <span class="dv">0</span>)</span>
<span id="section-cb28-3"><a href="#section-cb28-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;PV at time 6:&quot;</span>, pv_at_6)</span></code></pre></div>
<pre><code>## PV at time 6: 22483.39</code></pre>
<div class="sourceCode" id="section-cb30"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb30-1"><a href="#section-cb30-1" tabindex="-1"></a>difference <span class="ot">&lt;-</span> av <span class="sc">-</span> pv</span>
<span id="section-cb30-2"><a href="#section-cb30-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Difference:&quot;</span>, difference)</span></code></pre></div>
<pre><code>## Difference: 2682.41</code></pre>
<p>As you can see, there would be a difference of $2682.41 if you saved
the money instead of spending it.</p>
<div id="section-sensitivity-analysis-of-accumulated-value"
class="section level4">
<h4>Sensitivity Analysis of Accumulated Value</h4>
<p>To understand how sensitive the accumulated value is to changes in
the interest rate, we can perform a sensitivity
analysis<sup><a href="#" title="Sensitivity analysis helps us understand how changes in one factor, like sales or costs, affect outcomes such as profit or investment returns. It shows the impact of these changes, helping to make better decisions or prepare for different scenarios.">(?)</a></sup>
.</p>
<div class="sourceCode" id="section-cb32"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb32-1"><a href="#section-cb32-1" tabindex="-1"></a><span class="co"># Sensitivity analysis for different interest rates</span></span>
<span id="section-cb32-2"><a href="#section-cb32-2" tabindex="-1"></a>interest_rates <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="at">by =</span> <span class="fl">0.005</span>)</span>
<span id="section-cb32-3"><a href="#section-cb32-3" tabindex="-1"></a>accumulated_values <span class="ot">&lt;-</span> <span class="fu">sapply</span>(interest_rates, <span class="cf">function</span>(i) {</span>
<span id="section-cb32-4"><a href="#section-cb32-4" tabindex="-1"></a>  discount <span class="ot">&lt;-</span> <span class="cf">function</span>(s, t) (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (t <span class="sc">-</span> s)</span>
<span id="section-cb32-5"><a href="#section-cb32-5" tabindex="-1"></a>  <span class="fu">sum</span>(cash_flows <span class="sc">*</span> <span class="fu">discount</span>(<span class="dv">6</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>))</span>
<span id="section-cb32-6"><a href="#section-cb32-6" tabindex="-1"></a>  <span class="fu">sum</span>(cash_flows <span class="sc">*</span> <span class="fu">discount</span>(<span class="dv">6</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>))</span>
<span id="section-cb32-7"><a href="#section-cb32-7" tabindex="-1"></a>})</span>
<span id="section-cb32-8"><a href="#section-cb32-8" tabindex="-1"></a></span>
<span id="section-cb32-9"><a href="#section-cb32-9" tabindex="-1"></a><span class="co"># Plot the sensitivity analysis</span></span>
<span id="section-cb32-10"><a href="#section-cb32-10" tabindex="-1"></a><span class="fu">plot</span>(interest_rates, accumulated_values, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, </span>
<span id="section-cb32-11"><a href="#section-cb32-11" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Interest Rate&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Accumulated Value&quot;</span>, </span>
<span id="section-cb32-12"><a href="#section-cb32-12" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Sensitivity Analysis of Accumulated Value&quot;</span>)</span>
<span id="section-cb32-13"><a href="#section-cb32-13" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">0.0214</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-9-1.png" width="672" /></p>
<div class="sourceCode" id="section-cb33"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb33-1"><a href="#section-cb33-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Accumulated Values for different interest rates:&quot;</span>, accumulated_values)</span></code></pre></div>
<pre><code>## Accumulated Values for different interest rates: 21680.71 22029.21 22383.25 22742.92 23108.29 23479.45 23856.48 24239.48 24628.53</code></pre>
</div>
<div id="section-confidence-interval-for-accumulated-value"
class="section level4">
<h4>Confidence Interval for Accumulated Value</h4>
<p>Using bootstrapping to estimate the confidence interval for the
accumulated value.</p>
<div class="sourceCode" id="section-cb35"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb35-1"><a href="#section-cb35-1" tabindex="-1"></a><span class="co"># Bootstrapping for confidence interval of accumulated value</span></span>
<span id="section-cb35-2"><a href="#section-cb35-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="section-cb35-3"><a href="#section-cb35-3" tabindex="-1"></a>n_bootstrap <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="section-cb35-4"><a href="#section-cb35-4" tabindex="-1"></a>bootstrap_avs <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_bootstrap, {</span>
<span id="section-cb35-5"><a href="#section-cb35-5" tabindex="-1"></a>  sampled_cash_flows <span class="ot">&lt;-</span> <span class="fu">sample</span>(cash_flows, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="section-cb35-6"><a href="#section-cb35-6" tabindex="-1"></a>  <span class="fu">sum</span>(sampled_cash_flows <span class="sc">*</span> <span class="fu">discount</span>(<span class="dv">6</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>))</span>
<span id="section-cb35-7"><a href="#section-cb35-7" tabindex="-1"></a>})</span>
<span id="section-cb35-8"><a href="#section-cb35-8" tabindex="-1"></a></span>
<span id="section-cb35-9"><a href="#section-cb35-9" tabindex="-1"></a><span class="co"># Calculate 95% confidence interval</span></span>
<span id="section-cb35-10"><a href="#section-cb35-10" tabindex="-1"></a>ci_av <span class="ot">&lt;-</span> <span class="fu">quantile</span>(bootstrap_avs, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="section-cb35-11"><a href="#section-cb35-11" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;95% Confidence Interval for AV:&quot;</span>, ci_av)</span></code></pre></div>
<pre><code>## 95% Confidence Interval for AV: 19397.33 26927.34</code></pre>
</div>
<div id="section-hypothesis-testing-for-accumulated-value"
class="section level4">
<h4>Hypothesis Testing for Accumulated Value</h4>
<p>Perform a hypothesis test to determine if the accumulated value is
significantly different from a hypothesized value, say $25,000.</p>
<div class="sourceCode" id="section-cb37"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb37-1"><a href="#section-cb37-1" tabindex="-1"></a><span class="co"># Hypothesis testing for AV</span></span>
<span id="section-cb37-2"><a href="#section-cb37-2" tabindex="-1"></a>hypothesized_av <span class="ot">&lt;-</span> <span class="dv">25000</span></span>
<span id="section-cb37-3"><a href="#section-cb37-3" tabindex="-1"></a>t_stat_av <span class="ot">&lt;-</span> (av <span class="sc">-</span> hypothesized_av) <span class="sc">/</span> (<span class="fu">sd</span>(bootstrap_avs) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(bootstrap_avs)))</span>
<span id="section-cb37-4"><a href="#section-cb37-4" tabindex="-1"></a>p_value_av <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="sc">-</span><span class="fu">abs</span>(t_stat_av), <span class="at">df =</span> <span class="fu">length</span>(bootstrap_avs) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="section-cb37-5"><a href="#section-cb37-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;T-statistic for AV:&quot;</span>, t_stat_av, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## T-statistic for AV: -39.42543</code></pre>
<div class="sourceCode" id="section-cb39"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb39-1"><a href="#section-cb39-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;P-value for AV:&quot;</span>, p_value_av, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## P-value for AV: 8.702618e-206</code></pre>
<div class="sourceCode" id="section-cb41"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb41-1"><a href="#section-cb41-1" tabindex="-1"></a><span class="cf">if</span> (p_value_av <span class="sc">&lt;</span> <span class="fl">0.05</span>) {</span>
<span id="section-cb41-2"><a href="#section-cb41-2" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;We reject the null hypothesis that the AV is equal to&quot;</span>, hypothesized_av, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="section-cb41-3"><a href="#section-cb41-3" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="section-cb41-4"><a href="#section-cb41-4" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;We fail to reject the null hypothesis that the AV is equal to&quot;</span>, hypothesized_av, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="section-cb41-5"><a href="#section-cb41-5" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## We reject the null hypothesis that the AV is equal to 25000</code></pre>
<hr />
</div>
</div>
<div id="section-yearly-payments" class="section level2">
<h2>Yearly Payments</h2>
<p>Your parents want to start saving money for your university costs.
Each year of study will set you guys back by about 7500. You’re
currently 14 (t=0) and will start attending when you are 19 (t=5).
Therefore, your parents will make 1 deposit each year for 4 years (t=1
to t=4). Assume you will attend for 4 years (t=5 to t=22), the constant
annual interest rate is 3.14% and each deposit your parents make is
equal. Find the amount of the deposit</p>
<div class="sourceCode" id="section-cb43"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb43-1"><a href="#section-cb43-1" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">8</span></span>
<span id="section-cb43-2"><a href="#section-cb43-2" tabindex="-1"></a>cash_flows <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">7500</span>, <span class="dv">4</span>))</span>
<span id="section-cb43-3"><a href="#section-cb43-3" tabindex="-1"></a></span>
<span id="section-cb43-4"><a href="#section-cb43-4" tabindex="-1"></a></span>
<span id="section-cb43-5"><a href="#section-cb43-5" tabindex="-1"></a><span class="fu">plot</span>(times, cash_flows, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Time (t)&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Cash Flows&quot;</span>, <span class="at">main=</span><span class="st">&quot;Cash Flow Timeline&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">8000</span>, <span class="dv">7000</span>))</span>
<span id="section-cb43-6"><a href="#section-cb43-6" tabindex="-1"></a></span>
<span id="section-cb43-7"><a href="#section-cb43-7" tabindex="-1"></a></span>
<span id="section-cb43-8"><a href="#section-cb43-8" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span>
<span id="section-cb43-9"><a href="#section-cb43-9" tabindex="-1"></a></span>
<span id="section-cb43-10"><a href="#section-cb43-10" tabindex="-1"></a></span>
<span id="section-cb43-11"><a href="#section-cb43-11" tabindex="-1"></a><span class="fu">segments</span>(times, <span class="dv">0</span>, times, cash_flows)</span>
<span id="section-cb43-12"><a href="#section-cb43-12" tabindex="-1"></a></span>
<span id="section-cb43-13"><a href="#section-cb43-13" tabindex="-1"></a><span class="co"># Add text labels for the cash flows</span></span>
<span id="section-cb43-14"><a href="#section-cb43-14" tabindex="-1"></a><span class="fu">text</span>(times, cash_flows, <span class="at">labels=</span><span class="fu">round</span>(cash_flows, <span class="dv">2</span>), <span class="at">pos=</span><span class="fu">ifelse</span>(cash_flows <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="section-cb43-15"><a href="#section-cb43-15" tabindex="-1"></a></span>
<span id="section-cb43-16"><a href="#section-cb43-16" tabindex="-1"></a></span>
<span id="section-cb43-17"><a href="#section-cb43-17" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at=</span>times, <span class="at">labels=</span>times)</span>
<span id="section-cb43-18"><a href="#section-cb43-18" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">labels=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-12-1.png" width="672" /></p>
<div class="sourceCode" id="section-cb44"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb44-1"><a href="#section-cb44-1" tabindex="-1"></a><span class="co"># discount factors</span></span>
<span id="section-cb44-2"><a href="#section-cb44-2" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.0314</span>) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="section-cb44-3"><a href="#section-cb44-3" tabindex="-1"></a></span>
<span id="section-cb44-4"><a href="#section-cb44-4" tabindex="-1"></a><span class="co"># deposit pattern</span></span>
<span id="section-cb44-5"><a href="#section-cb44-5" tabindex="-1"></a>deposits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">4</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>))</span>
<span id="section-cb44-6"><a href="#section-cb44-6" tabindex="-1"></a></span>
<span id="section-cb44-7"><a href="#section-cb44-7" tabindex="-1"></a><span class="co"># university expenses</span></span>
<span id="section-cb44-8"><a href="#section-cb44-8" tabindex="-1"></a>payments <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="dv">7500</span>, <span class="dv">4</span>))</span>
<span id="section-cb44-9"><a href="#section-cb44-9" tabindex="-1"></a></span>
<span id="section-cb44-10"><a href="#section-cb44-10" tabindex="-1"></a><span class="co"># Calculate the PV of the deposits</span></span>
<span id="section-cb44-11"><a href="#section-cb44-11" tabindex="-1"></a>PV_deposit <span class="ot">&lt;-</span> <span class="fu">sum</span>(deposits <span class="sc">*</span> discount_factors)</span>
<span id="section-cb44-12"><a href="#section-cb44-12" tabindex="-1"></a></span>
<span id="section-cb44-13"><a href="#section-cb44-13" tabindex="-1"></a><span class="co"># Calculate the PV of the payments</span></span>
<span id="section-cb44-14"><a href="#section-cb44-14" tabindex="-1"></a>PV_payment <span class="ot">&lt;-</span> <span class="fu">sum</span>(payments <span class="sc">*</span> discount_factors)</span>
<span id="section-cb44-15"><a href="#section-cb44-15" tabindex="-1"></a></span>
<span id="section-cb44-16"><a href="#section-cb44-16" tabindex="-1"></a><span class="co"># Calculate the yearly deposit K in the first 4 years</span></span>
<span id="section-cb44-17"><a href="#section-cb44-17" tabindex="-1"></a>yearly_deposit <span class="ot">&lt;-</span>  PV_payment <span class="sc">/</span> PV_deposit </span>
<span id="section-cb44-18"><a href="#section-cb44-18" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Yearly Payments =&quot;</span>, yearly_deposit)</span></code></pre></div>
<pre><code>## Yearly Payments = 6627.546</code></pre>
<p>So your parents would have to make a deposit of 6627.546 for each of
the 4 years to finance your university.</p>
<hr />
</div>
<div id="section-varying-interest-rates" class="section level2">
<h2>Varying Interest Rates</h2>
<p>You want to take out a loan to open a new restaurant. You plan to
take $1000 this year and $3000 next year. You plan to repay the money
with equal yearly payments for the 10 years after next year (t=2 to
t=11). Note this time the interest rate isn’t constant but changes over
time. For the first 3 years it is 4%, then for the next 3 years it is
4.5%, then for the final 5 years it is 6%. How much will your yearly
payments be?</p>
<div class="sourceCode" id="section-cb46"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb46-1"><a href="#section-cb46-1" tabindex="-1"></a>cash_flows <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1000</span>, <span class="sc">-</span><span class="dv">3000</span>, <span class="fu">rep</span>(<span class="fl">516.39</span>, <span class="dv">10</span>))</span>
<span id="section-cb46-2"><a href="#section-cb46-2" tabindex="-1"></a>time_periods <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="section-cb46-3"><a href="#section-cb46-3" tabindex="-1"></a></span>
<span id="section-cb46-4"><a href="#section-cb46-4" tabindex="-1"></a><span class="co"># Calculate padding for y-axis</span></span>
<span id="section-cb46-5"><a href="#section-cb46-5" tabindex="-1"></a>y_padding <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(cash_flows)) <span class="sc">*</span> <span class="fl">0.2</span></span>
<span id="section-cb46-6"><a href="#section-cb46-6" tabindex="-1"></a></span>
<span id="section-cb46-7"><a href="#section-cb46-7" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="section-cb46-8"><a href="#section-cb46-8" tabindex="-1"></a><span class="fu">plot</span>(time_periods, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(time_periods)), <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="section-cb46-9"><a href="#section-cb46-9" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(cash_flows) <span class="sc">-</span> y_padding, <span class="fu">max</span>(cash_flows) <span class="sc">+</span> y_padding),</span>
<span id="section-cb46-10"><a href="#section-cb46-10" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>),</span>
<span id="section-cb46-11"><a href="#section-cb46-11" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;t&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="section-cb46-12"><a href="#section-cb46-12" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Cash Flow Timeline&quot;</span>,</span>
<span id="section-cb46-13"><a href="#section-cb46-13" tabindex="-1"></a>     <span class="at">xaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="at">yaxt =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="section-cb46-14"><a href="#section-cb46-14" tabindex="-1"></a></span>
<span id="section-cb46-15"><a href="#section-cb46-15" tabindex="-1"></a></span>
<span id="section-cb46-16"><a href="#section-cb46-16" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> time_periods)</span>
<span id="section-cb46-17"><a href="#section-cb46-17" tabindex="-1"></a></span>
<span id="section-cb46-18"><a href="#section-cb46-18" tabindex="-1"></a></span>
<span id="section-cb46-19"><a href="#section-cb46-19" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cash_flows)) {</span>
<span id="section-cb46-20"><a href="#section-cb46-20" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">c</span>(i<span class="dv">-1</span>, i<span class="dv">-1</span>), <span class="fu">c</span>(<span class="dv">0</span>, cash_flows[i]))</span>
<span id="section-cb46-21"><a href="#section-cb46-21" tabindex="-1"></a>  </span>
<span id="section-cb46-22"><a href="#section-cb46-22" tabindex="-1"></a>  </span>
<span id="section-cb46-23"><a href="#section-cb46-23" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&lt;=</span> <span class="dv">2</span>) {</span>
<span id="section-cb46-24"><a href="#section-cb46-24" tabindex="-1"></a>    <span class="co"># First two negative cash flows</span></span>
<span id="section-cb46-25"><a href="#section-cb46-25" tabindex="-1"></a>    label <span class="ot">&lt;-</span> <span class="fu">round</span>(cash_flows[i], <span class="dv">2</span>)</span>
<span id="section-cb46-26"><a href="#section-cb46-26" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">3</span> <span class="sc">||</span> i <span class="sc">==</span> <span class="dv">4</span> <span class="sc">||</span> i <span class="sc">==</span> <span class="dv">11</span> <span class="sc">||</span> i <span class="sc">==</span> <span class="dv">12</span>) {</span>
<span id="section-cb46-27"><a href="#section-cb46-27" tabindex="-1"></a>    <span class="co"># First two and last two positive cash flows</span></span>
<span id="section-cb46-28"><a href="#section-cb46-28" tabindex="-1"></a>    label <span class="ot">&lt;-</span> <span class="fu">round</span>(cash_flows[i], <span class="dv">2</span>)</span>
<span id="section-cb46-29"><a href="#section-cb46-29" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">7</span>) {</span>
<span id="section-cb46-30"><a href="#section-cb46-30" tabindex="-1"></a>    </span>
<span id="section-cb46-31"><a href="#section-cb46-31" tabindex="-1"></a>    label <span class="ot">&lt;-</span> <span class="st">&quot;...&quot;</span></span>
<span id="section-cb46-32"><a href="#section-cb46-32" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="section-cb46-33"><a href="#section-cb46-33" tabindex="-1"></a>    </span>
<span id="section-cb46-34"><a href="#section-cb46-34" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="section-cb46-35"><a href="#section-cb46-35" tabindex="-1"></a>  }</span>
<span id="section-cb46-36"><a href="#section-cb46-36" tabindex="-1"></a>  </span>
<span id="section-cb46-37"><a href="#section-cb46-37" tabindex="-1"></a>  <span class="fu">text</span>(i<span class="dv">-1</span>, cash_flows[i], <span class="at">labels =</span> label, </span>
<span id="section-cb46-38"><a href="#section-cb46-38" tabindex="-1"></a>       <span class="at">pos =</span> <span class="fu">ifelse</span>(cash_flows[i] <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">1</span>),</span>
<span id="section-cb46-39"><a href="#section-cb46-39" tabindex="-1"></a>       <span class="at">offset =</span> <span class="fl">0.5</span>)</span>
<span id="section-cb46-40"><a href="#section-cb46-40" tabindex="-1"></a>}</span>
<span id="section-cb46-41"><a href="#section-cb46-41" tabindex="-1"></a></span>
<span id="section-cb46-42"><a href="#section-cb46-42" tabindex="-1"></a><span class="co"># Add horizontal line</span></span>
<span id="section-cb46-43"><a href="#section-cb46-43" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-14-1.png" width="1152" /></p>
<div class="sourceCode" id="section-cb47"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb47-1"><a href="#section-cb47-1" tabindex="-1"></a><span class="co"># Interest rates</span></span>
<span id="section-cb47-2"><a href="#section-cb47-2" tabindex="-1"></a>interest <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fl">0.04</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="fl">0.045</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="fl">0.06</span>, <span class="dv">5</span>))</span>
<span id="section-cb47-3"><a href="#section-cb47-3" tabindex="-1"></a></span>
<span id="section-cb47-4"><a href="#section-cb47-4" tabindex="-1"></a><span class="co"># Yearly discount factors</span></span>
<span id="section-cb47-5"><a href="#section-cb47-5" tabindex="-1"></a>yearly_discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> interest) <span class="sc">^</span> (<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="section-cb47-6"><a href="#section-cb47-6" tabindex="-1"></a></span>
<span id="section-cb47-7"><a href="#section-cb47-7" tabindex="-1"></a><span class="co"># Discount factors</span></span>
<span id="section-cb47-8"><a href="#section-cb47-8" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="fu">c</span>(<span class="dv">1</span>, yearly_discount_factors))</span>
<span id="section-cb47-9"><a href="#section-cb47-9" tabindex="-1"></a></span>
<span id="section-cb47-10"><a href="#section-cb47-10" tabindex="-1"></a><span class="co"># Cash flows for the first two years</span></span>
<span id="section-cb47-11"><a href="#section-cb47-11" tabindex="-1"></a>cash_flow <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">3000</span>)</span>
<span id="section-cb47-12"><a href="#section-cb47-12" tabindex="-1"></a></span>
<span id="section-cb47-13"><a href="#section-cb47-13" tabindex="-1"></a><span class="co"># Calculate the PV of the loan</span></span>
<span id="section-cb47-14"><a href="#section-cb47-14" tabindex="-1"></a>PV_loan <span class="ot">&lt;-</span> <span class="fu">sum</span>(cash_flow <span class="sc">*</span> discount_factors[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="section-cb47-15"><a href="#section-cb47-15" tabindex="-1"></a></span>
<span id="section-cb47-16"><a href="#section-cb47-16" tabindex="-1"></a><span class="co"># Calculate the PV of the repayments</span></span>
<span id="section-cb47-17"><a href="#section-cb47-17" tabindex="-1"></a>repayment_years <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">11</span></span>
<span id="section-cb47-18"><a href="#section-cb47-18" tabindex="-1"></a>discount_factors_repayments <span class="ot">&lt;-</span> discount_factors[repayment_years <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb47-19"><a href="#section-cb47-19" tabindex="-1"></a>n_payments <span class="ot">&lt;-</span> <span class="fu">length</span>(discount_factors_repayments)</span>
<span id="section-cb47-20"><a href="#section-cb47-20" tabindex="-1"></a></span>
<span id="section-cb47-21"><a href="#section-cb47-21" tabindex="-1"></a></span>
<span id="section-cb47-22"><a href="#section-cb47-22" tabindex="-1"></a>yearly_payment <span class="ot">&lt;-</span> PV_loan <span class="sc">/</span> <span class="fu">sum</span>(discount_factors_repayments)</span>
<span id="section-cb47-23"><a href="#section-cb47-23" tabindex="-1"></a></span>
<span id="section-cb47-24"><a href="#section-cb47-24" tabindex="-1"></a></span>
<span id="section-cb47-25"><a href="#section-cb47-25" tabindex="-1"></a>cash_flow_full <span class="ot">&lt;-</span> <span class="fu">c</span>(cash_flow, <span class="fu">rep</span>(<span class="sc">-</span>yearly_payment, n_payments))</span>
<span id="section-cb47-26"><a href="#section-cb47-26" tabindex="-1"></a></span>
<span id="section-cb47-27"><a href="#section-cb47-27" tabindex="-1"></a><span class="co"># Calculate the PV of the repayments to check the balance</span></span>
<span id="section-cb47-28"><a href="#section-cb47-28" tabindex="-1"></a>PV_repayments <span class="ot">&lt;-</span> <span class="fu">sum</span>(cash_flow_full <span class="sc">*</span> discount_factors)</span>
<span id="section-cb47-29"><a href="#section-cb47-29" tabindex="-1"></a></span>
<span id="section-cb47-30"><a href="#section-cb47-30" tabindex="-1"></a><span class="co"># Display the yearly payment and the PV balance check</span></span>
<span id="section-cb47-31"><a href="#section-cb47-31" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Yearly payments =&quot;</span>, yearly_payment)</span></code></pre></div>
<pre><code>## Yearly payments = 515.2757</code></pre>
<div class="sourceCode" id="section-cb49"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb49-1"><a href="#section-cb49-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;PV of repayments =&quot;</span>,PV_repayments)</span></code></pre></div>
<pre><code>## PV of repayments = -1.705303e-13</code></pre>
<div class="sourceCode" id="section-cb51"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb51-1"><a href="#section-cb51-1" tabindex="-1"></a>cash_flows <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1000</span>, <span class="sc">-</span><span class="dv">3000</span>, <span class="fu">rep</span>(<span class="fl">516.39</span>, <span class="dv">10</span>))</span>
<span id="section-cb51-2"><a href="#section-cb51-2" tabindex="-1"></a>time_periods <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="section-cb51-3"><a href="#section-cb51-3" tabindex="-1"></a></span>
<span id="section-cb51-4"><a href="#section-cb51-4" tabindex="-1"></a><span class="co"># Calculate padding for y-axis</span></span>
<span id="section-cb51-5"><a href="#section-cb51-5" tabindex="-1"></a>y_padding <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(cash_flows)) <span class="sc">*</span> <span class="fl">0.2</span></span>
<span id="section-cb51-6"><a href="#section-cb51-6" tabindex="-1"></a></span>
<span id="section-cb51-7"><a href="#section-cb51-7" tabindex="-1"></a></span>
<span id="section-cb51-8"><a href="#section-cb51-8" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repr.plot.width=</span><span class="dv">12</span>, <span class="at">repr.plot.height=</span><span class="dv">6</span>)  <span class="co"># Adjust as needed</span></span>
<span id="section-cb51-9"><a href="#section-cb51-9" tabindex="-1"></a></span>
<span id="section-cb51-10"><a href="#section-cb51-10" tabindex="-1"></a></span>
<span id="section-cb51-11"><a href="#section-cb51-11" tabindex="-1"></a><span class="fu">plot</span>(time_periods, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(time_periods)), <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="section-cb51-12"><a href="#section-cb51-12" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(cash_flows) <span class="sc">-</span> y_padding, <span class="fu">max</span>(cash_flows) <span class="sc">+</span> y_padding),</span>
<span id="section-cb51-13"><a href="#section-cb51-13" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>),</span>
<span id="section-cb51-14"><a href="#section-cb51-14" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;t&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="section-cb51-15"><a href="#section-cb51-15" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Cash Flow Timeline&quot;</span>,</span>
<span id="section-cb51-16"><a href="#section-cb51-16" tabindex="-1"></a>     <span class="at">xaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="at">yaxt =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="section-cb51-17"><a href="#section-cb51-17" tabindex="-1"></a></span>
<span id="section-cb51-18"><a href="#section-cb51-18" tabindex="-1"></a></span>
<span id="section-cb51-19"><a href="#section-cb51-19" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> time_periods)</span>
<span id="section-cb51-20"><a href="#section-cb51-20" tabindex="-1"></a></span>
<span id="section-cb51-21"><a href="#section-cb51-21" tabindex="-1"></a></span>
<span id="section-cb51-22"><a href="#section-cb51-22" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cash_flows)) {</span>
<span id="section-cb51-23"><a href="#section-cb51-23" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">c</span>(i<span class="dv">-1</span>, i<span class="dv">-1</span>), <span class="fu">c</span>(<span class="dv">0</span>, cash_flows[i]))</span>
<span id="section-cb51-24"><a href="#section-cb51-24" tabindex="-1"></a>  </span>
<span id="section-cb51-25"><a href="#section-cb51-25" tabindex="-1"></a>  </span>
<span id="section-cb51-26"><a href="#section-cb51-26" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&lt;=</span> <span class="dv">2</span>) {</span>
<span id="section-cb51-27"><a href="#section-cb51-27" tabindex="-1"></a>  </span>
<span id="section-cb51-28"><a href="#section-cb51-28" tabindex="-1"></a>    label <span class="ot">&lt;-</span> <span class="fu">round</span>(cash_flows[i], <span class="dv">2</span>)</span>
<span id="section-cb51-29"><a href="#section-cb51-29" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">3</span> <span class="sc">||</span> i <span class="sc">==</span> <span class="dv">4</span> <span class="sc">||</span> i <span class="sc">==</span> <span class="dv">11</span> <span class="sc">||</span> i <span class="sc">==</span> <span class="dv">12</span>) {</span>
<span id="section-cb51-30"><a href="#section-cb51-30" tabindex="-1"></a>    </span>
<span id="section-cb51-31"><a href="#section-cb51-31" tabindex="-1"></a>    label <span class="ot">&lt;-</span> <span class="fu">round</span>(cash_flows[i], <span class="dv">2</span>)</span>
<span id="section-cb51-32"><a href="#section-cb51-32" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">7</span>) {</span>
<span id="section-cb51-33"><a href="#section-cb51-33" tabindex="-1"></a>    </span>
<span id="section-cb51-34"><a href="#section-cb51-34" tabindex="-1"></a>    label <span class="ot">&lt;-</span> <span class="st">&quot;...&quot;</span></span>
<span id="section-cb51-35"><a href="#section-cb51-35" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="section-cb51-36"><a href="#section-cb51-36" tabindex="-1"></a>   </span>
<span id="section-cb51-37"><a href="#section-cb51-37" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="section-cb51-38"><a href="#section-cb51-38" tabindex="-1"></a>  }</span>
<span id="section-cb51-39"><a href="#section-cb51-39" tabindex="-1"></a>  </span>
<span id="section-cb51-40"><a href="#section-cb51-40" tabindex="-1"></a>  <span class="fu">text</span>(i<span class="dv">-1</span>, cash_flows[i], <span class="at">labels =</span> label, </span>
<span id="section-cb51-41"><a href="#section-cb51-41" tabindex="-1"></a>       <span class="at">pos =</span> <span class="fu">ifelse</span>(cash_flows[i] <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">1</span>),</span>
<span id="section-cb51-42"><a href="#section-cb51-42" tabindex="-1"></a>       <span class="at">offset =</span> <span class="fl">0.5</span>)</span>
<span id="section-cb51-43"><a href="#section-cb51-43" tabindex="-1"></a>}</span>
<span id="section-cb51-44"><a href="#section-cb51-44" tabindex="-1"></a></span>
<span id="section-cb51-45"><a href="#section-cb51-45" tabindex="-1"></a><span class="co"># Add horizontal line</span></span>
<span id="section-cb51-46"><a href="#section-cb51-46" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-14-2.png" width="1152" /></p>
<p>Our PV is ~0, meaning the PV of the future payments and PV of your
loans are equal, hence the yearly payments would be 515.2757</p>
<div id="section-simulation-for-yearly-payments-analysis"
class="section level4">
<h4>Simulation for Yearly Payments Analysis</h4>
<p>To assess the variability in yearly payments, we can simulate
different interest rate scenarios.</p>
<div class="sourceCode" id="section-cb52"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb52-1"><a href="#section-cb52-1" tabindex="-1"></a><span class="co"># Simulation for varying interest rates</span></span>
<span id="section-cb52-2"><a href="#section-cb52-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="section-cb52-3"><a href="#section-cb52-3" tabindex="-1"></a>n_simulations <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="section-cb52-4"><a href="#section-cb52-4" tabindex="-1"></a>simulated_payments <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_simulations, {</span>
<span id="section-cb52-5"><a href="#section-cb52-5" tabindex="-1"></a>  interest_sim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">runif</span>(<span class="dv">1</span>, <span class="fl">0.035</span>, <span class="fl">0.045</span>), <span class="dv">3</span>), <span class="fu">rep</span>(<span class="fu">runif</span>(<span class="dv">1</span>, <span class="fl">0.04</span>, <span class="fl">0.05</span>), <span class="dv">3</span>), <span class="fu">rep</span>(<span class="fu">runif</span>(<span class="dv">1</span>, <span class="fl">0.055</span>, <span class="fl">0.065</span>), <span class="dv">5</span>))</span>
<span id="section-cb52-6"><a href="#section-cb52-6" tabindex="-1"></a>  yearly_discount_factors_sim <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> interest_sim) <span class="sc">^</span> (<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="section-cb52-7"><a href="#section-cb52-7" tabindex="-1"></a>  discount_factors_sim <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="fu">c</span>(<span class="dv">1</span>, yearly_discount_factors_sim))</span>
<span id="section-cb52-8"><a href="#section-cb52-8" tabindex="-1"></a>  </span>
<span id="section-cb52-9"><a href="#section-cb52-9" tabindex="-1"></a>  PV_loan_sim <span class="ot">&lt;-</span> <span class="fu">sum</span>(cash_flow <span class="sc">*</span> discount_factors_sim[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="section-cb52-10"><a href="#section-cb52-10" tabindex="-1"></a>  repayment_years_sim <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">11</span></span>
<span id="section-cb52-11"><a href="#section-cb52-11" tabindex="-1"></a>  discount_factors_repayments_sim <span class="ot">&lt;-</span> discount_factors_sim[repayment_years_sim <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb52-12"><a href="#section-cb52-12" tabindex="-1"></a>  yearly_payment_sim <span class="ot">&lt;-</span> PV_loan_sim <span class="sc">/</span> <span class="fu">sum</span>(discount_factors_repayments_sim)</span>
<span id="section-cb52-13"><a href="#section-cb52-13" tabindex="-1"></a>  </span>
<span id="section-cb52-14"><a href="#section-cb52-14" tabindex="-1"></a>  <span class="fu">return</span>(yearly_payment_sim)</span>
<span id="section-cb52-15"><a href="#section-cb52-15" tabindex="-1"></a>})</span>
<span id="section-cb52-16"><a href="#section-cb52-16" tabindex="-1"></a></span>
<span id="section-cb52-17"><a href="#section-cb52-17" tabindex="-1"></a><span class="co"># Calculate the mean and standard deviation of simulated yearly payments</span></span>
<span id="section-cb52-18"><a href="#section-cb52-18" tabindex="-1"></a>mean_payment <span class="ot">&lt;-</span> <span class="fu">mean</span>(simulated_payments)</span>
<span id="section-cb52-19"><a href="#section-cb52-19" tabindex="-1"></a>sd_payment <span class="ot">&lt;-</span> <span class="fu">sd</span>(simulated_payments)</span>
<span id="section-cb52-20"><a href="#section-cb52-20" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Mean Yearly Payment:&quot;</span>, mean_payment, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Mean Yearly Payment: 515.2269</code></pre>
<div class="sourceCode" id="section-cb54"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb54-1"><a href="#section-cb54-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Standard Deviation of Yearly Payment:&quot;</span>, sd_payment, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Standard Deviation of Yearly Payment: 4.438351</code></pre>
<div class="sourceCode" id="section-cb56"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb56-1"><a href="#section-cb56-1" tabindex="-1"></a><span class="co"># Plot the distribution of simulated yearly payments</span></span>
<span id="section-cb56-2"><a href="#section-cb56-2" tabindex="-1"></a><span class="fu">hist</span>(simulated_payments, <span class="at">breaks =</span> <span class="dv">30</span>, <span class="at">main =</span> <span class="st">&quot;Distribution of Simulated Yearly Payments&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Yearly Payment&quot;</span>)</span>
<span id="section-cb56-3"><a href="#section-cb56-3" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> mean_payment, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-15-1.png" width="672" /></p>
<hr />
</div>
</div>
<div id="section-yearly-to-monthly-interest-rate"
class="section level2">
<h2>Yearly to Monthly Interest Rate</h2>
<p>You plan to take out a 100,000 loan with a yearly interest rate of
2.88%. You want to pay back this loan with fixed monthly payments over
the next 15 years. Find how much these monthly payments will be.</p>
<div class="sourceCode" id="section-cb57"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb57-1"><a href="#section-cb57-1" tabindex="-1"></a><span class="co">#number of payments</span></span>
<span id="section-cb57-2"><a href="#section-cb57-2" tabindex="-1"></a>number_payments <span class="ot">&lt;-</span> <span class="dv">12</span><span class="sc">*</span><span class="dv">15</span></span>
<span id="section-cb57-3"><a href="#section-cb57-3" tabindex="-1"></a></span>
<span id="section-cb57-4"><a href="#section-cb57-4" tabindex="-1"></a><span class="co">#yearly interest rate</span></span>
<span id="section-cb57-5"><a href="#section-cb57-5" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fl">0.0288</span></span>
<span id="section-cb57-6"><a href="#section-cb57-6" tabindex="-1"></a></span>
<span id="section-cb57-7"><a href="#section-cb57-7" tabindex="-1"></a><span class="co">#monthly interest rate</span></span>
<span id="section-cb57-8"><a href="#section-cb57-8" tabindex="-1"></a></span>
<span id="section-cb57-9"><a href="#section-cb57-9" tabindex="-1"></a>monthly_interest <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">+</span>i)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>)<span class="sc">-</span><span class="dv">1</span></span>
<span id="section-cb57-10"><a href="#section-cb57-10" tabindex="-1"></a></span>
<span id="section-cb57-11"><a href="#section-cb57-11" tabindex="-1"></a></span>
<span id="section-cb57-12"><a href="#section-cb57-12" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> monthly_interest) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">1</span><span class="sc">:</span>number_payments)</span>
<span id="section-cb57-13"><a href="#section-cb57-13" tabindex="-1"></a></span>
<span id="section-cb57-14"><a href="#section-cb57-14" tabindex="-1"></a></span>
<span id="section-cb57-15"><a href="#section-cb57-15" tabindex="-1"></a>payments <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, number_payments)</span>
<span id="section-cb57-16"><a href="#section-cb57-16" tabindex="-1"></a></span>
<span id="section-cb57-17"><a href="#section-cb57-17" tabindex="-1"></a><span class="co"># Calculate the monthly loan payment K</span></span>
<span id="section-cb57-18"><a href="#section-cb57-18" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">100000</span> <span class="sc">/</span> <span class="fu">sum</span>(payments <span class="sc">*</span> discount_factors)</span>
<span id="section-cb57-19"><a href="#section-cb57-19" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Monthly loan payments =&quot;</span>, K)</span></code></pre></div>
<pre><code>## Monthly loan payments = 683.0401</code></pre>
<p>These monthly payments will be 683.0401</p>
<div id="section-confidence-interval-for-monthly-payments"
class="section level4">
<h4>Confidence Interval for Monthly Payments</h4>
<p>Using bootstrapping to estimate the confidence interval for the
monthly payments.</p>
<div class="sourceCode" id="section-cb59"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb59-1"><a href="#section-cb59-1" tabindex="-1"></a><span class="co"># Bootstrapping for confidence interval of monthly payments</span></span>
<span id="section-cb59-2"><a href="#section-cb59-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="section-cb59-3"><a href="#section-cb59-3" tabindex="-1"></a>bootstrap_payments <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_bootstrap, {</span>
<span id="section-cb59-4"><a href="#section-cb59-4" tabindex="-1"></a>  sampled_payments <span class="ot">&lt;-</span> payments <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(payments), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="section-cb59-5"><a href="#section-cb59-5" tabindex="-1"></a>  K_sim <span class="ot">&lt;-</span> <span class="dv">100000</span> <span class="sc">/</span> <span class="fu">sum</span>(sampled_payments <span class="sc">*</span> discount_factors)</span>
<span id="section-cb59-6"><a href="#section-cb59-6" tabindex="-1"></a>  <span class="fu">return</span>(K_sim)</span>
<span id="section-cb59-7"><a href="#section-cb59-7" tabindex="-1"></a>})</span>
<span id="section-cb59-8"><a href="#section-cb59-8" tabindex="-1"></a></span>
<span id="section-cb59-9"><a href="#section-cb59-9" tabindex="-1"></a><span class="co"># Calculate 95% confidence interval</span></span>
<span id="section-cb59-10"><a href="#section-cb59-10" tabindex="-1"></a>ci_payments <span class="ot">&lt;-</span> <span class="fu">quantile</span>(bootstrap_payments, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="section-cb59-11"><a href="#section-cb59-11" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;95% Confidence Interval for Monthly Payments:&quot;</span>, ci_payments)</span></code></pre></div>
<pre><code>## 95% Confidence Interval for Monthly Payments: -3081.038 5632.07</code></pre>
</div>
<div id="section-hypothesis-testing-for-monthly-payments"
class="section level4">
<h4>Hypothesis Testing for Monthly Payments</h4>
<p>Perform a hypothesis test to determine if the monthly payment is
significantly different from a hypothesized value, say $700.</p>
<div class="sourceCode" id="section-cb61"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb61-1"><a href="#section-cb61-1" tabindex="-1"></a><span class="co"># Hypothesis testing for monthly payments</span></span>
<span id="section-cb61-2"><a href="#section-cb61-2" tabindex="-1"></a>hypothesized_payment <span class="ot">&lt;-</span> <span class="dv">700</span></span>
<span id="section-cb61-3"><a href="#section-cb61-3" tabindex="-1"></a>t_stat_payment <span class="ot">&lt;-</span> (K <span class="sc">-</span> hypothesized_payment) <span class="sc">/</span> (<span class="fu">sd</span>(bootstrap_payments) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(bootstrap_payments)))</span>
<span id="section-cb61-4"><a href="#section-cb61-4" tabindex="-1"></a>p_value_payment <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="sc">-</span><span class="fu">abs</span>(t_stat_payment), <span class="at">df =</span> <span class="fu">length</span>(bootstrap_payments) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="section-cb61-5"><a href="#section-cb61-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;T-statistic for Monthly Payment:&quot;</span>, t_stat_payment, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## T-statistic for Monthly Payment: -0.02880914</code></pre>
<div class="sourceCode" id="section-cb63"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb63-1"><a href="#section-cb63-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;P-value for Monthly Payment:&quot;</span>, p_value_payment, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## P-value for Monthly Payment: 0.9770226</code></pre>
<div class="sourceCode" id="section-cb65"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb65-1"><a href="#section-cb65-1" tabindex="-1"></a><span class="cf">if</span> (p_value_payment <span class="sc">&lt;</span> <span class="fl">0.05</span>) {</span>
<span id="section-cb65-2"><a href="#section-cb65-2" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;We reject the null hypothesis that the monthly payment is equal to&quot;</span>, hypothesized_payment, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="section-cb65-3"><a href="#section-cb65-3" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="section-cb65-4"><a href="#section-cb65-4" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;We fail to reject the null hypothesis that the monthly payment is equal to&quot;</span>, hypothesized_payment, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="section-cb65-5"><a href="#section-cb65-5" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## We fail to reject the null hypothesis that the monthly payment is equal to 700</code></pre>
<hr />
</div>
</div>
</div>
<div id="section-life-tables" class="section level1">
<h1>Life Tables</h1>
<details>
<summary>
What are Life Tables?
</summary>
<p style="font-weight: bold; color: blue;">
Life tables are statistical tools used in demography and actuarial
science to analyze mortality rates and life expectancy within a
population. They provide a detailed breakdown of how long people are
expected to live, based on age-specific mortality rates. Life tables
tell us about the probability of surviving to different ages, expected
years of life remaining at various ages, and are crucial for
understanding population dynamics, healthcare planning, and insurance
risk assessment.In data analysis beyond actuarial science, life tables
serve as a model for understanding survival or retention rates in
various contexts. For instance, in customer analytics, they can help
predict how long customers are likely to remain active or how likely
they are to churn based on historical data. Similarly, in medical
research, life tables can be adapted to study survival rates after
treatments or interventions. Essentially, life tables provide a
structured way to analyze and predict durations or outcomes based on
observed data, making them versatile tools across different fields of
data analysis.
</p>
</details>
<p><strong>Import the life tables from <a
href="https://mortality.org/">mortality.org</a>. We are going to import
the dataset of Canada from 1921 - 2021.</strong></p>
<div class="sourceCode" id="section-cb67"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb67-1"><a href="#section-cb67-1" tabindex="-1"></a>life_table <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">megacrazyleo</span><span class="sc">\\</span><span class="st">Desktop</span><span class="sc">\\</span><span class="st">SQL</span><span class="sc">\\</span><span class="st">R</span><span class="sc">\\</span><span class="st">bltper_1x1.txt&quot;</span>, <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">skip =</span> <span class="dv">3</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>) </span>
<span id="section-cb67-2"><a href="#section-cb67-2" tabindex="-1"></a><span class="fu">colnames</span>(life_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Age&quot;</span>, <span class="st">&quot;mx&quot;</span>, <span class="st">&quot;qx&quot;</span>, <span class="st">&quot;ax&quot;</span>, <span class="st">&quot;lx&quot;</span>, <span class="st">&quot;dx&quot;</span>, <span class="st">&quot;Lx&quot;</span>, <span class="st">&quot;Tx&quot;</span>, <span class="st">&quot;ex&quot;</span>)</span></code></pre></div>
<p><strong>Setting up variables</strong></p>
<div class="sourceCode" id="section-cb68"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb68-1"><a href="#section-cb68-1" tabindex="-1"></a>year <span class="ot">&lt;-</span> life_table<span class="sc">$</span>Year</span>
<span id="section-cb68-2"><a href="#section-cb68-2" tabindex="-1"></a>age <span class="ot">&lt;-</span> life_table<span class="sc">$</span>Age</span>
<span id="section-cb68-3"><a href="#section-cb68-3" tabindex="-1"></a>qx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>qx</span>
<span id="section-cb68-4"><a href="#section-cb68-4" tabindex="-1"></a>mx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>mx</span>
<span id="section-cb68-5"><a href="#section-cb68-5" tabindex="-1"></a>ax <span class="ot">&lt;-</span> life_table<span class="sc">$</span>ax</span>
<span id="section-cb68-6"><a href="#section-cb68-6" tabindex="-1"></a>lx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>lx</span>
<span id="section-cb68-7"><a href="#section-cb68-7" tabindex="-1"></a>dx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>dx</span>
<span id="section-cb68-8"><a href="#section-cb68-8" tabindex="-1"></a>Lx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>Lx</span>
<span id="section-cb68-9"><a href="#section-cb68-9" tabindex="-1"></a>Tx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>Tx</span>
<span id="section-cb68-10"><a href="#section-cb68-10" tabindex="-1"></a>ex <span class="ot">&lt;-</span> life_table<span class="sc">$</span>ex</span>
<span id="section-cb68-11"><a href="#section-cb68-11" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> qx</span></code></pre></div>
<table>
<colgroup>
<col width="45%" />
<col width="54%" />
</colgroup>
<thead>
<tr>
<th><strong>Variable</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Year</td>
<td>Year or range of years (for period and cohort data)</td>
</tr>
<tr>
<td>Age</td>
<td>Age group, representing an n-year interval from exact age x to just
before x + n, where n = 1, 4, 5, or infinity</td>
</tr>
<tr>
<td>m(x)</td>
<td>Central death rate between ages x and x + n</td>
</tr>
<tr>
<td>q(x)</td>
<td>Probability of death between ages x and x + n</td>
</tr>
<tr>
<td>a(x)</td>
<td>Average length of survival between ages x and x + n for persons
dying in the interval</td>
</tr>
<tr>
<td>l(x)</td>
<td>Number of survivors at exact age x, assuming l(0) = 100,000</td>
</tr>
<tr>
<td>d(x)</td>
<td>Number of deaths between ages x and x + n</td>
</tr>
<tr>
<td>L(x)</td>
<td>Number of person-years lived between ages x and x + n</td>
</tr>
<tr>
<td>T(x)</td>
<td>Number of person-years remaining after exact age x</td>
</tr>
<tr>
<td>e(x)</td>
<td>Life expectancy at exact age x (in years)</td>
</tr>
</tbody>
</table>
<hr />
<div id="section-mortality-rates" class="section level2">
<h2>Mortality Rates</h2>
<p><strong>Plotting the mortality rates from 1921 to 2021 for all
ages</strong></p>
<div class="sourceCode" id="section-cb69"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb69-1"><a href="#section-cb69-1" tabindex="-1"></a><span class="co"># Setting up the plot</span></span>
<span id="section-cb69-2"><a href="#section-cb69-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">6</span>) <span class="sc">+</span> <span class="fl">0.1</span>) </span>
<span id="section-cb69-3"><a href="#section-cb69-3" tabindex="-1"></a></span>
<span id="section-cb69-4"><a href="#section-cb69-4" tabindex="-1"></a>convert_age <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="section-cb69-5"><a href="#section-cb69-5" tabindex="-1"></a>  x[x <span class="sc">==</span> <span class="st">&quot;110+&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;110&quot;</span>  <span class="co"># Here age is character in our dataset, need to change to numeric so that we don&#39;t run into issues with character </span></span>
<span id="section-cb69-6"><a href="#section-cb69-6" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>({</span>
<span id="section-cb69-7"><a href="#section-cb69-7" tabindex="-1"></a>    <span class="fu">as.numeric</span>(x)</span>
<span id="section-cb69-8"><a href="#section-cb69-8" tabindex="-1"></a>  })</span>
<span id="section-cb69-9"><a href="#section-cb69-9" tabindex="-1"></a>}</span>
<span id="section-cb69-10"><a href="#section-cb69-10" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">convert_age</span>(age)</span>
<span id="section-cb69-11"><a href="#section-cb69-11" tabindex="-1"></a></span>
<span id="section-cb69-12"><a href="#section-cb69-12" tabindex="-1"></a></span>
<span id="section-cb69-13"><a href="#section-cb69-13" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">unique</span>(year)</span>
<span id="section-cb69-14"><a href="#section-cb69-14" tabindex="-1"></a>color_palette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;red&quot;</span>))(<span class="fu">length</span>(years))</span>
<span id="section-cb69-15"><a href="#section-cb69-15" tabindex="-1"></a></span>
<span id="section-cb69-16"><a href="#section-cb69-16" tabindex="-1"></a></span>
<span id="section-cb69-17"><a href="#section-cb69-17" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="cn">NULL</span>, </span>
<span id="section-cb69-18"><a href="#section-cb69-18" tabindex="-1"></a>              <span class="at">xlim =</span> <span class="fu">range</span>(age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  </span>
<span id="section-cb69-19"><a href="#section-cb69-19" tabindex="-1"></a>              <span class="at">ylim =</span> <span class="fu">range</span>(qx, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),   </span>
<span id="section-cb69-20"><a href="#section-cb69-20" tabindex="-1"></a>              <span class="at">main =</span> <span class="st">&quot;Mortality rates (Canada, Males &amp; Females, 1921-2021)&quot;</span>,</span>
<span id="section-cb69-21"><a href="#section-cb69-21" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>,</span>
<span id="section-cb69-22"><a href="#section-cb69-22" tabindex="-1"></a>              <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Mortality rate &quot;</span>, q[x])),</span>
<span id="section-cb69-23"><a href="#section-cb69-23" tabindex="-1"></a>              <span class="at">type =</span> <span class="st">&quot;l&quot;</span></span>
<span id="section-cb69-24"><a href="#section-cb69-24" tabindex="-1"></a>)</span>
<span id="section-cb69-25"><a href="#section-cb69-25" tabindex="-1"></a></span>
<span id="section-cb69-26"><a href="#section-cb69-26" tabindex="-1"></a></span>
<span id="section-cb69-27"><a href="#section-cb69-27" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="section-cb69-28"><a href="#section-cb69-28" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(years)) {</span>
<span id="section-cb69-29"><a href="#section-cb69-29" tabindex="-1"></a>    year_data <span class="ot">&lt;-</span> <span class="fu">subset</span>(life_table, Year <span class="sc">==</span> years[i])</span>
<span id="section-cb69-30"><a href="#section-cb69-30" tabindex="-1"></a>    <span class="fu">lines</span>(year_data<span class="sc">$</span>Age, year_data<span class="sc">$</span>qx, <span class="at">col =</span> color_palette[i], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span>
<span id="section-cb69-31"><a href="#section-cb69-31" tabindex="-1"></a>  }</span>
<span id="section-cb69-32"><a href="#section-cb69-32" tabindex="-1"></a>})</span>
<span id="section-cb69-33"><a href="#section-cb69-33" tabindex="-1"></a></span>
<span id="section-cb69-34"><a href="#section-cb69-34" tabindex="-1"></a></span>
<span id="section-cb69-35"><a href="#section-cb69-35" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>,<span class="dv">0</span>),</span>
<span id="section-cb69-36"><a href="#section-cb69-36" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;1921&quot;</span>, <span class="st">&quot;1955&quot;</span>, <span class="st">&quot;1988&quot;</span>, <span class="st">&quot;2021&quot;</span>),</span>
<span id="section-cb69-37"><a href="#section-cb69-37" tabindex="-1"></a>       <span class="at">col =</span> color_palette[<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">which.min</span>(<span class="fu">abs</span>(years <span class="sc">-</span> <span class="dv">1955</span>)), </span>
<span id="section-cb69-38"><a href="#section-cb69-38" tabindex="-1"></a>                             <span class="fu">which.min</span>(<span class="fu">abs</span>(years <span class="sc">-</span> <span class="dv">1988</span>)), <span class="fu">length</span>(years))],</span>
<span id="section-cb69-39"><a href="#section-cb69-39" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>, </span>
<span id="section-cb69-40"><a href="#section-cb69-40" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Year&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-21-1.png" width="672" /></p>
<p>We can see that mortality rates from recent years are much lower
compared to the earliest years.</p>
<p>####Hypothesis Testing on Mortality Rates</p>
<p>We can perform a hypothesis test to determine if the mortality rate
at age 50 has significantly changed between 1921 and 2021.</p>
<div class="sourceCode" id="section-cb70"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb70-1"><a href="#section-cb70-1" tabindex="-1"></a><span class="co"># Hypothesis testing for mortality rates at age 50</span></span>
<span id="section-cb70-2"><a href="#section-cb70-2" tabindex="-1"></a>mort_1921 <span class="ot">&lt;-</span> <span class="fu">subset</span>(life_table, Year <span class="sc">==</span> <span class="dv">1921</span> <span class="sc">&amp;</span> Age <span class="sc">==</span> <span class="dv">50</span>)<span class="sc">$</span>qx</span>
<span id="section-cb70-3"><a href="#section-cb70-3" tabindex="-1"></a>mort_2021 <span class="ot">&lt;-</span> <span class="fu">subset</span>(life_table, Year <span class="sc">==</span> <span class="dv">2021</span> <span class="sc">&amp;</span> Age <span class="sc">==</span> <span class="dv">50</span>)<span class="sc">$</span>qx</span>
<span id="section-cb70-4"><a href="#section-cb70-4" tabindex="-1"></a></span>
<span id="section-cb70-5"><a href="#section-cb70-5" tabindex="-1"></a>t_stat <span class="ot">&lt;-</span> (mort_2021 <span class="sc">-</span> mort_1921) <span class="sc">/</span> <span class="fu">sqrt</span>((mort_1921 <span class="sc">/</span> lx[<span class="dv">51</span>]) <span class="sc">+</span> (mort_2021 <span class="sc">/</span> lx[<span class="dv">51</span>]))</span>
<span id="section-cb70-6"><a href="#section-cb70-6" tabindex="-1"></a>p_value <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="sc">-</span><span class="fu">abs</span>(t_stat), <span class="at">df =</span> lx[<span class="dv">51</span>] <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="section-cb70-7"><a href="#section-cb70-7" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;T-statistic:&quot;</span>, t_stat, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## T-statistic: -17.2664</code></pre>
<div class="sourceCode" id="section-cb72"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb72-1"><a href="#section-cb72-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;P-value:&quot;</span>, p_value, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## P-value: 1.158051e-66</code></pre>
<div class="sourceCode" id="section-cb74"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb74-1"><a href="#section-cb74-1" tabindex="-1"></a><span class="cf">if</span> (p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>) {</span>
<span id="section-cb74-2"><a href="#section-cb74-2" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;We reject the null hypothesis that the mortality rate at age 50 has not changed between 1921 and 2021</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="section-cb74-3"><a href="#section-cb74-3" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="section-cb74-4"><a href="#section-cb74-4" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;We fail to reject the null hypothesis that the mortality rate at age 50 has not changed between 1921 and 2021</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="section-cb74-5"><a href="#section-cb74-5" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## We reject the null hypothesis that the mortality rate at age 50 has not changed between 1921 and 2021</code></pre>
<hr />
</div>
<div id="section-life-expectancy" class="section level2">
<h2>Life Expectancy</h2>
<p><strong>Plotting the life expectancy of males and females from Canada
from the years 1921 - 2021</strong></p>
<div class="sourceCode" id="section-cb76"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb76-1"><a href="#section-cb76-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">6</span>) <span class="sc">+</span> <span class="fl">0.1</span>) </span>
<span id="section-cb76-2"><a href="#section-cb76-2" tabindex="-1"></a></span>
<span id="section-cb76-3"><a href="#section-cb76-3" tabindex="-1"></a></span>
<span id="section-cb76-4"><a href="#section-cb76-4" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">unique</span>(year)</span>
<span id="section-cb76-5"><a href="#section-cb76-5" tabindex="-1"></a>color_palette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;red&quot;</span>))(<span class="fu">length</span>(years))</span>
<span id="section-cb76-6"><a href="#section-cb76-6" tabindex="-1"></a></span>
<span id="section-cb76-7"><a href="#section-cb76-7" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>({</span>
<span id="section-cb76-8"><a href="#section-cb76-8" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="cn">NULL</span>, </span>
<span id="section-cb76-9"><a href="#section-cb76-9" tabindex="-1"></a>       <span class="at">xlim =</span> <span class="fu">range</span>(age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  </span>
<span id="section-cb76-10"><a href="#section-cb76-10" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">range</span>(ex, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),   </span>
<span id="section-cb76-11"><a href="#section-cb76-11" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Life Expectancy (Canada, Males &amp; Females, 1921-2021)&quot;</span>,</span>
<span id="section-cb76-12"><a href="#section-cb76-12" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>,</span>
<span id="section-cb76-13"><a href="#section-cb76-13" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Life Expectancy &quot;</span>, e[x])),</span>
<span id="section-cb76-14"><a href="#section-cb76-14" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">&quot;l&quot;</span></span>
<span id="section-cb76-15"><a href="#section-cb76-15" tabindex="-1"></a>  )</span>
<span id="section-cb76-16"><a href="#section-cb76-16" tabindex="-1"></a>})</span>
<span id="section-cb76-17"><a href="#section-cb76-17" tabindex="-1"></a></span>
<span id="section-cb76-18"><a href="#section-cb76-18" tabindex="-1"></a></span>
<span id="section-cb76-19"><a href="#section-cb76-19" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="section-cb76-20"><a href="#section-cb76-20" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(years)) {</span>
<span id="section-cb76-21"><a href="#section-cb76-21" tabindex="-1"></a>    year_data <span class="ot">&lt;-</span> <span class="fu">subset</span>(life_table, Year <span class="sc">==</span> years[i])</span>
<span id="section-cb76-22"><a href="#section-cb76-22" tabindex="-1"></a>    <span class="fu">lines</span>(year_data<span class="sc">$</span>Age, year_data<span class="sc">$</span>ex, <span class="at">col =</span> color_palette[i], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span>
<span id="section-cb76-23"><a href="#section-cb76-23" tabindex="-1"></a>  }</span>
<span id="section-cb76-24"><a href="#section-cb76-24" tabindex="-1"></a>})</span>
<span id="section-cb76-25"><a href="#section-cb76-25" tabindex="-1"></a></span>
<span id="section-cb76-26"><a href="#section-cb76-26" tabindex="-1"></a></span>
<span id="section-cb76-27"><a href="#section-cb76-27" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">0</span>),</span>
<span id="section-cb76-28"><a href="#section-cb76-28" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;1921&quot;</span>, <span class="st">&quot;1955&quot;</span>, <span class="st">&quot;1988&quot;</span>, <span class="st">&quot;2021&quot;</span>),</span>
<span id="section-cb76-29"><a href="#section-cb76-29" tabindex="-1"></a>       <span class="at">col =</span> color_palette[<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">which.min</span>(<span class="fu">abs</span>(years <span class="sc">-</span> <span class="dv">1955</span>)), </span>
<span id="section-cb76-30"><a href="#section-cb76-30" tabindex="-1"></a>                             <span class="fu">which.min</span>(<span class="fu">abs</span>(years <span class="sc">-</span> <span class="dv">1988</span>)), <span class="fu">length</span>(years))],</span>
<span id="section-cb76-31"><a href="#section-cb76-31" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>, </span>
<span id="section-cb76-32"><a href="#section-cb76-32" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Year&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-23-1.png" width="672" /></p>
<p>As we can see, the life expectancy is much higher from the years ~
2021 as opposed to the years from ~1921 or even ~1955. Note for the
early years, the life expectancy starts extremely low at age 0 and after
a couple years, has a sharp increase. This can be explained mainly
because it was much more difficult for an infant to survive the initial
years. In later years, thanks to modern medicine, the survival rate of
infants have risen much higher.</p>
<div id="section-confidence-interval-for-life-expectancy"
class="section level4">
<h4>Confidence Interval for Life Expectancy</h4>
<p>Using bootstrapping to estimate the confidence interval for life
expectancy at age 0 in 2021.</p>
<div class="sourceCode" id="section-cb77"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb77-1"><a href="#section-cb77-1" tabindex="-1"></a><span class="co"># Bootstrapping for confidence interval of life expectancy</span></span>
<span id="section-cb77-2"><a href="#section-cb77-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="section-cb77-3"><a href="#section-cb77-3" tabindex="-1"></a>n_bootstrap <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="section-cb77-4"><a href="#section-cb77-4" tabindex="-1"></a>bootstrap_ex <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_bootstrap, {</span>
<span id="section-cb77-5"><a href="#section-cb77-5" tabindex="-1"></a>  sampled_ex <span class="ot">&lt;-</span> <span class="fu">sample</span>(ex[age <span class="sc">==</span> <span class="dv">0</span>], <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="section-cb77-6"><a href="#section-cb77-6" tabindex="-1"></a>  <span class="fu">mean</span>(sampled_ex)</span>
<span id="section-cb77-7"><a href="#section-cb77-7" tabindex="-1"></a>})</span>
<span id="section-cb77-8"><a href="#section-cb77-8" tabindex="-1"></a></span>
<span id="section-cb77-9"><a href="#section-cb77-9" tabindex="-1"></a><span class="co"># Calculate 95% confidence interval</span></span>
<span id="section-cb77-10"><a href="#section-cb77-10" tabindex="-1"></a>ci_ex <span class="ot">&lt;-</span> <span class="fu">quantile</span>(bootstrap_ex, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="section-cb77-11"><a href="#section-cb77-11" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;95% Confidence Interval for Life Expectancy at age 0 in 2021:&quot;</span>, ci_ex)</span></code></pre></div>
<pre><code>## 95% Confidence Interval for Life Expectancy at age 0 in 2021: 70.54005 73.39801</code></pre>
<p>Let us focus on the year 2021.</p>
<p><strong>2021 Life Table</strong></p>
<div class="sourceCode" id="section-cb79"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb79-1"><a href="#section-cb79-1" tabindex="-1"></a>life_table <span class="ot">&lt;-</span> life_table[year <span class="sc">==</span> <span class="dv">2021</span>, ]  <span class="co">#Getting only data from the year 2021</span></span>
<span id="section-cb79-2"><a href="#section-cb79-2" tabindex="-1"></a>year <span class="ot">&lt;-</span> life_table<span class="sc">$</span>Year</span>
<span id="section-cb79-3"><a href="#section-cb79-3" tabindex="-1"></a>age <span class="ot">&lt;-</span> life_table<span class="sc">$</span>Age</span>
<span id="section-cb79-4"><a href="#section-cb79-4" tabindex="-1"></a>qx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>qx</span>
<span id="section-cb79-5"><a href="#section-cb79-5" tabindex="-1"></a>mx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>mx</span>
<span id="section-cb79-6"><a href="#section-cb79-6" tabindex="-1"></a>ax <span class="ot">&lt;-</span> life_table<span class="sc">$</span>ax</span>
<span id="section-cb79-7"><a href="#section-cb79-7" tabindex="-1"></a>lx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>lx</span>
<span id="section-cb79-8"><a href="#section-cb79-8" tabindex="-1"></a>dx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>dx</span>
<span id="section-cb79-9"><a href="#section-cb79-9" tabindex="-1"></a>Lx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>Lx</span>
<span id="section-cb79-10"><a href="#section-cb79-10" tabindex="-1"></a>Tx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>Tx</span>
<span id="section-cb79-11"><a href="#section-cb79-11" tabindex="-1"></a>ex <span class="ot">&lt;-</span> life_table<span class="sc">$</span>ex</span>
<span id="section-cb79-12"><a href="#section-cb79-12" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> qx</span></code></pre></div>
<div class="sourceCode" id="section-cb80"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb80-1"><a href="#section-cb80-1" tabindex="-1"></a>life_table_2021 <span class="ot">&lt;-</span> life_table[year <span class="sc">==</span> <span class="dv">2021</span>, ]  <span class="co">#Getting only data from the year 2021</span></span>
<span id="section-cb80-2"><a href="#section-cb80-2" tabindex="-1"></a>year <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>Year</span>
<span id="section-cb80-3"><a href="#section-cb80-3" tabindex="-1"></a>age <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>Age</span>
<span id="section-cb80-4"><a href="#section-cb80-4" tabindex="-1"></a>qx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>qx</span>
<span id="section-cb80-5"><a href="#section-cb80-5" tabindex="-1"></a>mx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>mx</span>
<span id="section-cb80-6"><a href="#section-cb80-6" tabindex="-1"></a>ax <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>ax</span>
<span id="section-cb80-7"><a href="#section-cb80-7" tabindex="-1"></a>lx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>lx</span>
<span id="section-cb80-8"><a href="#section-cb80-8" tabindex="-1"></a>dx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>dx</span>
<span id="section-cb80-9"><a href="#section-cb80-9" tabindex="-1"></a>Lx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>Lx</span>
<span id="section-cb80-10"><a href="#section-cb80-10" tabindex="-1"></a>Tx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>Tx</span>
<span id="section-cb80-11"><a href="#section-cb80-11" tabindex="-1"></a>ex <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>ex</span>
<span id="section-cb80-12"><a href="#section-cb80-12" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> qx</span></code></pre></div>
</div>
<div
id="section-probability-an-individual-of-age-x-dies-before-age-y-future-life-of-age-x"
class="section level3">
<h3>Probability an individual of age X dies before age Y, future life of
age X</h3>
<p><strong>Finding the probability that an 23 year old dies before
turning 24</strong></p>
<div class="sourceCode" id="section-cb81"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb81-1"><a href="#section-cb81-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;qx =&quot;</span>,qx[<span class="dv">23</span> <span class="sc">+</span> <span class="dv">1</span>])</span></code></pre></div>
<pre><code>## qx = 0.00072</code></pre>
<p>As we can see, it is a very low probability, &lt; 0.098%</p>
<p><strong>The expected future lifetime of an 23 year old</strong></p>
<div class="sourceCode" id="section-cb83"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb83-1"><a href="#section-cb83-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;ex =&quot;</span>,ex[<span class="dv">23</span> <span class="sc">+</span> <span class="dv">1</span>])</span></code></pre></div>
<pre><code>## ex = 59.34</code></pre>
<p>It is expected that an average 23 year old from Canada will live for
59.34 more years in Canada in 2021</p>
</div>
<div id="section-plotting-mortality-rates" class="section level3">
<h3>Plotting mortality rates</h3>
<p><strong>Plot the mortality rates in the year 2021</strong></p>
<div class="sourceCode" id="section-cb85"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb85-1"><a href="#section-cb85-1" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="section-cb85-2"><a href="#section-cb85-2" tabindex="-1"></a>  <span class="fu">plot</span>(age, qx, </span>
<span id="section-cb85-3"><a href="#section-cb85-3" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Mortality rates (Canada, 2021)&quot;</span>, </span>
<span id="section-cb85-4"><a href="#section-cb85-4" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>, </span>
<span id="section-cb85-5"><a href="#section-cb85-5" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Mortality rate &quot;</span>, q[x])), </span>
<span id="section-cb85-6"><a href="#section-cb85-6" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span>
<span id="section-cb85-7"><a href="#section-cb85-7" tabindex="-1"></a>})</span></code></pre></div>
<p><img src="figures/unnamed-chunk-29-1.png" width="672" /></p>
<p><strong>Plot the logarithm of the mortality rates in the year
2021</strong></p>
<div class="sourceCode" id="section-cb86"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb86-1"><a href="#section-cb86-1" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="section-cb86-2"><a href="#section-cb86-2" tabindex="-1"></a>  <span class="fu">plot</span>(age, <span class="fu">log</span>(qx), </span>
<span id="section-cb86-3"><a href="#section-cb86-3" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Log mortality rates (Canada, 2021)&quot;</span>, </span>
<span id="section-cb86-4"><a href="#section-cb86-4" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>, </span>
<span id="section-cb86-5"><a href="#section-cb86-5" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Log mortality rate &quot;</span>, <span class="fu">log</span>(q[x]))), </span>
<span id="section-cb86-6"><a href="#section-cb86-6" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span>
<span id="section-cb86-7"><a href="#section-cb86-7" tabindex="-1"></a>})</span></code></pre></div>
<p><img src="figures/unnamed-chunk-30-1.png" width="672" /></p>
<hr />
<p><strong>Plot the mortality rates of females vs males in the year
2021</strong></p>
<p>We need to import the male and female datasets here</p>
<div class="sourceCode" id="section-cb87"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb87-1"><a href="#section-cb87-1" tabindex="-1"></a><span class="co">#male data</span></span>
<span id="section-cb87-2"><a href="#section-cb87-2" tabindex="-1"></a>life_table_m <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">megacrazyleo</span><span class="sc">\\</span><span class="st">Desktop</span><span class="sc">\\</span><span class="st">SQL</span><span class="sc">\\</span><span class="st">R</span><span class="sc">\\</span><span class="st">mltper_1x1.txt&quot;</span>, <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">skip =</span> <span class="dv">3</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="section-cb87-3"><a href="#section-cb87-3" tabindex="-1"></a><span class="fu">colnames</span>(life_table_m) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Age&quot;</span>, <span class="st">&quot;mx&quot;</span>, <span class="st">&quot;qx&quot;</span>, <span class="st">&quot;ax&quot;</span>, <span class="st">&quot;lx&quot;</span>, <span class="st">&quot;dx&quot;</span>, <span class="st">&quot;Lx&quot;</span>, <span class="st">&quot;Tx&quot;</span>, <span class="st">&quot;ex&quot;</span>)</span>
<span id="section-cb87-4"><a href="#section-cb87-4" tabindex="-1"></a>male_2021 <span class="ot">&lt;-</span> life_table_m[life_table_m<span class="sc">$</span>Year <span class="sc">==</span> <span class="dv">2021</span>, ]</span>
<span id="section-cb87-5"><a href="#section-cb87-5" tabindex="-1"></a>year_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>Year</span>
<span id="section-cb87-6"><a href="#section-cb87-6" tabindex="-1"></a>age_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>Age</span>
<span id="section-cb87-7"><a href="#section-cb87-7" tabindex="-1"></a>qx_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>qx</span>
<span id="section-cb87-8"><a href="#section-cb87-8" tabindex="-1"></a>mx_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>mx</span>
<span id="section-cb87-9"><a href="#section-cb87-9" tabindex="-1"></a>ax_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>ax</span>
<span id="section-cb87-10"><a href="#section-cb87-10" tabindex="-1"></a>lx_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>lx</span>
<span id="section-cb87-11"><a href="#section-cb87-11" tabindex="-1"></a>dx_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>dx</span>
<span id="section-cb87-12"><a href="#section-cb87-12" tabindex="-1"></a>Lx_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>Lx</span>
<span id="section-cb87-13"><a href="#section-cb87-13" tabindex="-1"></a>Tx_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>Tx</span>
<span id="section-cb87-14"><a href="#section-cb87-14" tabindex="-1"></a>ex_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>ex</span>
<span id="section-cb87-15"><a href="#section-cb87-15" tabindex="-1"></a></span>
<span id="section-cb87-16"><a href="#section-cb87-16" tabindex="-1"></a><span class="co">#female data</span></span>
<span id="section-cb87-17"><a href="#section-cb87-17" tabindex="-1"></a>life_table_f <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">megacrazyleo</span><span class="sc">\\</span><span class="st">Desktop</span><span class="sc">\\</span><span class="st">SQL</span><span class="sc">\\</span><span class="st">R</span><span class="sc">\\</span><span class="st">fltper_1x1.txt&quot;</span>, <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">skip =</span> <span class="dv">3</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>) </span>
<span id="section-cb87-18"><a href="#section-cb87-18" tabindex="-1"></a><span class="fu">colnames</span>(life_table_f) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Age&quot;</span>, <span class="st">&quot;mx&quot;</span>, <span class="st">&quot;qx&quot;</span>, <span class="st">&quot;ax&quot;</span>, <span class="st">&quot;lx&quot;</span>, <span class="st">&quot;dx&quot;</span>, <span class="st">&quot;Lx&quot;</span>, <span class="st">&quot;Tx&quot;</span>, <span class="st">&quot;ex&quot;</span>)</span>
<span id="section-cb87-19"><a href="#section-cb87-19" tabindex="-1"></a>female_2021 <span class="ot">&lt;-</span> life_table_f[life_table_f<span class="sc">$</span>Year <span class="sc">==</span> <span class="dv">2021</span>, ]</span>
<span id="section-cb87-20"><a href="#section-cb87-20" tabindex="-1"></a>year_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>Year</span>
<span id="section-cb87-21"><a href="#section-cb87-21" tabindex="-1"></a>age_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>Age</span>
<span id="section-cb87-22"><a href="#section-cb87-22" tabindex="-1"></a>qx_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>qx</span>
<span id="section-cb87-23"><a href="#section-cb87-23" tabindex="-1"></a>mx_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>mx</span>
<span id="section-cb87-24"><a href="#section-cb87-24" tabindex="-1"></a>ax_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>ax</span>
<span id="section-cb87-25"><a href="#section-cb87-25" tabindex="-1"></a>lx_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>lx</span>
<span id="section-cb87-26"><a href="#section-cb87-26" tabindex="-1"></a>dx_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>dx</span>
<span id="section-cb87-27"><a href="#section-cb87-27" tabindex="-1"></a>Lx_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>Lx</span>
<span id="section-cb87-28"><a href="#section-cb87-28" tabindex="-1"></a>Tx_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>Tx</span>
<span id="section-cb87-29"><a href="#section-cb87-29" tabindex="-1"></a>ex_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>ex</span></code></pre></div>
<p><strong>Plot male vs female mortality rates in the year
2021</strong></p>
<div class="sourceCode" id="section-cb88"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb88-1"><a href="#section-cb88-1" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="section-cb88-2"><a href="#section-cb88-2" tabindex="-1"></a>  <span class="fu">plot</span>(age_m, qx_m, </span>
<span id="section-cb88-3"><a href="#section-cb88-3" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Mortality rates (Canada, 2021)&quot;</span>, </span>
<span id="section-cb88-4"><a href="#section-cb88-4" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>, </span>
<span id="section-cb88-5"><a href="#section-cb88-5" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Mortality rate &quot;</span>, q[x])), </span>
<span id="section-cb88-6"><a href="#section-cb88-6" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="section-cb88-7"><a href="#section-cb88-7" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="section-cb88-8"><a href="#section-cb88-8" tabindex="-1"></a>  )  </span>
<span id="section-cb88-9"><a href="#section-cb88-9" tabindex="-1"></a>  </span>
<span id="section-cb88-10"><a href="#section-cb88-10" tabindex="-1"></a>  <span class="co"># Add the female line to the same plot</span></span>
<span id="section-cb88-11"><a href="#section-cb88-11" tabindex="-1"></a>  <span class="fu">lines</span>(age_f, qx_f, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="section-cb88-12"><a href="#section-cb88-12" tabindex="-1"></a>  </span>
<span id="section-cb88-13"><a href="#section-cb88-13" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, </span>
<span id="section-cb88-14"><a href="#section-cb88-14" tabindex="-1"></a>         <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>),</span>
<span id="section-cb88-15"><a href="#section-cb88-15" tabindex="-1"></a>         <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>),</span>
<span id="section-cb88-16"><a href="#section-cb88-16" tabindex="-1"></a>         <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="section-cb88-17"><a href="#section-cb88-17" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="section-cb88-18"><a href="#section-cb88-18" tabindex="-1"></a>})</span></code></pre></div>
<p><img src="figures/unnamed-chunk-32-1.png" width="672" /></p>
<div class="sourceCode" id="section-cb89"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb89-1"><a href="#section-cb89-1" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="section-cb89-2"><a href="#section-cb89-2" tabindex="-1"></a>  <span class="fu">plot</span>(age_m, qx_m, </span>
<span id="section-cb89-3"><a href="#section-cb89-3" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Mortality rates (Canadian Males and Females, 2021)&quot;</span>, </span>
<span id="section-cb89-4"><a href="#section-cb89-4" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>, </span>
<span id="section-cb89-5"><a href="#section-cb89-5" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Mortality rate &quot;</span>, q[x])), </span>
<span id="section-cb89-6"><a href="#section-cb89-6" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="section-cb89-7"><a href="#section-cb89-7" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="section-cb89-8"><a href="#section-cb89-8" tabindex="-1"></a>       <span class="at">log =</span> <span class="st">&quot;y&quot;</span>,  </span>
<span id="section-cb89-9"><a href="#section-cb89-9" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">range</span>(<span class="fu">c</span>(qx_m, qx_f)) </span>
<span id="section-cb89-10"><a href="#section-cb89-10" tabindex="-1"></a>  )</span>
<span id="section-cb89-11"><a href="#section-cb89-11" tabindex="-1"></a>  </span>
<span id="section-cb89-12"><a href="#section-cb89-12" tabindex="-1"></a>  <span class="fu">lines</span>(age_f, qx_f, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="section-cb89-13"><a href="#section-cb89-13" tabindex="-1"></a>  </span>
<span id="section-cb89-14"><a href="#section-cb89-14" tabindex="-1"></a>  <span class="fu">grid</span>()</span>
<span id="section-cb89-15"><a href="#section-cb89-15" tabindex="-1"></a>  </span>
<span id="section-cb89-16"><a href="#section-cb89-16" tabindex="-1"></a>  <span class="fu">points</span>(age_m, qx_m, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="section-cb89-17"><a href="#section-cb89-17" tabindex="-1"></a>  <span class="fu">points</span>(age_f, qx_f, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="section-cb89-18"><a href="#section-cb89-18" tabindex="-1"></a>  </span>
<span id="section-cb89-19"><a href="#section-cb89-19" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, </span>
<span id="section-cb89-20"><a href="#section-cb89-20" tabindex="-1"></a>         <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Males&quot;</span>, <span class="st">&quot;Females&quot;</span>),</span>
<span id="section-cb89-21"><a href="#section-cb89-21" tabindex="-1"></a>         <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>),</span>
<span id="section-cb89-22"><a href="#section-cb89-22" tabindex="-1"></a>         <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="section-cb89-23"><a href="#section-cb89-23" tabindex="-1"></a>         <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="section-cb89-24"><a href="#section-cb89-24" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="section-cb89-25"><a href="#section-cb89-25" tabindex="-1"></a>})</span></code></pre></div>
<p><img src="figures/unnamed-chunk-33-1.png" width="672" /></p>
<p>As we can see, females on average for every age have a lower
mortality rate than males. The gap only begins to narrow at the later
ages, where it eventually becomes near equal around the age of 100.
While there could be multiple reasons for this disparity, a study from
<a
href="https://www.health.harvard.edu/blog/why-men-often-die-earlier-than-women-201602199137">Harvard</a>
states that one of the reasons could be because men have lower estrogen
levels, hence they are more likely to die of heart disease</p>
</div>
<div id="section-probability-for-invidivual-of-age-x-to-reach-age-y"
class="section level3">
<h3>Probability for invidivual of age x to reach age y</h3>
<p><strong>Find the probability for a 0 year old female and male in
Canada to reach the age of 100 in 2021</strong></p>
<div class="sourceCode" id="section-cb90"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb90-1"><a href="#section-cb90-1" tabindex="-1"></a>male_prob <span class="ot">&lt;-</span> lx_m[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx_m[<span class="dv">0</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb90-2"><a href="#section-cb90-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Male probability:&quot;</span>, male_prob))</span></code></pre></div>
<pre><code>## [1] &quot;Male probability: 0.01918&quot;</code></pre>
<div class="sourceCode" id="section-cb92"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb92-1"><a href="#section-cb92-1" tabindex="-1"></a>female_prob <span class="ot">&lt;-</span> lx_f[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx_f[<span class="dv">0</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb92-2"><a href="#section-cb92-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Female probability:&quot;</span>, female_prob))</span></code></pre></div>
<pre><code>## [1] &quot;Female probability: 0.05113&quot;</code></pre>
<hr />
<p><strong>Find the probability for a 0 year old in Canada to reach the
age of 100 in 2021</strong></p>
<div class="sourceCode" id="section-cb94"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb94-1"><a href="#section-cb94-1" tabindex="-1"></a>canada_prob <span class="ot">&lt;-</span> lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">0</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb94-2"><a href="#section-cb94-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;M/F probability:&quot;</span>, canada_prob))</span></code></pre></div>
<pre><code>## [1] &quot;M/F probability: 0.03606&quot;</code></pre>
<p>If we compare this with an 18 year old individual</p>
<div class="sourceCode" id="section-cb96"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb96-1"><a href="#section-cb96-1" tabindex="-1"></a>canada_prob_2 <span class="ot">&lt;-</span> lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">18</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb96-2"><a href="#section-cb96-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;M/F age 18 probability:&quot;</span>, canada_prob_2))</span></code></pre></div>
<pre><code>## [1] &quot;M/F age 18 probability: 0.0363050591492575&quot;</code></pre>
<p>Vs a 40 year old individual</p>
<div class="sourceCode" id="section-cb98"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb98-1"><a href="#section-cb98-1" tabindex="-1"></a>canada_prob_5 <span class="ot">&lt;-</span> lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">40</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb98-2"><a href="#section-cb98-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;M/F age 40 probability:&quot;</span>, canada_prob_5))</span></code></pre></div>
<pre><code>## [1] &quot;M/F age 40 probability: 0.0370583520029597&quot;</code></pre>
<p>And again with a 75 year old individual</p>
<div class="sourceCode" id="section-cb100"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb100-1"><a href="#section-cb100-1" tabindex="-1"></a>canada_prob_3 <span class="ot">&lt;-</span> lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">75</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb100-2"><a href="#section-cb100-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;M/F age 75 probability:&quot;</span>, canada_prob_3))</span></code></pre></div>
<pre><code>## [1] &quot;M/F age 75 probability: 0.0473352585980572&quot;</code></pre>
<p>Finally, compare with a 98 year old individual</p>
<div class="sourceCode" id="section-cb102"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb102-1"><a href="#section-cb102-1" tabindex="-1"></a>canada_prob_4 <span class="ot">&lt;-</span> lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">98</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb102-2"><a href="#section-cb102-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;M/F age 98 probability:&quot;</span>, canada_prob_4))</span></code></pre></div>
<pre><code>## [1] &quot;M/F age 98 probability: 0.534459759893286&quot;</code></pre>
<div class="sourceCode" id="section-cb104"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb104-1"><a href="#section-cb104-1" tabindex="-1"></a>ages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">18</span>, <span class="dv">75</span>, <span class="dv">98</span>)</span>
<span id="section-cb104-2"><a href="#section-cb104-2" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="section-cb104-3"><a href="#section-cb104-3" tabindex="-1"></a>  lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">0</span> <span class="sc">+</span> <span class="dv">1</span>],</span>
<span id="section-cb104-4"><a href="#section-cb104-4" tabindex="-1"></a>  lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">18</span> <span class="sc">+</span> <span class="dv">1</span>],</span>
<span id="section-cb104-5"><a href="#section-cb104-5" tabindex="-1"></a>  lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">40</span> <span class="sc">+</span> <span class="dv">1</span>],</span>
<span id="section-cb104-6"><a href="#section-cb104-6" tabindex="-1"></a>  lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">75</span> <span class="sc">+</span> <span class="dv">1</span>],</span>
<span id="section-cb104-7"><a href="#section-cb104-7" tabindex="-1"></a>  lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">98</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb104-8"><a href="#section-cb104-8" tabindex="-1"></a>)</span>
<span id="section-cb104-9"><a href="#section-cb104-9" tabindex="-1"></a></span>
<span id="section-cb104-10"><a href="#section-cb104-10" tabindex="-1"></a></span>
<span id="section-cb104-11"><a href="#section-cb104-11" tabindex="-1"></a>prob_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Age =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;40&quot;</span>, <span class="st">&quot;75&quot;</span>, <span class="st">&quot;98&quot;</span>), <span class="at">Probability =</span> probs)</span>
<span id="section-cb104-12"><a href="#section-cb104-12" tabindex="-1"></a></span>
<span id="section-cb104-13"><a href="#section-cb104-13" tabindex="-1"></a></span>
<span id="section-cb104-14"><a href="#section-cb104-14" tabindex="-1"></a><span class="fu">barplot</span>(prob_data<span class="sc">$</span>Probability, </span>
<span id="section-cb104-15"><a href="#section-cb104-15" tabindex="-1"></a>        <span class="at">names.arg =</span> prob_data<span class="sc">$</span>Age,</span>
<span id="section-cb104-16"><a href="#section-cb104-16" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Probability of Reaching Age 100 from Different Starting Ages&quot;</span>,</span>
<span id="section-cb104-17"><a href="#section-cb104-17" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Starting Age&quot;</span>,</span>
<span id="section-cb104-18"><a href="#section-cb104-18" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Probability&quot;</span>,</span>
<span id="section-cb104-19"><a href="#section-cb104-19" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">&quot;skyblue&quot;</span>,</span>
<span id="section-cb104-20"><a href="#section-cb104-20" tabindex="-1"></a>        <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(probs) <span class="sc">*</span> <span class="fl">1.1</span>))  </span>
<span id="section-cb104-21"><a href="#section-cb104-21" tabindex="-1"></a></span>
<span id="section-cb104-22"><a href="#section-cb104-22" tabindex="-1"></a></span>
<span id="section-cb104-23"><a href="#section-cb104-23" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, </span>
<span id="section-cb104-24"><a href="#section-cb104-24" tabindex="-1"></a>     <span class="at">y =</span> probs,</span>
<span id="section-cb104-25"><a href="#section-cb104-25" tabindex="-1"></a>     <span class="at">labels =</span> <span class="fu">round</span>(probs, <span class="dv">5</span>),</span>
<span id="section-cb104-26"><a href="#section-cb104-26" tabindex="-1"></a>     <span class="at">pos =</span> <span class="dv">3</span>,</span>
<span id="section-cb104-27"><a href="#section-cb104-27" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="section-cb104-28"><a href="#section-cb104-28" tabindex="-1"></a></span>
<span id="section-cb104-29"><a href="#section-cb104-29" tabindex="-1"></a><span class="fu">grid</span>()</span></code></pre></div>
<p><img src="figures/unnamed-chunk-40-1.png" width="672" /></p>
<div class="sourceCode" id="section-cb105"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb105-1"><a href="#section-cb105-1" tabindex="-1"></a><span class="co"># Just adding a grid for some better readability</span></span></code></pre></div>
<p><strong>Plot the survival probabilties for (18) up to age
100</strong></p>
<div class="sourceCode" id="section-cb106"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb106-1"><a href="#section-cb106-1" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">82</span></span>
<span id="section-cb106-2"><a href="#section-cb106-2" tabindex="-1"></a><span class="fu">plot</span>(k, lx[<span class="dv">18</span> <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">18</span> <span class="sc">+</span> <span class="dv">1</span>], </span>
<span id="section-cb106-3"><a href="#section-cb106-3" tabindex="-1"></a>    <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="section-cb106-4"><a href="#section-cb106-4" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;k&quot;</span>, </span>
<span id="section-cb106-5"><a href="#section-cb106-5" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;&quot;</span>[k], <span class="st">&quot;p&quot;</span>[<span class="dv">18</span>])), </span>
<span id="section-cb106-6"><a href="#section-cb106-6" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Survival probabilities for age 18 up to 100&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-41-1.png" width="672" /></p>
<p>Compare this with a 50 year old</p>
<div class="sourceCode" id="section-cb107"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb107-1"><a href="#section-cb107-1" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="section-cb107-2"><a href="#section-cb107-2" tabindex="-1"></a><span class="fu">plot</span>(k, lx[<span class="dv">50</span> <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">50</span> <span class="sc">+</span> <span class="dv">1</span>], </span>
<span id="section-cb107-3"><a href="#section-cb107-3" tabindex="-1"></a>    <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="section-cb107-4"><a href="#section-cb107-4" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;k&quot;</span>, </span>
<span id="section-cb107-5"><a href="#section-cb107-5" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;&quot;</span>[k], <span class="st">&quot;p&quot;</span>[<span class="dv">50</span>])), </span>
<span id="section-cb107-6"><a href="#section-cb107-6" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Survival probabilities for age 50 up to 100&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-42-1.png" width="672" /></p>
<p><strong>Plot the number of deaths</strong></p>
<div class="sourceCode" id="section-cb108"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb108-1"><a href="#section-cb108-1" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="section-cb108-2"><a href="#section-cb108-2" tabindex="-1"></a>  <span class="fu">plot</span>(age, dx, </span>
<span id="section-cb108-3"><a href="#section-cb108-3" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">&quot;h&quot;</span>, </span>
<span id="section-cb108-4"><a href="#section-cb108-4" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="section-cb108-5"><a href="#section-cb108-5" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>, </span>
<span id="section-cb108-6"><a href="#section-cb108-6" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="st">&quot;d&quot;</span>[x]),</span>
<span id="section-cb108-7"><a href="#section-cb108-7" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Number of deaths (Canada, M/F, 2021)&quot;</span>)</span>
<span id="section-cb108-8"><a href="#section-cb108-8" tabindex="-1"></a>  </span>
<span id="section-cb108-9"><a href="#section-cb108-9" tabindex="-1"></a>  sims <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">length</span>(lx), <span class="at">size =</span> lx, <span class="at">prob =</span> qx)</span>
<span id="section-cb108-10"><a href="#section-cb108-10" tabindex="-1"></a>  </span>
<span id="section-cb108-11"><a href="#section-cb108-11" tabindex="-1"></a>  <span class="fu">points</span>(age, sims, </span>
<span id="section-cb108-12"><a href="#section-cb108-12" tabindex="-1"></a>         <span class="at">pch =</span> <span class="dv">4</span>, </span>
<span id="section-cb108-13"><a href="#section-cb108-13" tabindex="-1"></a>         <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="section-cb108-14"><a href="#section-cb108-14" tabindex="-1"></a>})</span></code></pre></div>
<p><img src="figures/unnamed-chunk-43-1.png" width="672" /></p>
</div>
<div
id="section-probability-that-individual-of-age-x-survives-y-more-years"
class="section level3">
<h3>Probability that individual of age x survives y more years</h3>
<p><strong>Calculate the probability that (25) survives 5 more
years</strong></p>
<details>
<summary style="font-weight: bold; color: blue;">
Explanation
</summary>
<p>
<p><strong>px Calculation:</strong><br> px typically represents the
survival probability (1 - qx) at each age x. In this context, it’s
assumed to be a sequence or vector containing survival probabilities for
each age from 25 onwards.<br><br></p>
<p><strong>Subset of px:</strong><br> px[(25 + 1):(30 + 1)] selects a
subset of px starting from age 26 (25 + 1) to age 31 (30 + 1). This
corresponds to the ages from 26 to 30, inclusive.<br><br></p>
<p><strong>Product Calculation:</strong><br> prod(px[(25 + 1):(30 + 1)])
calculates the product of the survival probabilities for the selected
ages. This multiplication represents the joint probability that a
25-year-old individual survives consecutively from age 25 to age 30 (5
years in total).<br><br></p>
<strong>Output:</strong><br> cat(“Prob that a 25 year old survives for 5
more years =”, value1) prints the result to the console in a
human-readable format. It displays the calculated probability that a
25-year-old individual survives for exactly 5 more years based on the
provided survival probabilities.
</p>
</details>
<div class="sourceCode" id="section-cb109"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb109-1"><a href="#section-cb109-1" tabindex="-1"></a>value1 <span class="ot">&lt;-</span> <span class="fu">prod</span>(px[(<span class="dv">25</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">30</span> <span class="sc">+</span> <span class="dv">1</span>)])</span>
<span id="section-cb109-2"><a href="#section-cb109-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Prob that a 25 year old survives for 5 more years =&quot;</span>, value1)</span></code></pre></div>
<pre><code>## Prob that a 25 year old survives for 5 more years = 0.9946519</code></pre>
<p><em>How to interpret these results</em>:</p>
<p>At age 25, our survival probability is very high, close to 100% ie
nearly all individuals who are 25 years old are expected to survive to
the next age, 26. As the individual ages, the survival probabilities
gradually decrease. For example, at age 30, the survival probability
might be around 0.994, indicating that about 99.4% of individuals who
reached age 30 are expected to survive to age 31.</p>
<p>By age 50, the survival probability decreases further, reflecting the
increased likelihood of mortality as people grow older. For instance, a
survival probability of 0.874 at age 50 means that approximately 87.4%
of individuals who reach age 50 are expected to survive to age 51.</p>
<p>Towards older ages, such as age 70 and beyond, the survival
probabilities continue to decline more steeply. This reflects the
increasing vulnerability to health risks and mortality associated with
advanced age.</p>
<p><strong>Compute the survival probabilities of (25) until the age of
100</strong></p>
<details>
<summary style="font-weight: bold; color: blue;">
Explanation
</summary>
<p>
<p><strong>Survival Probability (px):</strong><br> px is a vector where
each element represents the probability of survival (1 - qx) at a
specific age x. It starts from age 25 and continues for subsequent
ages.<br><br></p>
<p><strong>Subset of Survival Probabilities (px[(25 + 1):(99 +
1)]):</strong><br> This selects a subset of px starting from age 26 (25
+ 1) to age 100 (99 + 1). These are the survival probabilities
considered for each age from 25 to 100.<br><br></p>
<strong>Cumulative Product Calculation (cumprod(px[(25 + 1):(99 +
1)])):</strong><br> cumprod calculates the cumulative product of the
selected survival probabilities. It computes the joint probability that
a 25-year-old individual survives consecutively from age 25 up to age
100. Each value in kpx represents the accumulated survival probability
up to each respective age.
</p>
</details>
<div class="sourceCode" id="section-cb111"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb111-1"><a href="#section-cb111-1" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(px[(<span class="dv">25</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">99</span> <span class="sc">+</span> <span class="dv">1</span>)])</span>
<span id="section-cb111-2"><a href="#section-cb111-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Survival prob&#39;s of a 25 year old until 100 =&quot;</span>, kpx)</span></code></pre></div>
<pre><code>## Survival prob&#39;s of a 25 year old until 100 = 0.9992 0.9984006 0.9975121 0.9966542 0.9956276 0.9946519 0.9936573 0.992604 0.9914824 0.9904016 0.9891141 0.987858 0.9864947 0.9850742 0.9837443 0.9821998 0.9807265 0.9792162 0.9776593 0.9758506 0.9740257 0.972068 0.970153 0.9679798 0.9655212 0.962866 0.9599004 0.9569247 0.9536616 0.9499041 0.945981 0.9417336 0.9371285 0.932246 0.9266619 0.9206942 0.9143782 0.9075387 0.9002874 0.8924099 0.8837089 0.8745449 0.8647237 0.8540703 0.842361 0.8300204 0.8165907 0.8025617 0.7872889 0.7701418 0.7523361 0.7328732 0.711913 0.6888043 0.6647788 0.6390851 0.611336 0.5820286 0.5505234 0.5169249 0.4817068 0.4448996 0.407141 0.3675954 0.3271856 0.2868076 0.2478965 0.2109524 0.1754449 0.1430666 0.1145033 0.08950153 0.06820643 0.05058803 0.03645575</code></pre>
<p><em>How to interpret these results</em>:</p>
<p>The output kpx provides a sequence of survival probabilities for each
age from 25 to 100. For example, if kpx[1] is 0.9992, it means there’s a
99.92% chance that a 25-year-old individual will survive until age 26.
Similarly, kpx[2] (0.9984006) represents the probability of surviving
from age 25 to age 27, and so on.</p>
<p><strong>Extract the probability that (25) survives until the age of
100</strong></p>
<div class="sourceCode" id="section-cb113"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb113-1"><a href="#section-cb113-1" tabindex="-1"></a>value3 <span class="ot">&lt;-</span> kpx[<span class="fu">length</span>(kpx)]</span>
<span id="section-cb113-2"><a href="#section-cb113-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Prob that a 25 year old survives until 100:&quot;</span>, value3)</span></code></pre></div>
<pre><code>## Prob that a 25 year old survives until 100: 0.03645575</code></pre>
<p><strong>Plot the probabilties for (25) to reach the age of 26, 27, …,
100</strong></p>
<div class="sourceCode" id="section-cb115"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb115-1"><a href="#section-cb115-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(kpx), kpx,</span>
<span id="section-cb115-2"><a href="#section-cb115-2" tabindex="-1"></a>    <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="section-cb115-3"><a href="#section-cb115-3" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;k&quot;</span>,</span>
<span id="section-cb115-4"><a href="#section-cb115-4" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;&quot;</span>[k], <span class="st">&quot;p&quot;</span>[<span class="dv">25</span>])),</span>
<span id="section-cb115-5"><a href="#section-cb115-5" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Survival probabilities for (25)&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-47-1.png" width="672" /></p>
</div>
</div>
<div
id="section-survival-probabilities-and-curtate-expected-future-lifetime"
class="section level2">
<h2>Survival Probabilities and Curtate Expected Future Lifetime</h2>
<details>
<summary>
What is Curtate Expected Future Lifetime?
</summary>
<p style="font-weight: bold; color: blue;">
Curtate expected future lifetime is a statistical measure used in
actuarial science and life insurance. It represents the expected number
of whole years a person, starting at a given age, is expected to live
into the future. This measure is calculated by considering the
probability of surviving each year from the current age until the
individual’s death. Curtate expected future lifetime provides valuable
insights into life expectancy and is crucial for determining insurance
premiums and retirement planning.
</p>
</details>
<p><strong>Compute the survival probabilities of (25)</strong></p>
<div class="sourceCode" id="section-cb116"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb116-1"><a href="#section-cb116-1" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(<span class="dv">25</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">length</span>(px) <span class="sc">-</span> <span class="dv">1</span>)]))</span>
<span id="section-cb116-2"><a href="#section-cb116-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Survival prob&#39;s of a 25 year old:&quot;</span>, kpx)</span></code></pre></div>
<pre><code>## Survival prob&#39;s of a 25 year old: 1 0.9992 0.9984006 0.9975121 0.9966542 0.9956276 0.9946519 0.9936573 0.992604 0.9914824 0.9904016 0.9891141 0.987858 0.9864947 0.9850742 0.9837443 0.9821998 0.9807265 0.9792162 0.9776593 0.9758506 0.9740257 0.972068 0.970153 0.9679798 0.9655212 0.962866 0.9599004 0.9569247 0.9536616 0.9499041 0.945981 0.9417336 0.9371285 0.932246 0.9266619 0.9206942 0.9143782 0.9075387 0.9002874 0.8924099 0.8837089 0.8745449 0.8647237 0.8540703 0.842361 0.8300204 0.8165907 0.8025617 0.7872889 0.7701418 0.7523361 0.7328732 0.711913 0.6888043 0.6647788 0.6390851 0.611336 0.5820286 0.5505234 0.5169249 0.4817068 0.4448996 0.407141 0.3675954 0.3271856 0.2868076 0.2478965 0.2109524 0.1754449 0.1430666 0.1145033 0.08950153 0.06820643 0.05058803 0.03645575 0.02548512 0.01725751 0.0113047 0.007155764 0.004373102 0.002578643 0.001466681 0.000804665 0.0004259575 0.0002176983</code></pre>
<p><strong>Compute the deferred mortality probabilities of
(25)</strong></p>
<details>
<summary style="font-weight: bold; color: blue;">
Explanation
</summary>
<p>
<p><strong>Deferred Mortality Probabilities of a
25-Year-Old:</strong><br> The <code>kqx</code> values calculated
represent the adjusted probabilities of dying at each age from 26
onwards, starting from age 25. Here’s how this calculation
works:<br><br></p>
<p><strong>Original Survival Probabilities
(<code>kpx</code>):</strong><br> <code>kpx</code> is a sequence of
probabilities that a 25-year-old individual will survive from age 25 up
to each subsequent age. It starts with a probability of 1 (indicating
certainty of survival at age 25) and adjusts slightly with each
subsequent age.<br><br></p>
<p><strong>Adjusted for Mortality Rate (<code>qx</code>):</strong><br>
<code>qx</code> represents the mortality rate at each age. It’s the
probability of dying within the next year at a given age. Multiplying
<code>kpx</code> by <code>qx</code> adjusts the survival probabilities
to reflect the increasing risk of mortality as individuals
age.<br><br></p>
<p><strong>Interpreting <code>kqx</code>:</strong><br> Each value in
<code>kqx</code> shows the adjusted probability that a 25-year-old
individual will survive to each subsequent age, considering the
mortality rate specific to that age. For example, <code>kqx[1]</code>
(0.9992) indicates the probability of surviving from age 25 to age 26,
adjusted for mortality at age 26. Similarly, <code>kqx[2]</code>
(0.9984006) represents the adjusted survival probability from age 25 to
age 27, and so on.<br><br></p>
</p>
</details>
<div class="sourceCode" id="section-cb118"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb118-1"><a href="#section-cb118-1" tabindex="-1"></a>kqx <span class="ot">&lt;-</span> kpx <span class="sc">*</span> qx[(<span class="dv">25</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(qx)]</span>
<span id="section-cb118-2"><a href="#section-cb118-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Deferred mortality prob&#39;s of a 25 year old:&quot;</span>, kpx)</span></code></pre></div>
<pre><code>## Deferred mortality prob&#39;s of a 25 year old: 1 0.9992 0.9984006 0.9975121 0.9966542 0.9956276 0.9946519 0.9936573 0.992604 0.9914824 0.9904016 0.9891141 0.987858 0.9864947 0.9850742 0.9837443 0.9821998 0.9807265 0.9792162 0.9776593 0.9758506 0.9740257 0.972068 0.970153 0.9679798 0.9655212 0.962866 0.9599004 0.9569247 0.9536616 0.9499041 0.945981 0.9417336 0.9371285 0.932246 0.9266619 0.9206942 0.9143782 0.9075387 0.9002874 0.8924099 0.8837089 0.8745449 0.8647237 0.8540703 0.842361 0.8300204 0.8165907 0.8025617 0.7872889 0.7701418 0.7523361 0.7328732 0.711913 0.6888043 0.6647788 0.6390851 0.611336 0.5820286 0.5505234 0.5169249 0.4817068 0.4448996 0.407141 0.3675954 0.3271856 0.2868076 0.2478965 0.2109524 0.1754449 0.1430666 0.1145033 0.08950153 0.06820643 0.05058803 0.03645575 0.02548512 0.01725751 0.0113047 0.007155764 0.004373102 0.002578643 0.001466681 0.000804665 0.0004259575 0.0002176983</code></pre>
<details>
<summary style="font-weight: bold; color: blue;">
Why Use Deferred Mortality Probabilities?
</summary>
<p>
<p><strong>Risk Assessment:</strong> Deferred mortality probabilities
provide a more accurate assessment of mortality risk over time. By
adjusting survival probabilities with age-specific mortality rates
(<code>qx</code>), they reflect the increasing likelihood of death as
individuals age.<br><br></p>
<p><strong>Product Design:</strong> Insurance companies and pension
funds use deferred mortality probabilities to design products such as
life insurance policies and annuities. These products rely on accurate
estimates of how mortality risk changes with age to determine premiums
and payouts.<br><br></p>
<p><strong>Financial Planning:</strong> Individuals and institutions use
deferred mortality probabilities for retirement planning and financial
forecasting. They help in estimating life expectancies and determining
the financial resources needed for retirement based on expected future
lifetimes.<br><br></p>
<p><strong>Actuarial Calculations:</strong> Actuaries use deferred
mortality probabilities in complex calculations such as pension fund
valuations, reserve calculations, and risk assessments. These
calculations ensure that financial institutions have adequate reserves
to cover future obligations.<br><br></p>
<p><strong>Long-Term Commitments:</strong> Many financial products, such
as pensions and annuities, involve long-term commitments spanning
several decades. Deferred mortality probabilities provide insights into
how mortality risk impacts these long-term financial
commitments.<br><br></p>
Overall, deferred mortality probabilities are essential tools in
understanding and managing mortality risk in various financial contexts.
They provide a nuanced view of how survival probabilities change with
age, informing decisions that impact both individuals and financial
institutions over the long term.
</p>
</details>
<p><strong>Plot the deferred mortality probabilities of
(25)</strong></p>
<div class="sourceCode" id="section-cb120"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb120-1"><a href="#section-cb120-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span><span class="sc">:</span>(<span class="fu">length</span>(kqx) <span class="sc">-</span> <span class="dv">1</span>), kqx,</span>
<span id="section-cb120-2"><a href="#section-cb120-2" tabindex="-1"></a>    <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="section-cb120-3"><a href="#section-cb120-3" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;k&quot;</span>,</span>
<span id="section-cb120-4"><a href="#section-cb120-4" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;&quot;</span>[<span class="st">&#39;k|&#39;</span>], <span class="st">&quot;q&quot;</span>[<span class="dv">25</span>])),</span>
<span id="section-cb120-5"><a href="#section-cb120-5" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Deferred mortality probabilities of (25)&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-50-1.png" width="672" /></p>
<p><strong>Survival probabilities and curtate expected future lifetime
of (0)</strong></p>
<div class="sourceCode" id="section-cb121"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb121-1"><a href="#section-cb121-1" tabindex="-1"></a>kp0 <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(px)</span>
<span id="section-cb121-2"><a href="#section-cb121-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Survival prob&#39;s of a 0 year old&quot;</span>, kp0)</span></code></pre></div>
<pre><code>## Survival prob&#39;s of a 0 year old 0.99563 0.995391 0.9952517 0.9951223 0.9950328 0.9949432 0.9948835 0.9948238 0.9947442 0.9946746 0.994595 0.9945154 0.9944061 0.9942867 0.9941575 0.9939288 0.9936406 0.993263 0.992826 0.9923295 0.9917937 0.9912383 0.9906336 0.9899204 0.989168 0.9883767 0.987586 0.986707 0.9858585 0.984843 0.9838779 0.982894 0.9818521 0.9807427 0.9796736 0.9784001 0.9771575 0.975809 0.9744039 0.9730884 0.9715607 0.9701033 0.9686094 0.9670693 0.9652802 0.9634751 0.9615385 0.9596443 0.9574947 0.9550627 0.9524362 0.9495027 0.9465593 0.9433315 0.9396148 0.9357342 0.9315327 0.9269775 0.922148 0.9166243 0.9107213 0.9044737 0.8977082 0.8905356 0.8827434 0.8741366 0.8650718 0.8553571 0.8448191 0.8332366 0.8210297 0.8077454 0.7938684 0.778761 0.7617996 0.7441868 0.7249347 0.7042016 0.6813432 0.6575779 0.6321626 0.6047141 0.5757241 0.5445601 0.5113256 0.476489 0.4400805 0.4027308 0.3636136 0.3236416 0.283701 0.2452112 0.2086674 0.1735445 0.1415169 0.113263 0.08853205 0.06746762 0.05004006 0.03606087 0.02520907 0.01707057 0.01118225 0.007078253 0.004325732 0.002550711 0.001450794 0.0007959489 0.0004213435 0.0002153402 0</code></pre>
<div class="sourceCode" id="section-cb123"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb123-1"><a href="#section-cb123-1" tabindex="-1"></a>sum_kp0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(kp0)</span>
<span id="section-cb123-2"><a href="#section-cb123-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Curtate expected future lifetime of a 0 year old&quot;</span>,sum_kp0 )</span></code></pre></div>
<pre><code>## Curtate expected future lifetime of a 0 year old 81.15437</code></pre>
<p><strong>Survival probabilities and curtate expected future lifetime
of a 25 year old</strong></p>
<div class="sourceCode" id="section-cb125"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb125-1"><a href="#section-cb125-1" tabindex="-1"></a>kp25 <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(px[(<span class="dv">25</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(px)])</span>
<span id="section-cb125-2"><a href="#section-cb125-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Survival prob&#39;s of a 25 year old&quot;</span>, kp25)</span></code></pre></div>
<pre><code>## Survival prob&#39;s of a 25 year old 0.9992 0.9984006 0.9975121 0.9966542 0.9956276 0.9946519 0.9936573 0.992604 0.9914824 0.9904016 0.9891141 0.987858 0.9864947 0.9850742 0.9837443 0.9821998 0.9807265 0.9792162 0.9776593 0.9758506 0.9740257 0.972068 0.970153 0.9679798 0.9655212 0.962866 0.9599004 0.9569247 0.9536616 0.9499041 0.945981 0.9417336 0.9371285 0.932246 0.9266619 0.9206942 0.9143782 0.9075387 0.9002874 0.8924099 0.8837089 0.8745449 0.8647237 0.8540703 0.842361 0.8300204 0.8165907 0.8025617 0.7872889 0.7701418 0.7523361 0.7328732 0.711913 0.6888043 0.6647788 0.6390851 0.611336 0.5820286 0.5505234 0.5169249 0.4817068 0.4448996 0.407141 0.3675954 0.3271856 0.2868076 0.2478965 0.2109524 0.1754449 0.1430666 0.1145033 0.08950153 0.06820643 0.05058803 0.03645575 0.02548512 0.01725751 0.0113047 0.007155764 0.004373102 0.002578643 0.001466681 0.000804665 0.0004259575 0.0002176983 0</code></pre>
<div class="sourceCode" id="section-cb127"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb127-1"><a href="#section-cb127-1" tabindex="-1"></a>sum_kp25 <span class="ot">&lt;-</span> <span class="fu">sum</span>(kp25)</span>
<span id="section-cb127-2"><a href="#section-cb127-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Curtate expected future lifetime of a 25 year old&quot;</span>,sum_kp25 )</span></code></pre></div>
<pre><code>## Curtate expected future lifetime of a 25 year old 56.92983</code></pre>
<p><strong>Complete expected future lifetime of (0) and
(25)</strong></p>
<div class="sourceCode" id="section-cb129"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb129-1"><a href="#section-cb129-1" tabindex="-1"></a>efl <span class="ot">&lt;-</span> ex[<span class="fu">c</span>(<span class="dv">0</span> <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">25</span> <span class="sc">+</span> <span class="dv">1</span>)]</span>
<span id="section-cb129-2"><a href="#section-cb129-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Expected future lifetime of a 0 and 25 year old&quot;</span>, efl)</span></code></pre></div>
<pre><code>## Expected future lifetime of a 0 and 25 year old 81.65 57.43</code></pre>
<div
id="section-function-to-compute-the-curtate-expected-future-lifetime-for-a-given-age-and-life-table"
class="section level3">
<h3>Function to compute the curtate expected future lifetime for a given
age and life table</h3>
<details>
<summary style="font-weight: bold; color: blue;">
Explanation: Computing Curtate Expected Future Lifetime
</summary>
<p>
<p><strong>Function Purpose:</strong> The function
<code>curtate_future_lifetime</code> calculates the curtate expected
future lifetime for a given starting age using a life table
dataset.<br><br></p>
<p><strong>Inputs:</strong></p>
<ul>
<li><p><code>age2</code>: Represents the starting age for which we want
to compute the curtate expected future lifetime.</p>
<ul>
<li><code>life_table</code>: Contains mortality data including qx
(probability of dying between ages x and x+1) needed for
calculations.<br><br></li>
</ul>
<p><strong>Steps:</strong></p>
<ol style="list-style-type: decimal">
<li><strong>qx Calculation:</strong> Extracts qx values from the
<code>life_table</code>. qx represents the probability of dying between
ages x and x+1.<br></li>
<li><strong>px Calculation:</strong> Computes px as 1 - qx, which
represents the probability of survival between ages x and x+1.<br></li>
<li><strong>Subset and Cumulative Product:</strong> Selects and computes
the cumulative product of px values starting from <code>age2 + 1</code>
to the end of the dataset. This sequence represents the joint
probability of surviving each subsequent year after
<code>age2</code>.<br></li>
<li><strong>Summation:</strong> Sums up the cumulative product
(<code>kpx</code>) to obtain the curtate expected future lifetime, which
represents the expected number of full years an individual aged
<code>age2</code> is expected to live from that age.<br><br></li>
</ol>
<p><strong>Output:</strong> The function returns the computed curtate
expected future lifetime as a numeric value.<br><br></p>
<p>This function is crucial in actuarial science and insurance for
estimating life expectancies and making financial projections based on
mortality data.</p>
</p>
</details></li>
</ul>
<div class="sourceCode" id="section-cb131"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb131-1"><a href="#section-cb131-1" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="section-cb131-2"><a href="#section-cb131-2" tabindex="-1"></a>  curtate_future_lifetime <span class="ot">&lt;-</span> <span class="cf">function</span>(age2, life_table) {</span>
<span id="section-cb131-3"><a href="#section-cb131-3" tabindex="-1"></a>    qx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>qx</span>
<span id="section-cb131-4"><a href="#section-cb131-4" tabindex="-1"></a>    px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> qx</span>
<span id="section-cb131-5"><a href="#section-cb131-5" tabindex="-1"></a>    kpx <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(px[(age2 <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(px)])</span>
<span id="section-cb131-6"><a href="#section-cb131-6" tabindex="-1"></a>    <span class="fu">sum</span>(kpx)</span>
<span id="section-cb131-7"><a href="#section-cb131-7" tabindex="-1"></a>  }</span>
<span id="section-cb131-8"><a href="#section-cb131-8" tabindex="-1"></a>})</span></code></pre></div>
<p><strong>Curtate future lifetimes for all ages</strong></p>
<div class="sourceCode" id="section-cb132"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb132-1"><a href="#section-cb132-1" tabindex="-1"></a>valid_ages <span class="ot">&lt;-</span> age2[<span class="sc">!</span><span class="fu">is.na</span>(age2)]</span>
<span id="section-cb132-2"><a href="#section-cb132-2" tabindex="-1"></a>future_lifetimes <span class="ot">&lt;-</span> <span class="fu">sapply</span>(valid_ages, <span class="cf">function</span>(age) <span class="fu">curtate_future_lifetime</span>(age, life_table))</span>
<span id="section-cb132-3"><a href="#section-cb132-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Future lifetimes for all ages:&quot;</span>, future_lifetimes)</span></code></pre></div>
<pre><code>## Future lifetimes for all ages: 81.15437 80.51057 79.5299 78.54103 77.55124 76.55822 75.56511 74.56965 73.57412 72.58001 71.58509 70.59082 69.59647 68.60412 67.61236 66.62115 65.63647 64.65551 63.68009 62.70812 61.73949 60.77285 59.8069 58.84341 57.8858 56.92983 55.97541 55.02023 54.06924 53.11578 52.17054 51.22172 50.27299 49.32634 48.38214 47.43494 46.49668 45.55581 44.61876 43.68311 42.74216 41.80937 40.87218 39.93522 38.99881 38.0711 37.14242 36.21723 35.28872 34.36794 33.45546 32.54771 31.64827 30.74669 29.85189 28.96997 28.09012 27.21681 26.35055 25.48856 24.64215 23.80188 22.96629 22.13937 21.31769 20.50586 19.70777 18.91428 18.1291 17.35523 16.59648 15.84323 15.10379 14.36781 13.64654 12.95037 12.25687 11.58238 10.92339 10.28986 9.661739 9.050179 8.460974 7.887018 7.338374 6.815344 6.313621 5.835957 5.377189 4.955662 4.567722 4.210785 3.871733 3.549788 3.268213 3.007865 2.758187 2.528673 2.318163 2.125515 1.949482 1.788679 1.641443 1.50579 1.378853 1.256235 1.13044 0.987482 0.7999053 0.51108</code></pre>
<p><em>How to interpret</em>:</p>
<p>These are the expected number of years an individual, starting from
each age, is expected to live based on the curtate expected future
lifetime calculation.Each value corresponds to the expected future
lifetime for individuals starting from different ages.</p>
<p>For example, the first value, 81.15437, indicates that a 25-year-old
individual is expected to live approximately 81.15 years on average. The
values decrease as the starting age increases, reflecting the decreasing
life expectancy as individuals age. These estimates are based on
mortality data and assume that future mortality rates remain consistent
with those observed in the life table used for calculation.</p>
<div class="sourceCode" id="section-cb134"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb134-1"><a href="#section-cb134-1" tabindex="-1"></a><span class="co"># Future lifetime by age</span></span>
<span id="section-cb134-2"><a href="#section-cb134-2" tabindex="-1"></a><span class="fu">plot</span>(age2[<span class="sc">!</span><span class="fu">is.na</span>(age2)], future_lifetimes, <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Future lifetime&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Future lifetime by age&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-56-1.png" width="672" /></p>
<p><strong>Plot the logarithm of the male/female mortality rates for
(18) by year</strong></p>
<div class="sourceCode" id="section-cb135"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb135-1"><a href="#section-cb135-1" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="section-cb135-2"><a href="#section-cb135-2" tabindex="-1"></a>  life_table <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">megacrazyleo</span><span class="sc">\\</span><span class="st">Desktop</span><span class="sc">\\</span><span class="st">SQL</span><span class="sc">\\</span><span class="st">R</span><span class="sc">\\</span><span class="st">bltper_1x1.txt&quot;</span>, <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">skip =</span> <span class="dv">3</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>) </span>
<span id="section-cb135-3"><a href="#section-cb135-3" tabindex="-1"></a>  <span class="fu">colnames</span>(life_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Age&quot;</span>, <span class="st">&quot;mx&quot;</span>, <span class="st">&quot;qx&quot;</span>, <span class="st">&quot;ax&quot;</span>, <span class="st">&quot;lx&quot;</span>, <span class="st">&quot;dx&quot;</span>, <span class="st">&quot;Lx&quot;</span>, <span class="st">&quot;Tx&quot;</span>, <span class="st">&quot;ex&quot;</span>)</span>
<span id="section-cb135-4"><a href="#section-cb135-4" tabindex="-1"></a></span>
<span id="section-cb135-5"><a href="#section-cb135-5" tabindex="-1"></a>  </span>
<span id="section-cb135-6"><a href="#section-cb135-6" tabindex="-1"></a>  life_table<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(life_table<span class="sc">$</span>Age)</span>
<span id="section-cb135-7"><a href="#section-cb135-7" tabindex="-1"></a></span>
<span id="section-cb135-8"><a href="#section-cb135-8" tabindex="-1"></a>  <span class="co"># Subset the life table for age 18</span></span>
<span id="section-cb135-9"><a href="#section-cb135-9" tabindex="-1"></a>  subset_18 <span class="ot">&lt;-</span> <span class="fu">subset</span>(life_table, Age <span class="sc">==</span> <span class="dv">18</span>)</span>
<span id="section-cb135-10"><a href="#section-cb135-10" tabindex="-1"></a></span>
<span id="section-cb135-11"><a href="#section-cb135-11" tabindex="-1"></a>  </span>
<span id="section-cb135-12"><a href="#section-cb135-12" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(subset_18) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="section-cb135-13"><a href="#section-cb135-13" tabindex="-1"></a>    <span class="fu">with</span>(subset_18,</span>
<span id="section-cb135-14"><a href="#section-cb135-14" tabindex="-1"></a>         <span class="fu">plot</span>(Year, <span class="fu">log</span>(qx),</span>
<span id="section-cb135-15"><a href="#section-cb135-15" tabindex="-1"></a>              <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Log mortality rates (Canada, M/F, 18-year-old)&quot;</span>,</span>
<span id="section-cb135-16"><a href="#section-cb135-16" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="st">&quot;Year t&quot;</span>, <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Log mortality rate &quot;</span>, <span class="fu">log</span>(q[<span class="dv">18</span>])))))</span>
<span id="section-cb135-17"><a href="#section-cb135-17" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="section-cb135-18"><a href="#section-cb135-18" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&quot;No data available for age 18&quot;</span>)</span>
<span id="section-cb135-19"><a href="#section-cb135-19" tabindex="-1"></a>  }</span>
<span id="section-cb135-20"><a href="#section-cb135-20" tabindex="-1"></a>})</span></code></pre></div>
<p><img src="figures/unnamed-chunk-57-1.png" width="672" /></p>
<p><strong>Plot the logarithm of the female mortality rates in the year
1950 by age</strong></p>
<div class="sourceCode" id="section-cb136"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb136-1"><a href="#section-cb136-1" tabindex="-1"></a><span class="co"># Subset the life table for the year 1950</span></span>
<span id="section-cb136-2"><a href="#section-cb136-2" tabindex="-1"></a>subset_1950 <span class="ot">&lt;-</span> <span class="fu">subset</span>(life_table, Year <span class="sc">==</span> <span class="dv">1950</span>)</span>
<span id="section-cb136-3"><a href="#section-cb136-3" tabindex="-1"></a></span>
<span id="section-cb136-4"><a href="#section-cb136-4" tabindex="-1"></a></span>
<span id="section-cb136-5"><a href="#section-cb136-5" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(subset_1950) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="section-cb136-6"><a href="#section-cb136-6" tabindex="-1"></a>  <span class="fu">with</span>(subset_1950,</span>
<span id="section-cb136-7"><a href="#section-cb136-7" tabindex="-1"></a>       <span class="fu">plot</span>(Age, <span class="fu">log</span>(qx),</span>
<span id="section-cb136-8"><a href="#section-cb136-8" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Log mortality rates (Canada, M/F, 1950)&quot;</span>,</span>
<span id="section-cb136-9"><a href="#section-cb136-9" tabindex="-1"></a>            <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>, <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Log mortality rate &quot;</span>, <span class="fu">log</span>(q[x])))))</span>
<span id="section-cb136-10"><a href="#section-cb136-10" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="section-cb136-11"><a href="#section-cb136-11" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;No data available for the year 1950&quot;</span>)</span>
<span id="section-cb136-12"><a href="#section-cb136-12" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="figures/unnamed-chunk-58-1.png" width="672" /></p>
<p><strong>Constructing and printing the cohort life table for birth
year 1981</strong></p>
<div class="sourceCode" id="section-cb137"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb137-1"><a href="#section-cb137-1" tabindex="-1"></a>life_table_1981 <span class="ot">&lt;-</span> <span class="fu">subset</span>(life_table, Year <span class="sc">-</span> Age <span class="sc">==</span> <span class="dv">1981</span>)</span>
<span id="section-cb137-2"><a href="#section-cb137-2" tabindex="-1"></a>life_table_1981</span></code></pre></div>
<pre><code>##       Year Age      mx      qx   ax     lx  dx    Lx      Tx    ex
## 6661  1981   0 0.00972 0.00963 0.13 100000 963 99161 7548411 75.48
## 6773  1982   1 0.00063 0.00063 0.50  99076  63 99045 7470238 75.40
## 6885  1983   2 0.00044 0.00044 0.50  99077  43 99056 7408421 74.77
## 6997  1984   3 0.00039 0.00039 0.50  99073  39 99053 7338302 74.07
## 7109  1985   4 0.00028 0.00028 0.50  99059  28 99045 7238256 73.07
## 7221  1986   5 0.00029 0.00029 0.50  99037  29 99022 7153349 72.23
## 7333  1987   6 0.00020 0.00020 0.50  99077  20 99066 7084561 71.51
## 7445  1988   7 0.00023 0.00023 0.50  99072  23 99061 6991848 70.57
## 7557  1989   8 0.00017 0.00017 0.50  99056  17 99048 6919036 69.85
## 7669  1990   9 0.00020 0.00020 0.50  99091  20 99081 6850504 69.13
## 7781  1991  10 0.00015 0.00015 0.50  99150  15 99143 6766861 68.25
## 7893  1992  11 0.00015 0.00015 0.50  99164  15 99157 6692921 67.49
## 8005  1993  12 0.00021 0.00021 0.50  99150  21 99140 6581079 66.37
## 8117  1994  13 0.00026 0.00026 0.50  99122  26 99109 6499918 65.57
## 8229  1995  14 0.00027 0.00027 0.50  99134  26 99121 6412031 64.68
## 8341  1996  15 0.00031 0.00031 0.50  99180  31 99165 6337554 63.90
## 8453  1997  16 0.00053 0.00053 0.50  99141  52 99115 6257835 63.12
## 8565  1998  17 0.00042 0.00042 0.50  99150  41 99130 6178885 62.32
## 8677  1999  18 0.00063 0.00063 0.50  99099  62 99068 6100645 61.56
## 8789  2000  19 0.00064 0.00064 0.50  99080  63 99048 6035708 60.92
## 8901  2001  20 0.00059 0.00059 0.50  99008  58 98979 5958898 60.19
## 9013  2002  21 0.00058 0.00058 0.50  98946  57 98917 5871755 59.34
## 9125  2003  22 0.00055 0.00055 0.50  98905  54 98878 5789571 58.54
## 9237  2004  23 0.00055 0.00055 0.50  98888  55 98861 5719518 57.84
## 9349  2005  24 0.00056 0.00056 0.50  98782  56 98755 5631507 57.01
## 9461  2006  25 0.00056 0.00056 0.50  98779  55 98751 5572998 56.42
## 9573  2007  26 0.00057 0.00057 0.50  98728  56 98700 5474686 55.45
## 9685  2008  27 0.00050 0.00050 0.50  98717  49 98693 5394059 54.64
## 9797  2009  28 0.00050 0.00050 0.50  98709  49 98684 5327781 53.97
## 9909  2010  29 0.00056 0.00056 0.50  98664  56 98636 5256681 53.28
## 10021 2011  30 0.00056 0.00056 0.50  98624  55 98596 5174985 52.47
## 10133 2012  31 0.00058 0.00058 0.50  98579  57 98551 5094853 51.68
## 10245 2013  32 0.00064 0.00064 0.50  98532  63 98500 5005052 50.80
## 10357 2014  33 0.00077 0.00077 0.50  98474  76 98436 4910497 49.87
## 10469 2015  34 0.00073 0.00073 0.50  98374  72 98338 4819383 48.99
## 10581 2016  35 0.00083 0.00083 0.50  98252  81 98211 4733277 48.17
## 10693 2017  36 0.00094 0.00094 0.50  98049  92 98003 4624539 47.17
## 10805 2018  37 0.00098 0.00098 0.50  97930  96 97882 4528434 46.24
## 10917 2019  38 0.00097 0.00097 0.50  97963  95 97916 4464141 45.57
## 11029 2020  39 0.00123 0.00123 0.50  97569 120 97509 4305572 44.13
## 11141 2021  40 0.00157 0.00157 0.50  97306 153 97230 4207847 43.24</code></pre>
<p><strong>1981 cohort one-year survival probabilities</strong></p>
<div class="sourceCode" id="section-cb139"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb139-1"><a href="#section-cb139-1" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> life_table_1981<span class="sc">$</span>qx</span>
<span id="section-cb139-2"><a href="#section-cb139-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;One year survival probabilities for 1981 birth year = &quot;</span>, px)</span></code></pre></div>
<pre><code>## One year survival probabilities for 1981 birth year =  0.99037 0.99937 0.99956 0.99961 0.99972 0.99971 0.9998 0.99977 0.99983 0.9998 0.99985 0.99985 0.99979 0.99974 0.99973 0.99969 0.99947 0.99958 0.99937 0.99936 0.99941 0.99942 0.99945 0.99945 0.99944 0.99944 0.99943 0.9995 0.9995 0.99944 0.99944 0.99942 0.99936 0.99923 0.99927 0.99917 0.99906 0.99902 0.99903 0.99877 0.99843</code></pre>
<p><strong>1981 cohort survival probability that (18) survives 5 more
years</strong></p>
<div class="sourceCode" id="section-cb141"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb141-1"><a href="#section-cb141-1" tabindex="-1"></a>prodp <span class="ot">&lt;-</span> <span class="fu">prod</span>(px[(<span class="dv">18</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">22</span> <span class="sc">+</span> <span class="dv">1</span>)])</span>
<span id="section-cb141-2"><a href="#section-cb141-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Survival probability that an 18 year old survives 5 more years for 1981 birth year =&quot;</span>, prodp)</span></code></pre></div>
<pre><code>## Survival probability that an 18 year old survives 5 more years for 1981 birth year = 0.9970136</code></pre>
<p><strong>1881 cohort survival probability that (18) survives 5 more
years</strong></p>
<div class="sourceCode" id="section-cb143"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb143-1"><a href="#section-cb143-1" tabindex="-1"></a>prodp2 <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="fu">subset</span>(life_table, Year <span class="sc">-</span> Age <span class="sc">==</span> <span class="dv">1881</span>), <span class="fu">prod</span>(<span class="dv">1</span> <span class="sc">-</span> qx[(<span class="dv">18</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">22</span> <span class="sc">+</span> <span class="dv">1</span>)]))</span>
<span id="section-cb143-2"><a href="#section-cb143-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Survival probability that an 18 year old survives 5 more years for 1881 birth year =&quot;</span>, prodp2)</span></code></pre></div>
<pre><code>## Survival probability that an 18 year old survives 5 more years for 1881 birth year = 0.9124045</code></pre>
<p><strong>PV of guaranteed payment of 10,000 in 5 years</strong></p>
<div class="sourceCode" id="section-cb145"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb145-1"><a href="#section-cb145-1" tabindex="-1"></a>PV <span class="ot">&lt;-</span> <span class="dv">10000</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.02</span>) <span class="sc">^</span> <span class="sc">-</span><span class="dv">5</span></span>
<span id="section-cb145-2"><a href="#section-cb145-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;PV =&quot;</span>,PV)</span></code></pre></div>
<pre><code>## PV = 9057.308</code></pre>
<p><strong>5 year survival probabilities of (20)</strong></p>
<div class="sourceCode" id="section-cb147"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb147-1"><a href="#section-cb147-1" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">prod</span>(px[(<span class="dv">20</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">24</span> <span class="sc">+</span> <span class="dv">1</span>)])</span>
<span id="section-cb147-2"><a href="#section-cb147-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;kpx =&quot;</span>, kpx)</span></code></pre></div>
<pre><code>## kpx = 0.9971732</code></pre>
<p><strong>EPV of pure endowment of 10,000 in 5 years for
(20)</strong></p>
<div class="sourceCode" id="section-cb149"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb149-1"><a href="#section-cb149-1" tabindex="-1"></a>epv <span class="ot">&lt;-</span> PV <span class="sc">*</span> kpx</span>
<span id="section-cb149-2"><a href="#section-cb149-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Expected Present value =&quot;</span>, epv)</span></code></pre></div>
<pre><code>## Expected Present value = 9031.705</code></pre>
</div>
</div>
</div>
<div id="section-life-annuities" class="section level1">
<h1>Life Annuities</h1>
<p><strong>PV of guaranteed payments of 10,000 in 5, 10 and 30
years</strong></p>
<div class="sourceCode" id="section-cb151"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb151-1"><a href="#section-cb151-1" tabindex="-1"></a>PV <span class="ot">&lt;-</span> <span class="dv">10000</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.02</span>) <span class="sc">^</span> <span class="sc">-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">30</span>)</span>
<span id="section-cb151-2"><a href="#section-cb151-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Present value =&quot;</span>,PV)</span></code></pre></div>
<pre><code>## Present value = 9057.308 8203.483 5520.709</code></pre>
<p><strong>Survival probabilities of (20)</strong></p>
<div class="sourceCode" id="section-cb153"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb153-1"><a href="#section-cb153-1" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(px[(<span class="dv">20</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(px)])</span>
<span id="section-cb153-2"><a href="#section-cb153-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;kpx =&quot;</span>, kpx)</span></code></pre></div>
<pre><code>## kpx = 0.99941 0.9988303 0.998281 0.9977319 0.9971732 0.9966148 0.9960467 0.9955487 0.9950509 0.9944937 0.9939368 0.9933603 0.9927245 0.9919601 0.991236 0.9904133 0.9894823 0.9885126 0.9875537 0.9863391 0.9847905</code></pre>
<p><strong>EPV of pure endowments of 10,000 in 5, 10 and 30 years for
(20)</strong></p>
<div class="sourceCode" id="section-cb155"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb155-1"><a href="#section-cb155-1" tabindex="-1"></a>epv2 <span class="ot">&lt;-</span> PV <span class="sc">*</span> kpx[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">30</span>)]</span>
<span id="section-cb155-2"><a href="#section-cb155-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Expected Present Value =&quot;</span>, epv)</span></code></pre></div>
<pre><code>## Expected Present Value = 9031.705</code></pre>
<div id="section-whole-life-annuity-due" class="section level2">
<h2>Whole Life Annuity Due</h2>
<p>A type of annuity where payments are made at the beginning of each
period, starting immediately upon purchase and continuing for the
lifetime of the annuitant. Payments start immediately and occur at the
beginning of each payment period (e.g., monthly, annually)</p>
<p><strong>Calculating the whole life annuity due of a 35 year
old</strong></p>
<div class="sourceCode" id="section-cb157"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb157-1"><a href="#section-cb157-1" tabindex="-1"></a>kpx <span class="ot">&lt;-</span></span>
<span id="section-cb157-2"><a href="#section-cb157-2" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(<span class="dv">35</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(px)]))</span>
<span id="section-cb157-3"><a href="#section-cb157-3" tabindex="-1"></a>discount_facotrs <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="fl">+0.03</span>)<span class="sc">^-</span>(<span class="dv">0</span><span class="sc">:</span>(<span class="fu">length</span>(kpx)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="section-cb157-4"><a href="#section-cb157-4" tabindex="-1"></a>benefits <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">length</span>(kpx))</span>
<span id="section-cb157-5"><a href="#section-cb157-5" tabindex="-1"></a><span class="fu">sum</span>(benefits<span class="sc">*</span>discount_factors<span class="sc">*</span>kpx)</span></code></pre></div>
<pre><code>## Warning in benefits * discount_factors: longer object length is not a multiple of shorter object length</code></pre>
<pre><code>## Warning in benefits * discount_factors * kpx: longer object length is not a multiple of shorter object length</code></pre>
<pre><code>## [1] 145.9806</code></pre>
</div>
<div id="section-whole-life-immediate-annuity" class="section level2">
<h2>Whole Life Immediate Annuity</h2>
<p>A type of annuity where payments are made at the end of each period,
starting immediately upon purchase and continuing for the lifetime of
the annuitant. Payments start immediately but occur at the end of each
payment period (e.g., monthly, annually).</p>
<p><strong>Calculating the whole life immediate annuity of a 35 year
old</strong></p>
<div class="sourceCode" id="section-cb161"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb161-1"><a href="#section-cb161-1" tabindex="-1"></a>kpx <span class="ot">&lt;-</span></span>
<span id="section-cb161-2"><a href="#section-cb161-2" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(<span class="dv">35</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(px)]))</span>
<span id="section-cb161-3"><a href="#section-cb161-3" tabindex="-1"></a>discount_facotrs <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="fl">+0.03</span>)<span class="sc">^-</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(kpx)))</span>
<span id="section-cb161-4"><a href="#section-cb161-4" tabindex="-1"></a>benefits <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">length</span>(kpx))</span>
<span id="section-cb161-5"><a href="#section-cb161-5" tabindex="-1"></a>wid <span class="ot">&lt;-</span> <span class="fu">sum</span>(benefits<span class="sc">*</span>discount_factors<span class="sc">*</span>kpx)</span></code></pre></div>
<pre><code>## Warning in benefits * discount_factors: longer object length is not a multiple of shorter object length</code></pre>
<pre><code>## Warning in benefits * discount_factors * kpx: longer object length is not a multiple of shorter object length</code></pre>
<div class="sourceCode" id="section-cb164"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb164-1"><a href="#section-cb164-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Whole life immediate annuity =&quot;</span>, wid)</span></code></pre></div>
<pre><code>## Whole life immediate annuity = 145.9806</code></pre>
</div>
<div id="section-expected-present-value" class="section level2">
<h2>Expected Present Value</h2>
<div
id="section-function-to-compute-the-epv-of-a-whole-life-annuity-due-for-a-given-age-interest-rate-i-and-life-table"
class="section level4">
<h4>Function to compute the EPV of a whole life annuity due for a given
age, interest rate i and life table</h4>
<div class="sourceCode" id="section-cb166"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb166-1"><a href="#section-cb166-1" tabindex="-1"></a>life_annuity_due <span class="ot">&lt;-</span> <span class="cf">function</span>(age, i, life_table) {</span>
<span id="section-cb166-2"><a href="#section-cb166-2" tabindex="-1"></a>  px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> life_table<span class="sc">$</span>qx</span>
<span id="section-cb166-3"><a href="#section-cb166-3" tabindex="-1"></a>  kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(px)]))</span>
<span id="section-cb166-4"><a href="#section-cb166-4" tabindex="-1"></a>  discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">0</span><span class="sc">:</span>(<span class="fu">length</span>(kpx) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="section-cb166-5"><a href="#section-cb166-5" tabindex="-1"></a>  <span class="fu">sum</span>(discount_factors <span class="sc">*</span> kpx)</span>
<span id="section-cb166-6"><a href="#section-cb166-6" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="section-shiny-app-for-life-annuity-calculator"
class="section level2">
<h2>Shiny App for Life Annuity Calculator</h2>
<iframe src="http://camleo.shinyapps.io/life_annuity_app" width="100%" height="300">
</iframe>
<p><strong>EPV of a whole life annuity due for (20) at interest rate 2%
using life_table</strong></p>
<div class="sourceCode" id="section-cb167"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb167-1"><a href="#section-cb167-1" tabindex="-1"></a>epv3 <span class="ot">&lt;-</span> <span class="fu">life_annuity_due</span>(<span class="dv">20</span>, <span class="fl">0.02</span>, life_table)</span>
<span id="section-cb167-2"><a href="#section-cb167-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;EPV of whole life annuity due =&quot;</span>, epv3)</span></code></pre></div>
<pre><code>## EPV of whole life annuity due = 30.5222</code></pre>
<p><strong>EPV of a whole life annuity due for (20) at interest rate 5%
and for (65) at interest rate 2% using life_table</strong></p>
<div class="sourceCode" id="section-cb169"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb169-1"><a href="#section-cb169-1" tabindex="-1"></a>epv4 <span class="ot">&lt;-</span> <span class="fu">life_annuity_due</span>(<span class="dv">20</span>, <span class="fl">0.05</span>, life_table)</span>
<span id="section-cb169-2"><a href="#section-cb169-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;EPV of life annuity due for 20 year old at 5% interest rate =&quot;</span>, epv4)</span></code></pre></div>
<pre><code>## EPV of life annuity due for 20 year old at 5% interest rate = 18.09666</code></pre>
<div class="sourceCode" id="section-cb171"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb171-1"><a href="#section-cb171-1" tabindex="-1"></a>epv5 <span class="ot">&lt;-</span> <span class="fu">life_annuity_due</span>(<span class="dv">65</span>, <span class="fl">0.02</span>, life_table)</span>
<span id="section-cb171-2"><a href="#section-cb171-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;EPV of life annuity due for 65 year old at 5% interest rate =&quot;</span>, epv5)</span></code></pre></div>
<pre><code>## EPV of life annuity due for 65 year old at 5% interest rate = 11.94589</code></pre>
<div
id="section-function-to-compute-the-epv-of-a-whole-life-immediate-annuity-for-a-given-age-interest-rate-i-and-life-table"
class="section level4">
<h4>Function to compute the EPV of a whole life immediate annuity for a
given age, interest rate i and life table</h4>
<div class="sourceCode" id="section-cb173"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb173-1"><a href="#section-cb173-1" tabindex="-1"></a>life_immediate_annuity <span class="ot">&lt;-</span> <span class="cf">function</span>(age, i, life_table) {</span>
<span id="section-cb173-2"><a href="#section-cb173-2" tabindex="-1"></a>  px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> life_table<span class="sc">$</span>qx</span>
<span id="section-cb173-3"><a href="#section-cb173-3" tabindex="-1"></a>  kpx <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(px[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(px)])</span>
<span id="section-cb173-4"><a href="#section-cb173-4" tabindex="-1"></a>  discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(kpx))</span>
<span id="section-cb173-5"><a href="#section-cb173-5" tabindex="-1"></a>  <span class="fu">sum</span>(discount_factors <span class="sc">*</span> kpx)</span>
<span id="section-cb173-6"><a href="#section-cb173-6" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>EPV of a whole life immediate annuity for (20) at interest
rate 2% using life_table</strong></p>
<div class="sourceCode" id="section-cb174"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb174-1"><a href="#section-cb174-1" tabindex="-1"></a>epv6 <span class="ot">&lt;-</span> <span class="fu">life_immediate_annuity</span>(<span class="dv">20</span>, <span class="fl">0.02</span>, life_table)</span>
<span id="section-cb174-2"><a href="#section-cb174-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;EPV of life annuity immediate for a 20 year old using 2% interest rate =&quot;</span>, epv6)</span></code></pre></div>
<pre><code>## EPV of life annuity immediate for a 20 year old using 2% interest rate = 29.5222</code></pre>
</div>
<div
id="section-function-to-compute-the-epv-of-a-temporary-life-annuity-due-for-a-given-age-period-of-n-years-interest-rate-i-and-life-table"
class="section level4">
<h4>Function to compute the EPV of a temporary life annuity due for a
given age, period of n years, interest rate i and life table</h4>
<div class="sourceCode" id="section-cb176"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb176-1"><a href="#section-cb176-1" tabindex="-1"></a>temporary_life_annuity_due <span class="ot">&lt;-</span> <span class="cf">function</span>(age, n, i, life_table) {</span>
<span id="section-cb176-2"><a href="#section-cb176-2" tabindex="-1"></a>  px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> life_table<span class="sc">$</span>qx</span>
<span id="section-cb176-3"><a href="#section-cb176-3" tabindex="-1"></a>  kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(age <span class="sc">+</span> n <span class="sc">-</span> <span class="dv">1</span>)]))</span>
<span id="section-cb176-4"><a href="#section-cb176-4" tabindex="-1"></a>  discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">0</span><span class="sc">:</span>(n <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="section-cb176-5"><a href="#section-cb176-5" tabindex="-1"></a>  <span class="fu">sum</span>(discount_factors <span class="sc">*</span> kpx)</span>
<span id="section-cb176-6"><a href="#section-cb176-6" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="section-shiny-app-for-temporary-life-annuity-calculator"
class="section level2">
<h2>Shiny app for Temporary Life Annuity Calculator</h2>
<div class="sourceCode" id="section-cb177"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb177-1"><a href="#section-cb177-1" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="section-cb177-2"><a href="#section-cb177-2" tabindex="-1"></a></span>
<span id="section-cb177-3"><a href="#section-cb177-3" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="section-cb177-4"><a href="#section-cb177-4" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Temporary Life Annuity Calculator&quot;</span>),</span>
<span id="section-cb177-5"><a href="#section-cb177-5" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="section-cb177-6"><a href="#section-cb177-6" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="section-cb177-7"><a href="#section-cb177-7" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;Age:&quot;</span>, <span class="dv">20</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">110</span>),</span>
<span id="section-cb177-8"><a href="#section-cb177-8" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;term&quot;</span>, <span class="st">&quot;Term (years):&quot;</span>, <span class="dv">10</span>, <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">50</span>),</span>
<span id="section-cb177-9"><a href="#section-cb177-9" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;interest&quot;</span>, <span class="st">&quot;Interest Rate:&quot;</span>, <span class="fl">0.02</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="fl">0.2</span>, <span class="at">step =</span> <span class="fl">0.001</span>)</span>
<span id="section-cb177-10"><a href="#section-cb177-10" tabindex="-1"></a>    ),</span>
<span id="section-cb177-11"><a href="#section-cb177-11" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="section-cb177-12"><a href="#section-cb177-12" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">&quot;Expected Present Value:&quot;</span>),</span>
<span id="section-cb177-13"><a href="#section-cb177-13" tabindex="-1"></a>      <span class="fu">textOutput</span>(<span class="st">&quot;epv&quot;</span>)</span>
<span id="section-cb177-14"><a href="#section-cb177-14" tabindex="-1"></a>    )</span>
<span id="section-cb177-15"><a href="#section-cb177-15" tabindex="-1"></a>  )</span>
<span id="section-cb177-16"><a href="#section-cb177-16" tabindex="-1"></a>)</span>
<span id="section-cb177-17"><a href="#section-cb177-17" tabindex="-1"></a></span>
<span id="section-cb177-18"><a href="#section-cb177-18" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="section-cb177-19"><a href="#section-cb177-19" tabindex="-1"></a>  output<span class="sc">$</span>epv <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="section-cb177-20"><a href="#section-cb177-20" tabindex="-1"></a>    epv <span class="ot">&lt;-</span> <span class="fu">temporary_life_annuity_due</span>(input<span class="sc">$</span>age, input<span class="sc">$</span>term, input<span class="sc">$</span>interest, life_table)</span>
<span id="section-cb177-21"><a href="#section-cb177-21" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;$&quot;</span>, <span class="fu">round</span>(epv, <span class="dv">2</span>))</span>
<span id="section-cb177-22"><a href="#section-cb177-22" tabindex="-1"></a>  })</span>
<span id="section-cb177-23"><a href="#section-cb177-23" tabindex="-1"></a>}</span>
<span id="section-cb177-24"><a href="#section-cb177-24" tabindex="-1"></a></span>
<span id="section-cb177-25"><a href="#section-cb177-25" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<iframe data-deferred-src="appbdd6e6aae500e116d9a98657125a3eac/?w=&amp;__subapp__=1" width="100%" height="400" class="shiny-frame shiny-frame-deferred"></iframe>
<p><strong>EPV of a temporary life annuity due for (20) over 10 years at
interest rate 2% using life_table</strong></p>
<div class="sourceCode" id="section-cb178"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb178-1"><a href="#section-cb178-1" tabindex="-1"></a>epvt <span class="ot">&lt;-</span> <span class="fu">temporary_life_annuity_due</span>(<span class="dv">20</span>, <span class="dv">10</span>, <span class="fl">0.02</span>, life_table)</span>
<span id="section-cb178-2"><a href="#section-cb178-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;EPV of temporary life annuity due for 20 year old over 10 years at 2% interest rate =&quot;</span>, epvt)</span></code></pre></div>
<pre><code>## EPV of temporary life annuity due for 20 year old over 10 years at 2% interest rate = 9.002238</code></pre>
</div>
<div id="section-pension-valuation" class="section level2">
<h2>Pension Valuation</h2>
<details>
<summary>
What is a pension and pension valuation?
</summary>
<p style="font-weight: bold; color: blue;">
Pension valuation is the process of determining the present value of
future pension benefits that employees or retirees are entitled to
receive from their employers or pension funds. It involves estimating
the current worth of these future payments, taking into account factors
such as inflation, mortality rates, interest rates, and the expected
duration of payments.
</p>
</details>
<details>
<summary>
Purpose and Factors Considered?
</summary>
<p style="font-weight: bold; color: blue;">
<p>Purpose: The primary goal of pension valuation is to assess the
financial obligations of a pension plan or fund accurately. This helps
pension managers, actuaries, and policymakers understand the funding
requirements necessary to meet future pension obligations.</p>
<p>Factors Considered: Key factors considered in pension valuation
include:</p>
<p>Discount Rates: Used to discount future cash flows to their present
value, reflecting the time value of money and investment returns.</p>
<p>Mortality Assumptions: Expected longevity of pension recipients
affects the duration and total amount of pension payments.</p>
<p>Inflation Rates: Adjustments for inflation ensure that future pension
payments maintain their purchasing power.</p>
Plan Design: Specific features of the pension plan, such as retirement
age, payment options, and eligibility criteria, influence valuation
calculations.
</p>
</details>
<p><strong>Calculating the PV of a pension at age 65</strong></p>
<div class="sourceCode" id="section-cb180"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb180-1"><a href="#section-cb180-1" tabindex="-1"></a>benefits <span class="ot">&lt;-</span> <span class="dv">20000</span> <span class="sc">*</span> <span class="fl">1.02</span> <span class="sc">^</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">35</span>)</span>
<span id="section-cb180-2"><a href="#section-cb180-2" tabindex="-1"></a></span>
<span id="section-cb180-3"><a href="#section-cb180-3" tabindex="-1"></a></span>
<span id="section-cb180-4"><a href="#section-cb180-4" tabindex="-1"></a></span>
<span id="section-cb180-5"><a href="#section-cb180-5" tabindex="-1"></a></span>
<span id="section-cb180-6"><a href="#section-cb180-6" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> <span class="fl">1.04</span> <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">35</span>)</span>
<span id="section-cb180-7"><a href="#section-cb180-7" tabindex="-1"></a></span>
<span id="section-cb180-8"><a href="#section-cb180-8" tabindex="-1"></a></span>
<span id="section-cb180-9"><a href="#section-cb180-9" tabindex="-1"></a></span>
<span id="section-cb180-10"><a href="#section-cb180-10" tabindex="-1"></a></span>
<span id="section-cb180-11"><a href="#section-cb180-11" tabindex="-1"></a>PV_65 <span class="ot">&lt;-</span> <span class="fu">sum</span>(benefits <span class="sc">*</span> discount_factors)</span>
<span id="section-cb180-12"><a href="#section-cb180-12" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;PV of pension at age 65 =&quot;</span>,PV_65)</span></code></pre></div>
<pre><code>## PV of pension at age 65 = 523061</code></pre>
<div class="sourceCode" id="section-cb182"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb182-1"><a href="#section-cb182-1" tabindex="-1"></a>PV_20 <span class="ot">&lt;-</span> PV_65 <span class="sc">*</span> <span class="fl">1.03</span> <span class="sc">^</span> <span class="sc">-</span> <span class="dv">45</span></span>
<span id="section-cb182-2"><a href="#section-cb182-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;PV of pension at age 20 =&quot;</span>,PV_20)</span></code></pre></div>
<pre><code>## PV of pension at age 20 = 138317.5</code></pre>
<p><strong>EPV of pension at age 20</strong></p>
<div class="sourceCode" id="section-cb184"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb184-1"><a href="#section-cb184-1" tabindex="-1"></a><span class="co"># Survival probabilities of (65) up to age 100</span></span>
<span id="section-cb184-2"><a href="#section-cb184-2" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> life_table<span class="sc">$</span>qx</span>
<span id="section-cb184-3"><a href="#section-cb184-3" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(<span class="dv">65</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">99</span> <span class="sc">+</span> <span class="dv">1</span>)]))</span>
<span id="section-cb184-4"><a href="#section-cb184-4" tabindex="-1"></a></span>
<span id="section-cb184-5"><a href="#section-cb184-5" tabindex="-1"></a></span>
<span id="section-cb184-6"><a href="#section-cb184-6" tabindex="-1"></a></span>
<span id="section-cb184-7"><a href="#section-cb184-7" tabindex="-1"></a></span>
<span id="section-cb184-8"><a href="#section-cb184-8" tabindex="-1"></a>EPV_65 <span class="ot">&lt;-</span> <span class="fu">sum</span>(benefits <span class="sc">*</span> discount_factors <span class="sc">*</span> kpx)</span>
<span id="section-cb184-9"><a href="#section-cb184-9" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;EPV of pension at age 65 =&quot;</span>,<span class="fu">cbind</span>(PV_65, EPV_65))</span></code></pre></div>
<pre><code>## EPV of pension at age 65 = 523061 239587.2</code></pre>
<div class="sourceCode" id="section-cb186"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb186-1"><a href="#section-cb186-1" tabindex="-1"></a>EPV_20 <span class="ot">&lt;-</span> EPV_65 <span class="sc">*</span> (<span class="fl">1.03</span> <span class="sc">^</span> <span class="sc">-</span> <span class="dv">45</span> <span class="sc">*</span> <span class="fu">prod</span>(px[(<span class="dv">20</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">64</span> <span class="sc">+</span> <span class="dv">1</span>)]))</span>
<span id="section-cb186-2"><a href="#section-cb186-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;EPV of pension at age 20 =&quot;</span>,<span class="fu">cbind</span>(PV_20, EPV_20))</span></code></pre></div>
<pre><code>## EPV of pension at age 20 = 138317.5 42596.32</code></pre>
<div id="section-retirement-plan" class="section level3">
<h3>Retirement Plan</h3>
<p>You’re planning for your retirement at age 40. You want to buy an
annuity that will provide you 10000 annually for life, starting at age
65. If you die before the annuity starts, you get paid nothing.</p>
<div class="sourceCode" id="section-cb188"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb188-1"><a href="#section-cb188-1" tabindex="-1"></a><span class="fu">library</span>(actuar)</span>
<span id="section-cb188-2"><a href="#section-cb188-2" tabindex="-1"></a><span class="co"># Survival probabilities of (40)</span></span>
<span id="section-cb188-3"><a href="#section-cb188-3" tabindex="-1"></a></span>
<span id="section-cb188-4"><a href="#section-cb188-4" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(<span class="dv">40</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(px)]))</span>
<span id="section-cb188-5"><a href="#section-cb188-5" tabindex="-1"></a></span>
<span id="section-cb188-6"><a href="#section-cb188-6" tabindex="-1"></a></span>
<span id="section-cb188-7"><a href="#section-cb188-7" tabindex="-1"></a></span>
<span id="section-cb188-8"><a href="#section-cb188-8" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.03</span>) <span class="sc">^</span> <span class="sc">-</span>(<span class="dv">0</span><span class="sc">:</span>(<span class="fu">length</span>(kpx) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="section-cb188-9"><a href="#section-cb188-9" tabindex="-1"></a></span>
<span id="section-cb188-10"><a href="#section-cb188-10" tabindex="-1"></a></span>
<span id="section-cb188-11"><a href="#section-cb188-11" tabindex="-1"></a></span>
<span id="section-cb188-12"><a href="#section-cb188-12" tabindex="-1"></a></span>
<span id="section-cb188-13"><a href="#section-cb188-13" tabindex="-1"></a>benefits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">25</span>), <span class="fu">rep</span>(<span class="dv">10000</span>, <span class="fu">length</span>(kpx) <span class="sc">-</span> <span class="dv">25</span>))</span>
<span id="section-cb188-14"><a href="#section-cb188-14" tabindex="-1"></a></span>
<span id="section-cb188-15"><a href="#section-cb188-15" tabindex="-1"></a></span>
<span id="section-cb188-16"><a href="#section-cb188-16" tabindex="-1"></a></span>
<span id="section-cb188-17"><a href="#section-cb188-17" tabindex="-1"></a></span>
<span id="section-cb188-18"><a href="#section-cb188-18" tabindex="-1"></a>single_premium <span class="ot">&lt;-</span> <span class="fu">sum</span>(benefits <span class="sc">*</span> discount_factors <span class="sc">*</span> kpx)</span>
<span id="section-cb188-19"><a href="#section-cb188-19" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Single premium =&quot;</span>,single_premium)</span></code></pre></div>
<pre><code>## Single premium = 38954.59</code></pre>
<div class="sourceCode" id="section-cb190"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb190-1"><a href="#section-cb190-1" tabindex="-1"></a><span class="co"># Define the premium_gen function</span></span>
<span id="section-cb190-2"><a href="#section-cb190-2" tabindex="-1"></a>premium_gen <span class="ot">&lt;-</span> <span class="cf">function</span>(age, term, interest_rate, mortality_rate) {</span>
<span id="section-cb190-3"><a href="#section-cb190-3" tabindex="-1"></a>  v <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> interest_rate)</span>
<span id="section-cb190-4"><a href="#section-cb190-4" tabindex="-1"></a>  present_value_benefit <span class="ot">&lt;-</span> <span class="fu">sum</span>(v<span class="sc">^</span>(<span class="dv">1</span><span class="sc">:</span>term) <span class="sc">*</span> (mortality_rate <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> mortality_rate)<span class="sc">^</span>(<span class="dv">0</span><span class="sc">:</span>(term <span class="sc">-</span> <span class="dv">1</span>))))</span>
<span id="section-cb190-5"><a href="#section-cb190-5" tabindex="-1"></a>  </span>
<span id="section-cb190-6"><a href="#section-cb190-6" tabindex="-1"></a>  </span>
<span id="section-cb190-7"><a href="#section-cb190-7" tabindex="-1"></a>  premium <span class="ot">&lt;-</span> present_value_benefit <span class="sc">/</span> <span class="fu">sum</span>(v<span class="sc">^</span>(<span class="dv">1</span><span class="sc">:</span>term) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> mortality_rate)<span class="sc">^</span>(<span class="dv">0</span><span class="sc">:</span>(term <span class="sc">-</span> <span class="dv">1</span>)))</span>
<span id="section-cb190-8"><a href="#section-cb190-8" tabindex="-1"></a>  <span class="fu">return</span>(premium)</span>
<span id="section-cb190-9"><a href="#section-cb190-9" tabindex="-1"></a>}</span>
<span id="section-cb190-10"><a href="#section-cb190-10" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="section-cb190-11"><a href="#section-cb190-11" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="section-cb190-12"><a href="#section-cb190-12" tabindex="-1"></a>interest_rate <span class="ot">&lt;-</span> <span class="fl">0.03</span></span>
<span id="section-cb190-13"><a href="#section-cb190-13" tabindex="-1"></a>mortality_rate <span class="ot">&lt;-</span> <span class="fl">0.005</span></span>
<span id="section-cb190-14"><a href="#section-cb190-14" tabindex="-1"></a>premium <span class="ot">&lt;-</span> <span class="fu">premium_gen</span>(age, term, interest_rate, mortality_rate)</span>
<span id="section-cb190-15"><a href="#section-cb190-15" tabindex="-1"></a>premium</span></code></pre></div>
<pre><code>## [1] 0.005</code></pre>
<p>Suppose you want to finance this deferred life annuity with annual
premiums payable for 25 years beginning at age 40. However, you plan to
reduce your work hours from age 55 onwards, therefore the premium will
reduce by 1 half after 15 years. What is the initial premium you will
pay</p>
<div class="sourceCode" id="section-cb192"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb192-1"><a href="#section-cb192-1" tabindex="-1"></a><span class="co"># Premium pattern rho</span></span>
<span id="section-cb192-2"><a href="#section-cb192-2" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">15</span>), <span class="fu">rep</span>(<span class="fl">0.5</span>, <span class="dv">10</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(kpx) <span class="sc">-</span> <span class="dv">25</span>))</span>
<span id="section-cb192-3"><a href="#section-cb192-3" tabindex="-1"></a></span>
<span id="section-cb192-4"><a href="#section-cb192-4" tabindex="-1"></a></span>
<span id="section-cb192-5"><a href="#section-cb192-5" tabindex="-1"></a>initial_premium <span class="ot">&lt;-</span> single_premium <span class="sc">/</span> <span class="fu">sum</span>(rho <span class="sc">*</span> discount_factors <span class="sc">*</span> kpx, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="section-cb192-6"><a href="#section-cb192-6" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Initial premium =&quot;</span>, initial_premium, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Initial premium = 2763.3</code></pre>
<div class="sourceCode" id="section-cb194"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb194-1"><a href="#section-cb194-1" tabindex="-1"></a>annual_premiums <span class="ot">&lt;-</span> initial_premium <span class="sc">*</span> rho</span>
<span id="section-cb194-2"><a href="#section-cb194-2" tabindex="-1"></a></span>
<span id="section-cb194-3"><a href="#section-cb194-3" tabindex="-1"></a></span>
<span id="section-cb194-4"><a href="#section-cb194-4" tabindex="-1"></a>filtered_annual_premiums <span class="ot">&lt;-</span> annual_premiums[annual_premiums <span class="sc">!=</span> <span class="dv">0</span>]</span>
<span id="section-cb194-5"><a href="#section-cb194-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Filtered annual premiums =&quot;</span>, filtered_annual_premiums, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Filtered annual premiums = 2763.3 2763.3 2763.3 2763.3 2763.3 2763.3 2763.3 2763.3 2763.3 2763.3 2763.3 2763.3 2763.3 2763.3 2763.3 1381.65 1381.65 1381.65 1381.65 1381.65 1381.65 1381.65 1381.65 1381.65 1381.65</code></pre>
<div class="sourceCode" id="section-cb196"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb196-1"><a href="#section-cb196-1" tabindex="-1"></a><span class="co"># Sum of the annual premiums (no actuarial discounting)</span></span>
<span id="section-cb196-2"><a href="#section-cb196-2" tabindex="-1"></a>sap <span class="ot">&lt;-</span> <span class="fu">sum</span>(filtered_annual_premiums)</span>
<span id="section-cb196-3"><a href="#section-cb196-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Sum of annual premiums =&quot;</span>, sap, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Sum of annual premiums = 55266</code></pre>
<p>Find out if this product would be a favorable deal for you. How much
would you receive if you died instead at 75, or 95?</p>
<div class="sourceCode" id="section-cb198"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb198-1"><a href="#section-cb198-1" tabindex="-1"></a><span class="co"># Curtate life expectancy of (40)</span></span>
<span id="section-cb198-2"><a href="#section-cb198-2" tabindex="-1"></a><span class="fu">sum</span>(kpx[<span class="sc">-</span><span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] 31.9023</code></pre>
<div class="sourceCode" id="section-cb200"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb200-1"><a href="#section-cb200-1" tabindex="-1"></a><span class="co"># Present value of annuity benefits when (40) lives until age 75</span></span>
<span id="section-cb200-2"><a href="#section-cb200-2" tabindex="-1"></a>subset1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">36</span></span>
<span id="section-cb200-3"><a href="#section-cb200-3" tabindex="-1"></a><span class="fu">sum</span>(benefits[subset1] <span class="sc">*</span> discount_factors[subset1])</span></code></pre></div>
<pre><code>## [1] 45516.78</code></pre>
<div class="sourceCode" id="section-cb202"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb202-1"><a href="#section-cb202-1" tabindex="-1"></a><span class="co"># Present value of annuity benefits when (40) lives until age 95</span></span>
<span id="section-cb202-2"><a href="#section-cb202-2" tabindex="-1"></a>subset2 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">56</span></span>
<span id="section-cb202-3"><a href="#section-cb202-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Present value of the annuity benefits for a 40 year old living until 95 =&quot;</span>,<span class="fu">sum</span>(benefits[subset2] <span class="sc">*</span> discount_factors[subset2]))</span></code></pre></div>
<pre><code>## Present value of the annuity benefits for a 40 year old living until 95 = 98388.86</code></pre>
<div
id="section-integrating-generalized-linear-models-glms-and-time-series-analysis"
class="section level4">
<h4>Integrating Generalized Linear Models (GLMs) and Time Series
Analysis</h4>
<p><strong>Using GLMs to Model Survival Probabilities</strong></p>
<p>We can use a logistic regression model (a type of GLM) to model the
probability of survival based on age and other factors.</p>
<div class="sourceCode" id="section-cb204"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb204-1"><a href="#section-cb204-1" tabindex="-1"></a><span class="fu">library</span>(MASS)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;MASS&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:plotly&#39;:
## 
##     select</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select</code></pre>
<div class="sourceCode" id="section-cb208"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb208-1"><a href="#section-cb208-1" tabindex="-1"></a>life_table <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(life_table)</span>
<span id="section-cb208-2"><a href="#section-cb208-2" tabindex="-1"></a></span>
<span id="section-cb208-3"><a href="#section-cb208-3" tabindex="-1"></a><span class="co"># Fit a logistic regression model to predict the probability of death based on age</span></span>
<span id="section-cb208-4"><a href="#section-cb208-4" tabindex="-1"></a>glm_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(dx, lx <span class="sc">-</span> dx) <span class="sc">~</span> Age, <span class="at">family =</span> binomial, <span class="at">data =</span> life_table)</span>
<span id="section-cb208-5"><a href="#section-cb208-5" tabindex="-1"></a><span class="fu">summary</span>(glm_model)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cbind(dx, lx - dx) ~ Age, family = binomial, data = life_table)
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -8.329e+00  1.420e-03   -5867   &lt;2e-16 ***
## Age          7.113e-02  1.953e-05    3642   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 25097787  on 11104  degrees of freedom
## Residual deviance:  4866962  on 11103  degrees of freedom
## AIC: 4950096
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode" id="section-cb210"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb210-1"><a href="#section-cb210-1" tabindex="-1"></a><span class="co"># Predict survival probabilities using the fitted model</span></span>
<span id="section-cb210-2"><a href="#section-cb210-2" tabindex="-1"></a>predicted_qx <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm_model, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="section-cb210-3"><a href="#section-cb210-3" tabindex="-1"></a>predicted_px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> predicted_qx</span>
<span id="section-cb210-4"><a href="#section-cb210-4" tabindex="-1"></a></span>
<span id="section-cb210-5"><a href="#section-cb210-5" tabindex="-1"></a>length_actual <span class="ot">&lt;-</span> <span class="fu">length</span>(life_table<span class="sc">$</span>qx)</span>
<span id="section-cb210-6"><a href="#section-cb210-6" tabindex="-1"></a>length_predicted <span class="ot">&lt;-</span> <span class="fu">length</span>(predicted_qx)</span>
<span id="section-cb210-7"><a href="#section-cb210-7" tabindex="-1"></a></span>
<span id="section-cb210-8"><a href="#section-cb210-8" tabindex="-1"></a><span class="cf">if</span> (length_actual <span class="sc">!=</span> length_predicted) {</span>
<span id="section-cb210-9"><a href="#section-cb210-9" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">&quot;Lengths of predicted and actual values do not match! Actual:&quot;</span>, length_actual, <span class="st">&quot;Predicted:&quot;</span>, length_predicted))</span>
<span id="section-cb210-10"><a href="#section-cb210-10" tabindex="-1"></a>}</span>
<span id="section-cb210-11"><a href="#section-cb210-11" tabindex="-1"></a></span>
<span id="section-cb210-12"><a href="#section-cb210-12" tabindex="-1"></a><span class="co"># Compare predicted survival probabilities with actual values</span></span>
<span id="section-cb210-13"><a href="#section-cb210-13" tabindex="-1"></a><span class="fu">plot</span>(life_table<span class="sc">$</span>Age, life_table<span class="sc">$</span>qx, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Probability of Death&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Actual vs Predicted Mortality Rates&quot;</span>)</span>
<span id="section-cb210-14"><a href="#section-cb210-14" tabindex="-1"></a><span class="fu">lines</span>(life_table<span class="sc">$</span>Age, predicted_qx, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="section-cb210-15"><a href="#section-cb210-15" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Actual&quot;</span>, <span class="st">&quot;Predicted&quot;</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">lty =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-84-1.png" width="672" /></p>
<div class="sourceCode" id="section-cb211"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb211-1"><a href="#section-cb211-1" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="section-cb211-2"><a href="#section-cb211-2" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span></code></pre></div>
<pre><code>## Loading required package: nlme</code></pre>
<pre><code>## 
## Attaching package: &#39;nlme&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     collapse</code></pre>
<pre><code>## This is mgcv 1.8-42. For overview type &#39;help(&quot;mgcv-package&quot;)&#39;.</code></pre>
<div class="sourceCode" id="section-cb216"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb216-1"><a href="#section-cb216-1" tabindex="-1"></a>life_table <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(life_table)</span>
<span id="section-cb216-2"><a href="#section-cb216-2" tabindex="-1"></a></span>
<span id="section-cb216-3"><a href="#section-cb216-3" tabindex="-1"></a><span class="co"># Fit a GAM model with smoothing splines for Age, Year, and mx</span></span>
<span id="section-cb216-4"><a href="#section-cb216-4" tabindex="-1"></a>gam_model <span class="ot">&lt;-</span> <span class="fu">gam</span>(<span class="fu">cbind</span>(dx, lx <span class="sc">-</span> dx) <span class="sc">~</span> <span class="fu">s</span>(Age) <span class="sc">+</span> <span class="fu">s</span>(Year) <span class="sc">+</span> <span class="fu">s</span>(mx), <span class="at">family =</span> binomial, <span class="at">data =</span> life_table)</span>
<span id="section-cb216-5"><a href="#section-cb216-5" tabindex="-1"></a><span class="fu">summary</span>(gam_model)</span></code></pre></div>
<pre><code>## 
## Family: binomial 
## Link function: logit 
## 
## Formula:
## cbind(dx, lx - dx) ~ s(Age) + s(Year) + s(mx)
## 
## Parametric coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -4.300445   0.001442   -2983   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df Chi.sq p-value    
## s(Age)  8.994      9 721719  &lt;2e-16 ***
## s(Year) 8.969      9  62693  &lt;2e-16 ***
## s(mx)   8.996      9 341958  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =   0.99   Deviance explained = 98.6%
## UBRE =  30.26  Scale est. = 1         n = 11110</code></pre>
<div class="sourceCode" id="section-cb218"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb218-1"><a href="#section-cb218-1" tabindex="-1"></a><span class="co"># Predict survival probabilities using the fitted GAM model</span></span>
<span id="section-cb218-2"><a href="#section-cb218-2" tabindex="-1"></a>predicted_qx_gam <span class="ot">&lt;-</span> <span class="fu">predict</span>(gam_model, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="section-cb218-3"><a href="#section-cb218-3" tabindex="-1"></a>predicted_px_gam <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> predicted_qx_gam</span>
<span id="section-cb218-4"><a href="#section-cb218-4" tabindex="-1"></a></span>
<span id="section-cb218-5"><a href="#section-cb218-5" tabindex="-1"></a>length_actual_gam <span class="ot">&lt;-</span> <span class="fu">length</span>(life_table<span class="sc">$</span>qx)</span>
<span id="section-cb218-6"><a href="#section-cb218-6" tabindex="-1"></a>length_predicted_gam <span class="ot">&lt;-</span> <span class="fu">length</span>(predicted_qx_gam)</span>
<span id="section-cb218-7"><a href="#section-cb218-7" tabindex="-1"></a></span>
<span id="section-cb218-8"><a href="#section-cb218-8" tabindex="-1"></a><span class="cf">if</span> (length_actual_gam <span class="sc">!=</span> length_predicted_gam) {</span>
<span id="section-cb218-9"><a href="#section-cb218-9" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">&quot;Lengths of predicted and actual values do not match! Actual:&quot;</span>, length_actual_gam, <span class="st">&quot;Predicted:&quot;</span>, length_predicted_gam))</span>
<span id="section-cb218-10"><a href="#section-cb218-10" tabindex="-1"></a>}</span>
<span id="section-cb218-11"><a href="#section-cb218-11" tabindex="-1"></a></span>
<span id="section-cb218-12"><a href="#section-cb218-12" tabindex="-1"></a><span class="co"># Compare predicted survival probabilities with actual values</span></span>
<span id="section-cb218-13"><a href="#section-cb218-13" tabindex="-1"></a><span class="fu">plot</span>(life_table<span class="sc">$</span>Age, life_table<span class="sc">$</span>qx, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Probability of Death&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Actual vs Predicted Mortality Rates&quot;</span>)</span>
<span id="section-cb218-14"><a href="#section-cb218-14" tabindex="-1"></a><span class="fu">lines</span>(life_table<span class="sc">$</span>Age, predicted_qx_gam, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="section-cb218-15"><a href="#section-cb218-15" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Actual&quot;</span>, <span class="st">&quot;Predicted&quot;</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">lty =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-85-1.png" width="672" /></p>
</div>
</div>
</div>
</div>
<div id="section-life-insurance" class="section level1">
<h1>Life Insurance</h1>
<p>You have bought a life insurance that is sold to 20 year olds and
will pay 10000 at the end of the year of death if your death occurs at
age 30. How much is the expected present value (EPV)</p>
<div class="sourceCode" id="section-cb219"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb219-1"><a href="#section-cb219-1" tabindex="-1"></a><span class="co"># 10-year survival probability of (20)</span></span>
<span id="section-cb219-2"><a href="#section-cb219-2" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">prod</span>(px[(<span class="dv">20</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">29</span> <span class="sc">+</span> <span class="dv">1</span>)])</span>
<span id="section-cb219-3"><a href="#section-cb219-3" tabindex="-1"></a>kpx</span></code></pre></div>
<pre><code>## [1] 0.9589195</code></pre>
<div class="sourceCode" id="section-cb221"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb221-1"><a href="#section-cb221-1" tabindex="-1"></a><span class="co"># 10-year deferred mortality probability of (20)</span></span>
<span id="section-cb221-2"><a href="#section-cb221-2" tabindex="-1"></a>kqx <span class="ot">&lt;-</span> kpx <span class="sc">*</span> qx[<span class="dv">30</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb221-3"><a href="#section-cb221-3" tabindex="-1"></a>kqx</span></code></pre></div>
<pre><code>## [1] 0.0009397411</code></pre>
<div class="sourceCode" id="section-cb223"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb223-1"><a href="#section-cb223-1" tabindex="-1"></a><span class="co"># Discount factor</span></span>
<span id="section-cb223-2"><a href="#section-cb223-2" tabindex="-1"></a>discount_factor <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.01</span>) <span class="sc">^</span> <span class="sc">-</span> <span class="dv">11</span></span>
<span id="section-cb223-3"><a href="#section-cb223-3" tabindex="-1"></a>discount_factor</span></code></pre></div>
<pre><code>## [1] 0.8963237</code></pre>
<div class="sourceCode" id="section-cb225"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb225-1"><a href="#section-cb225-1" tabindex="-1"></a><span class="co"># EPV of the simple life insurance</span></span>
<span id="section-cb225-2"><a href="#section-cb225-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;EPV of simple life insurance =&quot;</span>,<span class="dv">10000</span> <span class="sc">*</span> discount_factor <span class="sc">*</span> kqx)</span></code></pre></div>
<pre><code>## EPV of simple life insurance = 8.423123</code></pre>
<div id="section-whole-temporary-and-deferred-life-insurance"
class="section level2">
<h2>Whole, Temporary and Deferred Life Insurance</h2>
<div id="section-function-to-find-epv-of-a-whole-life-insurance"
class="section level3">
<h3>Function to find EPV of a whole life Insurance</h3>
<div class="sourceCode" id="section-cb227"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb227-1"><a href="#section-cb227-1" tabindex="-1"></a>whole_life_insurance <span class="ot">&lt;-</span> <span class="cf">function</span>(age, i, life_table_2021) {</span>
<span id="section-cb227-2"><a href="#section-cb227-2" tabindex="-1"></a>  qx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>qx</span>
<span id="section-cb227-3"><a href="#section-cb227-3" tabindex="-1"></a>  px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> qx</span>
<span id="section-cb227-4"><a href="#section-cb227-4" tabindex="-1"></a>  kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">length</span>(px) <span class="sc">-</span> <span class="dv">1</span>)]))</span>
<span id="section-cb227-5"><a href="#section-cb227-5" tabindex="-1"></a>  kqx <span class="ot">&lt;-</span> kpx <span class="sc">*</span> qx[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(qx)]</span>
<span id="section-cb227-6"><a href="#section-cb227-6" tabindex="-1"></a>  discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(kqx))</span>
<span id="section-cb227-7"><a href="#section-cb227-7" tabindex="-1"></a>  <span class="fu">sum</span>(discount_factors <span class="sc">*</span> kqx, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="section-cb227-8"><a href="#section-cb227-8" tabindex="-1"></a>}</span>
<span id="section-cb227-9"><a href="#section-cb227-9" tabindex="-1"></a></span>
<span id="section-cb227-10"><a href="#section-cb227-10" tabindex="-1"></a><span class="co"># Function to plot EPV by age</span></span>
<span id="section-cb227-11"><a href="#section-cb227-11" tabindex="-1"></a>plot_by_age <span class="ot">&lt;-</span> <span class="cf">function</span>(life_table_2021, <span class="at">interest_rate =</span> <span class="fl">0.03</span>) {</span>
<span id="section-cb227-12"><a href="#section-cb227-12" tabindex="-1"></a>  ages <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>(<span class="fu">length</span>(life_table_2021<span class="sc">$</span>qx) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="section-cb227-13"><a href="#section-cb227-13" tabindex="-1"></a>  epvs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(ages, <span class="cf">function</span>(age) <span class="fu">whole_life_insurance</span>(age, interest_rate, life_table_2021))</span>
<span id="section-cb227-14"><a href="#section-cb227-14" tabindex="-1"></a>  <span class="fu">plot</span>(ages, epvs, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, </span>
<span id="section-cb227-15"><a href="#section-cb227-15" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;EPV of Whole Life Insurance by Age&quot;</span>, </span>
<span id="section-cb227-16"><a href="#section-cb227-16" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;EPV&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="section-cb227-17"><a href="#section-cb227-17" tabindex="-1"></a>}</span>
<span id="section-cb227-18"><a href="#section-cb227-18" tabindex="-1"></a></span>
<span id="section-cb227-19"><a href="#section-cb227-19" tabindex="-1"></a><span class="co"># Function to plot EPV by interest rate for a given age</span></span>
<span id="section-cb227-20"><a href="#section-cb227-20" tabindex="-1"></a>plot_by_interest_rate <span class="ot">&lt;-</span> <span class="cf">function</span>(life_table_2021, <span class="at">target_age =</span> <span class="dv">20</span>) {</span>
<span id="section-cb227-21"><a href="#section-cb227-21" tabindex="-1"></a>  interest_rates <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="section-cb227-22"><a href="#section-cb227-22" tabindex="-1"></a>  epvs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(interest_rates, <span class="cf">function</span>(i) <span class="fu">whole_life_insurance</span>(target_age, i, life_table_2021))</span>
<span id="section-cb227-23"><a href="#section-cb227-23" tabindex="-1"></a>  <span class="fu">plot</span>(interest_rates, epvs, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="section-cb227-24"><a href="#section-cb227-24" tabindex="-1"></a>       <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">&quot;EPV of Whole Life Insurance for Age&quot;</span>, target_age, <span class="st">&quot;by Interest Rate&quot;</span>), </span>
<span id="section-cb227-25"><a href="#section-cb227-25" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;Interest Rate&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;EPV&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="section-cb227-26"><a href="#section-cb227-26" tabindex="-1"></a>}</span>
<span id="section-cb227-27"><a href="#section-cb227-27" tabindex="-1"></a></span>
<span id="section-cb227-28"><a href="#section-cb227-28" tabindex="-1"></a></span>
<span id="section-cb227-29"><a href="#section-cb227-29" tabindex="-1"></a><span class="fu">plot_by_age</span>(life_table_2021, <span class="at">interest_rate =</span> <span class="fl">0.03</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-87-1.png" width="672" /></p>
<div class="sourceCode" id="section-cb228"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb228-1"><a href="#section-cb228-1" tabindex="-1"></a><span class="fu">plot_by_interest_rate</span>(life_table_2021, <span class="at">target_age =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-87-2.png" width="672" /></p>
</div>
</div>
<div id="section-temporary-life-insurance" class="section level2">
<h2>Temporary Life Insurance</h2>
<p><strong>Finding the EPV of a life insurance where the coverage is
restricted in time for a 20 year old in Canada in 2021 using an interest
rate of 2%</strong></p>
<div class="sourceCode" id="section-cb229"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb229-1"><a href="#section-cb229-1" tabindex="-1"></a><span class="fu">whole_life_insurance</span>(<span class="dv">20</span>, <span class="fl">0.02</span>, life_table_2021)</span></code></pre></div>
<pre><code>## [1] 0.301949</code></pre>
<div class="sourceCode" id="section-cb231"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb231-1"><a href="#section-cb231-1" tabindex="-1"></a><span class="co"># Function to compute the EPV of a temporary life insurance</span></span>
<span id="section-cb231-2"><a href="#section-cb231-2" tabindex="-1"></a>temporary_life_insurance <span class="ot">&lt;-</span> <span class="cf">function</span>(age, n, i, life_table_2021) {</span>
<span id="section-cb231-3"><a href="#section-cb231-3" tabindex="-1"></a>  qx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>qx</span>
<span id="section-cb231-4"><a href="#section-cb231-4" tabindex="-1"></a>  px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> qx</span>
<span id="section-cb231-5"><a href="#section-cb231-5" tabindex="-1"></a>  kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(age <span class="sc">+</span> n <span class="sc">-</span> <span class="dv">1</span>)]))</span>
<span id="section-cb231-6"><a href="#section-cb231-6" tabindex="-1"></a>  kqx <span class="ot">&lt;-</span> kpx <span class="sc">*</span> qx[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(age <span class="sc">+</span> n)]</span>
<span id="section-cb231-7"><a href="#section-cb231-7" tabindex="-1"></a>  discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(kqx))</span>
<span id="section-cb231-8"><a href="#section-cb231-8" tabindex="-1"></a>  <span class="fu">sum</span>(discount_factors <span class="sc">*</span> kqx)</span>
<span id="section-cb231-9"><a href="#section-cb231-9" tabindex="-1"></a>}</span>
<span id="section-cb231-10"><a href="#section-cb231-10" tabindex="-1"></a></span>
<span id="section-cb231-11"><a href="#section-cb231-11" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;EPV of a temporary life insurance for (20) over a period of 45 years at interest rate 2% =&quot;</span>,<span class="fu">temporary_life_insurance</span>(<span class="dv">20</span>, <span class="dv">45</span>, <span class="fl">0.02</span>, life_table_2021))</span></code></pre></div>
<pre><code>## EPV of a temporary life insurance for (20) over a period of 45 years at interest rate 2% = 0.059754</code></pre>
<div class="sourceCode" id="section-cb233"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb233-1"><a href="#section-cb233-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot; EPV of a whole life insurance for (20) at interest rate 2% =&quot;</span>,<span class="fu">whole_life_insurance</span>(<span class="dv">20</span>, <span class="fl">0.02</span>, life_table_2021))</span></code></pre></div>
<pre><code>##  EPV of a whole life insurance for (20) at interest rate 2% = 0.301949</code></pre>
</div>
<div id="section-deferred-life-insurance" class="section level2">
<h2>Deferred Life Insurance</h2>
<p><strong>Calculating EPV of a deferred life insurance for constant
interest rate on age x</strong></p>
<details>
<summary>
<span style="color:blue;">Explanation of Calculating EPV of a deferred
life insurance for constant interest rate on age x</span>
</summary>
In this code, we are calculating the Expected Present Value (EPV) of a
deferred whole life insurance policy. The EPV is calculated by
considering the mortality rates (<code>qx</code>), survival
probabilities (<code>kpx</code>), and discount factors based on a
constant interest rate (<code>i</code>). The deferred period
(<code>u</code>) is taken into account to determine when the insurance
benefits start to be paid. The EPV is the sum of the discounted expected
benefits.
</details>
<div class="sourceCode" id="section-cb235"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb235-1"><a href="#section-cb235-1" tabindex="-1"></a><span class="co"># Function to compute the EPV of a deferred whole life insurance</span></span>
<span id="section-cb235-2"><a href="#section-cb235-2" tabindex="-1"></a>deferred_life_insurance <span class="ot">&lt;-</span> <span class="cf">function</span>(age, u, i, life_table_2021) {</span>
<span id="section-cb235-3"><a href="#section-cb235-3" tabindex="-1"></a>  qx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>qx;  px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> qx</span>
<span id="section-cb235-4"><a href="#section-cb235-4" tabindex="-1"></a>  kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">length</span>(px) <span class="sc">-</span> <span class="dv">1</span>)]))</span>
<span id="section-cb235-5"><a href="#section-cb235-5" tabindex="-1"></a>  kqx <span class="ot">&lt;-</span> kpx <span class="sc">*</span> qx[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(qx)]</span>
<span id="section-cb235-6"><a href="#section-cb235-6" tabindex="-1"></a>  discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(kqx))</span>
<span id="section-cb235-7"><a href="#section-cb235-7" tabindex="-1"></a>  benefits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, u), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(kpx) <span class="sc">-</span> u))</span>
<span id="section-cb235-8"><a href="#section-cb235-8" tabindex="-1"></a>  <span class="fu">sum</span>(benefits <span class="sc">*</span> discount_factors <span class="sc">*</span> kqx)</span>
<span id="section-cb235-9"><a href="#section-cb235-9" tabindex="-1"></a>}</span>
<span id="section-cb235-10"><a href="#section-cb235-10" tabindex="-1"></a></span>
<span id="section-cb235-11"><a href="#section-cb235-11" tabindex="-1"></a></span>
<span id="section-cb235-12"><a href="#section-cb235-12" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;EPV of a deferred life insurance for (20) deferred over 45 years at interest rate 2% =&quot;</span>,<span class="fu">deferred_life_insurance</span>(<span class="dv">20</span>, <span class="dv">45</span>, <span class="fl">0.02</span>, life_table_2021))</span></code></pre></div>
<pre><code>## EPV of a deferred life insurance for (20) deferred over 45 years at interest rate 2% = 0.242195</code></pre>
<p><strong>Suppose you are age 48 and want to insure a benefit of 40000
for death between the ages of 55 and 75. Assume interest rate is
5%</strong></p>
<details>
<summary>
<span style="color:blue;">Explanation of insuring a benefit of 40000 for
death between the ages of 55 and 75</span>
</summary>
In this code, we are calculating the Expected Present Value (EPV) of
death benefits for an insurance policy. The policyholder is currently 48
years old and will receive a benefit of 40000 if they die between the
ages of 55 and 75. We use mortality rates (<code>qx</code>), survival
probabilities (<code>kpx</code>), and discount factors based on an
interest rate (<code>i</code>) to calculate the EPV of these benefits.
</details>
<div class="sourceCode" id="section-cb237"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb237-1"><a href="#section-cb237-1" tabindex="-1"></a><span class="co"># Deferred mortality probabilites of (48)</span></span>
<span id="section-cb237-2"><a href="#section-cb237-2" tabindex="-1"></a>kqx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(<span class="dv">48</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">73</span> <span class="sc">+</span> <span class="dv">1</span>)])) <span class="sc">*</span> qx[(<span class="dv">48</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">74</span> <span class="sc">+</span> <span class="dv">1</span>)]</span>
<span id="section-cb237-3"><a href="#section-cb237-3" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="section-cb237-4"><a href="#section-cb237-4" tabindex="-1"></a></span>
<span id="section-cb237-5"><a href="#section-cb237-5" tabindex="-1"></a></span>
<span id="section-cb237-6"><a href="#section-cb237-6" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(kqx))</span>
<span id="section-cb237-7"><a href="#section-cb237-7" tabindex="-1"></a></span>
<span id="section-cb237-8"><a href="#section-cb237-8" tabindex="-1"></a></span>
<span id="section-cb237-9"><a href="#section-cb237-9" tabindex="-1"></a>benefits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">7</span>), <span class="fu">rep</span>(<span class="dv">40000</span>, <span class="fu">length</span>(kqx) <span class="sc">-</span> <span class="dv">7</span>))</span>
<span id="section-cb237-10"><a href="#section-cb237-10" tabindex="-1"></a></span>
<span id="section-cb237-11"><a href="#section-cb237-11" tabindex="-1"></a></span>
<span id="section-cb237-12"><a href="#section-cb237-12" tabindex="-1"></a>EPV_death_benefits <span class="ot">&lt;-</span> <span class="fu">sum</span>(benefits <span class="sc">*</span> discount_factors <span class="sc">*</span> kqx)</span>
<span id="section-cb237-13"><a href="#section-cb237-13" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;EPV of death benefits =&quot;</span>,EPV_death_benefits)</span></code></pre></div>
<pre><code>## EPV of death benefits = 2377.926</code></pre>
<p><strong>Now suppose you want to add a savings component to the policy
that will add 80000 if you are alive at age 75. You want to finance this
endowment insurance with constant premiums.</strong></p>
<details>
<summary>
<span style="color:blue;">Explanation of adding a savings component to
the policy with constant premiums</span>
</summary>
This code calculates the Expected Present Value (EPV) of adding a
savings component to an insurance policy. The policyholder will receive
an additional 80000 if they are alive at age 75. We calculate the EPV of
the pure endowment and then determine the level of constant premiums
required to finance both the death benefits and the savings component.
</details>
<div class="sourceCode" id="section-cb239"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb239-1"><a href="#section-cb239-1" tabindex="-1"></a><span class="co"># Pure endowment</span></span>
<span id="section-cb239-2"><a href="#section-cb239-2" tabindex="-1"></a>EPV_pure_endowment <span class="ot">&lt;-</span> <span class="dv">80000</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> <span class="dv">27</span> <span class="sc">*</span> <span class="fu">prod</span>(px[(<span class="dv">48</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">74</span> <span class="sc">+</span> <span class="dv">1</span>)])</span>
<span id="section-cb239-3"><a href="#section-cb239-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot; EPV of pure endowment =&quot;</span>,EPV_pure_endowment)</span></code></pre></div>
<pre><code>##  EPV of pure endowment = 10614</code></pre>
<div class="sourceCode" id="section-cb241"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb241-1"><a href="#section-cb241-1" tabindex="-1"></a><span class="co"># Premium pattern</span></span>
<span id="section-cb241-2"><a href="#section-cb241-2" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(<span class="dv">48</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">73</span> <span class="sc">+</span> <span class="dv">1</span>)]))</span>
<span id="section-cb241-3"><a href="#section-cb241-3" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">0</span><span class="sc">:</span>(<span class="fu">length</span>(kpx) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="section-cb241-4"><a href="#section-cb241-4" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(kpx))</span>
<span id="section-cb241-5"><a href="#section-cb241-5" tabindex="-1"></a>EPV_rho <span class="ot">&lt;-</span> <span class="fu">sum</span>(rho <span class="sc">*</span> discount_factors <span class="sc">*</span> kpx)</span>
<span id="section-cb241-6"><a href="#section-cb241-6" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Premium pattern EPV = &quot;</span>,EPV_rho)</span></code></pre></div>
<pre><code>## Premium pattern EPV =  13.33744</code></pre>
<div class="sourceCode" id="section-cb243"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb243-1"><a href="#section-cb243-1" tabindex="-1"></a><span class="co"># Premium level</span></span>
<span id="section-cb243-2"><a href="#section-cb243-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Premium level =&quot;</span>, (EPV_death_benefits <span class="sc">+</span> EPV_pure_endowment) <span class="sc">/</span> EPV_rho)</span></code></pre></div>
<pre><code>## Premium level = 974.0947</code></pre>
</div>
<div id="section-shiny-app-for-life-insurance-calculator"
class="section level2">
<h2>Shiny App for Life Insurance Calculator</h2>
<details>
<summary>
<span style="color:blue;">Explanation of Shiny App for Life Insurance
Calculator</span>
</summary>
This Shiny app allows users to calculate the Expected Present Value
(EPV) of different types of life insurance policies (whole life,
temporary, or deferred). The user inputs their age, interest rate, and
the type of insurance, and the app calculates the EPV using predefined
functions for each insurance type.
</details>
<div class="sourceCode" id="section-cb245"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb245-1"><a href="#section-cb245-1" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="section-cb245-2"><a href="#section-cb245-2" tabindex="-1"></a></span>
<span id="section-cb245-3"><a href="#section-cb245-3" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="section-cb245-4"><a href="#section-cb245-4" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Life Insurance Calculator&quot;</span>),</span>
<span id="section-cb245-5"><a href="#section-cb245-5" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="section-cb245-6"><a href="#section-cb245-6" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="section-cb245-7"><a href="#section-cb245-7" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;Age:&quot;</span>, <span class="dv">20</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">110</span>),</span>
<span id="section-cb245-8"><a href="#section-cb245-8" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;interest&quot;</span>, <span class="st">&quot;Interest Rate:&quot;</span>, <span class="fl">0.02</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="fl">0.2</span>, <span class="at">step =</span> <span class="fl">0.001</span>),</span>
<span id="section-cb245-9"><a href="#section-cb245-9" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="st">&quot;type&quot;</span>, <span class="st">&quot;Insurance Type:&quot;</span>, </span>
<span id="section-cb245-10"><a href="#section-cb245-10" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">&quot;Whole Life&quot;</span> <span class="ot">=</span> <span class="st">&quot;whole&quot;</span>, </span>
<span id="section-cb245-11"><a href="#section-cb245-11" tabindex="-1"></a>                              <span class="st">&quot;Temporary&quot;</span> <span class="ot">=</span> <span class="st">&quot;temp&quot;</span>, </span>
<span id="section-cb245-12"><a href="#section-cb245-12" tabindex="-1"></a>                              <span class="st">&quot;Deferred&quot;</span> <span class="ot">=</span> <span class="st">&quot;deferred&quot;</span>)),</span>
<span id="section-cb245-13"><a href="#section-cb245-13" tabindex="-1"></a>      <span class="fu">conditionalPanel</span>(</span>
<span id="section-cb245-14"><a href="#section-cb245-14" tabindex="-1"></a>        <span class="at">condition =</span> <span class="st">&quot;input.type == &#39;temp&#39; || input.type == &#39;deferred&#39;&quot;</span>,</span>
<span id="section-cb245-15"><a href="#section-cb245-15" tabindex="-1"></a>        <span class="fu">numericInput</span>(<span class="st">&quot;term&quot;</span>, <span class="st">&quot;Term/Deferment (years):&quot;</span>, <span class="dv">10</span>, <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">50</span>)</span>
<span id="section-cb245-16"><a href="#section-cb245-16" tabindex="-1"></a>      )</span>
<span id="section-cb245-17"><a href="#section-cb245-17" tabindex="-1"></a>    ),</span>
<span id="section-cb245-18"><a href="#section-cb245-18" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="section-cb245-19"><a href="#section-cb245-19" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">&quot;Expected Present Value:&quot;</span>),</span>
<span id="section-cb245-20"><a href="#section-cb245-20" tabindex="-1"></a>      <span class="fu">textOutput</span>(<span class="st">&quot;epv&quot;</span>)</span>
<span id="section-cb245-21"><a href="#section-cb245-21" tabindex="-1"></a>    )</span>
<span id="section-cb245-22"><a href="#section-cb245-22" tabindex="-1"></a>  )</span>
<span id="section-cb245-23"><a href="#section-cb245-23" tabindex="-1"></a>)</span>
<span id="section-cb245-24"><a href="#section-cb245-24" tabindex="-1"></a></span>
<span id="section-cb245-25"><a href="#section-cb245-25" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="section-cb245-26"><a href="#section-cb245-26" tabindex="-1"></a>  output<span class="sc">$</span>epv <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="section-cb245-27"><a href="#section-cb245-27" tabindex="-1"></a>    epv <span class="ot">&lt;-</span> <span class="cf">switch</span>(input<span class="sc">$</span>type,</span>
<span id="section-cb245-28"><a href="#section-cb245-28" tabindex="-1"></a>                  <span class="st">&quot;whole&quot;</span> <span class="ot">=</span> <span class="fu">whole_life_insurance</span>(input<span class="sc">$</span>age, input<span class="sc">$</span>interest, life_table),</span>
<span id="section-cb245-29"><a href="#section-cb245-29" tabindex="-1"></a>                  <span class="st">&quot;temp&quot;</span> <span class="ot">=</span> <span class="fu">temporary_life_insurance</span>(input<span class="sc">$</span>age, input<span class="sc">$</span>term, input<span class="sc">$</span>interest, life_table),</span>
<span id="section-cb245-30"><a href="#section-cb245-30" tabindex="-1"></a>                  <span class="st">&quot;deferred&quot;</span> <span class="ot">=</span> <span class="fu">deferred_life_insurance</span>(input<span class="sc">$</span>age, input<span class="sc">$</span>term, input<span class="sc">$</span>interest, life_table))</span>
<span id="section-cb245-31"><a href="#section-cb245-31" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;$&quot;</span>, <span class="fu">round</span>(epv, <span class="dv">2</span>))</span>
<span id="section-cb245-32"><a href="#section-cb245-32" tabindex="-1"></a>  })</span>
<span id="section-cb245-33"><a href="#section-cb245-33" tabindex="-1"></a>}</span>
<span id="section-cb245-34"><a href="#section-cb245-34" tabindex="-1"></a></span>
<span id="section-cb245-35"><a href="#section-cb245-35" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<iframe data-deferred-src="app33c284f63b4855716990772a2cbb91bb/?w=&amp;__subapp__=1" width="100%" height="400" class="shiny-frame shiny-frame-deferred"></iframe>
<div id="section-integrating-survival-models" class="section level3">
<h3>Integrating Survival Models</h3>
<div id="section-kaplan-meier-estimator-for-survival-probabilities"
class="section level4">
<h4>Kaplan-Meier Estimator for Survival Probabilities</h4>
<details>
<summary>
<span style="color:blue;">Explanation of Kaplan-Meier Estimator for
Survival Probabilities</span>
</summary>
This code uses the Kaplan-Meier estimator to calculate the survival
probabilities based on the life table data. The Kaplan-Meier estimator
is a non-parametric statistic used to estimate the survival function
from lifetime data. It plots the probability of survival at different
ages.
</details>
<div class="sourceCode" id="section-cb246"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb246-1"><a href="#section-cb246-1" tabindex="-1"></a><span class="fu">library</span>(survival)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;survival&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:caret&#39;:
## 
##     cluster</code></pre>
<div class="sourceCode" id="section-cb249"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb249-1"><a href="#section-cb249-1" tabindex="-1"></a><span class="co"># Creating a survival object</span></span>
<span id="section-cb249-2"><a href="#section-cb249-2" tabindex="-1"></a>surv_obj <span class="ot">&lt;-</span> <span class="fu">Surv</span>(<span class="at">time =</span> life_table<span class="sc">$</span>Age, <span class="at">event =</span> life_table<span class="sc">$</span>dx <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="section-cb249-3"><a href="#section-cb249-3" tabindex="-1"></a></span>
<span id="section-cb249-4"><a href="#section-cb249-4" tabindex="-1"></a><span class="co"># Kaplan-Meier estimate</span></span>
<span id="section-cb249-5"><a href="#section-cb249-5" tabindex="-1"></a>km_fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(surv_obj <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> life_table)</span>
<span id="section-cb249-6"><a href="#section-cb249-6" tabindex="-1"></a></span>
<span id="section-cb249-7"><a href="#section-cb249-7" tabindex="-1"></a><span class="co"># Plot the Kaplan-Meier estimate</span></span>
<span id="section-cb249-8"><a href="#section-cb249-8" tabindex="-1"></a><span class="fu">plot</span>(km_fit, <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Survival Probability&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Kaplan-Meier Estimate of Survival Probability&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-93-1.png" width="672" /></p>
</div>
<div id="section-cox-proportional-hazards-model" class="section level4">
<h4>Cox Proportional Hazards Model</h4>
<p>We can use the Cox Proportional Hazards model to analyze the effect
of covariates on survival time.</p>
<details>
<summary>
<span style="color:blue;">Explanation of Cox Proportional Hazards
Model</span>
</summary>
This code fits a Cox Proportional Hazards model to the life table data.
The Cox model is used to analyze the effect of covariates (such as age
and mortality rate) on survival time. It helps us understand how these
factors influence the risk of death at different ages.
</details>
<div class="sourceCode" id="section-cb250"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb250-1"><a href="#section-cb250-1" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="section-cb250-2"><a href="#section-cb250-2" tabindex="-1"></a></span>
<span id="section-cb250-3"><a href="#section-cb250-3" tabindex="-1"></a>  <span class="fu">library</span>(survival)</span>
<span id="section-cb250-4"><a href="#section-cb250-4" tabindex="-1"></a>  </span>
<span id="section-cb250-5"><a href="#section-cb250-5" tabindex="-1"></a></span>
<span id="section-cb250-6"><a href="#section-cb250-6" tabindex="-1"></a>  life_table <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">megacrazyleo</span><span class="sc">\\</span><span class="st">Desktop</span><span class="sc">\\</span><span class="st">SQL</span><span class="sc">\\</span><span class="st">R</span><span class="sc">\\</span><span class="st">bltper_1x1.txt&quot;</span>, <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">skip =</span> <span class="dv">3</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>) </span>
<span id="section-cb250-7"><a href="#section-cb250-7" tabindex="-1"></a>  <span class="fu">colnames</span>(life_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Age&quot;</span>, <span class="st">&quot;mx&quot;</span>, <span class="st">&quot;qx&quot;</span>, <span class="st">&quot;ax&quot;</span>, <span class="st">&quot;lx&quot;</span>, <span class="st">&quot;dx&quot;</span>, <span class="st">&quot;Lx&quot;</span>, <span class="st">&quot;Tx&quot;</span>, <span class="st">&quot;ex&quot;</span>)</span>
<span id="section-cb250-8"><a href="#section-cb250-8" tabindex="-1"></a>  available_columns <span class="ot">&lt;-</span> <span class="fu">colnames</span>(life_table)</span>
<span id="section-cb250-9"><a href="#section-cb250-9" tabindex="-1"></a></span>
<span id="section-cb250-10"><a href="#section-cb250-10" tabindex="-1"></a>  required_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Age&quot;</span>, <span class="st">&quot;mx&quot;</span>, <span class="st">&quot;dx&quot;</span>, <span class="st">&quot;lx&quot;</span>)</span>
<span id="section-cb250-11"><a href="#section-cb250-11" tabindex="-1"></a>  available_columns <span class="ot">&lt;-</span> required_columns[required_columns <span class="sc">%in%</span> <span class="fu">colnames</span>(life_table)]</span>
<span id="section-cb250-12"><a href="#section-cb250-12" tabindex="-1"></a>  </span>
<span id="section-cb250-13"><a href="#section-cb250-13" tabindex="-1"></a></span>
<span id="section-cb250-14"><a href="#section-cb250-14" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(available_columns) <span class="sc">&lt;</span> <span class="dv">5</span>) {</span>
<span id="section-cb250-15"><a href="#section-cb250-15" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Some required columns are missing from life_table&quot;</span>)</span>
<span id="section-cb250-16"><a href="#section-cb250-16" tabindex="-1"></a>  }</span>
<span id="section-cb250-17"><a href="#section-cb250-17" tabindex="-1"></a>  </span>
<span id="section-cb250-18"><a href="#section-cb250-18" tabindex="-1"></a>  <span class="co"># Ensure all required columns are numeric</span></span>
<span id="section-cb250-19"><a href="#section-cb250-19" tabindex="-1"></a>  <span class="cf">for</span> (col <span class="cf">in</span> available_columns) {</span>
<span id="section-cb250-20"><a href="#section-cb250-20" tabindex="-1"></a>    life_table[[col]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(life_table[[col]])</span>
<span id="section-cb250-21"><a href="#section-cb250-21" tabindex="-1"></a>  }</span>
<span id="section-cb250-22"><a href="#section-cb250-22" tabindex="-1"></a>  </span>
<span id="section-cb250-23"><a href="#section-cb250-23" tabindex="-1"></a>  <span class="co"># Clean the data (remove NAs and infinite values)</span></span>
<span id="section-cb250-24"><a href="#section-cb250-24" tabindex="-1"></a>  life_table_clean <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(life_table[, available_columns])</span>
<span id="section-cb250-25"><a href="#section-cb250-25" tabindex="-1"></a>  life_table_clean <span class="ot">&lt;-</span> life_table_clean[<span class="fu">is.finite</span>(<span class="fu">rowSums</span>(life_table_clean)), ]</span>
<span id="section-cb250-26"><a href="#section-cb250-26" tabindex="-1"></a>  </span>
<span id="section-cb250-27"><a href="#section-cb250-27" tabindex="-1"></a></span>
<span id="section-cb250-28"><a href="#section-cb250-28" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.finite</span>(<span class="fu">as.matrix</span>(life_table_clean)))) {</span>
<span id="section-cb250-29"><a href="#section-cb250-29" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;NA/NaN/Inf values detected in life_table_clean&quot;</span>)</span>
<span id="section-cb250-30"><a href="#section-cb250-30" tabindex="-1"></a>  }</span>
<span id="section-cb250-31"><a href="#section-cb250-31" tabindex="-1"></a>  </span>
<span id="section-cb250-32"><a href="#section-cb250-32" tabindex="-1"></a></span>
<span id="section-cb250-33"><a href="#section-cb250-33" tabindex="-1"></a>  surv_obj <span class="ot">&lt;-</span> <span class="fu">Surv</span>(<span class="at">time =</span> life_table_clean<span class="sc">$</span>Age, <span class="at">event =</span> life_table_clean<span class="sc">$</span>dx <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="section-cb250-34"><a href="#section-cb250-34" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.finite</span>(<span class="fu">as.matrix</span>(surv_obj)))) {</span>
<span id="section-cb250-35"><a href="#section-cb250-35" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;NA/NaN/Inf values detected in surv_obj&quot;</span>)</span>
<span id="section-cb250-36"><a href="#section-cb250-36" tabindex="-1"></a>  }</span>
<span id="section-cb250-37"><a href="#section-cb250-37" tabindex="-1"></a>  </span>
<span id="section-cb250-38"><a href="#section-cb250-38" tabindex="-1"></a>  <span class="co"># Fit the Cox Proportional Hazards model (simplified)</span></span>
<span id="section-cb250-39"><a href="#section-cb250-39" tabindex="-1"></a>  cox_model <span class="ot">&lt;-</span> <span class="fu">coxph</span>(surv_obj <span class="sc">~</span> Age <span class="sc">+</span> mx, <span class="at">data =</span> life_table_clean)</span>
<span id="section-cb250-40"><a href="#section-cb250-40" tabindex="-1"></a>  <span class="fu">summary</span>(cox_model)</span>
<span id="section-cb250-41"><a href="#section-cb250-41" tabindex="-1"></a>  </span>
<span id="section-cb250-42"><a href="#section-cb250-42" tabindex="-1"></a></span>
<span id="section-cb250-43"><a href="#section-cb250-43" tabindex="-1"></a>  newdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Age =</span> <span class="dv">50</span>, <span class="at">Year =</span> <span class="dv">2021</span>, <span class="at">mx =</span> <span class="fu">mean</span>(life_table_clean<span class="sc">$</span>mx, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="section-cb250-44"><a href="#section-cb250-44" tabindex="-1"></a>  <span class="fu">print</span>(newdata)</span>
<span id="section-cb250-45"><a href="#section-cb250-45" tabindex="-1"></a>  </span>
<span id="section-cb250-46"><a href="#section-cb250-46" tabindex="-1"></a></span>
<span id="section-cb250-47"><a href="#section-cb250-47" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.finite</span>(<span class="fu">as.matrix</span>(newdata)))) {</span>
<span id="section-cb250-48"><a href="#section-cb250-48" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;NA/NaN/Inf values detected in newdata&quot;</span>)</span>
<span id="section-cb250-49"><a href="#section-cb250-49" tabindex="-1"></a>  }</span>
<span id="section-cb250-50"><a href="#section-cb250-50" tabindex="-1"></a>  </span>
<span id="section-cb250-51"><a href="#section-cb250-51" tabindex="-1"></a>  <span class="co"># Predict survival probabilities using the Cox model</span></span>
<span id="section-cb250-52"><a href="#section-cb250-52" tabindex="-1"></a>  cox_surv_fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(cox_model, <span class="at">newdata =</span> newdata)</span>
<span id="section-cb250-53"><a href="#section-cb250-53" tabindex="-1"></a>  </span>
<span id="section-cb250-54"><a href="#section-cb250-54" tabindex="-1"></a>  <span class="co"># Check the cox_surv_fit object</span></span>
<span id="section-cb250-55"><a href="#section-cb250-55" tabindex="-1"></a>  <span class="fu">print</span>(cox_surv_fit)</span>
<span id="section-cb250-56"><a href="#section-cb250-56" tabindex="-1"></a>  </span>
<span id="section-cb250-57"><a href="#section-cb250-57" tabindex="-1"></a>  <span class="fu">plot</span>(cox_surv_fit, <span class="at">xlab =</span> <span class="st">&quot;Time&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Survival Probability&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Survival Probabilities from Cox Model for Age 50 in 2021&quot;</span>)</span>
<span id="section-cb250-58"><a href="#section-cb250-58" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>##   Age Year         mx
## 1  50 2021 0.09661647
## Call: survfit(formula = cox_model, newdata = newdata)
## 
##          n events median 0.95LCL 0.95UCL
## [1,] 11110  11086     52      50      NA</code></pre>
<p><img src="figures/unnamed-chunk-94-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="section-integrating-credibility-theory" class="section level2">
<h2>Integrating Credibility Theory</h2>
<div id="section-simple-credibility-model" class="section level4">
<h4>Simple Credibility Model</h4>
<p><strong>We will use a simple credibility model to adjust the
mortality rates based on past experience and new data.</strong></p>
<details>
<summary>
<span style="color:blue;">Explanation of Simple Credibility Model</span>
</summary>
This code demonstrates a simple credibility model to adjust mortality
rates based on observed and expected data. The credibility model
combines past experience (observed mortality rates) with new data
(expected mortality rates) to produce adjusted rates. The credibility
factor determines the weight given to the observed data.
</details>
<div class="sourceCode" id="section-cb252"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb252-1"><a href="#section-cb252-1" tabindex="-1"></a><span class="co"># Create synthetic data for demonstration</span></span>
<span id="section-cb252-2"><a href="#section-cb252-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="section-cb252-3"><a href="#section-cb252-3" tabindex="-1"></a>age_range <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">110</span></span>
<span id="section-cb252-4"><a href="#section-cb252-4" tabindex="-1"></a></span>
<span id="section-cb252-5"><a href="#section-cb252-5" tabindex="-1"></a><span class="co"># Synthetic observed data for life_table_2021</span></span>
<span id="section-cb252-6"><a href="#section-cb252-6" tabindex="-1"></a>life_table_2021 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="section-cb252-7"><a href="#section-cb252-7" tabindex="-1"></a>  <span class="at">Age =</span> age_range,</span>
<span id="section-cb252-8"><a href="#section-cb252-8" tabindex="-1"></a>  <span class="at">qx =</span> <span class="fu">runif</span>(<span class="fu">length</span>(age_range), <span class="at">min =</span> <span class="fl">0.0001</span>, <span class="at">max =</span> <span class="fl">0.01</span>)</span>
<span id="section-cb252-9"><a href="#section-cb252-9" tabindex="-1"></a>)</span>
<span id="section-cb252-10"><a href="#section-cb252-10" tabindex="-1"></a></span>
<span id="section-cb252-11"><a href="#section-cb252-11" tabindex="-1"></a><span class="co"># Synthetic expected data for filtered_life_table</span></span>
<span id="section-cb252-12"><a href="#section-cb252-12" tabindex="-1"></a>filtered_life_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="section-cb252-13"><a href="#section-cb252-13" tabindex="-1"></a>  <span class="at">Age =</span> age_range,</span>
<span id="section-cb252-14"><a href="#section-cb252-14" tabindex="-1"></a>  <span class="at">qx =</span> <span class="fu">runif</span>(<span class="fu">length</span>(age_range), <span class="at">min =</span> <span class="fl">0.0001</span>, <span class="at">max =</span> <span class="fl">0.01</span>)</span>
<span id="section-cb252-15"><a href="#section-cb252-15" tabindex="-1"></a>)</span>
<span id="section-cb252-16"><a href="#section-cb252-16" tabindex="-1"></a></span>
<span id="section-cb252-17"><a href="#section-cb252-17" tabindex="-1"></a><span class="co"># Ensure observed_qx and expected_qx cover the same age range</span></span>
<span id="section-cb252-18"><a href="#section-cb252-18" tabindex="-1"></a>common_ages <span class="ot">&lt;-</span> <span class="fu">intersect</span>(life_table_2021<span class="sc">$</span>Age, filtered_life_table<span class="sc">$</span>Age)</span>
<span id="section-cb252-19"><a href="#section-cb252-19" tabindex="-1"></a></span>
<span id="section-cb252-20"><a href="#section-cb252-20" tabindex="-1"></a><span class="co"># Filter both life_table_2021 and filtered_life_table to only include common ages</span></span>
<span id="section-cb252-21"><a href="#section-cb252-21" tabindex="-1"></a>life_table_2021_filtered <span class="ot">&lt;-</span> life_table_2021[life_table_2021<span class="sc">$</span>Age <span class="sc">%in%</span> common_ages, ]</span>
<span id="section-cb252-22"><a href="#section-cb252-22" tabindex="-1"></a>filtered_life_table_filtered <span class="ot">&lt;-</span> filtered_life_table[filtered_life_table<span class="sc">$</span>Age <span class="sc">%in%</span> common_ages, ]</span>
<span id="section-cb252-23"><a href="#section-cb252-23" tabindex="-1"></a></span>
<span id="section-cb252-24"><a href="#section-cb252-24" tabindex="-1"></a><span class="co"># Extract qx values for common ages</span></span>
<span id="section-cb252-25"><a href="#section-cb252-25" tabindex="-1"></a>observed_qx <span class="ot">&lt;-</span> life_table_2021_filtered<span class="sc">$</span>qx</span>
<span id="section-cb252-26"><a href="#section-cb252-26" tabindex="-1"></a>expected_qx <span class="ot">&lt;-</span> filtered_life_table_filtered<span class="sc">$</span>qx</span>
<span id="section-cb252-27"><a href="#section-cb252-27" tabindex="-1"></a></span>
<span id="section-cb252-28"><a href="#section-cb252-28" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Summary of Ages in life_table_2021_filtered:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Summary of Ages in life_table_2021_filtered:</code></pre>
<div class="sourceCode" id="section-cb254"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb254-1"><a href="#section-cb254-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(life_table_2021_filtered<span class="sc">$</span>Age))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     0.0    27.5    55.0    55.0    82.5   110.0</code></pre>
<div class="sourceCode" id="section-cb256"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb256-1"><a href="#section-cb256-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Summary of Ages in filtered_life_table_filtered:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Summary of Ages in filtered_life_table_filtered:</code></pre>
<div class="sourceCode" id="section-cb258"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb258-1"><a href="#section-cb258-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(filtered_life_table_filtered<span class="sc">$</span>Age))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     0.0    27.5    55.0    55.0    82.5   110.0</code></pre>
<div class="sourceCode" id="section-cb260"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb260-1"><a href="#section-cb260-1" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(observed_qx) <span class="sc">!=</span> <span class="fu">length</span>(expected_qx)) {</span>
<span id="section-cb260-2"><a href="#section-cb260-2" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&quot;Lengths of observed_qx and expected_qx do not match after alignment!&quot;</span>)</span>
<span id="section-cb260-3"><a href="#section-cb260-3" tabindex="-1"></a>}</span>
<span id="section-cb260-4"><a href="#section-cb260-4" tabindex="-1"></a></span>
<span id="section-cb260-5"><a href="#section-cb260-5" tabindex="-1"></a><span class="co"># Apply credibility model</span></span>
<span id="section-cb260-6"><a href="#section-cb260-6" tabindex="-1"></a>simple_credibility <span class="ot">&lt;-</span> <span class="cf">function</span>(observed_qx, expected_qx, credibility_factor) {</span>
<span id="section-cb260-7"><a href="#section-cb260-7" tabindex="-1"></a>  adjusted_qx <span class="ot">&lt;-</span> credibility_factor <span class="sc">*</span> observed_qx <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> credibility_factor) <span class="sc">*</span> expected_qx</span>
<span id="section-cb260-8"><a href="#section-cb260-8" tabindex="-1"></a>  <span class="fu">return</span>(adjusted_qx)</span>
<span id="section-cb260-9"><a href="#section-cb260-9" tabindex="-1"></a>}</span>
<span id="section-cb260-10"><a href="#section-cb260-10" tabindex="-1"></a></span>
<span id="section-cb260-11"><a href="#section-cb260-11" tabindex="-1"></a>credibility_factor <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="section-cb260-12"><a href="#section-cb260-12" tabindex="-1"></a>adjusted_qx <span class="ot">&lt;-</span> <span class="fu">simple_credibility</span>(observed_qx, expected_qx, credibility_factor)</span>
<span id="section-cb260-13"><a href="#section-cb260-13" tabindex="-1"></a></span>
<span id="section-cb260-14"><a href="#section-cb260-14" tabindex="-1"></a></span>
<span id="section-cb260-15"><a href="#section-cb260-15" tabindex="-1"></a><span class="co"># Plot the adjusted mortality rates</span></span>
<span id="section-cb260-16"><a href="#section-cb260-16" tabindex="-1"></a><span class="fu">plot</span>(life_table_2021_filtered<span class="sc">$</span>Age, adjusted_qx, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Adjusted Mortality Rate&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Adjusted Mortality Rates using Credibility Theory&quot;</span>)</span>
<span id="section-cb260-17"><a href="#section-cb260-17" tabindex="-1"></a><span class="fu">lines</span>(life_table_2021_filtered<span class="sc">$</span>Age, observed_qx, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="section-cb260-18"><a href="#section-cb260-18" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Adjusted&quot;</span>, <span class="st">&quot;Observed&quot;</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;blue&quot;</span>), <span class="at">lty =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-95-1.png" width="672" /></p>
</div>
<div
id="section-incorporating-adjusted-mortality-rates-into-life-insurance-calculations"
class="section level3">
<h3>Incorporating Adjusted Mortality Rates into Life Insurance
Calculations</h3>
<p><strong>We will now use the adjusted mortality rates in the life
insurance calculations.</strong></p>
<details>
<summary>
<span style="color:blue;">Explanation of using adjusted mortality rates
in life insurance calculations</span>
</summary>
This code uses the adjusted mortality rates obtained from the
credibility model to calculate the Expected Present Value (EPV) of a
whole life insurance policy. The EPV is calculated by considering the
adjusted mortality rates (<code>adjusted_qx</code>), survival
probabilities (<code>kpx</code>), and discount factors based on a
constant interest rate (<code>i</code>). This helps in determining the
value of the insurance policy using more accurate mortality estimates.
</details>
<div class="sourceCode" id="section-cb261"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb261-1"><a href="#section-cb261-1" tabindex="-1"></a><span class="co"># Function to compute the EPV of a whole life insurance with adjusted mortality rates</span></span>
<span id="section-cb261-2"><a href="#section-cb261-2" tabindex="-1"></a>whole_life_insurance_adjusted <span class="ot">&lt;-</span> <span class="cf">function</span>(age, i, adjusted_qx) {</span>
<span id="section-cb261-3"><a href="#section-cb261-3" tabindex="-1"></a>  px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> adjusted_qx</span>
<span id="section-cb261-4"><a href="#section-cb261-4" tabindex="-1"></a>  kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">length</span>(px) <span class="sc">-</span> <span class="dv">1</span>)]))</span>
<span id="section-cb261-5"><a href="#section-cb261-5" tabindex="-1"></a>  kqx <span class="ot">&lt;-</span> kpx <span class="sc">*</span> adjusted_qx[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(adjusted_qx)]</span>
<span id="section-cb261-6"><a href="#section-cb261-6" tabindex="-1"></a>  discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(kqx))</span>
<span id="section-cb261-7"><a href="#section-cb261-7" tabindex="-1"></a>  <span class="fu">sum</span>(discount_factors <span class="sc">*</span> kqx, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="section-cb261-8"><a href="#section-cb261-8" tabindex="-1"></a>}</span>
<span id="section-cb261-9"><a href="#section-cb261-9" tabindex="-1"></a></span>
<span id="section-cb261-10"><a href="#section-cb261-10" tabindex="-1"></a><span class="co"># EPV of whole life insurance for a 20-year-old at 2% interest rate using adjusted mortality rates</span></span>
<span id="section-cb261-11"><a href="#section-cb261-11" tabindex="-1"></a>epv_adjusted <span class="ot">&lt;-</span> <span class="fu">whole_life_insurance_adjusted</span>(<span class="dv">20</span>, <span class="fl">0.02</span>, adjusted_qx)</span>
<span id="section-cb261-12"><a href="#section-cb261-12" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;EPV of whole life insurance with adjusted mortality rates =&quot;</span>, epv_adjusted)</span></code></pre></div>
<pre><code>## EPV of whole life insurance with adjusted mortality rates = 0.1840597</code></pre>
</div>
</div>
<div
id="section-shiny-app-for-life-insurance-calculator-with-adjusted-mortality-rates"
class="section level2">
<h2>Shiny App for Life Insurance Calculator with Adjusted Mortality
Rates</h2>
<div class="sourceCode" id="section-cb263"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb263-1"><a href="#section-cb263-1" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="section-cb263-2"><a href="#section-cb263-2" tabindex="-1"></a></span>
<span id="section-cb263-3"><a href="#section-cb263-3" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="section-cb263-4"><a href="#section-cb263-4" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Life Insurance Calculator with Adjusted Mortality Rates&quot;</span>),</span>
<span id="section-cb263-5"><a href="#section-cb263-5" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="section-cb263-6"><a href="#section-cb263-6" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="section-cb263-7"><a href="#section-cb263-7" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;Age:&quot;</span>, <span class="dv">20</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">110</span>),</span>
<span id="section-cb263-8"><a href="#section-cb263-8" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;interest&quot;</span>, <span class="st">&quot;Interest Rate:&quot;</span>, <span class="fl">0.02</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="fl">0.2</span>, <span class="at">step =</span> <span class="fl">0.001</span>),</span>
<span id="section-cb263-9"><a href="#section-cb263-9" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;credibility&quot;</span>, <span class="st">&quot;Credibility Factor:&quot;</span>, <span class="fl">0.8</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>, <span class="at">step =</span> <span class="fl">0.1</span>),</span>
<span id="section-cb263-10"><a href="#section-cb263-10" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="st">&quot;type&quot;</span>, <span class="st">&quot;Insurance Type:&quot;</span>, </span>
<span id="section-cb263-11"><a href="#section-cb263-11" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">&quot;Whole Life&quot;</span> <span class="ot">=</span> <span class="st">&quot;whole&quot;</span>, </span>
<span id="section-cb263-12"><a href="#section-cb263-12" tabindex="-1"></a>                              <span class="st">&quot;Temporary&quot;</span> <span class="ot">=</span> <span class="st">&quot;temp&quot;</span>, </span>
<span id="section-cb263-13"><a href="#section-cb263-13" tabindex="-1"></a>                              <span class="st">&quot;Deferred&quot;</span> <span class="ot">=</span> <span class="st">&quot;deferred&quot;</span>)),</span>
<span id="section-cb263-14"><a href="#section-cb263-14" tabindex="-1"></a>      <span class="fu">conditionalPanel</span>(</span>
<span id="section-cb263-15"><a href="#section-cb263-15" tabindex="-1"></a>        <span class="at">condition =</span> <span class="st">&quot;input.type == &#39;temp&#39; || input.type == &#39;deferred&#39;&quot;</span>,</span>
<span id="section-cb263-16"><a href="#section-cb263-16" tabindex="-1"></a>        <span class="fu">numericInput</span>(<span class="st">&quot;term&quot;</span>, <span class="st">&quot;Term/Deferment (years):&quot;</span>, <span class="dv">10</span>, <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">50</span>)</span>
<span id="section-cb263-17"><a href="#section-cb263-17" tabindex="-1"></a>      )</span>
<span id="section-cb263-18"><a href="#section-cb263-18" tabindex="-1"></a>    ),</span>
<span id="section-cb263-19"><a href="#section-cb263-19" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="section-cb263-20"><a href="#section-cb263-20" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">&quot;Expected Present Value:&quot;</span>),</span>
<span id="section-cb263-21"><a href="#section-cb263-21" tabindex="-1"></a>      <span class="fu">textOutput</span>(<span class="st">&quot;epv&quot;</span>)</span>
<span id="section-cb263-22"><a href="#section-cb263-22" tabindex="-1"></a>    )</span>
<span id="section-cb263-23"><a href="#section-cb263-23" tabindex="-1"></a>  )</span>
<span id="section-cb263-24"><a href="#section-cb263-24" tabindex="-1"></a>)</span>
<span id="section-cb263-25"><a href="#section-cb263-25" tabindex="-1"></a></span>
<span id="section-cb263-26"><a href="#section-cb263-26" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="section-cb263-27"><a href="#section-cb263-27" tabindex="-1"></a>  output<span class="sc">$</span>epv <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="section-cb263-28"><a href="#section-cb263-28" tabindex="-1"></a>    observed_qx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>qx</span>
<span id="section-cb263-29"><a href="#section-cb263-29" tabindex="-1"></a>    expected_qx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>qx</span>
<span id="section-cb263-30"><a href="#section-cb263-30" tabindex="-1"></a>    adjusted_qx <span class="ot">&lt;-</span> <span class="fu">simple_credibility</span>(observed_qx, expected_qx, input<span class="sc">$</span>credibility)</span>
<span id="section-cb263-31"><a href="#section-cb263-31" tabindex="-1"></a>    epv <span class="ot">&lt;-</span> <span class="cf">switch</span>(input<span class="sc">$</span>type,</span>
<span id="section-cb263-32"><a href="#section-cb263-32" tabindex="-1"></a>                  <span class="st">&quot;whole&quot;</span> <span class="ot">=</span> <span class="fu">whole_life_insurance_adjusted</span>(input<span class="sc">$</span>age, input<span class="sc">$</span>interest, adjusted_qx),</span>
<span id="section-cb263-33"><a href="#section-cb263-33" tabindex="-1"></a>                  <span class="st">&quot;temp&quot;</span> <span class="ot">=</span> <span class="fu">temporary_life_insurance</span>(input<span class="sc">$</span>age, input<span class="sc">$</span>term, input<span class="sc">$</span>interest, life_table),</span>
<span id="section-cb263-34"><a href="#section-cb263-34" tabindex="-1"></a>                  <span class="st">&quot;deferred&quot;</span> <span class="ot">=</span> <span class="fu">deferred_life_insurance</span>(input<span class="sc">$</span>age, input<span class="sc">$</span>term, input<span class="sc">$</span>interest, life_table))</span>
<span id="section-cb263-35"><a href="#section-cb263-35" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;$&quot;</span>, <span class="fu">round</span>(epv, <span class="dv">2</span>))</span>
<span id="section-cb263-36"><a href="#section-cb263-36" tabindex="-1"></a>  })</span>
<span id="section-cb263-37"><a href="#section-cb263-37" tabindex="-1"></a>}</span>
<span id="section-cb263-38"><a href="#section-cb263-38" tabindex="-1"></a></span>
<span id="section-cb263-39"><a href="#section-cb263-39" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<iframe data-deferred-src="appdc690c84766dc893403b4bc64adc2a2a/?w=&amp;__subapp__=1" width="100%" height="400" class="shiny-frame shiny-frame-deferred"></iframe>
</div>
<div id="section-generalized-linear-models-glms-for-mortality-rates"
class="section level2">
<h2>Generalized Linear Models (GLMs) for Mortality Rates</h2>
<p><strong>We will use GLMs with various link functions to model
mortality rates.</strong></p>
<details>
<summary style="font-weight: bold; color: blue;">
Generalized Linear Models (GLMs) for Mortality Rates
</summary>
<p>
<p><strong>Overview:</strong><br> We use Generalized Linear Models
(GLMs) with various link functions to model mortality rates. This
approach allows us to analyze and predict mortality probabilities based
on different factors.<br><br> <strong>1. Logistic Regression
Model:</strong><br> - We load the MASS library to perform GLM
analysis.<br> - A logistic regression model is fitted to predict death
probability based on age, year, and mortality rate (mx).<br> - The model
summary provides coefficients, standard errors, z-values, and p-values
for each predictor.<br> - Significant predictors (p-value &lt; 0.05)
indicate a strong relationship with death probability.<br><br></p>
<p><strong>2. Complementary Log-Log Regression Model:</strong><br> - We
fit a complementary log-log regression model using the same
predictors.<br> - This model is particularly suitable for survival data
and rare events.<br> - The summary output is interpreted similarly to
the logistic regression model.<br><br></p>
<p><strong>3. Model Comparison:</strong><br> - We use the Akaike
Information Criterion (AIC) to compare the fitted models.<br> - AIC
measures the relative quality of statistical models for a given
dataset.<br> - Lower AIC values indicate better-fitting models.<br> - We
compare AIC values of logistic, probit, and complementary log-log
regression models.<br> - The model with the lowest AIC is considered the
best among the compared models.<br><br></p>
This approach allows us to identify the most appropriate model for
predicting mortality rates and understanding the influence of different
factors on mortality probabilities.
</details>
<div class="sourceCode" id="section-cb264"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb264-1"><a href="#section-cb264-1" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="section-cb264-2"><a href="#section-cb264-2" tabindex="-1"></a></span>
<span id="section-cb264-3"><a href="#section-cb264-3" tabindex="-1"></a><span class="co"># Fit a logistic regression model (GLM) to predict the probability of death based on age</span></span>
<span id="section-cb264-4"><a href="#section-cb264-4" tabindex="-1"></a>glm_logit <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(dx, lx <span class="sc">-</span> dx) <span class="sc">~</span> Age <span class="sc">+</span> Year <span class="sc">+</span> mx, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data =</span> life_table)</span>
<span id="section-cb264-5"><a href="#section-cb264-5" tabindex="-1"></a><span class="fu">summary</span>(glm_logit)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cbind(dx, lx - dx) ~ Age + Year + mx, family = binomial(link = &quot;logit&quot;), 
##     data = life_table)
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.096e+01  2.266e-02   483.6   &lt;2e-16 ***
## Age          5.438e-02  2.661e-05  2043.7   &lt;2e-16 ***
## Year        -9.376e-03  1.165e-05  -804.7   &lt;2e-16 ***
## mx           5.726e+00  5.783e-03   990.2   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 25097787  on 11104  degrees of freedom
## Residual deviance:  2952984  on 11101  degrees of freedom
##   (101 observations deleted due to missingness)
## AIC: 3036122
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode" id="section-cb266"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb266-1"><a href="#section-cb266-1" tabindex="-1"></a><span class="co"># Fit a probit regression model (GLM) to predict the probability of death based on age</span></span>
<span id="section-cb266-2"><a href="#section-cb266-2" tabindex="-1"></a>glm_probit <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(dx, lx <span class="sc">-</span> dx) <span class="sc">~</span> Age <span class="sc">+</span> Year <span class="sc">+</span> mx, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;probit&quot;</span>), <span class="at">data =</span> life_table)</span>
<span id="section-cb266-3"><a href="#section-cb266-3" tabindex="-1"></a><span class="fu">summary</span>(glm_probit)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cbind(dx, lx - dx) ~ Age + Year + mx, family = binomial(link = &quot;probit&quot;), 
##     data = life_table)
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  4.049e+00  9.795e-03   413.3   &lt;2e-16 ***
## Age          1.688e-02  9.526e-06  1772.3   &lt;2e-16 ***
## Year        -3.708e-03  5.021e-06  -738.5   &lt;2e-16 ***
## mx           4.460e+00  2.830e-03  1576.0   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 25097787  on 11104  degrees of freedom
## Residual deviance:  2652471  on 11101  degrees of freedom
##   (101 observations deleted due to missingness)
## AIC: 2735608
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode" id="section-cb268"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb268-1"><a href="#section-cb268-1" tabindex="-1"></a><span class="co"># Fit a complementary log-log regression model (GLM) to predict the probability of death based on age</span></span>
<span id="section-cb268-2"><a href="#section-cb268-2" tabindex="-1"></a>glm_cloglog <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(dx, lx <span class="sc">-</span> dx) <span class="sc">~</span> Age <span class="sc">+</span> Year <span class="sc">+</span> mx, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;cloglog&quot;</span>), <span class="at">data =</span> life_table)</span>
<span id="section-cb268-3"><a href="#section-cb268-3" tabindex="-1"></a><span class="fu">summary</span>(glm_cloglog)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cbind(dx, lx - dx) ~ Age + Year + mx, family = binomial(link = &quot;cloglog&quot;), 
##     data = life_table)
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.070e+01  2.167e-02   493.7   &lt;2e-16 ***
## Age          5.680e-02  2.593e-05  2190.5   &lt;2e-16 ***
## Year        -9.298e-03  1.115e-05  -834.1   &lt;2e-16 ***
## mx           4.278e+00  4.953e-03   863.8   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 25097787  on 11104  degrees of freedom
## Residual deviance:  3091528  on 11101  degrees of freedom
##   (101 observations deleted due to missingness)
## AIC: 3174666
## 
## Number of Fisher Scoring iterations: 7</code></pre>
<div class="sourceCode" id="section-cb270"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb270-1"><a href="#section-cb270-1" tabindex="-1"></a><span class="co"># Compare the models using AIC</span></span>
<span id="section-cb270-2"><a href="#section-cb270-2" tabindex="-1"></a><span class="fu">AIC</span>(glm_logit, glm_probit, glm_cloglog)</span></code></pre></div>
<pre><code>##             df     AIC
## glm_logit    4 3036122
## glm_probit   4 2735608
## glm_cloglog  4 3174666</code></pre>
<div class="sourceCode" id="section-cb272"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb272-1"><a href="#section-cb272-1" tabindex="-1"></a><span class="co"># Predict survival probabilities using the best model (lowest AIC)</span></span>
<span id="section-cb272-2"><a href="#section-cb272-2" tabindex="-1"></a>best_glm <span class="ot">&lt;-</span> glm_logit </span>
<span id="section-cb272-3"><a href="#section-cb272-3" tabindex="-1"></a>predicted_qx_glm <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_glm, <span class="at">newdata =</span> life_table, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="section-cb272-4"><a href="#section-cb272-4" tabindex="-1"></a>predicted_px_glm <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> predicted_qx_glm</span>
<span id="section-cb272-5"><a href="#section-cb272-5" tabindex="-1"></a></span>
<span id="section-cb272-6"><a href="#section-cb272-6" tabindex="-1"></a></span>
<span id="section-cb272-7"><a href="#section-cb272-7" tabindex="-1"></a><span class="fu">plot</span>(life_table<span class="sc">$</span>Age, life_table<span class="sc">$</span>qx, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Probability of Death&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Actual vs Predicted Mortality Rates (GLM)&quot;</span>)</span>
<span id="section-cb272-8"><a href="#section-cb272-8" tabindex="-1"></a><span class="fu">lines</span>(life_table<span class="sc">$</span>Age, predicted_qx_glm, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="section-cb272-9"><a href="#section-cb272-9" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Actual&quot;</span>, <span class="st">&quot;Predicted&quot;</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">lty =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-98-1.png" width="672" /></p>
</div>
<div id="section-arimaarma-models-for-mortality-rate-forecasting"
class="section level2">
<h2>ARIMA/ARMA Models for Mortality Rate Forecasting</h2>
<p><strong>We will use ARIMA and ARMA models to forecast future
mortality rates.</strong></p>
<details>
<summary>
<span style="color:blue;">Explanation of the Code and Graph</span>
</summary>
<p>
### Explanation of the Code
</p>
<p>
#### What We Are Doing in the Code
</p>
<p>
<ol style="list-style-type: decimal">
<li><strong>Aggregating Mortality Rates</strong>:
</p>
<ul>
<li>
We are averaging mortality rates (<code>qx</code>) by year from a
dataset called <code>life_table</code>.
</li>
<li>
This helps us get a yearly average mortality rate.
</li>
</ul></li>
</ol>
<pre><code>agg_mortality <- aggregate(qx ~ Year, data = life_table, FUN = mean)</code></pre>
<p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Fitting an ARIMA Model</strong>:
</p>
<ul>
<li>
We use an ARIMA (AutoRegressive Integrated Moving Average) model to fit
the historical mortality rates.
</li>
<li>
The ARIMA model helps us identify patterns in the data and forecast
future values.
</li>
</ul></li>
</ol>
<pre><code>arima_model <- auto.arima(agg_mortality$qx)
summary(arima_model)</code></pre>
<p>
<ol start="3" style="list-style-type: decimal">
<li><strong>Forecasting Future Mortality Rates</strong>:
</p>
<ul>
<li>
Using the ARIMA model, we forecast future mortality rates for the next
10 years.
</li>
</ul></li>
</ol>
<pre><code>forecasts_arima <- forecast(arima_model, h = 10)</code></pre>
<p>
<ol start="4" style="list-style-type: decimal">
<li><strong>Plotting the Data</strong>:
</p>
<ul>
<li>
We plot both the historical mortality rates and the forecasted future
rates.
</li>
<li>
This helps visualize trends over time and the predicted future values.
</li>
</ul></li>
</ol>
<pre><code>plot(forecasts_arima, main = "Forecasted Mortality Rates (ARIMA)")
lines(agg_mortality$Year, agg_mortality$qx, col = "black")
legend("topright", legend = c("Historical", "Forecasted"), col = c("black", "blue"), lty = 1:1)</code></pre>
</ul>
</details>
<div class="sourceCode" id="section-cb273"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb273-1"><a href="#section-cb273-1" tabindex="-1"></a><span class="fu">library</span>(forecast)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;quantmod&#39;:
##   method            from
##   as.zoo.data.frame zoo</code></pre>
<pre><code>## 
## Attaching package: &#39;forecast&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:nlme&#39;:
## 
##     getResponse</code></pre>
<div class="sourceCode" id="section-cb277"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb277-1"><a href="#section-cb277-1" tabindex="-1"></a><span class="co"># Aggregate mortality rates by year</span></span>
<span id="section-cb277-2"><a href="#section-cb277-2" tabindex="-1"></a>agg_mortality <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(qx <span class="sc">~</span> Year, <span class="at">data =</span> life_table, <span class="at">FUN =</span> mean)</span>
<span id="section-cb277-3"><a href="#section-cb277-3" tabindex="-1"></a></span>
<span id="section-cb277-4"><a href="#section-cb277-4" tabindex="-1"></a><span class="co"># Fit an ARIMA model to the historical mortality rates</span></span>
<span id="section-cb277-5"><a href="#section-cb277-5" tabindex="-1"></a>arima_model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(agg_mortality<span class="sc">$</span>qx)</span>
<span id="section-cb277-6"><a href="#section-cb277-6" tabindex="-1"></a><span class="fu">summary</span>(arima_model)</span></code></pre></div>
<pre><code>## Series: agg_mortality$qx 
## ARIMA(0,1,1) with drift 
## 
## Coefficients:
##           ma1   drift
##       -0.5044  -3e-04
## s.e.   0.0818   1e-04
## 
## sigma^2 = 4.442e-06:  log likelihood = 475.2
## AIC=-944.39   AICc=-944.14   BIC=-936.58
## 
## Training set error measures:
##                       ME        RMSE         MAE         MPE     MAPE      MASE        ACF1
## Training set 2.02937e-05 0.002075956 0.001491127 -0.03464433 1.619527 0.8680309 -0.01778237</code></pre>
<div class="sourceCode" id="section-cb279"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb279-1"><a href="#section-cb279-1" tabindex="-1"></a>forecasts_arima <span class="ot">&lt;-</span> <span class="fu">forecast</span>(arima_model, <span class="at">h =</span> <span class="dv">10</span>)</span>
<span id="section-cb279-2"><a href="#section-cb279-2" tabindex="-1"></a></span>
<span id="section-cb279-3"><a href="#section-cb279-3" tabindex="-1"></a></span>
<span id="section-cb279-4"><a href="#section-cb279-4" tabindex="-1"></a><span class="fu">plot</span>(forecasts_arima, <span class="at">main =</span> <span class="st">&quot;Forecasted Mortality Rates (ARIMA)&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Mortality Rate&quot;</span>)</span>
<span id="section-cb279-5"><a href="#section-cb279-5" tabindex="-1"></a><span class="fu">lines</span>(agg_mortality<span class="sc">$</span>Year, agg_mortality<span class="sc">$</span>qx, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="section-cb279-6"><a href="#section-cb279-6" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Historical&quot;</span>, <span class="st">&quot;Forecasted&quot;</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;blue&quot;</span>), <span class="at">lty =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-99-1.png" width="672" /></p>
<p><strong>How we interpret these results</strong>:</p>
<p>The blue line shows the historical mortality rates over the years and
how it changed, while the red line and shaded area is the forecasted
data. The red line is the forecasted mortality rates for the next 10
years and the shaded area around the red line is the confidence
interval.</p>
</div>
<div
id="section-bühlmann-and-bühlmann-straub-models-for-credibility-theory"
class="section level2">
<h2>Bühlmann and Bühlmann-Straub Models for Credibility Theory</h2>
<p><strong>We will use the Bühlmann and Bühlmann-Straub models for
credibility adjustments.</strong></p>
<!-- # ```{r} -->
<!-- # # Load the life tables -->
<!-- # life_table <- read.table("C:\\Users\\megacrazyleo\\Desktop\\SQL\\R\\bltper_1x1.txt", header = FALSE, skip = 3, sep = "") -->
<!-- # colnames(life_table) <- c("Year", "Age", "mx", "qx", "ax", "lx", "dx", "Lx", "Tx", "ex") -->
<!-- #  -->
<!-- # # Subset the life table for the year 2021 -->
<!-- # life_table_2021 <- subset(life_table, Year == 2021) -->
<!-- #  -->
<!-- # # Ensure Age is numeric and remove NAs -->
<!-- # life_table$Age <- as.numeric(life_table$Age) -->
<!-- # life_table_2021$Age <- as.numeric(life_table_2021$Age) -->
<!-- #  -->
<!-- # # Remove rows with NA ages -->
<!-- # life_table <- life_table[!is.na(life_table$Age), ] -->
<!-- # life_table_2021 <- life_table_2021[!is.na(life_table_2021$Age), ] -->
<!-- #  -->
<!-- # # Print summary of ages to diagnose potential issues -->
<!-- # cat("Summary of Ages in life_table:\n") -->
<!-- # print(summary(life_table$Age)) -->
<!-- #  -->
<!-- # cat("Summary of Ages in life_table_2021:\n") -->
<!-- # print(summary(life_table_2021$Age)) -->
<!-- #  -->
<!-- # # Filter the historical life table to only include data for 2021 ages -->
<!-- # common_ages <- intersect(life_table$Age, life_table_2021$Age) -->
<!-- # life_table_filtered <- life_table[life_table$Age %in% common_ages & life_table$Year != 2021, ] -->
<!-- # life_table_2021_filtered <- life_table_2021[life_table_2021$Age %in% common_ages, ] -->
<!-- #  -->
<!-- # # Sort by Age to ensure alignment -->
<!-- # life_table_filtered <- life_table_filtered[order(life_table_filtered$Age), ] -->
<!-- # life_table_2021_filtered <- life_table_2021_filtered[order(life_table_2021_filtered$Age), ] -->
<!-- #  -->
<!-- # # Extract qx values for the common ages -->
<!-- # expected_qx <- life_table_filtered$qx -->
<!-- # observed_qx <- life_table_2021_filtered$qx -->
<!-- #  -->
<!-- # # Print lengths and summaries for diagnostic purposes -->
<!-- # cat("Length of observed_qx:", length(observed_qx), "\n") -->
<!-- # cat("Length of expected_qx:", length(expected_qx), "\n") -->
<!-- #  -->
<!-- # cat("First few values of observed_qx:\n") -->
<!-- # print(head(observed_qx)) -->
<!-- #  -->
<!-- # cat("First few values of expected_qx:\n") -->
<!-- # print(head(expected_qx)) -->
<!-- #  -->
<!-- # # Ensure they have the same length -->
<!-- # if (length(observed_qx) != length(expected_qx)) { -->
<!-- #   stop("Lengths of observed_qx and expected_qx do not match after alignment!") -->
<!-- # } -->
<!-- #  -->
<!-- # # Define the Bühlmann and Bühlmann-Straub models -->
<!-- # buhlmann <- function(x) { -->
<!-- #   n <- length(x) -->
<!-- #   m <- mean(x) -->
<!-- #   v <- var(x) -->
<!-- #   z <- n / (n + v / var(m)) -->
<!-- #   return(z * x + (1 - z) * m) -->
<!-- # } -->
<!-- #  -->
<!-- # buhlmann_straub <- function(x, w) { -->
<!-- #   n <- length(x) -->
<!-- #   m <- weighted.mean(x, w) -->
<!-- #   v <- sum(w * (x - m)^2) / sum(w) -->
<!-- #   z <- sum(w) / (sum(w) + v / var(m)) -->
<!-- #   return(z * x + (1 - z) * m) -->
<!-- # } -->
<!-- #  -->
<!-- # # Apply Bühlmann Model -->
<!-- # adjusted_qx_buhlmann <- buhlmann(observed_qx) -->
<!-- #  -->
<!-- # # Apply Bühlmann-Straub Model -->
<!-- # weights <- rep(1, length(observed_qx)) # Assuming equal weights for simplicity -->
<!-- # adjusted_qx_buhlmann_straub <- buhlmann_straub(observed_qx, weights) -->
<!-- #  -->
<!-- # # Plot adjusted mortality rates -->
<!-- # plot(life_table_2021_filtered$Age, observed_qx, type = "l", col = "blue", xlab = "Age", ylab = "Mortality Rate", main = "Adjusted Mortality Rates using Credibility Theory") -->
<!-- # lines(life_table_2021_filtered$Age, adjusted_qx_buhlmann, col = "green") -->
<!-- # lines(life_table_2021_filtered$Age, adjusted_qx_buhlmann_straub, col = "red") -->
<!-- # legend("topright", legend = c("Observed", "Bühlmann", "Bühlmann-Straub"), col = c("blue", "green", "red"), lty = 1) -->
<!-- #  -->
<!-- #  -->
<!-- #  -->
<!-- #  -->
<!-- #  -->
<!-- # ``` -->
<div
id="section-incorporating-adjusted-mortality-rates-into-life-insurance-calculations-1"
class="section level3">
<h3>Incorporating Adjusted Mortality Rates into Life Insurance
Calculations</h3>
<!-- # ```{r} -->
<!-- # # Function to compute the EPV of a whole life insurance with adjusted mortality rates -->
<!-- # whole_life_insurance_adjusted <- function(age, i, adjusted_qx) { -->
<!-- #   px <- 1 - adjusted_qx -->
<!-- #   kpx <- c(1, cumprod(px[(age + 1):(length(px) - 1)])) -->
<!-- #   kqx <- kpx * adjusted_qx[(age + 1):length(adjusted_qx)] -->
<!-- #   discount_factors <- (1 + i) ^ - (1:length(kqx)) -->
<!-- #   sum(discount_factors * kqx, na.rm = TRUE) -->
<!-- # } -->
<!-- # -->
<!-- # # EPV of whole life insurance for a 20-year-old at 2% interest rate using adjusted mortality rates -->
<!-- # epv_adjusted_buhlmann <- whole_life_insurance_adjusted(20, 0.02, adjusted_qx_buhlmann) -->
<!-- # cat("EPV of whole life insurance with Bühlmann adjusted mortality rates =", epv_adjusted_buhlmann) -->
<!-- # -->
<!-- # epv_adjusted_buhlmann_straub <- whole_life_insurance_adjusted(20, 0.02, adjusted_qx_buhlmann_straub) -->
<!-- # cat("EPV of whole life insurance with Bühlmann-Straub adjusted mortality rates =", epv_adjusted_buhlmann_straub) -->
<!-- # -->
<!-- # ``` -->
</div>
<div
id="section-shiny-app-for-life-insurance-calculator-with-adjusted-mortality-rates-1"
class="section level3">
<h3>Shiny App for Life Insurance Calculator with Adjusted Mortality
Rates</h3>
<div class="sourceCode" id="section-cb280"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb280-1"><a href="#section-cb280-1" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="section-cb280-2"><a href="#section-cb280-2" tabindex="-1"></a></span>
<span id="section-cb280-3"><a href="#section-cb280-3" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="section-cb280-4"><a href="#section-cb280-4" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Life Insurance Calculator with Adjusted Mortality Rates&quot;</span>),</span>
<span id="section-cb280-5"><a href="#section-cb280-5" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="section-cb280-6"><a href="#section-cb280-6" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="section-cb280-7"><a href="#section-cb280-7" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;Age:&quot;</span>, <span class="dv">20</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">110</span>),</span>
<span id="section-cb280-8"><a href="#section-cb280-8" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;interest&quot;</span>, <span class="st">&quot;Interest Rate:&quot;</span>, <span class="fl">0.02</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="fl">0.2</span>, <span class="at">step =</span> <span class="fl">0.001</span>),</span>
<span id="section-cb280-9"><a href="#section-cb280-9" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;credibility&quot;</span>, <span class="st">&quot;Credibility Factor:&quot;</span>, <span class="fl">0.8</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>, <span class="at">step =</span> <span class="fl">0.1</span>),</span>
<span id="section-cb280-10"><a href="#section-cb280-10" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="st">&quot;type&quot;</span>, <span class="st">&quot;Insurance Type:&quot;</span>, </span>
<span id="section-cb280-11"><a href="#section-cb280-11" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">&quot;Whole Life&quot;</span> <span class="ot">=</span> <span class="st">&quot;whole&quot;</span>, </span>
<span id="section-cb280-12"><a href="#section-cb280-12" tabindex="-1"></a>                              <span class="st">&quot;Temporary&quot;</span> <span class="ot">=</span> <span class="st">&quot;temp&quot;</span>, </span>
<span id="section-cb280-13"><a href="#section-cb280-13" tabindex="-1"></a>                              <span class="st">&quot;Deferred&quot;</span> <span class="ot">=</span> <span class="st">&quot;deferred&quot;</span>)),</span>
<span id="section-cb280-14"><a href="#section-cb280-14" tabindex="-1"></a>      <span class="fu">conditionalPanel</span>(</span>
<span id="section-cb280-15"><a href="#section-cb280-15" tabindex="-1"></a>        <span class="at">condition =</span> <span class="st">&quot;input.type == &#39;temp&#39; || input.type == &#39;deferred&#39;&quot;</span>,</span>
<span id="section-cb280-16"><a href="#section-cb280-16" tabindex="-1"></a>        <span class="fu">numericInput</span>(<span class="st">&quot;term&quot;</span>, <span class="st">&quot;Term/Deferment (years):&quot;</span>, <span class="dv">10</span>, <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">50</span>)</span>
<span id="section-cb280-17"><a href="#section-cb280-17" tabindex="-1"></a>      )</span>
<span id="section-cb280-18"><a href="#section-cb280-18" tabindex="-1"></a>    ),</span>
<span id="section-cb280-19"><a href="#section-cb280-19" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="section-cb280-20"><a href="#section-cb280-20" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">&quot;Expected Present Value:&quot;</span>),</span>
<span id="section-cb280-21"><a href="#section-cb280-21" tabindex="-1"></a>      <span class="fu">textOutput</span>(<span class="st">&quot;epv&quot;</span>)</span>
<span id="section-cb280-22"><a href="#section-cb280-22" tabindex="-1"></a>    )</span>
<span id="section-cb280-23"><a href="#section-cb280-23" tabindex="-1"></a>  )</span>
<span id="section-cb280-24"><a href="#section-cb280-24" tabindex="-1"></a>)</span>
<span id="section-cb280-25"><a href="#section-cb280-25" tabindex="-1"></a></span>
<span id="section-cb280-26"><a href="#section-cb280-26" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="section-cb280-27"><a href="#section-cb280-27" tabindex="-1"></a>  output<span class="sc">$</span>epv <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="section-cb280-28"><a href="#section-cb280-28" tabindex="-1"></a>    observed_qx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>qx</span>
<span id="section-cb280-29"><a href="#section-cb280-29" tabindex="-1"></a>    expected_qx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>qx</span>
<span id="section-cb280-30"><a href="#section-cb280-30" tabindex="-1"></a>    adjusted_qx <span class="ot">&lt;-</span> <span class="fu">simple_credibility</span>(observed_qx, expected_qx, input<span class="sc">$</span>credibility)</span>
<span id="section-cb280-31"><a href="#section-cb280-31" tabindex="-1"></a>    epv <span class="ot">&lt;-</span> <span class="cf">switch</span>(input<span class="sc">$</span>type,</span>
<span id="section-cb280-32"><a href="#section-cb280-32" tabindex="-1"></a>                  <span class="st">&quot;whole&quot;</span> <span class="ot">=</span> <span class="fu">whole_life_insurance_adjusted</span>(input<span class="sc">$</span>age, input<span class="sc">$</span>interest, adjusted_qx),</span>
<span id="section-cb280-33"><a href="#section-cb280-33" tabindex="-1"></a>                  <span class="st">&quot;temp&quot;</span> <span class="ot">=</span> <span class="fu">temporary_life_insurance</span>(input<span class="sc">$</span>age, input<span class="sc">$</span>term, input<span class="sc">$</span>interest, life_table),</span>
<span id="section-cb280-34"><a href="#section-cb280-34" tabindex="-1"></a>                  <span class="st">&quot;deferred&quot;</span> <span class="ot">=</span> <span class="fu">deferred_life_insurance</span>(input<span class="sc">$</span>age, input<span class="sc">$</span>term, input<span class="sc">$</span>interest, life_table))</span>
<span id="section-cb280-35"><a href="#section-cb280-35" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;$&quot;</span>, <span class="fu">round</span>(epv, <span class="dv">2</span>))</span>
<span id="section-cb280-36"><a href="#section-cb280-36" tabindex="-1"></a>  })</span>
<span id="section-cb280-37"><a href="#section-cb280-37" tabindex="-1"></a>}</span>
<span id="section-cb280-38"><a href="#section-cb280-38" tabindex="-1"></a></span>
<span id="section-cb280-39"><a href="#section-cb280-39" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<iframe data-deferred-src="appa57075d6aefcd25a9d12a0ddf6a75d7d/?w=&amp;__subapp__=1" width="100%" height="400" class="shiny-frame shiny-frame-deferred"></iframe>
</div>
</div>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#section-TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
