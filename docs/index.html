<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Leo Cam" />

<meta name="date" content="2023-01-22" />

<title>Life Insurance Analysis</title>

<script src="index_files/header-attrs-2.25/header-attrs.js"></script>
<script src="index_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="index_files/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="index_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="index_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="index_files/navigation-1.1/tabsets.js"></script>
<script src="index_files/navigation-1.1/codefolding.js"></script>
<link href="index_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="index_files/pagedtable-1.1/js/pagedtable.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#section-TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#section-TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="section-TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="section-header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Life Insurance Analysis</h1>
<h4 class="author">Leo Cam</h4>
<h4 class="date">2023-01-22</h4>

</div>


<hr />
<div id="section-introduction" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<hr />
<p>This document is divided into four parts, each focusing on different
aspects of financial and actuarial analysis related to life
insurance:</p>
<p><strong>Cash Flows</strong>: Calculate Present Value (PV), Net
Present Value (NPV), and Accumulated Value (AV) based on cash
transactions.</p>
<p><strong>Life Tables</strong>: Import and analyze survival
probabilities from a mortality dataset.</p>
<p><strong>Life Annuities</strong>: Calculate PV and Expected Present
Value (EPV) of different annuities.</p>
<p><strong>Life Insurance</strong>: Analyze premiums and EPV of various
life insurance products.</p>
<hr />
</div>
<div id="section-cash-flows" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Cash Flows</h1>
<hr />
<div id="section-present-value" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Present Value</h2>
<p>Suppose you want to go on a trip 5 years from now. You have expenses
of 3000 each year for 4 years (including this year), followed by an
expense of 4000 and a final expense of 5000. How much would you have to
deposit at this moment in time to cover all of these future payments?
Assume a constant interest rate of 2.14% and payments would take place
at the beginning of the year.</p>
<div class="sourceCode" id="section-cb1"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb1-1"><a href="#section-cb1-1" tabindex="-1"></a><span class="co"># We have an expense of 3000 from t=0 to t=3, an expense of 4000 at t=4 and 5000 at t=5</span></span>
<span id="section-cb1-2"><a href="#section-cb1-2" tabindex="-1"></a></span>
<span id="section-cb1-3"><a href="#section-cb1-3" tabindex="-1"></a><span class="co"># Cash flows</span></span>
<span id="section-cb1-4"><a href="#section-cb1-4" tabindex="-1"></a>cash_flows <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">3000</span>,<span class="dv">4</span>), <span class="dv">4000</span>, <span class="dv">5000</span>)</span>
<span id="section-cb1-5"><a href="#section-cb1-5" tabindex="-1"></a>                </span>
<span id="section-cb1-6"><a href="#section-cb1-6" tabindex="-1"></a><span class="co"># Interest Rate</span></span>
<span id="section-cb1-7"><a href="#section-cb1-7" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fl">0.0214</span></span>
<span id="section-cb1-8"><a href="#section-cb1-8" tabindex="-1"></a></span>
<span id="section-cb1-9"><a href="#section-cb1-9" tabindex="-1"></a><span class="co"># Discount factor</span></span>
<span id="section-cb1-10"><a href="#section-cb1-10" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span><span class="sc">+</span>i)</span>
<span id="section-cb1-11"><a href="#section-cb1-11" tabindex="-1"></a></span>
<span id="section-cb1-12"><a href="#section-cb1-12" tabindex="-1"></a><span class="co"># Discount factors</span></span>
<span id="section-cb1-13"><a href="#section-cb1-13" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> v <span class="sc">^</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="section-cb1-14"><a href="#section-cb1-14" tabindex="-1"></a></span>
<span id="section-cb1-15"><a href="#section-cb1-15" tabindex="-1"></a><span class="co"># Present value</span></span>
<span id="section-cb1-16"><a href="#section-cb1-16" tabindex="-1"></a>present_val <span class="ot">&lt;-</span> <span class="fu">sum</span>(cash_flows <span class="sc">*</span> discount_factors)</span>
<span id="section-cb1-17"><a href="#section-cb1-17" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Present Value (PV):&quot;</span>, present_val)</span></code></pre></div>
<pre><code>## Present Value (PV): 19800.98</code></pre>
<p>So you would have to make a deposit of 19800.98 at this current time
to cover all of these future payments.</p>
<hr />
</div>
<div id="section-net-present-value-npv" class="section level2"
number="2.2">
<h2><span class="header-section-number">2.2</span> Net Present Value
(NPV)</h2>
<p>You’re the head of a lawn mowing company. You want to invest in a new
lawn mower than you are confident will generate cash flows of 50 each
month for 3 months, followed by 20 for 2 months. The issue is it costs
185 and you’re unsure if it will be a profitable investment. To find out
if it is a good investment or not, you must calculate the NPV for this
investment. Assume the monthly interest rate is 0.6%.</p>
<div class="sourceCode" id="section-cb3"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb3-1"><a href="#section-cb3-1" tabindex="-1"></a><span class="co"># Define the cash flows</span></span>
<span id="section-cb3-2"><a href="#section-cb3-2" tabindex="-1"></a><span class="co"># We have a negative cash flow at t=0 of 500, and 5 positive cash flows of 50 from t=1 to t=5</span></span>
<span id="section-cb3-3"><a href="#section-cb3-3" tabindex="-1"></a></span>
<span id="section-cb3-4"><a href="#section-cb3-4" tabindex="-1"></a>cash_flows <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">rep</span>(<span class="dv">50</span>,<span class="dv">3</span>), <span class="fu">rep</span>(<span class="dv">30</span>,<span class="dv">2</span>))</span>
<span id="section-cb3-5"><a href="#section-cb3-5" tabindex="-1"></a></span>
<span id="section-cb3-6"><a href="#section-cb3-6" tabindex="-1"></a><span class="co"># Discount factors</span></span>
<span id="section-cb3-7"><a href="#section-cb3-7" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="fl">+0.006</span>) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="section-cb3-8"><a href="#section-cb3-8" tabindex="-1"></a></span>
<span id="section-cb3-9"><a href="#section-cb3-9" tabindex="-1"></a><span class="co"># NPV</span></span>
<span id="section-cb3-10"><a href="#section-cb3-10" tabindex="-1"></a>npv <span class="ot">&lt;-</span> <span class="fu">sum</span>(cash_flows <span class="sc">*</span> discount_factors) <span class="sc">-</span> <span class="dv">185</span></span>
<span id="section-cb3-11"><a href="#section-cb3-11" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Net Present value (NPV) = &quot;</span>, npv)</span></code></pre></div>
<pre><code>## Net Present value (NPV) =  21.62449</code></pre>
<p>Since our NPV is positive, this indicates that this would be an
overall gain ie profit.</p>
<hr />
</div>
<div id="section-accumulated-value" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Accumulated
Value</h2>
<p>Suppose instead of making those expenses, you chose to put them into
a savings account. What would be your new present value, assuming same
interest rate. What would be your new accumulated value?</p>
<div class="sourceCode" id="section-cb5"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb5-1"><a href="#section-cb5-1" tabindex="-1"></a><span class="co"># Cash flows</span></span>
<span id="section-cb5-2"><a href="#section-cb5-2" tabindex="-1"></a>cash_flows <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">3000</span>,<span class="dv">4</span>), <span class="dv">4000</span>, <span class="dv">5000</span>)</span>
<span id="section-cb5-3"><a href="#section-cb5-3" tabindex="-1"></a></span>
<span id="section-cb5-4"><a href="#section-cb5-4" tabindex="-1"></a><span class="co"># Define the discount function </span></span>
<span id="section-cb5-5"><a href="#section-cb5-5" tabindex="-1"></a>discount <span class="ot">&lt;-</span> <span class="cf">function</span>(s, t, <span class="at">i =</span> <span class="fl">0.0214</span>) {</span>
<span id="section-cb5-6"><a href="#section-cb5-6" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (t <span class="sc">-</span> s)</span>
<span id="section-cb5-7"><a href="#section-cb5-7" tabindex="-1"></a>}</span>
<span id="section-cb5-8"><a href="#section-cb5-8" tabindex="-1"></a></span>
<span id="section-cb5-9"><a href="#section-cb5-9" tabindex="-1"></a><span class="co"># Calculate the pv</span></span>
<span id="section-cb5-10"><a href="#section-cb5-10" tabindex="-1"></a>pv <span class="ot">&lt;-</span> <span class="fu">sum</span>(cash_flows <span class="sc">*</span> <span class="fu">discount</span>(<span class="dv">0</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>))</span>
<span id="section-cb5-11"><a href="#section-cb5-11" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Present Value =&quot;</span>, pv)</span></code></pre></div>
<pre><code>## Present Value = 19800.98</code></pre>
<div class="sourceCode" id="section-cb7"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb7-1"><a href="#section-cb7-1" tabindex="-1"></a><span class="co"># Calculate the value at time 6</span></span>
<span id="section-cb7-2"><a href="#section-cb7-2" tabindex="-1"></a>av <span class="ot">&lt;-</span> <span class="fu">sum</span>(cash_flows <span class="sc">*</span> <span class="fu">discount</span>(<span class="dv">6</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>))</span>
<span id="section-cb7-3"><a href="#section-cb7-3" tabindex="-1"></a></span>
<span id="section-cb7-4"><a href="#section-cb7-4" tabindex="-1"></a><span class="co"># Calculate the value at time 6, starting from present_value</span></span>
<span id="section-cb7-5"><a href="#section-cb7-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Value at time 6 from Present value =&quot;</span>, pv <span class="sc">*</span> <span class="fu">discount</span>(<span class="dv">6</span>, <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## Value at time 6 from Present value = 22483.39</code></pre>
<div class="sourceCode" id="section-cb9"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb9-1"><a href="#section-cb9-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Difference between Accumulated Value and Present Value =&quot;</span>, av <span class="sc">-</span> pv)</span></code></pre></div>
<pre><code>## Difference between Accumulated Value and Present Value = 2682.41</code></pre>
<p>As you can see, there would be a difference of $2682.41 if you saved
the money instead of spending it.</p>
<hr />
</div>
<div id="section-yearly-payments" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Yearly Payments</h2>
<p>Your parents want to start saving money for your university costs.
Each year of study will set you guys back by about 7500. You’re
currently 14 (t=0) and will start attending when you are 19 (t=5).
Therefore, your parents will make 1 deposit each year for 4 years (t=1
to t=4). Assume you will attend for 4 years (t=5 to t=22), the constant
annual interest rate is 3.14% and each deposit your parents make is
equal. Find the amount of the deposit</p>
<div class="sourceCode" id="section-cb11"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb11-1"><a href="#section-cb11-1" tabindex="-1"></a><span class="co"># discount factors</span></span>
<span id="section-cb11-2"><a href="#section-cb11-2" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.0314</span>) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="section-cb11-3"><a href="#section-cb11-3" tabindex="-1"></a></span>
<span id="section-cb11-4"><a href="#section-cb11-4" tabindex="-1"></a><span class="co"># deposit pattern</span></span>
<span id="section-cb11-5"><a href="#section-cb11-5" tabindex="-1"></a>deposits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">4</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>))</span>
<span id="section-cb11-6"><a href="#section-cb11-6" tabindex="-1"></a></span>
<span id="section-cb11-7"><a href="#section-cb11-7" tabindex="-1"></a><span class="co"># university expenses</span></span>
<span id="section-cb11-8"><a href="#section-cb11-8" tabindex="-1"></a>payments <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="dv">7500</span>, <span class="dv">4</span>))</span>
<span id="section-cb11-9"><a href="#section-cb11-9" tabindex="-1"></a></span>
<span id="section-cb11-10"><a href="#section-cb11-10" tabindex="-1"></a><span class="co"># Calculate the present value of the deposits</span></span>
<span id="section-cb11-11"><a href="#section-cb11-11" tabindex="-1"></a>PV_deposit <span class="ot">&lt;-</span> <span class="fu">sum</span>(deposits <span class="sc">*</span> discount_factors)</span>
<span id="section-cb11-12"><a href="#section-cb11-12" tabindex="-1"></a></span>
<span id="section-cb11-13"><a href="#section-cb11-13" tabindex="-1"></a><span class="co"># Calculate the present value of the payments</span></span>
<span id="section-cb11-14"><a href="#section-cb11-14" tabindex="-1"></a>PV_payment <span class="ot">&lt;-</span> <span class="fu">sum</span>(payments <span class="sc">*</span> discount_factors)</span>
<span id="section-cb11-15"><a href="#section-cb11-15" tabindex="-1"></a></span>
<span id="section-cb11-16"><a href="#section-cb11-16" tabindex="-1"></a><span class="co"># Calculate the yearly deposit K in the first 4 years</span></span>
<span id="section-cb11-17"><a href="#section-cb11-17" tabindex="-1"></a>yearly_deposit <span class="ot">&lt;-</span>  PV_payment <span class="sc">/</span> PV_deposit </span>
<span id="section-cb11-18"><a href="#section-cb11-18" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Yearly deposits&quot;</span>, yearly_deposit)</span></code></pre></div>
<pre><code>## Yearly deposits 6627.546</code></pre>
<p>So your parents would have to make a deposit of 6627.546 for each of
the 4 years to finance your university.</p>
<hr />
</div>
<div id="section-varying-interest-rates" class="section level2"
number="2.5">
<h2><span class="header-section-number">2.5</span> Varying Interest
Rates</h2>
<p>You want to take out a loan to open a new restaurant. You plan to
take 1000 this year and 3000 next year. You plan to repay the money with
equal yearly payments for the 10 years after next year (t=2 to t=11).
Note this time the interest rate isn’t constant but changes over time.
For the first 3 years it is 4%, then for the next 3 years it is 4.5%,
then for the final 5 years it is 6%. How much will your yearly payments
be?</p>
<div class="sourceCode" id="section-cb13"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb13-1"><a href="#section-cb13-1" tabindex="-1"></a><span class="co"># Interest rates</span></span>
<span id="section-cb13-2"><a href="#section-cb13-2" tabindex="-1"></a>interest <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fl">0.04</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="fl">0.045</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="fl">0.06</span>, <span class="dv">5</span>))</span>
<span id="section-cb13-3"><a href="#section-cb13-3" tabindex="-1"></a></span>
<span id="section-cb13-4"><a href="#section-cb13-4" tabindex="-1"></a><span class="co"># Yearly discount factors</span></span>
<span id="section-cb13-5"><a href="#section-cb13-5" tabindex="-1"></a>yearly_discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> interest) <span class="sc">^</span> (<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="section-cb13-6"><a href="#section-cb13-6" tabindex="-1"></a></span>
<span id="section-cb13-7"><a href="#section-cb13-7" tabindex="-1"></a><span class="co"># Discount factors</span></span>
<span id="section-cb13-8"><a href="#section-cb13-8" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="fu">c</span>(<span class="dv">1</span>, yearly_discount_factors))</span>
<span id="section-cb13-9"><a href="#section-cb13-9" tabindex="-1"></a></span>
<span id="section-cb13-10"><a href="#section-cb13-10" tabindex="-1"></a><span class="co"># Cash flows for the first two years</span></span>
<span id="section-cb13-11"><a href="#section-cb13-11" tabindex="-1"></a>cash_flow <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">3000</span>)</span>
<span id="section-cb13-12"><a href="#section-cb13-12" tabindex="-1"></a></span>
<span id="section-cb13-13"><a href="#section-cb13-13" tabindex="-1"></a><span class="co"># Calculate the present value (PV) of the loan</span></span>
<span id="section-cb13-14"><a href="#section-cb13-14" tabindex="-1"></a>PV_loan <span class="ot">&lt;-</span> <span class="fu">sum</span>(cash_flow <span class="sc">*</span> discount_factors[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="section-cb13-15"><a href="#section-cb13-15" tabindex="-1"></a></span>
<span id="section-cb13-16"><a href="#section-cb13-16" tabindex="-1"></a><span class="co"># Calculate the present value (PV) of the repayments</span></span>
<span id="section-cb13-17"><a href="#section-cb13-17" tabindex="-1"></a>repayment_years <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">11</span></span>
<span id="section-cb13-18"><a href="#section-cb13-18" tabindex="-1"></a>discount_factors_repayments <span class="ot">&lt;-</span> discount_factors[repayment_years <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb13-19"><a href="#section-cb13-19" tabindex="-1"></a>n_payments <span class="ot">&lt;-</span> <span class="fu">length</span>(discount_factors_repayments)</span>
<span id="section-cb13-20"><a href="#section-cb13-20" tabindex="-1"></a></span>
<span id="section-cb13-21"><a href="#section-cb13-21" tabindex="-1"></a><span class="co"># yearly payment variable</span></span>
<span id="section-cb13-22"><a href="#section-cb13-22" tabindex="-1"></a>yearly_payment <span class="ot">&lt;-</span> PV_loan <span class="sc">/</span> <span class="fu">sum</span>(discount_factors_repayments)</span>
<span id="section-cb13-23"><a href="#section-cb13-23" tabindex="-1"></a></span>
<span id="section-cb13-24"><a href="#section-cb13-24" tabindex="-1"></a><span class="co"># full cash flow vector with the repayments</span></span>
<span id="section-cb13-25"><a href="#section-cb13-25" tabindex="-1"></a>cash_flow_full <span class="ot">&lt;-</span> <span class="fu">c</span>(cash_flow, <span class="fu">rep</span>(<span class="sc">-</span>yearly_payment, n_payments))</span>
<span id="section-cb13-26"><a href="#section-cb13-26" tabindex="-1"></a></span>
<span id="section-cb13-27"><a href="#section-cb13-27" tabindex="-1"></a><span class="co"># Calculate the PV of the repayments to check the balance</span></span>
<span id="section-cb13-28"><a href="#section-cb13-28" tabindex="-1"></a>PV_repayments <span class="ot">&lt;-</span> <span class="fu">sum</span>(cash_flow_full <span class="sc">*</span> discount_factors)</span>
<span id="section-cb13-29"><a href="#section-cb13-29" tabindex="-1"></a></span>
<span id="section-cb13-30"><a href="#section-cb13-30" tabindex="-1"></a><span class="co"># Display the yearly payment and the PV balance check</span></span>
<span id="section-cb13-31"><a href="#section-cb13-31" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Yearly Payments&quot;</span>, yearly_payment)</span></code></pre></div>
<pre><code>## Yearly Payments 515.2757</code></pre>
<div class="sourceCode" id="section-cb15"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb15-1"><a href="#section-cb15-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Present value of the repayments&quot;</span>, PV_repayments)</span></code></pre></div>
<pre><code>## Present value of the repayments -1.705303e-13</code></pre>
<p>Our PV is ~0, meaning the PV of the future payments and PV of your
loans are equal, hence the yearly payments would be 515.2757</p>
<hr />
</div>
<div id="section-yearly-to-monthly-interest-rate" class="section level2"
number="2.6">
<h2><span class="header-section-number">2.6</span> Yearly to Monthly
Interest Rate</h2>
<p>You plan to take out a 100,000 loan with a yearly interest rate of
2.88%. You want to pay back this loan with fixed monthly payments over
the next 15 years. Find how much these monthly payments will be.</p>
<div class="sourceCode" id="section-cb17"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb17-1"><a href="#section-cb17-1" tabindex="-1"></a><span class="co">#number of payments</span></span>
<span id="section-cb17-2"><a href="#section-cb17-2" tabindex="-1"></a>number_payments <span class="ot">&lt;-</span> <span class="dv">12</span><span class="sc">*</span><span class="dv">15</span></span>
<span id="section-cb17-3"><a href="#section-cb17-3" tabindex="-1"></a></span>
<span id="section-cb17-4"><a href="#section-cb17-4" tabindex="-1"></a><span class="co">#yearly interest rate</span></span>
<span id="section-cb17-5"><a href="#section-cb17-5" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fl">0.0288</span></span>
<span id="section-cb17-6"><a href="#section-cb17-6" tabindex="-1"></a></span>
<span id="section-cb17-7"><a href="#section-cb17-7" tabindex="-1"></a><span class="co">#monthly interest rate</span></span>
<span id="section-cb17-8"><a href="#section-cb17-8" tabindex="-1"></a></span>
<span id="section-cb17-9"><a href="#section-cb17-9" tabindex="-1"></a>monthly_interest <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">+</span>i)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>)<span class="sc">-</span><span class="dv">1</span></span>
<span id="section-cb17-10"><a href="#section-cb17-10" tabindex="-1"></a></span>
<span id="section-cb17-11"><a href="#section-cb17-11" tabindex="-1"></a><span class="co"># Define the discount factors</span></span>
<span id="section-cb17-12"><a href="#section-cb17-12" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> monthly_interest) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">1</span><span class="sc">:</span>number_payments)</span>
<span id="section-cb17-13"><a href="#section-cb17-13" tabindex="-1"></a></span>
<span id="section-cb17-14"><a href="#section-cb17-14" tabindex="-1"></a><span class="co"># Define the payment pattern</span></span>
<span id="section-cb17-15"><a href="#section-cb17-15" tabindex="-1"></a>payments <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, number_payments)</span>
<span id="section-cb17-16"><a href="#section-cb17-16" tabindex="-1"></a></span>
<span id="section-cb17-17"><a href="#section-cb17-17" tabindex="-1"></a><span class="co"># Calculate the monthly loan payment K</span></span>
<span id="section-cb17-18"><a href="#section-cb17-18" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">100000</span> <span class="sc">/</span> <span class="fu">sum</span>(payments <span class="sc">*</span> discount_factors)</span>
<span id="section-cb17-19"><a href="#section-cb17-19" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Monthly payments = &quot;</span>, K)</span></code></pre></div>
<pre><code>## Monthly payments =  683.0401</code></pre>
<p>These monthly payments will be 683.0401</p>
<hr />
</div>
</div>
<div id="section-life-tables" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Life Tables</h1>
<div
id="section-import-the-life-tables-from-mortality.org.-we-are-going-to-import-the-dataset-of-canada-from-1921---2021."
class="section level4" number="3.0.0.1">
<h4><span class="header-section-number">3.0.0.1</span> Import the life
tables from mortality.org. We are going to import the dataset of Canada
from 1921 - 2021.</h4>
<div class="sourceCode" id="section-cb19"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb19-1"><a href="#section-cb19-1" tabindex="-1"></a>life_table <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">megacrazyleo</span><span class="sc">\\</span><span class="st">Desktop</span><span class="sc">\\</span><span class="st">SQL</span><span class="sc">\\</span><span class="st">R</span><span class="sc">\\</span><span class="st">bltper_1x1.txt&quot;</span>, <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">skip =</span> <span class="dv">3</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>) </span>
<span id="section-cb19-2"><a href="#section-cb19-2" tabindex="-1"></a><span class="fu">colnames</span>(life_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Age&quot;</span>, <span class="st">&quot;mx&quot;</span>, <span class="st">&quot;qx&quot;</span>, <span class="st">&quot;ax&quot;</span>, <span class="st">&quot;lx&quot;</span>, <span class="st">&quot;dx&quot;</span>, <span class="st">&quot;Lx&quot;</span>, <span class="st">&quot;Tx&quot;</span>, <span class="st">&quot;ex&quot;</span>)</span></code></pre></div>
</div>
<div id="section-setting-up-variables" class="section level4"
number="3.0.0.2">
<h4><span class="header-section-number">3.0.0.2</span> Setting up
variables</h4>
<div class="sourceCode" id="section-cb20"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb20-1"><a href="#section-cb20-1" tabindex="-1"></a>year <span class="ot">&lt;-</span> life_table<span class="sc">$</span>Year</span>
<span id="section-cb20-2"><a href="#section-cb20-2" tabindex="-1"></a>age <span class="ot">&lt;-</span> life_table<span class="sc">$</span>Age</span>
<span id="section-cb20-3"><a href="#section-cb20-3" tabindex="-1"></a>qx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>qx</span>
<span id="section-cb20-4"><a href="#section-cb20-4" tabindex="-1"></a>mx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>mx</span>
<span id="section-cb20-5"><a href="#section-cb20-5" tabindex="-1"></a>ax <span class="ot">&lt;-</span> life_table<span class="sc">$</span>ax</span>
<span id="section-cb20-6"><a href="#section-cb20-6" tabindex="-1"></a>lx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>lx</span>
<span id="section-cb20-7"><a href="#section-cb20-7" tabindex="-1"></a>dx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>dx</span>
<span id="section-cb20-8"><a href="#section-cb20-8" tabindex="-1"></a>Lx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>Lx</span>
<span id="section-cb20-9"><a href="#section-cb20-9" tabindex="-1"></a>Tx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>Tx</span>
<span id="section-cb20-10"><a href="#section-cb20-10" tabindex="-1"></a>ex <span class="ot">&lt;-</span> life_table<span class="sc">$</span>ex</span>
<span id="section-cb20-11"><a href="#section-cb20-11" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> qx</span></code></pre></div>
<table>
<colgroup>
<col width="45%" />
<col width="54%" />
</colgroup>
<thead>
<tr>
<th><strong>Variable</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Year</td>
<td>Year or range of years (for period and cohort data)</td>
</tr>
<tr>
<td>Age</td>
<td>Age group, representing an n-year interval from exact age x to just
before x + n, where n = 1, 4, 5, or infinity</td>
</tr>
<tr>
<td>m(x)</td>
<td>Central death rate between ages x and x + n</td>
</tr>
<tr>
<td>q(x)</td>
<td>Probability of death between ages x and x + n</td>
</tr>
<tr>
<td>a(x)</td>
<td>Average length of survival between ages x and x + n for persons
dying in the interval</td>
</tr>
<tr>
<td>l(x)</td>
<td>Number of survivors at exact age x, assuming l(0) = 100,000</td>
</tr>
<tr>
<td>d(x)</td>
<td>Number of deaths between ages x and x + n</td>
</tr>
<tr>
<td>L(x)</td>
<td>Number of person-years lived between ages x and x + n</td>
</tr>
<tr>
<td>T(x)</td>
<td>Number of person-years remaining after exact age x</td>
</tr>
<tr>
<td>e(x)</td>
<td>Life expectancy at exact age x (in years)</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="section-mortality-rates" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Mortality Rates</h2>
<div class="sourceCode" id="section-cb21"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb21-1"><a href="#section-cb21-1" tabindex="-1"></a><span class="co"># Adjusting plot size and margins</span></span>
<span id="section-cb21-2"><a href="#section-cb21-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">6</span>) <span class="sc">+</span> <span class="fl">0.1</span>, <span class="at">pin =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>))  <span class="co"># Adjusted margins and aspect ratio</span></span>
<span id="section-cb21-3"><a href="#section-cb21-3" tabindex="-1"></a></span>
<span id="section-cb21-4"><a href="#section-cb21-4" tabindex="-1"></a><span class="co"># Function to convert age to numeric</span></span>
<span id="section-cb21-5"><a href="#section-cb21-5" tabindex="-1"></a>convert_age <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="section-cb21-6"><a href="#section-cb21-6" tabindex="-1"></a>  x[x <span class="sc">==</span> <span class="st">&quot;110+&quot;</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span>  <span class="co"># Exclude &quot;110+&quot; from numeric conversion</span></span>
<span id="section-cb21-7"><a href="#section-cb21-7" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>({</span>
<span id="section-cb21-8"><a href="#section-cb21-8" tabindex="-1"></a>    <span class="fu">as.numeric</span>(x)</span>
<span id="section-cb21-9"><a href="#section-cb21-9" tabindex="-1"></a>  })</span>
<span id="section-cb21-10"><a href="#section-cb21-10" tabindex="-1"></a>}</span>
<span id="section-cb21-11"><a href="#section-cb21-11" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">convert_age</span>(age)</span>
<span id="section-cb21-12"><a href="#section-cb21-12" tabindex="-1"></a></span>
<span id="section-cb21-13"><a href="#section-cb21-13" tabindex="-1"></a><span class="co"># Create a color palette</span></span>
<span id="section-cb21-14"><a href="#section-cb21-14" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">unique</span>(year)</span>
<span id="section-cb21-15"><a href="#section-cb21-15" tabindex="-1"></a>color_palette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;red&quot;</span>))(<span class="fu">length</span>(years))</span>
<span id="section-cb21-16"><a href="#section-cb21-16" tabindex="-1"></a></span>
<span id="section-cb21-17"><a href="#section-cb21-17" tabindex="-1"></a><span class="co"># Initialize the plot</span></span>
<span id="section-cb21-18"><a href="#section-cb21-18" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, </span>
<span id="section-cb21-19"><a href="#section-cb21-19" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">range</span>(age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Exclude NAs from range calculation</span></span>
<span id="section-cb21-20"><a href="#section-cb21-20" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.0</span>),   <span class="co"># Set y-axis range from 0 to 1.0</span></span>
<span id="section-cb21-21"><a href="#section-cb21-21" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Mortality rates (Canada, Males &amp; Females, 1921-2021)&quot;</span>,</span>
<span id="section-cb21-22"><a href="#section-cb21-22" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>,</span>
<span id="section-cb21-23"><a href="#section-cb21-23" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Mortality rate &quot;</span>, q[x])),</span>
<span id="section-cb21-24"><a href="#section-cb21-24" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;n&quot;</span>  <span class="co"># Create an empty plot</span></span>
<span id="section-cb21-25"><a href="#section-cb21-25" tabindex="-1"></a>)</span>
<span id="section-cb21-26"><a href="#section-cb21-26" tabindex="-1"></a></span>
<span id="section-cb21-27"><a href="#section-cb21-27" tabindex="-1"></a><span class="co"># Plot each year&#39;s data</span></span>
<span id="section-cb21-28"><a href="#section-cb21-28" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="section-cb21-29"><a href="#section-cb21-29" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(years)) {</span>
<span id="section-cb21-30"><a href="#section-cb21-30" tabindex="-1"></a>    year_data <span class="ot">&lt;-</span> <span class="fu">subset</span>(life_table, Year <span class="sc">==</span> years[i])</span>
<span id="section-cb21-31"><a href="#section-cb21-31" tabindex="-1"></a>    </span>
<span id="section-cb21-32"><a href="#section-cb21-32" tabindex="-1"></a>    <span class="co"># Exclude &quot;110+&quot; age category</span></span>
<span id="section-cb21-33"><a href="#section-cb21-33" tabindex="-1"></a>    year_data <span class="ot">&lt;-</span> year_data[year_data<span class="sc">$</span>Age <span class="sc">!=</span> <span class="st">&quot;110+&quot;</span>, ]</span>
<span id="section-cb21-34"><a href="#section-cb21-34" tabindex="-1"></a>    </span>
<span id="section-cb21-35"><a href="#section-cb21-35" tabindex="-1"></a>    <span class="co"># Convert Age to numeric</span></span>
<span id="section-cb21-36"><a href="#section-cb21-36" tabindex="-1"></a>    year_data<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">convert_age</span>(year_data<span class="sc">$</span>Age)</span>
<span id="section-cb21-37"><a href="#section-cb21-37" tabindex="-1"></a>    </span>
<span id="section-cb21-38"><a href="#section-cb21-38" tabindex="-1"></a>    <span class="co"># Ensure data is sorted by Age for proper line connection</span></span>
<span id="section-cb21-39"><a href="#section-cb21-39" tabindex="-1"></a>    year_data <span class="ot">&lt;-</span> year_data[<span class="fu">order</span>(year_data<span class="sc">$</span>Age), ]</span>
<span id="section-cb21-40"><a href="#section-cb21-40" tabindex="-1"></a>    </span>
<span id="section-cb21-41"><a href="#section-cb21-41" tabindex="-1"></a>    <span class="fu">lines</span>(year_data<span class="sc">$</span>Age, year_data<span class="sc">$</span>qx, <span class="at">col =</span> color_palette[i])</span>
<span id="section-cb21-42"><a href="#section-cb21-42" tabindex="-1"></a>  }</span>
<span id="section-cb21-43"><a href="#section-cb21-43" tabindex="-1"></a>})</span>
<span id="section-cb21-44"><a href="#section-cb21-44" tabindex="-1"></a></span>
<span id="section-cb21-45"><a href="#section-cb21-45" tabindex="-1"></a><span class="co"># Colored legend</span></span>
<span id="section-cb21-46"><a href="#section-cb21-46" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">0</span>),</span>
<span id="section-cb21-47"><a href="#section-cb21-47" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;1921&quot;</span>, <span class="st">&quot;1955&quot;</span>, <span class="st">&quot;1988&quot;</span>, <span class="st">&quot;2021&quot;</span>),</span>
<span id="section-cb21-48"><a href="#section-cb21-48" tabindex="-1"></a>       <span class="at">col =</span> color_palette[<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">which.min</span>(<span class="fu">abs</span>(years <span class="sc">-</span> <span class="dv">1955</span>)), </span>
<span id="section-cb21-49"><a href="#section-cb21-49" tabindex="-1"></a>                             <span class="fu">which.min</span>(<span class="fu">abs</span>(years <span class="sc">-</span> <span class="dv">1988</span>)), <span class="fu">length</span>(years))],</span>
<span id="section-cb21-50"><a href="#section-cb21-50" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>, </span>
<span id="section-cb21-51"><a href="#section-cb21-51" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Year&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-9-1.png" width="672" /></p>
<p>We can see that mortality rates from recent years are much lower
compared to the earliest years.</p>
<hr />
</div>
<div id="section-life-expectancy" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Life Expectancy</h2>
<div class="sourceCode" id="section-cb22"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb22-1"><a href="#section-cb22-1" tabindex="-1"></a><span class="co"># Setting up the plot</span></span>
<span id="section-cb22-2"><a href="#section-cb22-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">6</span>) <span class="sc">+</span> <span class="fl">0.1</span>) <span class="co"># To ensure plot doesn&#39;t cover data</span></span>
<span id="section-cb22-3"><a href="#section-cb22-3" tabindex="-1"></a></span>
<span id="section-cb22-4"><a href="#section-cb22-4" tabindex="-1"></a><span class="co"># Create a color palette</span></span>
<span id="section-cb22-5"><a href="#section-cb22-5" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">unique</span>(year)</span>
<span id="section-cb22-6"><a href="#section-cb22-6" tabindex="-1"></a>color_palette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;red&quot;</span>))(<span class="fu">length</span>(years))</span>
<span id="section-cb22-7"><a href="#section-cb22-7" tabindex="-1"></a></span>
<span id="section-cb22-8"><a href="#section-cb22-8" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>({</span>
<span id="section-cb22-9"><a href="#section-cb22-9" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="cn">NULL</span>, </span>
<span id="section-cb22-10"><a href="#section-cb22-10" tabindex="-1"></a>       <span class="at">xlim =</span> <span class="fu">range</span>(age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Exclude NAs from range calculation</span></span>
<span id="section-cb22-11"><a href="#section-cb22-11" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">range</span>(ex, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),   <span class="co"># Exclude NAs from range calculation</span></span>
<span id="section-cb22-12"><a href="#section-cb22-12" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Life Expectancy (Canada, Males &amp; Females, 1921-2021)&quot;</span>,</span>
<span id="section-cb22-13"><a href="#section-cb22-13" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>,</span>
<span id="section-cb22-14"><a href="#section-cb22-14" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Life Expectancy &quot;</span>, e[x])),</span>
<span id="section-cb22-15"><a href="#section-cb22-15" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">&quot;l&quot;</span></span>
<span id="section-cb22-16"><a href="#section-cb22-16" tabindex="-1"></a>  )</span>
<span id="section-cb22-17"><a href="#section-cb22-17" tabindex="-1"></a>})</span>
<span id="section-cb22-18"><a href="#section-cb22-18" tabindex="-1"></a></span>
<span id="section-cb22-19"><a href="#section-cb22-19" tabindex="-1"></a><span class="co"># Plot each year&#39;s data</span></span>
<span id="section-cb22-20"><a href="#section-cb22-20" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="section-cb22-21"><a href="#section-cb22-21" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(years)) {</span>
<span id="section-cb22-22"><a href="#section-cb22-22" tabindex="-1"></a>    year_data <span class="ot">&lt;-</span> <span class="fu">subset</span>(life_table, Year <span class="sc">==</span> years[i])</span>
<span id="section-cb22-23"><a href="#section-cb22-23" tabindex="-1"></a>    <span class="fu">lines</span>(year_data<span class="sc">$</span>Age, year_data<span class="sc">$</span>ex, <span class="at">col =</span> color_palette[i], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span>
<span id="section-cb22-24"><a href="#section-cb22-24" tabindex="-1"></a>  }</span>
<span id="section-cb22-25"><a href="#section-cb22-25" tabindex="-1"></a>})</span>
<span id="section-cb22-26"><a href="#section-cb22-26" tabindex="-1"></a></span>
<span id="section-cb22-27"><a href="#section-cb22-27" tabindex="-1"></a><span class="co"># Colored legend</span></span>
<span id="section-cb22-28"><a href="#section-cb22-28" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">0</span>),</span>
<span id="section-cb22-29"><a href="#section-cb22-29" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;1921&quot;</span>, <span class="st">&quot;1955&quot;</span>, <span class="st">&quot;1988&quot;</span>, <span class="st">&quot;2021&quot;</span>),</span>
<span id="section-cb22-30"><a href="#section-cb22-30" tabindex="-1"></a>       <span class="at">col =</span> color_palette[<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">which.min</span>(<span class="fu">abs</span>(years <span class="sc">-</span> <span class="dv">1955</span>)), </span>
<span id="section-cb22-31"><a href="#section-cb22-31" tabindex="-1"></a>                             <span class="fu">which.min</span>(<span class="fu">abs</span>(years <span class="sc">-</span> <span class="dv">1988</span>)), <span class="fu">length</span>(years))],</span>
<span id="section-cb22-32"><a href="#section-cb22-32" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>, </span>
<span id="section-cb22-33"><a href="#section-cb22-33" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Year&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-10-1.png" width="672" /></p>
<p>As we can see, the life expectancy is much higher from the years ~
2021 as opposed to the years from ~1921 or even ~1955. Note for the
early years, the life expectancy starts extremely low at age 0 and after
a couple years, has a sharp increase. This can be explained mainly
because it was much more difficult for an infant to survive the initial
years. In later years, thanks to modern medicine, the survival rate of
infants have risen much higher.</p>
<p>Let us focus on the year 2021.</p>
<div id="section-life-table" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> 2021 Life
Table</h3>
<div class="sourceCode" id="section-cb23"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb23-1"><a href="#section-cb23-1" tabindex="-1"></a>life_table <span class="ot">&lt;-</span> life_table[year <span class="sc">==</span> <span class="dv">2021</span>, ]  <span class="co">#Getting only data from the year 2021</span></span>
<span id="section-cb23-2"><a href="#section-cb23-2" tabindex="-1"></a>year <span class="ot">&lt;-</span> life_table<span class="sc">$</span>Year</span>
<span id="section-cb23-3"><a href="#section-cb23-3" tabindex="-1"></a>age <span class="ot">&lt;-</span> life_table<span class="sc">$</span>Age</span>
<span id="section-cb23-4"><a href="#section-cb23-4" tabindex="-1"></a>qx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>qx</span>
<span id="section-cb23-5"><a href="#section-cb23-5" tabindex="-1"></a>mx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>mx</span>
<span id="section-cb23-6"><a href="#section-cb23-6" tabindex="-1"></a>ax <span class="ot">&lt;-</span> life_table<span class="sc">$</span>ax</span>
<span id="section-cb23-7"><a href="#section-cb23-7" tabindex="-1"></a>lx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>lx</span>
<span id="section-cb23-8"><a href="#section-cb23-8" tabindex="-1"></a>dx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>dx</span>
<span id="section-cb23-9"><a href="#section-cb23-9" tabindex="-1"></a>Lx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>Lx</span>
<span id="section-cb23-10"><a href="#section-cb23-10" tabindex="-1"></a>Tx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>Tx</span>
<span id="section-cb23-11"><a href="#section-cb23-11" tabindex="-1"></a>ex <span class="ot">&lt;-</span> life_table<span class="sc">$</span>ex</span>
<span id="section-cb23-12"><a href="#section-cb23-12" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> qx</span></code></pre></div>
<div class="sourceCode" id="section-cb24"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb24-1"><a href="#section-cb24-1" tabindex="-1"></a>life_table_2021 <span class="ot">&lt;-</span> life_table[year <span class="sc">==</span> <span class="dv">2021</span>, ]  <span class="co">#Getting only data from the year 2021</span></span>
<span id="section-cb24-2"><a href="#section-cb24-2" tabindex="-1"></a>year <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>Year</span>
<span id="section-cb24-3"><a href="#section-cb24-3" tabindex="-1"></a>age <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>Age</span>
<span id="section-cb24-4"><a href="#section-cb24-4" tabindex="-1"></a>qx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>qx</span>
<span id="section-cb24-5"><a href="#section-cb24-5" tabindex="-1"></a>mx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>mx</span>
<span id="section-cb24-6"><a href="#section-cb24-6" tabindex="-1"></a>ax <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>ax</span>
<span id="section-cb24-7"><a href="#section-cb24-7" tabindex="-1"></a>lx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>lx</span>
<span id="section-cb24-8"><a href="#section-cb24-8" tabindex="-1"></a>dx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>dx</span>
<span id="section-cb24-9"><a href="#section-cb24-9" tabindex="-1"></a>Lx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>Lx</span>
<span id="section-cb24-10"><a href="#section-cb24-10" tabindex="-1"></a>Tx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>Tx</span>
<span id="section-cb24-11"><a href="#section-cb24-11" tabindex="-1"></a>ex <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>ex</span>
<span id="section-cb24-12"><a href="#section-cb24-12" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> qx</span></code></pre></div>
</div>
<div
id="section-probability-an-invidual-of-age-x-dies-before-age-y-future-life-of-age-x"
class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Probability an
invidual of age X dies before age Y, future life of age X</h3>
<div
id="section-finding-the-probability-that-an-23-year-old-dies-before-turning-24"
class="section level4" number="3.2.2.1">
<h4><span class="header-section-number">3.2.2.1</span> Finding the
probability that an 23 year old dies before turning 24</h4>
<div class="sourceCode" id="section-cb25"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb25-1"><a href="#section-cb25-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;qx value&quot;</span>, qx[<span class="dv">23</span> <span class="sc">+</span> <span class="dv">1</span>])</span></code></pre></div>
<pre><code>## qx value 0.00072</code></pre>
<p>As we can see, it is a very low probability, &lt; 0.098%</p>
</div>
<div id="section-the-expected-future-lifetime-of-an-23-year-old"
class="section level4" number="3.2.2.2">
<h4><span class="header-section-number">3.2.2.2</span> The expected
future lifetime of an 23 year old</h4>
<div class="sourceCode" id="section-cb27"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb27-1"><a href="#section-cb27-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;ex value&quot;</span>, ex[<span class="dv">23</span> <span class="sc">+</span> <span class="dv">1</span>])</span></code></pre></div>
<pre><code>## ex value 59.34</code></pre>
<p>It is expected that an average 23 year old from Canada will live for
57.06 more years in Canada in 2021</p>
</div>
</div>
<div id="section-plotting-mortality-rates" class="section level3"
number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Plotting mortality
rates</h3>
<div id="section-plot-the-mortality-rates-in-the-year-2021"
class="section level4" number="3.2.3.1">
<h4><span class="header-section-number">3.2.3.1</span> Plot the
mortality rates in the year 2021</h4>
<div class="sourceCode" id="section-cb29"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb29-1"><a href="#section-cb29-1" tabindex="-1"></a><span class="fu">plot</span>(age, qx, </span>
<span id="section-cb29-2"><a href="#section-cb29-2" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Mortality rates (Canada, 2021)&quot;</span>, </span>
<span id="section-cb29-3"><a href="#section-cb29-3" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>, </span>
<span id="section-cb29-4"><a href="#section-cb29-4" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Mortality rate &quot;</span>, q[x])), </span>
<span id="section-cb29-5"><a href="#section-cb29-5" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in xy.coords(x, y, xlabel, ylabel, log): NAs introduced by coercion</code></pre>
<p><img src="figures/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div
id="section-plot-the-logarithm-of-the-mortality-rates-in-the-year-2021"
class="section level4" number="3.2.3.2">
<h4><span class="header-section-number">3.2.3.2</span> Plot the
logarithm of the mortality rates in the year 2021</h4>
<div class="sourceCode" id="section-cb31"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb31-1"><a href="#section-cb31-1" tabindex="-1"></a><span class="co"># Plot the logarithm of the mortality rates in the year 2021</span></span>
<span id="section-cb31-2"><a href="#section-cb31-2" tabindex="-1"></a><span class="fu">plot</span>(age, <span class="fu">log</span>(qx), </span>
<span id="section-cb31-3"><a href="#section-cb31-3" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Log mortality rates (Canada, 2021)&quot;</span>, </span>
<span id="section-cb31-4"><a href="#section-cb31-4" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>, </span>
<span id="section-cb31-5"><a href="#section-cb31-5" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Log mortality rate &quot;</span>, <span class="fu">log</span>(q[x]))), </span>
<span id="section-cb31-6"><a href="#section-cb31-6" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in xy.coords(x, y, xlabel, ylabel, log): NAs introduced by coercion</code></pre>
<p><img src="figures/unnamed-chunk-16-1.png" width="672" /></p>
<hr />
</div>
<div
id="section-plot-the-mortality-rates-of-females-vs-males-in-the-year-2021"
class="section level4" number="3.2.3.3">
<h4><span class="header-section-number">3.2.3.3</span> Plot the
mortality rates of females vs males in the year 2021</h4>
</div>
<div id="section-import-the-malefemale-datasets" class="section level4"
number="3.2.3.4">
<h4><span class="header-section-number">3.2.3.4</span> Import the
male/female datasets</h4>
<div class="sourceCode" id="section-cb33"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb33-1"><a href="#section-cb33-1" tabindex="-1"></a><span class="co">#male data</span></span>
<span id="section-cb33-2"><a href="#section-cb33-2" tabindex="-1"></a>life_table_m <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">megacrazyleo</span><span class="sc">\\</span><span class="st">Desktop</span><span class="sc">\\</span><span class="st">SQL</span><span class="sc">\\</span><span class="st">R</span><span class="sc">\\</span><span class="st">mltper_1x1.txt&quot;</span>, <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">skip =</span> <span class="dv">3</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="section-cb33-3"><a href="#section-cb33-3" tabindex="-1"></a><span class="fu">colnames</span>(life_table_m) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Age&quot;</span>, <span class="st">&quot;mx&quot;</span>, <span class="st">&quot;qx&quot;</span>, <span class="st">&quot;ax&quot;</span>, <span class="st">&quot;lx&quot;</span>, <span class="st">&quot;dx&quot;</span>, <span class="st">&quot;Lx&quot;</span>, <span class="st">&quot;Tx&quot;</span>, <span class="st">&quot;ex&quot;</span>)</span>
<span id="section-cb33-4"><a href="#section-cb33-4" tabindex="-1"></a>male_2021 <span class="ot">&lt;-</span> life_table_m[life_table_m<span class="sc">$</span>Year <span class="sc">==</span> <span class="dv">2021</span>, ]</span>
<span id="section-cb33-5"><a href="#section-cb33-5" tabindex="-1"></a>year_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>Year</span>
<span id="section-cb33-6"><a href="#section-cb33-6" tabindex="-1"></a>age_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>Age</span>
<span id="section-cb33-7"><a href="#section-cb33-7" tabindex="-1"></a>qx_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>qx</span>
<span id="section-cb33-8"><a href="#section-cb33-8" tabindex="-1"></a>mx_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>mx</span>
<span id="section-cb33-9"><a href="#section-cb33-9" tabindex="-1"></a>ax_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>ax</span>
<span id="section-cb33-10"><a href="#section-cb33-10" tabindex="-1"></a>lx_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>lx</span>
<span id="section-cb33-11"><a href="#section-cb33-11" tabindex="-1"></a>dx_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>dx</span>
<span id="section-cb33-12"><a href="#section-cb33-12" tabindex="-1"></a>Lx_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>Lx</span>
<span id="section-cb33-13"><a href="#section-cb33-13" tabindex="-1"></a>Tx_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>Tx</span>
<span id="section-cb33-14"><a href="#section-cb33-14" tabindex="-1"></a>ex_m <span class="ot">&lt;-</span> male_2021<span class="sc">$</span>ex</span>
<span id="section-cb33-15"><a href="#section-cb33-15" tabindex="-1"></a></span>
<span id="section-cb33-16"><a href="#section-cb33-16" tabindex="-1"></a><span class="co">#female data</span></span>
<span id="section-cb33-17"><a href="#section-cb33-17" tabindex="-1"></a>life_table_f <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">megacrazyleo</span><span class="sc">\\</span><span class="st">Desktop</span><span class="sc">\\</span><span class="st">SQL</span><span class="sc">\\</span><span class="st">R</span><span class="sc">\\</span><span class="st">fltper_1x1.txt&quot;</span>, <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">skip =</span> <span class="dv">3</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>) </span>
<span id="section-cb33-18"><a href="#section-cb33-18" tabindex="-1"></a><span class="fu">colnames</span>(life_table_f) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Age&quot;</span>, <span class="st">&quot;mx&quot;</span>, <span class="st">&quot;qx&quot;</span>, <span class="st">&quot;ax&quot;</span>, <span class="st">&quot;lx&quot;</span>, <span class="st">&quot;dx&quot;</span>, <span class="st">&quot;Lx&quot;</span>, <span class="st">&quot;Tx&quot;</span>, <span class="st">&quot;ex&quot;</span>)</span>
<span id="section-cb33-19"><a href="#section-cb33-19" tabindex="-1"></a>female_2021 <span class="ot">&lt;-</span> life_table_f[life_table_f<span class="sc">$</span>Year <span class="sc">==</span> <span class="dv">2021</span>, ]</span>
<span id="section-cb33-20"><a href="#section-cb33-20" tabindex="-1"></a>year_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>Year</span>
<span id="section-cb33-21"><a href="#section-cb33-21" tabindex="-1"></a>age_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>Age</span>
<span id="section-cb33-22"><a href="#section-cb33-22" tabindex="-1"></a>qx_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>qx</span>
<span id="section-cb33-23"><a href="#section-cb33-23" tabindex="-1"></a>mx_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>mx</span>
<span id="section-cb33-24"><a href="#section-cb33-24" tabindex="-1"></a>ax_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>ax</span>
<span id="section-cb33-25"><a href="#section-cb33-25" tabindex="-1"></a>lx_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>lx</span>
<span id="section-cb33-26"><a href="#section-cb33-26" tabindex="-1"></a>dx_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>dx</span>
<span id="section-cb33-27"><a href="#section-cb33-27" tabindex="-1"></a>Lx_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>Lx</span>
<span id="section-cb33-28"><a href="#section-cb33-28" tabindex="-1"></a>Tx_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>Tx</span>
<span id="section-cb33-29"><a href="#section-cb33-29" tabindex="-1"></a>ex_f <span class="ot">&lt;-</span> female_2021<span class="sc">$</span>ex</span></code></pre></div>
</div>
<div id="section-plot-male-vs-female-mortality-rates-in-the-year-2021"
class="section level4" number="3.2.3.5">
<h4><span class="header-section-number">3.2.3.5</span> Plot male vs
female mortality rates in the year 2021</h4>
<div class="sourceCode" id="section-cb34"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb34-1"><a href="#section-cb34-1" tabindex="-1"></a><span class="fu">plot</span>(age_m, qx_m, </span>
<span id="section-cb34-2"><a href="#section-cb34-2" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Mortality rates (Canada, 2021)&quot;</span>, </span>
<span id="section-cb34-3"><a href="#section-cb34-3" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>, </span>
<span id="section-cb34-4"><a href="#section-cb34-4" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Mortality rate &quot;</span>, q[x])), </span>
<span id="section-cb34-5"><a href="#section-cb34-5" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="section-cb34-6"><a href="#section-cb34-6" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="section-cb34-7"><a href="#section-cb34-7" tabindex="-1"></a>     )  <span class="co"># Using log scale for y-axis to better show differences</span></span></code></pre></div>
<pre><code>## Warning in xy.coords(x, y, xlabel, ylabel, log): NAs introduced by coercion</code></pre>
<div class="sourceCode" id="section-cb36"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb36-1"><a href="#section-cb36-1" tabindex="-1"></a><span class="co"># Add the female line to the same plot</span></span>
<span id="section-cb36-2"><a href="#section-cb36-2" tabindex="-1"></a><span class="fu">lines</span>(age_f, qx_f, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in xy.coords(x, y): NAs introduced by coercion</code></pre>
<div class="sourceCode" id="section-cb38"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb38-1"><a href="#section-cb38-1" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, </span>
<span id="section-cb38-2"><a href="#section-cb38-2" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>),</span>
<span id="section-cb38-3"><a href="#section-cb38-3" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>),</span>
<span id="section-cb38-4"><a href="#section-cb38-4" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="section-cb38-5"><a href="#section-cb38-5" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-18-1.png" width="672" /></p>
<div class="sourceCode" id="section-cb39"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb39-1"><a href="#section-cb39-1" tabindex="-1"></a><span class="co"># Create the plot with male data</span></span>
<span id="section-cb39-2"><a href="#section-cb39-2" tabindex="-1"></a><span class="fu">plot</span>(age_m, qx_m, </span>
<span id="section-cb39-3"><a href="#section-cb39-3" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Mortality rates (Canadian Males and Females, 2021)&quot;</span>, </span>
<span id="section-cb39-4"><a href="#section-cb39-4" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>, </span>
<span id="section-cb39-5"><a href="#section-cb39-5" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Mortality rate &quot;</span>, q[x])), </span>
<span id="section-cb39-6"><a href="#section-cb39-6" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="section-cb39-7"><a href="#section-cb39-7" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="section-cb39-8"><a href="#section-cb39-8" tabindex="-1"></a>    <span class="at">log =</span> <span class="st">&quot;y&quot;</span>,  </span>
<span id="section-cb39-9"><a href="#section-cb39-9" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">range</span>(<span class="fu">c</span>(qx_m, qx_f))  <span class="co"># Set y-axis limits to include both male and female data</span></span>
<span id="section-cb39-10"><a href="#section-cb39-10" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning in xy.coords(x, y, xlabel, ylabel, log): NAs introduced by coercion</code></pre>
<div class="sourceCode" id="section-cb41"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb41-1"><a href="#section-cb41-1" tabindex="-1"></a><span class="co"># Add female data</span></span>
<span id="section-cb41-2"><a href="#section-cb41-2" tabindex="-1"></a><span class="fu">lines</span>(age_f, qx_f, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in xy.coords(x, y): NAs introduced by coercion</code></pre>
<div class="sourceCode" id="section-cb43"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb43-1"><a href="#section-cb43-1" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="section-cb43-2"><a href="#section-cb43-2" tabindex="-1"></a></span>
<span id="section-cb43-3"><a href="#section-cb43-3" tabindex="-1"></a><span class="co"># Add points to show actual data points</span></span>
<span id="section-cb43-4"><a href="#section-cb43-4" tabindex="-1"></a><span class="fu">points</span>(age_m, qx_m, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in xy.coords(x, y): NAs introduced by coercion</code></pre>
<div class="sourceCode" id="section-cb45"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb45-1"><a href="#section-cb45-1" tabindex="-1"></a><span class="fu">points</span>(age_f, qx_f, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in xy.coords(x, y): NAs introduced by coercion</code></pre>
<div class="sourceCode" id="section-cb47"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb47-1"><a href="#section-cb47-1" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, </span>
<span id="section-cb47-2"><a href="#section-cb47-2" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Males&quot;</span>, <span class="st">&quot;Females&quot;</span>),</span>
<span id="section-cb47-3"><a href="#section-cb47-3" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>),</span>
<span id="section-cb47-4"><a href="#section-cb47-4" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="section-cb47-5"><a href="#section-cb47-5" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="section-cb47-6"><a href="#section-cb47-6" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-19-1.png" width="672" /></p>
</div>
</div>
<div id="section-probability-for-invidivual-of-age-x-to-reach-age-y"
class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Probability for
invidivual of age x to reach age y</h3>
<div
id="section-find-the-probability-for-a-0-year-old-female-and-male-in-canada-to-reach-the-age-of-100-in-2021"
class="section level4" number="3.2.4.1">
<h4><span class="header-section-number">3.2.4.1</span> Find the
probability for a 0 year old female and male in Canada to reach the age
of 100 in 2021</h4>
<div class="sourceCode" id="section-cb48"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb48-1"><a href="#section-cb48-1" tabindex="-1"></a>male_prob <span class="ot">&lt;-</span> lx_m[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx_m[<span class="dv">0</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb48-2"><a href="#section-cb48-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Male probability:&quot;</span>, male_prob))</span></code></pre></div>
<pre><code>## [1] &quot;Male probability: 0.01918&quot;</code></pre>
<div class="sourceCode" id="section-cb50"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb50-1"><a href="#section-cb50-1" tabindex="-1"></a>female_prob <span class="ot">&lt;-</span> lx_f[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx_f[<span class="dv">0</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb50-2"><a href="#section-cb50-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Female probability:&quot;</span>, female_prob))</span></code></pre></div>
<pre><code>## [1] &quot;Female probability: 0.05113&quot;</code></pre>
<hr />
</div>
<div
id="section-find-the-probability-for-a-0-year-old-in-canada-to-reach-the-age-of-100-in-2021"
class="section level4" number="3.2.4.2">
<h4><span class="header-section-number">3.2.4.2</span> Find the
probability for a 0 year old in Canada to reach the age of 100 in
2021</h4>
<div class="sourceCode" id="section-cb52"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb52-1"><a href="#section-cb52-1" tabindex="-1"></a>canada_prob <span class="ot">&lt;-</span> lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">0</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb52-2"><a href="#section-cb52-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;M/F probability:&quot;</span>, canada_prob))</span></code></pre></div>
<pre><code>## [1] &quot;M/F probability: 0.03606&quot;</code></pre>
<p>If we compare this with an 18 year old individual</p>
<div class="sourceCode" id="section-cb54"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb54-1"><a href="#section-cb54-1" tabindex="-1"></a>canada_prob_2 <span class="ot">&lt;-</span> lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">18</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb54-2"><a href="#section-cb54-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;M/F age 18 probability:&quot;</span>, canada_prob_2))</span></code></pre></div>
<pre><code>## [1] &quot;M/F age 18 probability: 0.0363050591492575&quot;</code></pre>
<p>Vs a 40 year old individual</p>
<div class="sourceCode" id="section-cb56"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb56-1"><a href="#section-cb56-1" tabindex="-1"></a>canada_prob_5 <span class="ot">&lt;-</span> lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">40</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb56-2"><a href="#section-cb56-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;M/F age 40 probability:&quot;</span>, canada_prob_5))</span></code></pre></div>
<pre><code>## [1] &quot;M/F age 40 probability: 0.0370583520029597&quot;</code></pre>
<p>And again with a 75 year old individual</p>
<div class="sourceCode" id="section-cb58"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb58-1"><a href="#section-cb58-1" tabindex="-1"></a>canada_prob_3 <span class="ot">&lt;-</span> lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">75</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb58-2"><a href="#section-cb58-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;M/F age 75 probability:&quot;</span>, canada_prob_3))</span></code></pre></div>
<pre><code>## [1] &quot;M/F age 75 probability: 0.0473352585980572&quot;</code></pre>
<p>Finally, compare with a 98 year old individual</p>
<div class="sourceCode" id="section-cb60"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb60-1"><a href="#section-cb60-1" tabindex="-1"></a>canada_prob_4 <span class="ot">&lt;-</span> lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">98</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb60-2"><a href="#section-cb60-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;M/F age 98 probability:&quot;</span>, canada_prob_4))</span></code></pre></div>
<pre><code>## [1] &quot;M/F age 98 probability: 0.534459759893286&quot;</code></pre>
<div class="sourceCode" id="section-cb62"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb62-1"><a href="#section-cb62-1" tabindex="-1"></a><span class="co"># Calculate probabilities</span></span>
<span id="section-cb62-2"><a href="#section-cb62-2" tabindex="-1"></a>ages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">18</span>, <span class="dv">75</span>, <span class="dv">98</span>)</span>
<span id="section-cb62-3"><a href="#section-cb62-3" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="section-cb62-4"><a href="#section-cb62-4" tabindex="-1"></a>  lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">0</span> <span class="sc">+</span> <span class="dv">1</span>],</span>
<span id="section-cb62-5"><a href="#section-cb62-5" tabindex="-1"></a>  lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">18</span> <span class="sc">+</span> <span class="dv">1</span>],</span>
<span id="section-cb62-6"><a href="#section-cb62-6" tabindex="-1"></a>  lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">40</span> <span class="sc">+</span> <span class="dv">1</span>],</span>
<span id="section-cb62-7"><a href="#section-cb62-7" tabindex="-1"></a>  lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">75</span> <span class="sc">+</span> <span class="dv">1</span>],</span>
<span id="section-cb62-8"><a href="#section-cb62-8" tabindex="-1"></a>  lx[<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">98</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb62-9"><a href="#section-cb62-9" tabindex="-1"></a>)</span>
<span id="section-cb62-10"><a href="#section-cb62-10" tabindex="-1"></a></span>
<span id="section-cb62-11"><a href="#section-cb62-11" tabindex="-1"></a><span class="co"># Create a data frame</span></span>
<span id="section-cb62-12"><a href="#section-cb62-12" tabindex="-1"></a>prob_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Age =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;40&quot;</span>, <span class="st">&quot;75&quot;</span>, <span class="st">&quot;98&quot;</span>), <span class="at">Probability =</span> probs)</span>
<span id="section-cb62-13"><a href="#section-cb62-13" tabindex="-1"></a></span>
<span id="section-cb62-14"><a href="#section-cb62-14" tabindex="-1"></a><span class="co"># Create the bar plot</span></span>
<span id="section-cb62-15"><a href="#section-cb62-15" tabindex="-1"></a><span class="fu">barplot</span>(prob_data<span class="sc">$</span>Probability, </span>
<span id="section-cb62-16"><a href="#section-cb62-16" tabindex="-1"></a>        <span class="at">names.arg =</span> prob_data<span class="sc">$</span>Age,</span>
<span id="section-cb62-17"><a href="#section-cb62-17" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Probability of Reaching Age 100 from Different Starting Ages&quot;</span>,</span>
<span id="section-cb62-18"><a href="#section-cb62-18" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Starting Age&quot;</span>,</span>
<span id="section-cb62-19"><a href="#section-cb62-19" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Probability&quot;</span>,</span>
<span id="section-cb62-20"><a href="#section-cb62-20" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">&quot;skyblue&quot;</span>,</span>
<span id="section-cb62-21"><a href="#section-cb62-21" tabindex="-1"></a>        <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(probs) <span class="sc">*</span> <span class="fl">1.1</span>))  <span class="co"># Set y-axis limit to 110% of max probability</span></span>
<span id="section-cb62-22"><a href="#section-cb62-22" tabindex="-1"></a></span>
<span id="section-cb62-23"><a href="#section-cb62-23" tabindex="-1"></a><span class="co"># Add value labels on top of each bar</span></span>
<span id="section-cb62-24"><a href="#section-cb62-24" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, </span>
<span id="section-cb62-25"><a href="#section-cb62-25" tabindex="-1"></a>     <span class="at">y =</span> probs,</span>
<span id="section-cb62-26"><a href="#section-cb62-26" tabindex="-1"></a>     <span class="at">labels =</span> <span class="fu">round</span>(probs, <span class="dv">5</span>),</span>
<span id="section-cb62-27"><a href="#section-cb62-27" tabindex="-1"></a>     <span class="at">pos =</span> <span class="dv">3</span>,</span>
<span id="section-cb62-28"><a href="#section-cb62-28" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="section-cb62-29"><a href="#section-cb62-29" tabindex="-1"></a></span>
<span id="section-cb62-30"><a href="#section-cb62-30" tabindex="-1"></a><span class="co"># Add a grid for better readability</span></span>
<span id="section-cb62-31"><a href="#section-cb62-31" tabindex="-1"></a><span class="fu">grid</span>()</span></code></pre></div>
<p><img src="figures/unnamed-chunk-26-1.png" width="672" /></p>
</div>
<div id="section-plot-the-survival-probabilties-for-18-up-to-age-100"
class="section level4" number="3.2.4.3">
<h4><span class="header-section-number">3.2.4.3</span> Plot the survival
probabilties for (18) up to age 100</h4>
<div class="sourceCode" id="section-cb63"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb63-1"><a href="#section-cb63-1" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">82</span></span>
<span id="section-cb63-2"><a href="#section-cb63-2" tabindex="-1"></a><span class="fu">plot</span>(k, lx[<span class="dv">18</span> <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">18</span> <span class="sc">+</span> <span class="dv">1</span>], </span>
<span id="section-cb63-3"><a href="#section-cb63-3" tabindex="-1"></a>    <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="section-cb63-4"><a href="#section-cb63-4" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;k&quot;</span>, </span>
<span id="section-cb63-5"><a href="#section-cb63-5" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;&quot;</span>[k], <span class="st">&quot;p&quot;</span>[<span class="dv">18</span>])), </span>
<span id="section-cb63-6"><a href="#section-cb63-6" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Survival probabilities for age 18 up to 100&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-27-1.png" width="672" /> Compare this
with a 50 year old</p>
<div class="sourceCode" id="section-cb64"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb64-1"><a href="#section-cb64-1" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="section-cb64-2"><a href="#section-cb64-2" tabindex="-1"></a><span class="fu">plot</span>(k, lx[<span class="dv">50</span> <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> lx[<span class="dv">50</span> <span class="sc">+</span> <span class="dv">1</span>], </span>
<span id="section-cb64-3"><a href="#section-cb64-3" tabindex="-1"></a>    <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="section-cb64-4"><a href="#section-cb64-4" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;k&quot;</span>, </span>
<span id="section-cb64-5"><a href="#section-cb64-5" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;&quot;</span>[k], <span class="st">&quot;p&quot;</span>[<span class="dv">50</span>])), </span>
<span id="section-cb64-6"><a href="#section-cb64-6" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Survival probabilities for age 50 up to 100&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-28-1.png" width="672" /></p>
</div>
<div id="section-plot-the-number-of-deaths" class="section level4"
number="3.2.4.4">
<h4><span class="header-section-number">3.2.4.4</span> Plot the number
of deaths</h4>
<div class="sourceCode" id="section-cb65"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb65-1"><a href="#section-cb65-1" tabindex="-1"></a><span class="co"># Plot the number of deaths dx by age</span></span>
<span id="section-cb65-2"><a href="#section-cb65-2" tabindex="-1"></a><span class="fu">plot</span>(age, dx, </span>
<span id="section-cb65-3"><a href="#section-cb65-3" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;h&quot;</span>, </span>
<span id="section-cb65-4"><a href="#section-cb65-4" tabindex="-1"></a>    <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="section-cb65-5"><a href="#section-cb65-5" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>, </span>
<span id="section-cb65-6"><a href="#section-cb65-6" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="st">&quot;d&quot;</span>[x]),</span>
<span id="section-cb65-7"><a href="#section-cb65-7" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Number of deaths (Canada, M/F, 2021)&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in xy.coords(x, y, xlabel, ylabel, log): NAs introduced by coercion</code></pre>
<div class="sourceCode" id="section-cb67"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb67-1"><a href="#section-cb67-1" tabindex="-1"></a><span class="co"># Simulate the number of deaths using a binomial distribution</span></span>
<span id="section-cb67-2"><a href="#section-cb67-2" tabindex="-1"></a>sims <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">length</span>(lx), <span class="at">size =</span> lx, <span class="at">prob =</span> qx)</span>
<span id="section-cb67-3"><a href="#section-cb67-3" tabindex="-1"></a>  </span>
<span id="section-cb67-4"><a href="#section-cb67-4" tabindex="-1"></a><span class="co"># Plot the simulated number of deaths on top of the previous graph</span></span>
<span id="section-cb67-5"><a href="#section-cb67-5" tabindex="-1"></a><span class="fu">points</span>(age, sims, </span>
<span id="section-cb67-6"><a href="#section-cb67-6" tabindex="-1"></a>    <span class="at">pch =</span> <span class="dv">4</span>, </span>
<span id="section-cb67-7"><a href="#section-cb67-7" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in xy.coords(x, y): NAs introduced by coercion</code></pre>
<p><img src="figures/unnamed-chunk-29-1.png" width="672" /></p>
</div>
</div>
<div
id="section-probability-that-individual-of-age-x-survives-y-more-years"
class="section level3" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Probability that
individual of age x survives y more years</h3>
<div
id="section-calculate-the-probability-that-25-survives-5-more-years"
class="section level4" number="3.2.5.1">
<h4><span class="header-section-number">3.2.5.1</span> Calculate the
probability that (25) survives 5 more years</h4>
<div class="sourceCode" id="section-cb69"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb69-1"><a href="#section-cb69-1" tabindex="-1"></a><span class="fu">prod</span>(px[(<span class="dv">25</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">30</span> <span class="sc">+</span> <span class="dv">1</span>)])</span></code></pre></div>
<pre><code>## [1] 0.9946519</code></pre>
</div>
<div
id="section-compute-the-survival-probabilities-of-25-until-the-age-of-100"
class="section level4" number="3.2.5.2">
<h4><span class="header-section-number">3.2.5.2</span> Compute the
survival probabilities of (25) until the age of 100</h4>
<div class="sourceCode" id="section-cb71"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb71-1"><a href="#section-cb71-1" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(px[(<span class="dv">25</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">99</span> <span class="sc">+</span> <span class="dv">1</span>)])</span></code></pre></div>
</div>
<div
id="section-extract-the-probability-that-25-survives-until-the-age-of-100"
class="section level4" number="3.2.5.3">
<h4><span class="header-section-number">3.2.5.3</span> Extract the
probability that (25) survives until the age of 100</h4>
<div class="sourceCode" id="section-cb72"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb72-1"><a href="#section-cb72-1" tabindex="-1"></a>kpx[<span class="fu">length</span>(kpx)]</span></code></pre></div>
<pre><code>## [1] 0.03645575</code></pre>
</div>
<div
id="section-plot-the-probabilties-for-25-to-reach-the-age-of-26-27-100"
class="section level4" number="3.2.5.4">
<h4><span class="header-section-number">3.2.5.4</span> Plot the
probabilties for (25) to reach the age of 26, 27, …, 100</h4>
<div class="sourceCode" id="section-cb74"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb74-1"><a href="#section-cb74-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(kpx), kpx,</span>
<span id="section-cb74-2"><a href="#section-cb74-2" tabindex="-1"></a>    <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="section-cb74-3"><a href="#section-cb74-3" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;k&quot;</span>,</span>
<span id="section-cb74-4"><a href="#section-cb74-4" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;&quot;</span>[k], <span class="st">&quot;p&quot;</span>[<span class="dv">25</span>])),</span>
<span id="section-cb74-5"><a href="#section-cb74-5" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Survival probabilities for (25)&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-33-1.png" width="672" /> ## Survival
probabilities and Curtate Expected Future Lifetime</p>
</div>
<div id="section-compute-the-survival-probabilities-of-25"
class="section level4" number="3.2.5.5">
<h4><span class="header-section-number">3.2.5.5</span> Compute the
survival probabilities of (25)</h4>
<div class="sourceCode" id="section-cb75"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb75-1"><a href="#section-cb75-1" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(<span class="dv">25</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">length</span>(px) <span class="sc">-</span> <span class="dv">1</span>)]))</span></code></pre></div>
</div>
<div id="section-compute-the-deferred-mortality-probabilities-of-25"
class="section level4" number="3.2.5.6">
<h4><span class="header-section-number">3.2.5.6</span> Compute the
deferred mortality probabilities of (25)</h4>
<div class="sourceCode" id="section-cb76"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb76-1"><a href="#section-cb76-1" tabindex="-1"></a>kqx <span class="ot">&lt;-</span> kpx <span class="sc">*</span> qx[(<span class="dv">25</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(qx)]</span></code></pre></div>
</div>
<div id="section-plot-the-deferred-mortality-probabilities-of-25"
class="section level4" number="3.2.5.7">
<h4><span class="header-section-number">3.2.5.7</span> Plot the deferred
mortality probabilities of (25)</h4>
<div class="sourceCode" id="section-cb77"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb77-1"><a href="#section-cb77-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span><span class="sc">:</span>(<span class="fu">length</span>(kqx) <span class="sc">-</span> <span class="dv">1</span>), kqx,</span>
<span id="section-cb77-2"><a href="#section-cb77-2" tabindex="-1"></a>    <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="section-cb77-3"><a href="#section-cb77-3" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;k&quot;</span>,</span>
<span id="section-cb77-4"><a href="#section-cb77-4" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;&quot;</span>[<span class="st">&#39;k|&#39;</span>], <span class="st">&quot;q&quot;</span>[<span class="dv">25</span>])),</span>
<span id="section-cb77-5"><a href="#section-cb77-5" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Deferred mortality probabilities of (25)&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-36-1.png" width="672" /></p>
</div>
<div
id="section-survival-probabilities-and-curtate-expected-future-lifetime-of-0"
class="section level4" number="3.2.5.8">
<h4><span class="header-section-number">3.2.5.8</span> Survival
probabilities and curtate expected future lifetime of (0)</h4>
<div class="sourceCode" id="section-cb78"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb78-1"><a href="#section-cb78-1" tabindex="-1"></a>kp0 <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(px)</span>
<span id="section-cb78-2"><a href="#section-cb78-2" tabindex="-1"></a><span class="fu">sum</span>(kp0)</span></code></pre></div>
<pre><code>## [1] 81.15437</code></pre>
</div>
<div
id="section-survival-probabilities-and-curtate-expected-future-lifetime-of-a-25-year-old"
class="section level4" number="3.2.5.9">
<h4><span class="header-section-number">3.2.5.9</span> Survival
probabilities and curtate expected future lifetime of a 25 year old</h4>
<div class="sourceCode" id="section-cb80"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb80-1"><a href="#section-cb80-1" tabindex="-1"></a>kp25 <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(px[(<span class="dv">25</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(px)])</span>
<span id="section-cb80-2"><a href="#section-cb80-2" tabindex="-1"></a><span class="fu">sum</span>(kp25)</span></code></pre></div>
<pre><code>## [1] 56.92983</code></pre>
</div>
<div id="section-complete-expected-future-lifetime-of-0-and-25"
class="section level4" number="3.2.5.10">
<h4><span class="header-section-number">3.2.5.10</span> Complete
expected future lifetime of (0) and (25)</h4>
<div class="sourceCode" id="section-cb82"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb82-1"><a href="#section-cb82-1" tabindex="-1"></a>ex[<span class="fu">c</span>(<span class="dv">0</span> <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">25</span> <span class="sc">+</span> <span class="dv">1</span>)]</span></code></pre></div>
<pre><code>## [1] 81.65 57.43</code></pre>
</div>
</div>
<div
id="section-function-to-compute-the-curtate-expected-future-lifetime-for-a-given-age-and-life-table"
class="section level3" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> Function to compute
the curtate expected future lifetime for a given age and life table</h3>
<div class="sourceCode" id="section-cb84"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb84-1"><a href="#section-cb84-1" tabindex="-1"></a>age2 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(age)</span></code></pre></div>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<div class="sourceCode" id="section-cb86"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb86-1"><a href="#section-cb86-1" tabindex="-1"></a>curtate_future_lifetime <span class="ot">&lt;-</span> <span class="cf">function</span>(age2, life_table) {</span>
<span id="section-cb86-2"><a href="#section-cb86-2" tabindex="-1"></a>  qx <span class="ot">&lt;-</span> life_table<span class="sc">$</span>qx</span>
<span id="section-cb86-3"><a href="#section-cb86-3" tabindex="-1"></a>  px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> qx</span>
<span id="section-cb86-4"><a href="#section-cb86-4" tabindex="-1"></a>  kpx <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(px[(age2 <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(px)])</span>
<span id="section-cb86-5"><a href="#section-cb86-5" tabindex="-1"></a>  <span class="fu">sum</span>(kpx)</span>
<span id="section-cb86-6"><a href="#section-cb86-6" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="section-curtate-future-lifetimes-for-all-ages"
class="section level3" number="3.2.7">
<h3><span class="header-section-number">3.2.7</span> Curtate future
lifetimes for all ages</h3>
<div class="sourceCode" id="section-cb87"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb87-1"><a href="#section-cb87-1" tabindex="-1"></a>valid_ages <span class="ot">&lt;-</span> age2[<span class="sc">!</span><span class="fu">is.na</span>(age2)]</span>
<span id="section-cb87-2"><a href="#section-cb87-2" tabindex="-1"></a>future_lifetimes <span class="ot">&lt;-</span> <span class="fu">sapply</span>(valid_ages, <span class="cf">function</span>(age) <span class="fu">curtate_future_lifetime</span>(age, life_table))</span>
<span id="section-cb87-3"><a href="#section-cb87-3" tabindex="-1"></a>future_lifetimes</span></code></pre></div>
<pre><code>##   [1] 81.1543677 80.5105688 79.5298960 78.5410318 77.5512434 76.5582237 75.5651145 74.5696487 73.5741231 72.5800095 71.5850905 70.5908178 69.5964655 68.6041219
##  [15] 67.6123554 66.6211462 65.6364726 64.6555127 63.6800911 62.7081227 61.7394924 60.7728498 59.8069016 58.8434061 57.8858039 56.9298305 55.9754109 55.0202271
##  [29] 54.0692387 53.1157782 52.1705439 51.2217212 50.2729942 49.3263401 48.3821419 47.4349360 46.4966817 45.5558076 44.6187615 43.6831051 42.7421570 41.8093678
##  [43] 40.8721760 39.9352163 38.9988144 38.0710959 37.1424222 36.2172289 35.2887176 34.3679418 33.4554587 32.5477149 31.6482716 30.7466863 29.8518913 28.9699729
##  [57] 28.0901151 27.2168086 26.3505528 25.4885582 24.6421547 23.8018788 22.9662875 22.1393700 21.3176883 20.5058647 19.7077654 18.9142764 18.1290962 17.3552326
##  [71] 16.5964804 15.8432337 15.1037931 14.3678121 13.6465357 12.9503749 12.2568738 11.5823800 10.9233889 10.2898577  9.6617391  9.0501785  8.4609740  7.8870176
##  [85]  7.3383738  6.8153443  6.3136213  5.8359568  5.3771888  4.9556622  4.5677219  4.2107849  3.8717329  3.5497877  3.2682134  3.0078649  2.7581869  2.5286726
##  [99]  2.3181631  2.1255148  1.9494822  1.7886795  1.6414429  1.5057902  1.3788531  1.2562353  1.1304400  0.9874820  0.7999053  0.5110800</code></pre>
<div class="sourceCode" id="section-cb89"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb89-1"><a href="#section-cb89-1" tabindex="-1"></a><span class="co"># Future lifetime by age</span></span>
<span id="section-cb89-2"><a href="#section-cb89-2" tabindex="-1"></a><span class="fu">plot</span>(age2[<span class="sc">!</span><span class="fu">is.na</span>(age2)], future_lifetimes, <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Future lifetime&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Future lifetime by age&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-42-1.png" width="672" /></p>
<div
id="section-plot-the-logarithm-of-the-malefemale-mortality-rates-for-18-by-year"
class="section level4" number="3.2.7.1">
<h4><span class="header-section-number">3.2.7.1</span> Plot the
logarithm of the male/female mortality rates for (18) by year</h4>
<div class="sourceCode" id="section-cb90"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb90-1"><a href="#section-cb90-1" tabindex="-1"></a><span class="co"># Load the life table</span></span>
<span id="section-cb90-2"><a href="#section-cb90-2" tabindex="-1"></a>life_table <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">megacrazyleo</span><span class="sc">\\</span><span class="st">Desktop</span><span class="sc">\\</span><span class="st">SQL</span><span class="sc">\\</span><span class="st">R</span><span class="sc">\\</span><span class="st">bltper_1x1.txt&quot;</span>, <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">skip =</span> <span class="dv">3</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>) </span>
<span id="section-cb90-3"><a href="#section-cb90-3" tabindex="-1"></a><span class="fu">colnames</span>(life_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Age&quot;</span>, <span class="st">&quot;mx&quot;</span>, <span class="st">&quot;qx&quot;</span>, <span class="st">&quot;ax&quot;</span>, <span class="st">&quot;lx&quot;</span>, <span class="st">&quot;dx&quot;</span>, <span class="st">&quot;Lx&quot;</span>, <span class="st">&quot;Tx&quot;</span>, <span class="st">&quot;ex&quot;</span>)</span>
<span id="section-cb90-4"><a href="#section-cb90-4" tabindex="-1"></a></span>
<span id="section-cb90-5"><a href="#section-cb90-5" tabindex="-1"></a><span class="co"># Ensure Age is numeric</span></span>
<span id="section-cb90-6"><a href="#section-cb90-6" tabindex="-1"></a>life_table<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(life_table<span class="sc">$</span>Age)</span></code></pre></div>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<div class="sourceCode" id="section-cb92"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb92-1"><a href="#section-cb92-1" tabindex="-1"></a><span class="co"># Subset the life table for age 18</span></span>
<span id="section-cb92-2"><a href="#section-cb92-2" tabindex="-1"></a>subset_18 <span class="ot">&lt;-</span> <span class="fu">subset</span>(life_table, Age <span class="sc">==</span> <span class="dv">18</span>)</span>
<span id="section-cb92-3"><a href="#section-cb92-3" tabindex="-1"></a></span>
<span id="section-cb92-4"><a href="#section-cb92-4" tabindex="-1"></a><span class="co"># Check if the subset has the same length for &#39;Year&#39; and &#39;qx&#39;</span></span>
<span id="section-cb92-5"><a href="#section-cb92-5" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(subset_18) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="section-cb92-6"><a href="#section-cb92-6" tabindex="-1"></a>  <span class="co"># Plot the log mortality rates for age 18</span></span>
<span id="section-cb92-7"><a href="#section-cb92-7" tabindex="-1"></a>  <span class="fu">with</span>(subset_18,</span>
<span id="section-cb92-8"><a href="#section-cb92-8" tabindex="-1"></a>       <span class="fu">plot</span>(Year, <span class="fu">log</span>(qx),</span>
<span id="section-cb92-9"><a href="#section-cb92-9" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Log mortality rates (Canada, M/F, 18-year-old)&quot;</span>,</span>
<span id="section-cb92-10"><a href="#section-cb92-10" tabindex="-1"></a>            <span class="at">xlab =</span> <span class="st">&quot;Year t&quot;</span>, <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Log mortality rate &quot;</span>, <span class="fu">log</span>(q[<span class="dv">18</span>])))))</span>
<span id="section-cb92-11"><a href="#section-cb92-11" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="section-cb92-12"><a href="#section-cb92-12" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;No data available for age 18&quot;</span>)</span>
<span id="section-cb92-13"><a href="#section-cb92-13" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="figures/unnamed-chunk-43-1.png" width="672" /></p>
</div>
<div
id="section-plot-the-logarithm-of-the-female-mortality-rates-in-the-year-1950-by-age"
class="section level4" number="3.2.7.2">
<h4><span class="header-section-number">3.2.7.2</span> Plot the
logarithm of the female mortality rates in the year 1950 by age</h4>
<div class="sourceCode" id="section-cb93"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb93-1"><a href="#section-cb93-1" tabindex="-1"></a><span class="co"># Subset the life table for the year 1950</span></span>
<span id="section-cb93-2"><a href="#section-cb93-2" tabindex="-1"></a>subset_1950 <span class="ot">&lt;-</span> <span class="fu">subset</span>(life_table, Year <span class="sc">==</span> <span class="dv">1950</span>)</span>
<span id="section-cb93-3"><a href="#section-cb93-3" tabindex="-1"></a></span>
<span id="section-cb93-4"><a href="#section-cb93-4" tabindex="-1"></a><span class="co"># Check if the subset has the same length for &#39;Age&#39; and &#39;qx&#39;</span></span>
<span id="section-cb93-5"><a href="#section-cb93-5" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(subset_1950) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="section-cb93-6"><a href="#section-cb93-6" tabindex="-1"></a>  <span class="co"># Plot the log mortality rates for the year 1950</span></span>
<span id="section-cb93-7"><a href="#section-cb93-7" tabindex="-1"></a>  <span class="fu">with</span>(subset_1950,</span>
<span id="section-cb93-8"><a href="#section-cb93-8" tabindex="-1"></a>       <span class="fu">plot</span>(Age, <span class="fu">log</span>(qx),</span>
<span id="section-cb93-9"><a href="#section-cb93-9" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Log mortality rates (Canada, M/F, 1950)&quot;</span>,</span>
<span id="section-cb93-10"><a href="#section-cb93-10" tabindex="-1"></a>            <span class="at">xlab =</span> <span class="st">&quot;Age x&quot;</span>, <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Log mortality rate &quot;</span>, <span class="fu">log</span>(q[x])))))</span>
<span id="section-cb93-11"><a href="#section-cb93-11" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="section-cb93-12"><a href="#section-cb93-12" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;No data available for the year 1950&quot;</span>)</span>
<span id="section-cb93-13"><a href="#section-cb93-13" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="figures/unnamed-chunk-44-1.png" width="672" /></p>
</div>
<div
id="section-construct-and-print-the-cohort-life-table-for-birth-year-1981"
class="section level4" number="3.2.7.3">
<h4><span class="header-section-number">3.2.7.3</span> Construct and
print the cohort life table for birth year 1981</h4>
<div class="sourceCode" id="section-cb94"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb94-1"><a href="#section-cb94-1" tabindex="-1"></a>life_table_1981 <span class="ot">&lt;-</span> <span class="fu">subset</span>(life_table, Year <span class="sc">-</span> Age <span class="sc">==</span> <span class="dv">1981</span>)</span>
<span id="section-cb94-2"><a href="#section-cb94-2" tabindex="-1"></a>life_table_1981</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Year"],"name":[1],"type":["int"],"align":["right"]},{"label":["Age"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["mx"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["qx"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["ax"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["lx"],"name":[6],"type":["int"],"align":["right"]},{"label":["dx"],"name":[7],"type":["int"],"align":["right"]},{"label":["Lx"],"name":[8],"type":["int"],"align":["right"]},{"label":["Tx"],"name":[9],"type":["int"],"align":["right"]},{"label":["ex"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"1981","2":"0","3":"0.00972","4":"0.00963","5":"0.13","6":"100000","7":"963","8":"99161","9":"7548411","10":"75.48","_rn_":"6661"},{"1":"1982","2":"1","3":"0.00063","4":"0.00063","5":"0.50","6":"99076","7":"63","8":"99045","9":"7470238","10":"75.40","_rn_":"6773"},{"1":"1983","2":"2","3":"0.00044","4":"0.00044","5":"0.50","6":"99077","7":"43","8":"99056","9":"7408421","10":"74.77","_rn_":"6885"},{"1":"1984","2":"3","3":"0.00039","4":"0.00039","5":"0.50","6":"99073","7":"39","8":"99053","9":"7338302","10":"74.07","_rn_":"6997"},{"1":"1985","2":"4","3":"0.00028","4":"0.00028","5":"0.50","6":"99059","7":"28","8":"99045","9":"7238256","10":"73.07","_rn_":"7109"},{"1":"1986","2":"5","3":"0.00029","4":"0.00029","5":"0.50","6":"99037","7":"29","8":"99022","9":"7153349","10":"72.23","_rn_":"7221"},{"1":"1987","2":"6","3":"0.00020","4":"0.00020","5":"0.50","6":"99077","7":"20","8":"99066","9":"7084561","10":"71.51","_rn_":"7333"},{"1":"1988","2":"7","3":"0.00023","4":"0.00023","5":"0.50","6":"99072","7":"23","8":"99061","9":"6991848","10":"70.57","_rn_":"7445"},{"1":"1989","2":"8","3":"0.00017","4":"0.00017","5":"0.50","6":"99056","7":"17","8":"99048","9":"6919036","10":"69.85","_rn_":"7557"},{"1":"1990","2":"9","3":"0.00020","4":"0.00020","5":"0.50","6":"99091","7":"20","8":"99081","9":"6850504","10":"69.13","_rn_":"7669"},{"1":"1991","2":"10","3":"0.00015","4":"0.00015","5":"0.50","6":"99150","7":"15","8":"99143","9":"6766861","10":"68.25","_rn_":"7781"},{"1":"1992","2":"11","3":"0.00015","4":"0.00015","5":"0.50","6":"99164","7":"15","8":"99157","9":"6692921","10":"67.49","_rn_":"7893"},{"1":"1993","2":"12","3":"0.00021","4":"0.00021","5":"0.50","6":"99150","7":"21","8":"99140","9":"6581079","10":"66.37","_rn_":"8005"},{"1":"1994","2":"13","3":"0.00026","4":"0.00026","5":"0.50","6":"99122","7":"26","8":"99109","9":"6499918","10":"65.57","_rn_":"8117"},{"1":"1995","2":"14","3":"0.00027","4":"0.00027","5":"0.50","6":"99134","7":"26","8":"99121","9":"6412031","10":"64.68","_rn_":"8229"},{"1":"1996","2":"15","3":"0.00031","4":"0.00031","5":"0.50","6":"99180","7":"31","8":"99165","9":"6337554","10":"63.90","_rn_":"8341"},{"1":"1997","2":"16","3":"0.00053","4":"0.00053","5":"0.50","6":"99141","7":"52","8":"99115","9":"6257835","10":"63.12","_rn_":"8453"},{"1":"1998","2":"17","3":"0.00042","4":"0.00042","5":"0.50","6":"99150","7":"41","8":"99130","9":"6178885","10":"62.32","_rn_":"8565"},{"1":"1999","2":"18","3":"0.00063","4":"0.00063","5":"0.50","6":"99099","7":"62","8":"99068","9":"6100645","10":"61.56","_rn_":"8677"},{"1":"2000","2":"19","3":"0.00064","4":"0.00064","5":"0.50","6":"99080","7":"63","8":"99048","9":"6035708","10":"60.92","_rn_":"8789"},{"1":"2001","2":"20","3":"0.00059","4":"0.00059","5":"0.50","6":"99008","7":"58","8":"98979","9":"5958898","10":"60.19","_rn_":"8901"},{"1":"2002","2":"21","3":"0.00058","4":"0.00058","5":"0.50","6":"98946","7":"57","8":"98917","9":"5871755","10":"59.34","_rn_":"9013"},{"1":"2003","2":"22","3":"0.00055","4":"0.00055","5":"0.50","6":"98905","7":"54","8":"98878","9":"5789571","10":"58.54","_rn_":"9125"},{"1":"2004","2":"23","3":"0.00055","4":"0.00055","5":"0.50","6":"98888","7":"55","8":"98861","9":"5719518","10":"57.84","_rn_":"9237"},{"1":"2005","2":"24","3":"0.00056","4":"0.00056","5":"0.50","6":"98782","7":"56","8":"98755","9":"5631507","10":"57.01","_rn_":"9349"},{"1":"2006","2":"25","3":"0.00056","4":"0.00056","5":"0.50","6":"98779","7":"55","8":"98751","9":"5572998","10":"56.42","_rn_":"9461"},{"1":"2007","2":"26","3":"0.00057","4":"0.00057","5":"0.50","6":"98728","7":"56","8":"98700","9":"5474686","10":"55.45","_rn_":"9573"},{"1":"2008","2":"27","3":"0.00050","4":"0.00050","5":"0.50","6":"98717","7":"49","8":"98693","9":"5394059","10":"54.64","_rn_":"9685"},{"1":"2009","2":"28","3":"0.00050","4":"0.00050","5":"0.50","6":"98709","7":"49","8":"98684","9":"5327781","10":"53.97","_rn_":"9797"},{"1":"2010","2":"29","3":"0.00056","4":"0.00056","5":"0.50","6":"98664","7":"56","8":"98636","9":"5256681","10":"53.28","_rn_":"9909"},{"1":"2011","2":"30","3":"0.00056","4":"0.00056","5":"0.50","6":"98624","7":"55","8":"98596","9":"5174985","10":"52.47","_rn_":"10021"},{"1":"2012","2":"31","3":"0.00058","4":"0.00058","5":"0.50","6":"98579","7":"57","8":"98551","9":"5094853","10":"51.68","_rn_":"10133"},{"1":"2013","2":"32","3":"0.00064","4":"0.00064","5":"0.50","6":"98532","7":"63","8":"98500","9":"5005052","10":"50.80","_rn_":"10245"},{"1":"2014","2":"33","3":"0.00077","4":"0.00077","5":"0.50","6":"98474","7":"76","8":"98436","9":"4910497","10":"49.87","_rn_":"10357"},{"1":"2015","2":"34","3":"0.00073","4":"0.00073","5":"0.50","6":"98374","7":"72","8":"98338","9":"4819383","10":"48.99","_rn_":"10469"},{"1":"2016","2":"35","3":"0.00083","4":"0.00083","5":"0.50","6":"98252","7":"81","8":"98211","9":"4733277","10":"48.17","_rn_":"10581"},{"1":"2017","2":"36","3":"0.00094","4":"0.00094","5":"0.50","6":"98049","7":"92","8":"98003","9":"4624539","10":"47.17","_rn_":"10693"},{"1":"2018","2":"37","3":"0.00098","4":"0.00098","5":"0.50","6":"97930","7":"96","8":"97882","9":"4528434","10":"46.24","_rn_":"10805"},{"1":"2019","2":"38","3":"0.00097","4":"0.00097","5":"0.50","6":"97963","7":"95","8":"97916","9":"4464141","10":"45.57","_rn_":"10917"},{"1":"2020","2":"39","3":"0.00123","4":"0.00123","5":"0.50","6":"97569","7":"120","8":"97509","9":"4305572","10":"44.13","_rn_":"11029"},{"1":"2021","2":"40","3":"0.00157","4":"0.00157","5":"0.50","6":"97306","7":"153","8":"97230","9":"4207847","10":"43.24","_rn_":"11141"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="section-cohort-one-year-survival-probabilities"
class="section level4" number="3.2.7.4">
<h4><span class="header-section-number">3.2.7.4</span> 1981 cohort
one-year survival probabilities</h4>
<div class="sourceCode" id="section-cb95"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb95-1"><a href="#section-cb95-1" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> life_table_1981<span class="sc">$</span>qx</span></code></pre></div>
</div>
<div
id="section-cohort-survival-probability-that-18-survives-5-more-years"
class="section level4" number="3.2.7.5">
<h4><span class="header-section-number">3.2.7.5</span> 1981 cohort
survival probability that (18) survives 5 more years</h4>
<div class="sourceCode" id="section-cb96"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb96-1"><a href="#section-cb96-1" tabindex="-1"></a><span class="fu">prod</span>(px[(<span class="dv">18</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">22</span> <span class="sc">+</span> <span class="dv">1</span>)])</span></code></pre></div>
<pre><code>## [1] 0.9970136</code></pre>
</div>
<div
id="section-cohort-survival-probability-that-18-survives-5-more-years-1"
class="section level4" number="3.2.7.6">
<h4><span class="header-section-number">3.2.7.6</span> 1881 cohort
survival probability that (18) survives 5 more years</h4>
<div class="sourceCode" id="section-cb98"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb98-1"><a href="#section-cb98-1" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">subset</span>(life_table, Year <span class="sc">-</span> Age <span class="sc">==</span> <span class="dv">1881</span>), <span class="fu">prod</span>(<span class="dv">1</span> <span class="sc">-</span> qx[(<span class="dv">18</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">22</span> <span class="sc">+</span> <span class="dv">1</span>)]))</span></code></pre></div>
<pre><code>## [1] 0.9124045</code></pre>
</div>
<div id="section-pv-of-guaranteed-payment-of-10000-in-5-years"
class="section level4" number="3.2.7.7">
<h4><span class="header-section-number">3.2.7.7</span> PV of guaranteed
payment of 10,000 in 5 years</h4>
<div class="sourceCode" id="section-cb100"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb100-1"><a href="#section-cb100-1" tabindex="-1"></a>PV <span class="ot">&lt;-</span> <span class="dv">10000</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.02</span>) <span class="sc">^</span> <span class="sc">-</span><span class="dv">5</span></span>
<span id="section-cb100-2"><a href="#section-cb100-2" tabindex="-1"></a>PV</span></code></pre></div>
<pre><code>## [1] 9057.308</code></pre>
</div>
<div id="section-year-survival-probabilities-of-20"
class="section level4" number="3.2.7.8">
<h4><span class="header-section-number">3.2.7.8</span> 5 year survival
probabilities of (20)</h4>
<div class="sourceCode" id="section-cb102"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb102-1"><a href="#section-cb102-1" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">prod</span>(px[(<span class="dv">20</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">24</span> <span class="sc">+</span> <span class="dv">1</span>)])</span></code></pre></div>
</div>
<div id="section-epv-of-pure-endowment-of-10000-in-5-years-for-20"
class="section level4" number="3.2.7.9">
<h4><span class="header-section-number">3.2.7.9</span> EPV of pure
endowment of 10,000 in 5 years for (20)</h4>
<div class="sourceCode" id="section-cb103"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb103-1"><a href="#section-cb103-1" tabindex="-1"></a>PV <span class="sc">*</span> kpx</span></code></pre></div>
<pre><code>## [1] 9031.705</code></pre>
</div>
</div>
</div>
</div>
<div id="section-life-annuities" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Life Annuities</h1>
<div
id="section-pv-of-guaranteed-payments-of-10000-in-5-10-and-30-years"
class="section level4" number="4.0.0.1">
<h4><span class="header-section-number">4.0.0.1</span> PV of guaranteed
payments of 10,000 in 5, 10 and 30 years</h4>
<div class="sourceCode" id="section-cb105"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb105-1"><a href="#section-cb105-1" tabindex="-1"></a>PV <span class="ot">&lt;-</span> <span class="dv">10000</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.02</span>) <span class="sc">^</span> <span class="sc">-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">30</span>)</span>
<span id="section-cb105-2"><a href="#section-cb105-2" tabindex="-1"></a>PV</span></code></pre></div>
<pre><code>## [1] 9057.308 8203.483 5520.709</code></pre>
</div>
<div id="section-survival-probabilities-of-20" class="section level4"
number="4.0.0.2">
<h4><span class="header-section-number">4.0.0.2</span> Survival
probabilities of (20)</h4>
<div class="sourceCode" id="section-cb107"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb107-1"><a href="#section-cb107-1" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(px[(<span class="dv">20</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(px)])</span></code></pre></div>
</div>
<div
id="section-epv-of-pure-endowments-of-10000-in-5-10-and-30-years-for-20"
class="section level4" number="4.0.0.3">
<h4><span class="header-section-number">4.0.0.3</span> EPV of pure
endowments of 10,000 in 5, 10 and 30 years for (20)</h4>
<div class="sourceCode" id="section-cb108"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb108-1"><a href="#section-cb108-1" tabindex="-1"></a>PV <span class="sc">*</span> kpx[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">30</span>)]</span></code></pre></div>
<pre><code>## [1] 9031.705 8158.312       NA</code></pre>
</div>
<div id="section-whole-life-annuity-due" class="section level2"
number="4.1">
<h2><span class="header-section-number">4.1</span> Whole Life Annuity
Due</h2>
<p>A type of annuity where payments are made at the beginning of each
period, starting immediately upon purchase and continuing for the
lifetime of the annuitant. Payments start immediately and occur at the
beginning of each payment period (e.g., monthly, annually)</p>
<div
id="section-calculating-the-whole-life-annuity-due-of-a-35-year-old"
class="section level4" number="4.1.0.1">
<h4><span class="header-section-number">4.1.0.1</span> Calculating the
whole life annuity due of a 35 year old</h4>
<div class="sourceCode" id="section-cb110"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb110-1"><a href="#section-cb110-1" tabindex="-1"></a>kpx <span class="ot">&lt;-</span></span>
<span id="section-cb110-2"><a href="#section-cb110-2" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(<span class="dv">35</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(px)]))</span>
<span id="section-cb110-3"><a href="#section-cb110-3" tabindex="-1"></a>discount_facotrs <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="fl">+0.03</span>)<span class="sc">^-</span>(<span class="dv">0</span><span class="sc">:</span>(<span class="fu">length</span>(kpx)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="section-cb110-4"><a href="#section-cb110-4" tabindex="-1"></a>benefits <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">length</span>(kpx))</span>
<span id="section-cb110-5"><a href="#section-cb110-5" tabindex="-1"></a><span class="fu">sum</span>(benefits<span class="sc">*</span>discount_factors<span class="sc">*</span>kpx)</span></code></pre></div>
<pre><code>## Warning in benefits * discount_factors: longer object length is not a multiple of shorter object length</code></pre>
<pre><code>## Warning in benefits * discount_factors * kpx: longer object length is not a multiple of shorter object length</code></pre>
<pre><code>## [1] 145.9806</code></pre>
</div>
</div>
<div id="section-whole-life-immediate-annuity" class="section level2"
number="4.2">
<h2><span class="header-section-number">4.2</span> Whole Life Immediate
Annuity</h2>
<p>A type of annuity where payments are made at the end of each period,
starting immediately upon purchase and continuing for the lifetime of
the annuitant. Payments start immediately but occur at the end of each
payment period (e.g., monthly, annually).</p>
<div
id="section-calculating-the-whole-life-immediate-annuity-of-a-35-year-old"
class="section level4" number="4.2.0.1">
<h4><span class="header-section-number">4.2.0.1</span> Calculating the
whole life immediate annuity of a 35 year old</h4>
<div class="sourceCode" id="section-cb114"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb114-1"><a href="#section-cb114-1" tabindex="-1"></a>kpx <span class="ot">&lt;-</span></span>
<span id="section-cb114-2"><a href="#section-cb114-2" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(<span class="dv">35</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(px)]))</span>
<span id="section-cb114-3"><a href="#section-cb114-3" tabindex="-1"></a>discount_facotrs <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="fl">+0.03</span>)<span class="sc">^-</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(kpx)))</span>
<span id="section-cb114-4"><a href="#section-cb114-4" tabindex="-1"></a>benefits <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">length</span>(kpx))</span>
<span id="section-cb114-5"><a href="#section-cb114-5" tabindex="-1"></a><span class="fu">sum</span>(benefits<span class="sc">*</span>discount_factors<span class="sc">*</span>kpx)</span></code></pre></div>
<pre><code>## Warning in benefits * discount_factors: longer object length is not a multiple of shorter object length</code></pre>
<pre><code>## Warning in benefits * discount_factors * kpx: longer object length is not a multiple of shorter object length</code></pre>
<pre><code>## [1] 145.9806</code></pre>
</div>
</div>
<div id="section-expected-present-value" class="section level2"
number="4.3">
<h2><span class="header-section-number">4.3</span> Expected Present
Value</h2>
<div
id="section-function-to-compute-the-epv-of-a-whole-life-annuity-due-for-a-given-age-interest-rate-i-and-life-table"
class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Function to compute
the EPV of a whole life annuity due for a given age, interest rate i and
life table</h3>
<div class="sourceCode" id="section-cb118"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb118-1"><a href="#section-cb118-1" tabindex="-1"></a>life_annuity_due <span class="ot">&lt;-</span> <span class="cf">function</span>(age, i, life_table) {</span>
<span id="section-cb118-2"><a href="#section-cb118-2" tabindex="-1"></a>  px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> life_table<span class="sc">$</span>qx</span>
<span id="section-cb118-3"><a href="#section-cb118-3" tabindex="-1"></a>  kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(px)]))</span>
<span id="section-cb118-4"><a href="#section-cb118-4" tabindex="-1"></a>  discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">0</span><span class="sc">:</span>(<span class="fu">length</span>(kpx) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="section-cb118-5"><a href="#section-cb118-5" tabindex="-1"></a>  <span class="fu">sum</span>(discount_factors <span class="sc">*</span> kpx)</span>
<span id="section-cb118-6"><a href="#section-cb118-6" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="section-shiny-app-for-life-annuity-calculator"
class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Shiny App for Life
Annuity Calculator</h2>
<div class="sourceCode" id="section-cb119"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb119-1"><a href="#section-cb119-1" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="section-cb119-2"><a href="#section-cb119-2" tabindex="-1"></a></span>
<span id="section-cb119-3"><a href="#section-cb119-3" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="section-cb119-4"><a href="#section-cb119-4" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Life Annuity Calculator&quot;</span>),</span>
<span id="section-cb119-5"><a href="#section-cb119-5" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="section-cb119-6"><a href="#section-cb119-6" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="section-cb119-7"><a href="#section-cb119-7" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;Age:&quot;</span>, <span class="dv">20</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">110</span>),</span>
<span id="section-cb119-8"><a href="#section-cb119-8" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;interest&quot;</span>, <span class="st">&quot;Interest Rate:&quot;</span>, <span class="fl">0.02</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="fl">0.2</span>, <span class="at">step =</span> <span class="fl">0.001</span>),</span>
<span id="section-cb119-9"><a href="#section-cb119-9" tabindex="-1"></a>      <span class="fu">radioButtons</span>(<span class="st">&quot;type&quot;</span>, <span class="st">&quot;Annuity Type:&quot;</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">&quot;Due&quot;</span> <span class="ot">=</span> <span class="st">&quot;due&quot;</span>, <span class="st">&quot;Immediate&quot;</span> <span class="ot">=</span> <span class="st">&quot;immediate&quot;</span>))</span>
<span id="section-cb119-10"><a href="#section-cb119-10" tabindex="-1"></a>    ),</span>
<span id="section-cb119-11"><a href="#section-cb119-11" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="section-cb119-12"><a href="#section-cb119-12" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">&quot;Expected Present Value:&quot;</span>),</span>
<span id="section-cb119-13"><a href="#section-cb119-13" tabindex="-1"></a>      <span class="fu">textOutput</span>(<span class="st">&quot;epv&quot;</span>)</span>
<span id="section-cb119-14"><a href="#section-cb119-14" tabindex="-1"></a>    )</span>
<span id="section-cb119-15"><a href="#section-cb119-15" tabindex="-1"></a>  )</span>
<span id="section-cb119-16"><a href="#section-cb119-16" tabindex="-1"></a>)</span>
<span id="section-cb119-17"><a href="#section-cb119-17" tabindex="-1"></a></span>
<span id="section-cb119-18"><a href="#section-cb119-18" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="section-cb119-19"><a href="#section-cb119-19" tabindex="-1"></a>  output<span class="sc">$</span>epv <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="section-cb119-20"><a href="#section-cb119-20" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;due&quot;</span>) {</span>
<span id="section-cb119-21"><a href="#section-cb119-21" tabindex="-1"></a>      epv <span class="ot">&lt;-</span> <span class="fu">life_annuity_due</span>(input<span class="sc">$</span>age, input<span class="sc">$</span>interest, life_table)</span>
<span id="section-cb119-22"><a href="#section-cb119-22" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="section-cb119-23"><a href="#section-cb119-23" tabindex="-1"></a>      epv <span class="ot">&lt;-</span> <span class="fu">life_immediate_annuity</span>(input<span class="sc">$</span>age, input<span class="sc">$</span>interest, life_table)</span>
<span id="section-cb119-24"><a href="#section-cb119-24" tabindex="-1"></a>    }</span>
<span id="section-cb119-25"><a href="#section-cb119-25" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;$&quot;</span>, <span class="fu">round</span>(epv, <span class="dv">2</span>))</span>
<span id="section-cb119-26"><a href="#section-cb119-26" tabindex="-1"></a>  })</span>
<span id="section-cb119-27"><a href="#section-cb119-27" tabindex="-1"></a>}</span>
<span id="section-cb119-28"><a href="#section-cb119-28" tabindex="-1"></a></span>
<span id="section-cb119-29"><a href="#section-cb119-29" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<iframe data-deferred-src="app6019df57f827768df0d1f6d2e2ce4022/?w=&amp;__subapp__=1" width="100%" height="400" class="shiny-frame shiny-frame-deferred"></iframe>
<div
id="section-epv-of-a-whole-life-annuity-due-for-20-at-interest-rate-2-using-life_table"
class="section level4" number="4.4.0.1">
<h4><span class="header-section-number">4.4.0.1</span> EPV of a whole
life annuity due for (20) at interest rate 2% using life_table</h4>
<div class="sourceCode" id="section-cb120"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb120-1"><a href="#section-cb120-1" tabindex="-1"></a><span class="fu">life_annuity_due</span>(<span class="dv">20</span>, <span class="fl">0.02</span>, life_table)</span></code></pre></div>
<pre><code>## [1] 30.5222</code></pre>
</div>
<div
id="section-epv-of-a-whole-life-annuity-due-for-20-at-interest-rate-5-and-for-65-at-interest-rate-2-using-life_table"
class="section level4" number="4.4.0.2">
<h4><span class="header-section-number">4.4.0.2</span> EPV of a whole
life annuity due for (20) at interest rate 5% and for (65) at interest
rate 2% using life_table</h4>
<div class="sourceCode" id="section-cb122"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb122-1"><a href="#section-cb122-1" tabindex="-1"></a><span class="fu">life_annuity_due</span>(<span class="dv">20</span>, <span class="fl">0.05</span>, life_table)</span></code></pre></div>
<pre><code>## [1] 18.09666</code></pre>
<div class="sourceCode" id="section-cb124"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb124-1"><a href="#section-cb124-1" tabindex="-1"></a><span class="fu">life_annuity_due</span>(<span class="dv">65</span>, <span class="fl">0.02</span>, life_table)</span></code></pre></div>
<pre><code>## [1] 11.94589</code></pre>
</div>
<div
id="section-epv-of-a-whole-life-annuity-due-for-20-at-interest-rate-2-using-life_table-1"
class="section level4" number="4.4.0.3">
<h4><span class="header-section-number">4.4.0.3</span> EPV of a whole
life annuity due for (20) at interest rate 2% using life_table</h4>
<div class="sourceCode" id="section-cb126"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb126-1"><a href="#section-cb126-1" tabindex="-1"></a><span class="fu">life_annuity_due</span>(<span class="dv">20</span>, <span class="fl">0.02</span>, life_table)</span></code></pre></div>
<pre><code>## [1] 30.5222</code></pre>
</div>
<div
id="section-function-to-compute-the-epv-of-a-whole-life-immediate-annuity-for-a-given-age-interest-rate-i-and-life-table"
class="section level3" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Function to compute
the EPV of a whole life immediate annuity for a given age, interest rate
i and life table</h3>
<div class="sourceCode" id="section-cb128"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb128-1"><a href="#section-cb128-1" tabindex="-1"></a>life_immediate_annuity <span class="ot">&lt;-</span> <span class="cf">function</span>(age, i, life_table) {</span>
<span id="section-cb128-2"><a href="#section-cb128-2" tabindex="-1"></a>  px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> life_table<span class="sc">$</span>qx</span>
<span id="section-cb128-3"><a href="#section-cb128-3" tabindex="-1"></a>  kpx <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(px[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(px)])</span>
<span id="section-cb128-4"><a href="#section-cb128-4" tabindex="-1"></a>  discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(kpx))</span>
<span id="section-cb128-5"><a href="#section-cb128-5" tabindex="-1"></a>  <span class="fu">sum</span>(discount_factors <span class="sc">*</span> kpx)</span>
<span id="section-cb128-6"><a href="#section-cb128-6" tabindex="-1"></a>}</span></code></pre></div>
<div
id="section-epv-of-a-whole-life-immediate-annuity-for-20-at-interest-rate-2-using-life_table"
class="section level4" number="4.4.1.1">
<h4><span class="header-section-number">4.4.1.1</span> EPV of a whole
life immediate annuity for (20) at interest rate 2% using
life_table</h4>
<div class="sourceCode" id="section-cb129"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb129-1"><a href="#section-cb129-1" tabindex="-1"></a><span class="fu">life_immediate_annuity</span>(<span class="dv">20</span>, <span class="fl">0.02</span>, life_table)</span></code></pre></div>
<pre><code>## [1] 29.5222</code></pre>
</div>
<div
id="section-epv-of-a-whole-life-annuity-due-for-20-at-interest-rate-2-using-life_table-2"
class="section level4" number="4.4.1.2">
<h4><span class="header-section-number">4.4.1.2</span> EPV of a whole
life annuity due for (20) at interest rate 2% using life_table</h4>
<div class="sourceCode" id="section-cb131"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb131-1"><a href="#section-cb131-1" tabindex="-1"></a><span class="fu">life_annuity_due</span>(<span class="dv">20</span>, <span class="fl">0.02</span>, life_table)</span></code></pre></div>
<pre><code>## [1] 30.5222</code></pre>
</div>
</div>
<div
id="section-function-to-compute-the-epv-of-a-temporary-life-annuity-due-for-a-given-age-period-of-n-years-interest-rate-i-and-life-table"
class="section level3" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Function to compute
the EPV of a temporary life annuity due for a given age, period of n
years, interest rate i and life table</h3>
<div class="sourceCode" id="section-cb133"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb133-1"><a href="#section-cb133-1" tabindex="-1"></a>temporary_life_annuity_due <span class="ot">&lt;-</span> <span class="cf">function</span>(age, n, i, life_table) {</span>
<span id="section-cb133-2"><a href="#section-cb133-2" tabindex="-1"></a>  px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> life_table<span class="sc">$</span>qx</span>
<span id="section-cb133-3"><a href="#section-cb133-3" tabindex="-1"></a>  kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(age <span class="sc">+</span> n <span class="sc">-</span> <span class="dv">1</span>)]))</span>
<span id="section-cb133-4"><a href="#section-cb133-4" tabindex="-1"></a>  discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">0</span><span class="sc">:</span>(n <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="section-cb133-5"><a href="#section-cb133-5" tabindex="-1"></a>  <span class="fu">sum</span>(discount_factors <span class="sc">*</span> kpx)</span>
<span id="section-cb133-6"><a href="#section-cb133-6" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="section-shiny-app-for-temporary-life-annuity-calculator"
class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Shiny app for
Temporary Life Annuity Calculator</h2>
<div class="sourceCode" id="section-cb134"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb134-1"><a href="#section-cb134-1" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="section-cb134-2"><a href="#section-cb134-2" tabindex="-1"></a></span>
<span id="section-cb134-3"><a href="#section-cb134-3" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="section-cb134-4"><a href="#section-cb134-4" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Temporary Life Annuity Calculator&quot;</span>),</span>
<span id="section-cb134-5"><a href="#section-cb134-5" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="section-cb134-6"><a href="#section-cb134-6" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="section-cb134-7"><a href="#section-cb134-7" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;Age:&quot;</span>, <span class="dv">20</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">110</span>),</span>
<span id="section-cb134-8"><a href="#section-cb134-8" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;term&quot;</span>, <span class="st">&quot;Term (years):&quot;</span>, <span class="dv">10</span>, <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">50</span>),</span>
<span id="section-cb134-9"><a href="#section-cb134-9" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;interest&quot;</span>, <span class="st">&quot;Interest Rate:&quot;</span>, <span class="fl">0.02</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="fl">0.2</span>, <span class="at">step =</span> <span class="fl">0.001</span>)</span>
<span id="section-cb134-10"><a href="#section-cb134-10" tabindex="-1"></a>    ),</span>
<span id="section-cb134-11"><a href="#section-cb134-11" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="section-cb134-12"><a href="#section-cb134-12" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">&quot;Expected Present Value:&quot;</span>),</span>
<span id="section-cb134-13"><a href="#section-cb134-13" tabindex="-1"></a>      <span class="fu">textOutput</span>(<span class="st">&quot;epv&quot;</span>)</span>
<span id="section-cb134-14"><a href="#section-cb134-14" tabindex="-1"></a>    )</span>
<span id="section-cb134-15"><a href="#section-cb134-15" tabindex="-1"></a>  )</span>
<span id="section-cb134-16"><a href="#section-cb134-16" tabindex="-1"></a>)</span>
<span id="section-cb134-17"><a href="#section-cb134-17" tabindex="-1"></a></span>
<span id="section-cb134-18"><a href="#section-cb134-18" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="section-cb134-19"><a href="#section-cb134-19" tabindex="-1"></a>  output<span class="sc">$</span>epv <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="section-cb134-20"><a href="#section-cb134-20" tabindex="-1"></a>    epv <span class="ot">&lt;-</span> <span class="fu">temporary_life_annuity_due</span>(input<span class="sc">$</span>age, input<span class="sc">$</span>term, input<span class="sc">$</span>interest, life_table)</span>
<span id="section-cb134-21"><a href="#section-cb134-21" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;$&quot;</span>, <span class="fu">round</span>(epv, <span class="dv">2</span>))</span>
<span id="section-cb134-22"><a href="#section-cb134-22" tabindex="-1"></a>  })</span>
<span id="section-cb134-23"><a href="#section-cb134-23" tabindex="-1"></a>}</span>
<span id="section-cb134-24"><a href="#section-cb134-24" tabindex="-1"></a></span>
<span id="section-cb134-25"><a href="#section-cb134-25" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<iframe data-deferred-src="app62d6f20a6305e5dbba4f80aedd971f0c/?w=&amp;__subapp__=1" width="100%" height="400" class="shiny-frame shiny-frame-deferred"></iframe>
<div
id="section-epv-of-a-temporary-life-annuity-due-for-20-over-10-years-at-interest-rate-2-using-life_table"
class="section level3" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> EPV of a temporary
life annuity due for (20) over 10 years at interest rate 2% using
life_table</h3>
<div class="sourceCode" id="section-cb135"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb135-1"><a href="#section-cb135-1" tabindex="-1"></a><span class="fu">temporary_life_annuity_due</span>(<span class="dv">20</span>, <span class="dv">10</span>, <span class="fl">0.02</span>, life_table)</span></code></pre></div>
<pre><code>## [1] 9.002238</code></pre>
</div>
</div>
<div id="section-pension-valuation" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Pension
Valuation</h2>
<div id="section-calculating-the-pv-of-a-pension-at-age-65"
class="section level3" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Calculating the PV
of a pension at age 65</h3>
<div class="sourceCode" id="section-cb137"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb137-1"><a href="#section-cb137-1" tabindex="-1"></a>benefits <span class="ot">&lt;-</span> <span class="dv">20000</span> <span class="sc">*</span> <span class="fl">1.02</span> <span class="sc">^</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">35</span>)</span>
<span id="section-cb137-2"><a href="#section-cb137-2" tabindex="-1"></a></span>
<span id="section-cb137-3"><a href="#section-cb137-3" tabindex="-1"></a></span>
<span id="section-cb137-4"><a href="#section-cb137-4" tabindex="-1"></a><span class="co"># Discount factors (to age 65)</span></span>
<span id="section-cb137-5"><a href="#section-cb137-5" tabindex="-1"></a></span>
<span id="section-cb137-6"><a href="#section-cb137-6" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> <span class="fl">1.04</span> <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">35</span>)</span>
<span id="section-cb137-7"><a href="#section-cb137-7" tabindex="-1"></a></span>
<span id="section-cb137-8"><a href="#section-cb137-8" tabindex="-1"></a></span>
<span id="section-cb137-9"><a href="#section-cb137-9" tabindex="-1"></a><span class="co"># PV of pension at age 65</span></span>
<span id="section-cb137-10"><a href="#section-cb137-10" tabindex="-1"></a></span>
<span id="section-cb137-11"><a href="#section-cb137-11" tabindex="-1"></a>PV_65 <span class="ot">&lt;-</span> <span class="fu">sum</span>(benefits <span class="sc">*</span> discount_factors)</span>
<span id="section-cb137-12"><a href="#section-cb137-12" tabindex="-1"></a>PV_65</span></code></pre></div>
<pre><code>## [1] 523061</code></pre>
<div class="sourceCode" id="section-cb139"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb139-1"><a href="#section-cb139-1" tabindex="-1"></a><span class="co"># PV of pension at age 20</span></span>
<span id="section-cb139-2"><a href="#section-cb139-2" tabindex="-1"></a></span>
<span id="section-cb139-3"><a href="#section-cb139-3" tabindex="-1"></a>PV_20 <span class="ot">&lt;-</span> PV_65 <span class="sc">*</span> <span class="fl">1.03</span> <span class="sc">^</span> <span class="sc">-</span> <span class="dv">45</span></span>
<span id="section-cb139-4"><a href="#section-cb139-4" tabindex="-1"></a>PV_20</span></code></pre></div>
<pre><code>## [1] 138317.5</code></pre>
</div>
<div id="section-epv-of-pension-at-age-20" class="section level3"
number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> EPV of pension at
age 20</h3>
<div class="sourceCode" id="section-cb141"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb141-1"><a href="#section-cb141-1" tabindex="-1"></a><span class="co"># Survival probabilities of (65) up to age 100</span></span>
<span id="section-cb141-2"><a href="#section-cb141-2" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> life_table<span class="sc">$</span>qx</span>
<span id="section-cb141-3"><a href="#section-cb141-3" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(<span class="dv">65</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">99</span> <span class="sc">+</span> <span class="dv">1</span>)]))</span>
<span id="section-cb141-4"><a href="#section-cb141-4" tabindex="-1"></a></span>
<span id="section-cb141-5"><a href="#section-cb141-5" tabindex="-1"></a></span>
<span id="section-cb141-6"><a href="#section-cb141-6" tabindex="-1"></a><span class="co"># EPV of pension at age 65</span></span>
<span id="section-cb141-7"><a href="#section-cb141-7" tabindex="-1"></a></span>
<span id="section-cb141-8"><a href="#section-cb141-8" tabindex="-1"></a>EPV_65 <span class="ot">&lt;-</span> <span class="fu">sum</span>(benefits <span class="sc">*</span> discount_factors <span class="sc">*</span> kpx)</span>
<span id="section-cb141-9"><a href="#section-cb141-9" tabindex="-1"></a><span class="fu">cbind</span>(PV_65, EPV_65)</span></code></pre></div>
<pre><code>##       PV_65   EPV_65
## [1,] 523061 239587.2</code></pre>
<div class="sourceCode" id="section-cb143"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb143-1"><a href="#section-cb143-1" tabindex="-1"></a><span class="co"># EPV of pension at age 20</span></span>
<span id="section-cb143-2"><a href="#section-cb143-2" tabindex="-1"></a></span>
<span id="section-cb143-3"><a href="#section-cb143-3" tabindex="-1"></a>EPV_20 <span class="ot">&lt;-</span> EPV_65 <span class="sc">*</span> (<span class="fl">1.03</span> <span class="sc">^</span> <span class="sc">-</span> <span class="dv">45</span> <span class="sc">*</span> <span class="fu">prod</span>(px[(<span class="dv">20</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">64</span> <span class="sc">+</span> <span class="dv">1</span>)]))</span>
<span id="section-cb143-4"><a href="#section-cb143-4" tabindex="-1"></a><span class="fu">cbind</span>(PV_20, EPV_20)</span></code></pre></div>
<pre><code>##         PV_20   EPV_20
## [1,] 138317.5 42596.32</code></pre>
</div>
<div id="section-retirement-plan" class="section level3" number="4.6.3">
<h3><span class="header-section-number">4.6.3</span> Retirement
Plan</h3>
<p>You’re planning for your retirement at age 40. You want to buy an
annuity that will provide you 10000 annually for life, starting at age
65. If you die before the annuity starts, you get paid nothing.</p>
<div class="sourceCode" id="section-cb145"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb145-1"><a href="#section-cb145-1" tabindex="-1"></a><span class="co"># Survival probabilities of (40)</span></span>
<span id="section-cb145-2"><a href="#section-cb145-2" tabindex="-1"></a></span>
<span id="section-cb145-3"><a href="#section-cb145-3" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(<span class="dv">40</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(px)]))</span>
<span id="section-cb145-4"><a href="#section-cb145-4" tabindex="-1"></a></span>
<span id="section-cb145-5"><a href="#section-cb145-5" tabindex="-1"></a></span>
<span id="section-cb145-6"><a href="#section-cb145-6" tabindex="-1"></a><span class="co"># Discount factors (to age 40)</span></span>
<span id="section-cb145-7"><a href="#section-cb145-7" tabindex="-1"></a></span>
<span id="section-cb145-8"><a href="#section-cb145-8" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.03</span>) <span class="sc">^</span> <span class="sc">-</span>(<span class="dv">0</span><span class="sc">:</span>(<span class="fu">length</span>(kpx) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="section-cb145-9"><a href="#section-cb145-9" tabindex="-1"></a></span>
<span id="section-cb145-10"><a href="#section-cb145-10" tabindex="-1"></a></span>
<span id="section-cb145-11"><a href="#section-cb145-11" tabindex="-1"></a><span class="co"># Pension benefits</span></span>
<span id="section-cb145-12"><a href="#section-cb145-12" tabindex="-1"></a></span>
<span id="section-cb145-13"><a href="#section-cb145-13" tabindex="-1"></a>benefits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">25</span>), <span class="fu">rep</span>(<span class="dv">10000</span>, <span class="fu">length</span>(kpx) <span class="sc">-</span> <span class="dv">25</span>))</span>
<span id="section-cb145-14"><a href="#section-cb145-14" tabindex="-1"></a></span>
<span id="section-cb145-15"><a href="#section-cb145-15" tabindex="-1"></a></span>
<span id="section-cb145-16"><a href="#section-cb145-16" tabindex="-1"></a><span class="co"># The single premium</span></span>
<span id="section-cb145-17"><a href="#section-cb145-17" tabindex="-1"></a></span>
<span id="section-cb145-18"><a href="#section-cb145-18" tabindex="-1"></a>single_premium <span class="ot">&lt;-</span> <span class="fu">sum</span>(benefits <span class="sc">*</span> discount_factors <span class="sc">*</span> kpx)</span>
<span id="section-cb145-19"><a href="#section-cb145-19" tabindex="-1"></a>single_premium</span></code></pre></div>
<pre><code>## [1] 38954.59</code></pre>
<p>Suppose you want to finance this deferred life annuity with annual
premiums payable for 25 years beginning at age 40. However, you plan to
reduce your work hours from age 55 onwards, therefore the premium will
reduce by 1 half after 15 years. What is the initial premium you will
pay</p>
<div class="sourceCode" id="section-cb147"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb147-1"><a href="#section-cb147-1" tabindex="-1"></a><span class="co"># Premium pattern rho</span></span>
<span id="section-cb147-2"><a href="#section-cb147-2" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">15</span>), <span class="fu">rep</span>(<span class="fl">0.5</span>, <span class="dv">10</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(kpx) <span class="sc">-</span> <span class="dv">25</span>))</span>
<span id="section-cb147-3"><a href="#section-cb147-3" tabindex="-1"></a></span>
<span id="section-cb147-4"><a href="#section-cb147-4" tabindex="-1"></a><span class="co"># The initial premium</span></span>
<span id="section-cb147-5"><a href="#section-cb147-5" tabindex="-1"></a>initial_premium <span class="ot">&lt;-</span> single_premium <span class="sc">/</span> <span class="fu">sum</span>(rho <span class="sc">*</span> discount_factors <span class="sc">*</span> kpx, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="section-cb147-6"><a href="#section-cb147-6" tabindex="-1"></a>initial_premium</span></code></pre></div>
<pre><code>## [1] 2763.3</code></pre>
<div class="sourceCode" id="section-cb149"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb149-1"><a href="#section-cb149-1" tabindex="-1"></a><span class="co"># The annual premiums</span></span>
<span id="section-cb149-2"><a href="#section-cb149-2" tabindex="-1"></a>annual_premiums <span class="ot">&lt;-</span> initial_premium <span class="sc">*</span> rho</span>
<span id="section-cb149-3"><a href="#section-cb149-3" tabindex="-1"></a></span>
<span id="section-cb149-4"><a href="#section-cb149-4" tabindex="-1"></a><span class="co"># Filter out the zero values from the annual premiums</span></span>
<span id="section-cb149-5"><a href="#section-cb149-5" tabindex="-1"></a>filtered_annual_premiums <span class="ot">&lt;-</span> annual_premiums[annual_premiums <span class="sc">!=</span> <span class="dv">0</span>]</span>
<span id="section-cb149-6"><a href="#section-cb149-6" tabindex="-1"></a></span>
<span id="section-cb149-7"><a href="#section-cb149-7" tabindex="-1"></a><span class="co"># Sum of the annual premiums (no actuarial discounting)</span></span>
<span id="section-cb149-8"><a href="#section-cb149-8" tabindex="-1"></a><span class="fu">sum</span>(filtered_annual_premiums)</span></code></pre></div>
<pre><code>## [1] 55266</code></pre>
<p>Find out if this product would be a favorable deal for you. How much
would you receive if you died instead at 75, or 95?</p>
<div class="sourceCode" id="section-cb151"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb151-1"><a href="#section-cb151-1" tabindex="-1"></a><span class="co"># Curtate life expectancy of (40)</span></span>
<span id="section-cb151-2"><a href="#section-cb151-2" tabindex="-1"></a><span class="fu">sum</span>(kpx[<span class="sc">-</span><span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] 31.9023</code></pre>
<div class="sourceCode" id="section-cb153"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb153-1"><a href="#section-cb153-1" tabindex="-1"></a><span class="co"># Present value of annuity benefits when (40) lives until age 75</span></span>
<span id="section-cb153-2"><a href="#section-cb153-2" tabindex="-1"></a>subset1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">36</span></span>
<span id="section-cb153-3"><a href="#section-cb153-3" tabindex="-1"></a><span class="fu">sum</span>(benefits[subset1] <span class="sc">*</span> discount_factors[subset1])</span></code></pre></div>
<pre><code>## [1] 45516.78</code></pre>
<div class="sourceCode" id="section-cb155"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb155-1"><a href="#section-cb155-1" tabindex="-1"></a><span class="co"># Present value of annuity benefits when (40) lives until age 95</span></span>
<span id="section-cb155-2"><a href="#section-cb155-2" tabindex="-1"></a>subset2 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">56</span></span>
<span id="section-cb155-3"><a href="#section-cb155-3" tabindex="-1"></a><span class="fu">sum</span>(benefits[subset2] <span class="sc">*</span> discount_factors[subset2])</span></code></pre></div>
<pre><code>## [1] 98388.86</code></pre>
</div>
</div>
</div>
<div id="section-life-insurance" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Life Insurance</h1>
<p>You have bought a life insurance that is sold to 20 year olds and
will pay 10000 at the end of the year of death if your death occurs at
age 30. How much is the expected present value (EPV)</p>
<div class="sourceCode" id="section-cb157"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb157-1"><a href="#section-cb157-1" tabindex="-1"></a><span class="co"># 10-year survival probability of (20)</span></span>
<span id="section-cb157-2"><a href="#section-cb157-2" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">prod</span>(px[(<span class="dv">20</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">29</span> <span class="sc">+</span> <span class="dv">1</span>)])</span>
<span id="section-cb157-3"><a href="#section-cb157-3" tabindex="-1"></a>kpx</span></code></pre></div>
<pre><code>## [1] 0.9589195</code></pre>
<div class="sourceCode" id="section-cb159"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb159-1"><a href="#section-cb159-1" tabindex="-1"></a><span class="co"># 10-year deferred mortality probability of (20)</span></span>
<span id="section-cb159-2"><a href="#section-cb159-2" tabindex="-1"></a>kqx <span class="ot">&lt;-</span> kpx <span class="sc">*</span> qx[<span class="dv">30</span> <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="section-cb159-3"><a href="#section-cb159-3" tabindex="-1"></a>kqx</span></code></pre></div>
<pre><code>## [1] 0.0009397411</code></pre>
<div class="sourceCode" id="section-cb161"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb161-1"><a href="#section-cb161-1" tabindex="-1"></a><span class="co"># Discount factor</span></span>
<span id="section-cb161-2"><a href="#section-cb161-2" tabindex="-1"></a>discount_factor <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.01</span>) <span class="sc">^</span> <span class="sc">-</span> <span class="dv">11</span></span>
<span id="section-cb161-3"><a href="#section-cb161-3" tabindex="-1"></a>discount_factor</span></code></pre></div>
<pre><code>## [1] 0.8963237</code></pre>
<div class="sourceCode" id="section-cb163"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb163-1"><a href="#section-cb163-1" tabindex="-1"></a><span class="co"># EPV of the simple life insurance</span></span>
<span id="section-cb163-2"><a href="#section-cb163-2" tabindex="-1"></a><span class="dv">10000</span> <span class="sc">*</span> discount_factor <span class="sc">*</span> kqx</span></code></pre></div>
<pre><code>## [1] 8.423123</code></pre>
<div id="section-whole-temporary-and-deferred-life-insurance"
class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Whole, Temporary and
Deferred Life Insurance</h2>
<div id="section-function-to-find-epv-of-a-whole-life-insurance"
class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Function to find
EPV of a whole life Insurance</h3>
<div class="sourceCode" id="section-cb165"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb165-1"><a href="#section-cb165-1" tabindex="-1"></a><span class="co"># Define the whole life insurance function</span></span>
<span id="section-cb165-2"><a href="#section-cb165-2" tabindex="-1"></a>whole_life_insurance <span class="ot">&lt;-</span> <span class="cf">function</span>(age, i, life_table_2021) {</span>
<span id="section-cb165-3"><a href="#section-cb165-3" tabindex="-1"></a>  qx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>qx</span>
<span id="section-cb165-4"><a href="#section-cb165-4" tabindex="-1"></a>  px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> qx</span>
<span id="section-cb165-5"><a href="#section-cb165-5" tabindex="-1"></a>  kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">length</span>(px) <span class="sc">-</span> <span class="dv">1</span>)]))</span>
<span id="section-cb165-6"><a href="#section-cb165-6" tabindex="-1"></a>  kqx <span class="ot">&lt;-</span> kpx <span class="sc">*</span> qx[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(qx)]</span>
<span id="section-cb165-7"><a href="#section-cb165-7" tabindex="-1"></a>  discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(kqx))</span>
<span id="section-cb165-8"><a href="#section-cb165-8" tabindex="-1"></a>  <span class="fu">sum</span>(discount_factors <span class="sc">*</span> kqx, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="section-cb165-9"><a href="#section-cb165-9" tabindex="-1"></a>}</span>
<span id="section-cb165-10"><a href="#section-cb165-10" tabindex="-1"></a></span>
<span id="section-cb165-11"><a href="#section-cb165-11" tabindex="-1"></a><span class="co"># Function to plot EPV by age</span></span>
<span id="section-cb165-12"><a href="#section-cb165-12" tabindex="-1"></a>plot_by_age <span class="ot">&lt;-</span> <span class="cf">function</span>(life_table_2021, <span class="at">interest_rate =</span> <span class="fl">0.03</span>) {</span>
<span id="section-cb165-13"><a href="#section-cb165-13" tabindex="-1"></a>  ages <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>(<span class="fu">length</span>(life_table_2021<span class="sc">$</span>qx) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="section-cb165-14"><a href="#section-cb165-14" tabindex="-1"></a>  epvs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(ages, <span class="cf">function</span>(age) <span class="fu">whole_life_insurance</span>(age, interest_rate, life_table_2021))</span>
<span id="section-cb165-15"><a href="#section-cb165-15" tabindex="-1"></a>  <span class="fu">plot</span>(ages, epvs, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, </span>
<span id="section-cb165-16"><a href="#section-cb165-16" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;EPV of Whole Life Insurance by Age&quot;</span>, </span>
<span id="section-cb165-17"><a href="#section-cb165-17" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;EPV&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="section-cb165-18"><a href="#section-cb165-18" tabindex="-1"></a>}</span>
<span id="section-cb165-19"><a href="#section-cb165-19" tabindex="-1"></a></span>
<span id="section-cb165-20"><a href="#section-cb165-20" tabindex="-1"></a><span class="co"># Function to plot EPV by interest rate for a given age</span></span>
<span id="section-cb165-21"><a href="#section-cb165-21" tabindex="-1"></a>plot_by_interest_rate <span class="ot">&lt;-</span> <span class="cf">function</span>(life_table_2021, <span class="at">target_age =</span> <span class="dv">20</span>) {</span>
<span id="section-cb165-22"><a href="#section-cb165-22" tabindex="-1"></a>  interest_rates <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="section-cb165-23"><a href="#section-cb165-23" tabindex="-1"></a>  epvs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(interest_rates, <span class="cf">function</span>(i) <span class="fu">whole_life_insurance</span>(target_age, i, life_table_2021))</span>
<span id="section-cb165-24"><a href="#section-cb165-24" tabindex="-1"></a>  <span class="fu">plot</span>(interest_rates, epvs, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="section-cb165-25"><a href="#section-cb165-25" tabindex="-1"></a>       <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">&quot;EPV of Whole Life Insurance for Age&quot;</span>, target_age, <span class="st">&quot;by Interest Rate&quot;</span>), </span>
<span id="section-cb165-26"><a href="#section-cb165-26" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;Interest Rate&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;EPV&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="section-cb165-27"><a href="#section-cb165-27" tabindex="-1"></a>}</span>
<span id="section-cb165-28"><a href="#section-cb165-28" tabindex="-1"></a><span class="co"># Plot the EPV by age</span></span>
<span id="section-cb165-29"><a href="#section-cb165-29" tabindex="-1"></a><span class="fu">plot_by_age</span>(life_table_2021, <span class="at">interest_rate =</span> <span class="fl">0.03</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-74-1.png" width="672" /></p>
<div class="sourceCode" id="section-cb166"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb166-1"><a href="#section-cb166-1" tabindex="-1"></a><span class="co"># Plot the EPV by interest rate for age 20</span></span>
<span id="section-cb166-2"><a href="#section-cb166-2" tabindex="-1"></a><span class="fu">plot_by_interest_rate</span>(life_table_2021, <span class="at">target_age =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-74-2.png" width="672" /></p>
</div>
</div>
<div id="section-temporary-life-insurance" class="section level2"
number="5.2">
<h2><span class="header-section-number">5.2</span> Temporary Life
Insurance</h2>
<div
id="section-finding-the-epv-of-a-life-insurance-where-the-coverage-is-restricted-in-time-for-a-20-year-old-in-canada-in-2021-using-an-interest-rate-of-2"
class="section level4" number="5.2.0.1">
<h4><span class="header-section-number">5.2.0.1</span> Finding the EPV
of a life insurance where the coverage is restricted in time for a 20
year old in Canada in 2021 using an interest rate of 2%</h4>
<div class="sourceCode" id="section-cb167"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb167-1"><a href="#section-cb167-1" tabindex="-1"></a><span class="co"># EPV of a whole life insurance for (20) at interest rate 2% using life_table</span></span>
<span id="section-cb167-2"><a href="#section-cb167-2" tabindex="-1"></a><span class="fu">whole_life_insurance</span>(<span class="dv">20</span>, <span class="fl">0.02</span>, life_table_2021)</span></code></pre></div>
<pre><code>## [1] 0.301949</code></pre>
<div class="sourceCode" id="section-cb169"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb169-1"><a href="#section-cb169-1" tabindex="-1"></a><span class="co"># Function to compute the EPV of a temporary life insurance</span></span>
<span id="section-cb169-2"><a href="#section-cb169-2" tabindex="-1"></a>temporary_life_insurance <span class="ot">&lt;-</span> <span class="cf">function</span>(age, n, i, life_table_2021) {</span>
<span id="section-cb169-3"><a href="#section-cb169-3" tabindex="-1"></a>  qx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>qx</span>
<span id="section-cb169-4"><a href="#section-cb169-4" tabindex="-1"></a>  px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> qx</span>
<span id="section-cb169-5"><a href="#section-cb169-5" tabindex="-1"></a>  kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(age <span class="sc">+</span> n <span class="sc">-</span> <span class="dv">1</span>)]))</span>
<span id="section-cb169-6"><a href="#section-cb169-6" tabindex="-1"></a>  kqx <span class="ot">&lt;-</span> kpx <span class="sc">*</span> qx[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(age <span class="sc">+</span> n)]</span>
<span id="section-cb169-7"><a href="#section-cb169-7" tabindex="-1"></a>  discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(kqx))</span>
<span id="section-cb169-8"><a href="#section-cb169-8" tabindex="-1"></a>  <span class="fu">sum</span>(discount_factors <span class="sc">*</span> kqx)</span>
<span id="section-cb169-9"><a href="#section-cb169-9" tabindex="-1"></a>}</span>
<span id="section-cb169-10"><a href="#section-cb169-10" tabindex="-1"></a></span>
<span id="section-cb169-11"><a href="#section-cb169-11" tabindex="-1"></a><span class="co"># EPV of a temporary life insurance for (20) over a period of 45 years at interest rate 2% using life_table_2021</span></span>
<span id="section-cb169-12"><a href="#section-cb169-12" tabindex="-1"></a><span class="fu">temporary_life_insurance</span>(<span class="dv">20</span>, <span class="dv">45</span>, <span class="fl">0.02</span>, life_table_2021)</span></code></pre></div>
<pre><code>## [1] 0.059754</code></pre>
<div class="sourceCode" id="section-cb171"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb171-1"><a href="#section-cb171-1" tabindex="-1"></a><span class="co"># EPV of a whole life insurance for (20) at interest rate 2% using life_table</span></span>
<span id="section-cb171-2"><a href="#section-cb171-2" tabindex="-1"></a><span class="fu">whole_life_insurance</span>(<span class="dv">20</span>, <span class="fl">0.02</span>, life_table_2021)</span></code></pre></div>
<pre><code>## [1] 0.301949</code></pre>
</div>
</div>
<div id="section-deferred-life-insurance" class="section level2"
number="5.3">
<h2><span class="header-section-number">5.3</span> Deferred Life
Insurance</h2>
<div
id="section-calculating-epv-of-a-deferred-life-insurance-for-constant-interest-rate-on-age-x"
class="section level4" number="5.3.0.1">
<h4><span class="header-section-number">5.3.0.1</span> Calculating EPV
of a deferred life insurance for constant interest rate on age x</h4>
<div class="sourceCode" id="section-cb173"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb173-1"><a href="#section-cb173-1" tabindex="-1"></a><span class="co"># Function to compute the EPV of a deferred whole life insurance</span></span>
<span id="section-cb173-2"><a href="#section-cb173-2" tabindex="-1"></a>deferred_life_insurance <span class="ot">&lt;-</span> <span class="cf">function</span>(age, u, i, life_table_2021) {</span>
<span id="section-cb173-3"><a href="#section-cb173-3" tabindex="-1"></a>  qx <span class="ot">&lt;-</span> life_table_2021<span class="sc">$</span>qx;  px <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> qx</span>
<span id="section-cb173-4"><a href="#section-cb173-4" tabindex="-1"></a>  kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">length</span>(px) <span class="sc">-</span> <span class="dv">1</span>)]))</span>
<span id="section-cb173-5"><a href="#section-cb173-5" tabindex="-1"></a>  kqx <span class="ot">&lt;-</span> kpx <span class="sc">*</span> qx[(age <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(qx)]</span>
<span id="section-cb173-6"><a href="#section-cb173-6" tabindex="-1"></a>  discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(kqx))</span>
<span id="section-cb173-7"><a href="#section-cb173-7" tabindex="-1"></a>  benefits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, u), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(kpx) <span class="sc">-</span> u))</span>
<span id="section-cb173-8"><a href="#section-cb173-8" tabindex="-1"></a>  <span class="fu">sum</span>(benefits <span class="sc">*</span> discount_factors <span class="sc">*</span> kqx)</span>
<span id="section-cb173-9"><a href="#section-cb173-9" tabindex="-1"></a>}</span>
<span id="section-cb173-10"><a href="#section-cb173-10" tabindex="-1"></a></span>
<span id="section-cb173-11"><a href="#section-cb173-11" tabindex="-1"></a><span class="co"># EPV of a deferred life insurance for (20) deferred over 45 years at interest rate 2% using life_table_2021</span></span>
<span id="section-cb173-12"><a href="#section-cb173-12" tabindex="-1"></a><span class="fu">deferred_life_insurance</span>(<span class="dv">20</span>, <span class="dv">45</span>, <span class="fl">0.02</span>, life_table_2021)</span></code></pre></div>
<pre><code>## [1] 0.242195</code></pre>
</div>
<div
id="section-suppose-you-are-age-48-and-want-to-insure-a-benefit-of-40000-for-death-between-the-ages-of-55-and-75.-assume-interest-rate-is-5"
class="section level4" number="5.3.0.2">
<h4><span class="header-section-number">5.3.0.2</span> Suppose you are
age 48 and want to insure a benefit of 40000 for death between the ages
of 55 and 75. Assume interest rate is 5%</h4>
<div class="sourceCode" id="section-cb175"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb175-1"><a href="#section-cb175-1" tabindex="-1"></a><span class="co"># Deferred mortality probabilites of (48)</span></span>
<span id="section-cb175-2"><a href="#section-cb175-2" tabindex="-1"></a>kqx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(<span class="dv">48</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">73</span> <span class="sc">+</span> <span class="dv">1</span>)])) <span class="sc">*</span> qx[(<span class="dv">48</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">74</span> <span class="sc">+</span> <span class="dv">1</span>)]</span>
<span id="section-cb175-3"><a href="#section-cb175-3" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="section-cb175-4"><a href="#section-cb175-4" tabindex="-1"></a></span>
<span id="section-cb175-5"><a href="#section-cb175-5" tabindex="-1"></a><span class="co"># Discount factors</span></span>
<span id="section-cb175-6"><a href="#section-cb175-6" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(kqx))</span>
<span id="section-cb175-7"><a href="#section-cb175-7" tabindex="-1"></a></span>
<span id="section-cb175-8"><a href="#section-cb175-8" tabindex="-1"></a><span class="co"># Death benefits</span></span>
<span id="section-cb175-9"><a href="#section-cb175-9" tabindex="-1"></a>benefits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">7</span>), <span class="fu">rep</span>(<span class="dv">40000</span>, <span class="fu">length</span>(kqx) <span class="sc">-</span> <span class="dv">7</span>))</span>
<span id="section-cb175-10"><a href="#section-cb175-10" tabindex="-1"></a></span>
<span id="section-cb175-11"><a href="#section-cb175-11" tabindex="-1"></a><span class="co"># EPV of the death benefits</span></span>
<span id="section-cb175-12"><a href="#section-cb175-12" tabindex="-1"></a>EPV_death_benefits <span class="ot">&lt;-</span> <span class="fu">sum</span>(benefits <span class="sc">*</span> discount_factors <span class="sc">*</span> kqx)</span>
<span id="section-cb175-13"><a href="#section-cb175-13" tabindex="-1"></a>EPV_death_benefits</span></code></pre></div>
<pre><code>## [1] 2377.926</code></pre>
</div>
<div
id="section-now-suppose-you-want-to-add-a-savings-component-to-the-policy-that-will-add-80000-if-you-are-alive-at-age-75.-you-want-to-finance-this-endowment-insurance-with-constant-premiums."
class="section level4" number="5.3.0.3">
<h4><span class="header-section-number">5.3.0.3</span> Now suppose you
want to add a savings component to the policy that will add 80000 if you
are alive at age 75. You want to finance this endowment insurance with
constant premiums.</h4>
<div class="sourceCode" id="section-cb177"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb177-1"><a href="#section-cb177-1" tabindex="-1"></a><span class="co"># Pure endowment</span></span>
<span id="section-cb177-2"><a href="#section-cb177-2" tabindex="-1"></a>EPV_pure_endowment <span class="ot">&lt;-</span> <span class="dv">80000</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> <span class="dv">27</span> <span class="sc">*</span> <span class="fu">prod</span>(px[(<span class="dv">48</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">74</span> <span class="sc">+</span> <span class="dv">1</span>)])</span>
<span id="section-cb177-3"><a href="#section-cb177-3" tabindex="-1"></a>EPV_pure_endowment</span></code></pre></div>
<pre><code>## [1] 10614</code></pre>
<div class="sourceCode" id="section-cb179"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb179-1"><a href="#section-cb179-1" tabindex="-1"></a><span class="co"># Premium pattern</span></span>
<span id="section-cb179-2"><a href="#section-cb179-2" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(px[(<span class="dv">48</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">73</span> <span class="sc">+</span> <span class="dv">1</span>)]))</span>
<span id="section-cb179-3"><a href="#section-cb179-3" tabindex="-1"></a>discount_factors <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> i) <span class="sc">^</span> <span class="sc">-</span> (<span class="dv">0</span><span class="sc">:</span>(<span class="fu">length</span>(kpx) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="section-cb179-4"><a href="#section-cb179-4" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(kpx))</span>
<span id="section-cb179-5"><a href="#section-cb179-5" tabindex="-1"></a>EPV_rho <span class="ot">&lt;-</span> <span class="fu">sum</span>(rho <span class="sc">*</span> discount_factors <span class="sc">*</span> kpx)</span>
<span id="section-cb179-6"><a href="#section-cb179-6" tabindex="-1"></a>EPV_rho</span></code></pre></div>
<pre><code>## [1] 13.33744</code></pre>
<div class="sourceCode" id="section-cb181"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb181-1"><a href="#section-cb181-1" tabindex="-1"></a><span class="co"># Premium level</span></span>
<span id="section-cb181-2"><a href="#section-cb181-2" tabindex="-1"></a>(EPV_death_benefits <span class="sc">+</span> EPV_pure_endowment) <span class="sc">/</span> EPV_rho</span></code></pre></div>
<pre><code>## [1] 974.0947</code></pre>
</div>
</div>
<div id="section-shiny-app-for-life-insurance-calculator"
class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Shiny App for Life
Insurance Calculator</h2>
<div class="sourceCode" id="section-cb183"><pre
class="sourceCode r"><code class="sourceCode r"><span id="section-cb183-1"><a href="#section-cb183-1" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="section-cb183-2"><a href="#section-cb183-2" tabindex="-1"></a></span>
<span id="section-cb183-3"><a href="#section-cb183-3" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="section-cb183-4"><a href="#section-cb183-4" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Life Insurance Calculator&quot;</span>),</span>
<span id="section-cb183-5"><a href="#section-cb183-5" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="section-cb183-6"><a href="#section-cb183-6" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="section-cb183-7"><a href="#section-cb183-7" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;Age:&quot;</span>, <span class="dv">20</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">110</span>),</span>
<span id="section-cb183-8"><a href="#section-cb183-8" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">&quot;interest&quot;</span>, <span class="st">&quot;Interest Rate:&quot;</span>, <span class="fl">0.02</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="fl">0.2</span>, <span class="at">step =</span> <span class="fl">0.001</span>),</span>
<span id="section-cb183-9"><a href="#section-cb183-9" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="st">&quot;type&quot;</span>, <span class="st">&quot;Insurance Type:&quot;</span>, </span>
<span id="section-cb183-10"><a href="#section-cb183-10" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">&quot;Whole Life&quot;</span> <span class="ot">=</span> <span class="st">&quot;whole&quot;</span>, </span>
<span id="section-cb183-11"><a href="#section-cb183-11" tabindex="-1"></a>                              <span class="st">&quot;Temporary&quot;</span> <span class="ot">=</span> <span class="st">&quot;temp&quot;</span>, </span>
<span id="section-cb183-12"><a href="#section-cb183-12" tabindex="-1"></a>                              <span class="st">&quot;Deferred&quot;</span> <span class="ot">=</span> <span class="st">&quot;deferred&quot;</span>)),</span>
<span id="section-cb183-13"><a href="#section-cb183-13" tabindex="-1"></a>      <span class="fu">conditionalPanel</span>(</span>
<span id="section-cb183-14"><a href="#section-cb183-14" tabindex="-1"></a>        <span class="at">condition =</span> <span class="st">&quot;input.type == &#39;temp&#39; || input.type == &#39;deferred&#39;&quot;</span>,</span>
<span id="section-cb183-15"><a href="#section-cb183-15" tabindex="-1"></a>        <span class="fu">numericInput</span>(<span class="st">&quot;term&quot;</span>, <span class="st">&quot;Term/Deferment (years):&quot;</span>, <span class="dv">10</span>, <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">50</span>)</span>
<span id="section-cb183-16"><a href="#section-cb183-16" tabindex="-1"></a>      )</span>
<span id="section-cb183-17"><a href="#section-cb183-17" tabindex="-1"></a>    ),</span>
<span id="section-cb183-18"><a href="#section-cb183-18" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="section-cb183-19"><a href="#section-cb183-19" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">&quot;Expected Present Value:&quot;</span>),</span>
<span id="section-cb183-20"><a href="#section-cb183-20" tabindex="-1"></a>      <span class="fu">textOutput</span>(<span class="st">&quot;epv&quot;</span>)</span>
<span id="section-cb183-21"><a href="#section-cb183-21" tabindex="-1"></a>    )</span>
<span id="section-cb183-22"><a href="#section-cb183-22" tabindex="-1"></a>  )</span>
<span id="section-cb183-23"><a href="#section-cb183-23" tabindex="-1"></a>)</span>
<span id="section-cb183-24"><a href="#section-cb183-24" tabindex="-1"></a></span>
<span id="section-cb183-25"><a href="#section-cb183-25" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="section-cb183-26"><a href="#section-cb183-26" tabindex="-1"></a>  output<span class="sc">$</span>epv <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="section-cb183-27"><a href="#section-cb183-27" tabindex="-1"></a>    epv <span class="ot">&lt;-</span> <span class="cf">switch</span>(input<span class="sc">$</span>type,</span>
<span id="section-cb183-28"><a href="#section-cb183-28" tabindex="-1"></a>                  <span class="st">&quot;whole&quot;</span> <span class="ot">=</span> <span class="fu">whole_life_insurance</span>(input<span class="sc">$</span>age, input<span class="sc">$</span>interest, life_table),</span>
<span id="section-cb183-29"><a href="#section-cb183-29" tabindex="-1"></a>                  <span class="st">&quot;temp&quot;</span> <span class="ot">=</span> <span class="fu">temporary_life_insurance</span>(input<span class="sc">$</span>age, input<span class="sc">$</span>term, input<span class="sc">$</span>interest, life_table),</span>
<span id="section-cb183-30"><a href="#section-cb183-30" tabindex="-1"></a>                  <span class="st">&quot;deferred&quot;</span> <span class="ot">=</span> <span class="fu">deferred_life_insurance</span>(input<span class="sc">$</span>age, input<span class="sc">$</span>term, input<span class="sc">$</span>interest, life_table))</span>
<span id="section-cb183-31"><a href="#section-cb183-31" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;$&quot;</span>, <span class="fu">round</span>(epv, <span class="dv">2</span>))</span>
<span id="section-cb183-32"><a href="#section-cb183-32" tabindex="-1"></a>  })</span>
<span id="section-cb183-33"><a href="#section-cb183-33" tabindex="-1"></a>}</span>
<span id="section-cb183-34"><a href="#section-cb183-34" tabindex="-1"></a></span>
<span id="section-cb183-35"><a href="#section-cb183-35" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<iframe data-deferred-src="app0ea23567cf781ad5179a6eaecf3e3f1b/?w=&amp;__subapp__=1" width="100%" height="400" class="shiny-frame shiny-frame-deferred"></iframe>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#section-TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
